<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VoiceBank Recorder - ç€è¦½å™¨ç¯„ä¾‹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      max-width: 900px;
      width: 100%;
    }
    
    h1 {
      text-align: center;
      color: #667eea;
      margin-bottom: 10px;
      font-size: 2.5em;
    }
    
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1em;
    }
    
    .info-box {
      background: #f0f4ff;
      border-left: 4px solid #667eea;
      padding: 15px 20px;
      margin-bottom: 30px;
      border-radius: 5px;
    }
    
    .info-box h3 {
      color: #667eea;
      margin-bottom: 10px;
    }
    
    .info-box ul {
      list-style-position: inside;
      color: #555;
    }
    
    .info-box li {
      margin-bottom: 5px;
    }
    
    /* VoiceBank Recorder UI Styles */
    .voicebank-recorder {
      margin-top: 20px;
    }
    
    .recorder-controls {
      text-align: center;
      margin-bottom: 20px;
      padding: 20px;
      background: #f9fafb;
      border-radius: 10px;
    }
    
    .recorder-controls button {
      font-size: 16px;
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .btn-record {
      background: #ef4444;
      color: white;
    }
    
    .btn-record:hover:not(:disabled) {
      background: #dc2626;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
    }
    
    .btn-record.recording {
      background: #f59e0b;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .recording-info {
      margin-top: 15px;
      font-size: 14px;
      color: #666;
    }
    
    .recording-info span {
      margin: 0 10px;
    }
    
    .waveform-wrapper {
      margin: 20px 0;
    }
    
    .waveform-section {
      margin-bottom: 20px;
    }
    
    .waveform-section label {
      display: block;
      font-weight: 600;
      color: #555;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    .waveform-section canvas {
      display: block;
      width: 100%;
      height: auto;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: #f9fafb;
    }
    
    .playback-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      padding: 20px;
      background: #f9fafb;
      border-radius: 10px;
    }
    
    .playback-controls button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .btn-play {
      background: #10b981;
      color: white;
    }
    
    .btn-play:hover:not(:disabled) {
      background: #059669;
      transform: translateY(-2px);
    }
    
    .btn-pause {
      background: #f59e0b;
      color: white;
    }
    
    .btn-pause:hover:not(:disabled) {
      background: #d97706;
      transform: translateY(-2px);
    }
    
    .btn-stop {
      background: #ef4444;
      color: white;
    }
    
    .btn-pause:hover:not(:disabled) {
      background: #d97706;
      transform: translateY(-2px);
    }
    
    .btn-download {
      background: #667eea;
      color: white;
    }
    
    .btn-download:hover:not(:disabled) {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .playback-controls button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .toolbar {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }
    
    .toolbar button {
      padding: 10px 20px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: #555;
      transition: all 0.3s ease;
    }
    
    .toolbar button:hover:not(:disabled) {
      border-color: #667eea;
      color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }
    
    .toolbar button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .toolbar-btn {
      padding: 8px 16px;
      border: 1px solid #d0d0d0;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      color: #555;
      transition: all 0.2s ease;
    }
    
    .toolbar-btn:hover:not(:disabled) {
      border-color: #667eea;
      color: #667eea;
      background: #f0f4ff;
    }
    
    .toolbar-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .status-log {
      margin-top: 30px;
      padding: 20px;
      background: #1f2937;
      color: #10b981;
      border-radius: 10px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.8;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .status-log .log-entry {
      margin-bottom: 5px;
    }
    
    .status-log .log-time {
      color: #6b7280;
      margin-right: 10px;
    }
    
    .status-log .log-error {
      color: #ef4444;
    }
    
    .status-log .log-warning {
      color: #f59e0b;
    }
    
    .status-log .log-info {
      color: #3b82f6;
    }
    
    footer {
      margin-top: 30px;
      text-align: center;
      color: #999;
      font-size: 14px;
    }
    
    footer a {
      color: #667eea;
      text-decoration: none;
    }
    
    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ™ï¸ VoiceBank Recorder</h1>
    <p class="subtitle">è·¨å¹³å°éŸ³è¨ŠéŒ„éŸ³åº« - ç€è¦½å™¨ç¯„ä¾‹</p>
    
    <div class="info-box">
      <h3>ğŸ“‹ ä½¿ç”¨èªªæ˜</h3>
      <ul>
        <li><strong>é¦–æ¬¡ä½¿ç”¨è«‹é»æ“Šä¸‹æ–¹ã€Œå•Ÿå‹•éŸ³è¨Šç³»çµ±ã€æŒ‰éˆ•</strong>ï¼ˆç€è¦½å™¨å®‰å…¨è¦æ±‚ï¼‰</li>
        <li>å…è¨±ç€è¦½å™¨å­˜å–éº¥å…‹é¢¨æ¬Šé™</li>
        <li>é»æ“Šã€Œé–‹å§‹éŒ„éŸ³ã€æŒ‰éˆ•é–‹å§‹éŒ„è£½éŸ³è¨Š</li>
        <li>å³æ™‚æŸ¥çœ‹æ³¢å½¢å’ŒéŸ³é‡è¡¨</li>
        <li>é»æ“Šã€Œåœæ­¢éŒ„éŸ³ã€çµæŸéŒ„è£½</li>
        <li>ä½¿ç”¨æ’­æ”¾æ§åˆ¶æŒ‰éˆ•æ’­æ”¾éŒ„éŸ³</li>
      </ul>
    </div>
    
    <!-- å•Ÿå‹•æŒ‰éˆ• -->
    <div style="text-align: center; margin-bottom: 20px;">
      <button id="init-button" style="
        font-size: 18px;
        padding: 15px 40px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        transition: all 0.3s ease;
      " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.6)'" 
         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)'">
        ğŸ¤ å•Ÿå‹•éŸ³è¨Šç³»çµ±
      </button>
    </div>
    
    <!-- VoiceBank Recorder UI å°‡åœ¨é€™è£¡æ¸²æŸ“ -->
    <div id="voicebank-container" style="display: none;">
      <!-- éŒ„éŸ³æ§åˆ¶æŒ‰éˆ• -->
      <div class="recorder-controls">
        <button id="btn-record" class="btn-record">ğŸ™ï¸ é–‹å§‹éŒ„éŸ³</button>
        <button id="btn-stop" class="btn-stop" disabled>â¹ï¸ åœæ­¢éŒ„éŸ³</button>
      </div>
      
      <!-- æ³¢å½¢é¡¯ç¤ºå€åŸŸ -->
      <div class="waveforms">
        <div style="margin-bottom: 20px;">
          <h4 style="color: #667eea; margin-bottom: 10px;">å³æ™‚æ³¢å½¢</h4>
          <canvas id="vbr-live-waveform" width="800" height="120" style="border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb; display: block; width: 100%;"></canvas>
        </div>
        
        <div style="margin-bottom: 20px;">
          <h4 style="color: #667eea; margin-bottom: 10px;">éŸ³é‡è¡¨ (VU Meter)</h4>
          <canvas id="vbr-vu-meter" width="800" height="50" style="border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb; display: block; width: 100%;"></canvas>
        </div>
        
        <div style="margin-bottom: 20px;">
          <h4 style="color: #667eea; margin-bottom: 10px;">ç´¯ç©æ³¢å½¢ <span style="font-size: 12px; font-weight: normal; color: #888;">ï¼ˆå¯æ‹–æ›³å¹³ç§»ã€æ»¾è¼ªç¸®æ”¾ã€é»æ“Šå®šä½ï¼‰</span></h4>
          <canvas id="vbr-accumulated-waveform" width="800" height="200" style="border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb; display: block; width: 100%;"></canvas>
          <!-- ç´¯ç©æ³¢å½¢å·¥å…·åˆ— -->
          <div style="margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
            <button id="btn-zoom-in" class="toolbar-btn" disabled>æ”¾å¤§ +</button>
            <button id="btn-zoom-out" class="toolbar-btn" disabled>ç¸®å° âˆ’</button>
            <button id="btn-zoom-reset" class="toolbar-btn" disabled>é‡ç½®è¦–åœ–</button>
            <button id="btn-pan-left" class="toolbar-btn" disabled>â† å‘å·¦</button>
            <button id="btn-pan-right" class="toolbar-btn" disabled>å‘å³ â†’</button>
            <label style="margin-left: auto; display: flex; align-items: center; gap: 5px;">
              <input type="checkbox" id="chk-auto-scroll" checked>
              <span style="font-size: 13px;">è‡ªå‹•æ²å‹•</span>
            </label>
          </div>
        </div>
        
        <div style="margin-bottom: 20px;">
          <h4 style="color: #667eea; margin-bottom: 10px;">æ¦‚è¦½æ³¢å½¢ <span style="font-size: 12px; font-weight: normal; color: #888;">ï¼ˆé»æ“Šæˆ–æ‹–æ›³å¯å¿«é€Ÿå°èˆªï¼‰</span></h4>
          <canvas id="vbr-overview-waveform" width="800" height="80" style="border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb; display: block; width: 100%;"></canvas>
        </div>
      </div>
      
      <!-- é€²éšè¨­å®šé¢æ¿ -->
      <details style="margin: 20px 0; padding: 15px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px;">
        <summary style="cursor: pointer; font-weight: 600; color: #667eea; padding: 5px;">âš™ï¸ é€²éšè¨­å®š</summary>
        <div style="margin-top: 15px; display: grid; gap: 15px;">
          <!-- è£ç½®é¸æ“‡ -->
          <div>
            <label style="display: block; margin-bottom: 5px; font-weight: 500;">ğŸ¤ è¼¸å…¥è£ç½®ï¼ˆéº¥å…‹é¢¨ï¼‰</label>
            <div style="display: flex; gap: 8px; align-items: center;">
              <select id="mic-select" style="flex: 1; padding: 8px; border: 1px solid #d0d0d0; border-radius: 6px; font-size: 14px;" disabled>
                <option>è®€å–è£ç½®ä¸­...</option>
              </select>
              <button id="btn-refresh-mics" style="padding: 8px 12px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;" title="é‡æ–°æ•´ç†éº¥å…‹é¢¨æ¸…å–®">ğŸ”„</button>
            </div>
            <small id="mic-hint" style="color: #666; display: block; margin-top: 5px;">é¸æ“‡è¦ä½¿ç”¨çš„éº¥å…‹é¢¨è£ç½®</small>
          </div>
          
          <div>
            <label style="display: block; margin-bottom: 5px; font-weight: 500;">ğŸ”Š è¼¸å‡ºè£ç½®ï¼ˆæšè²å™¨ï¼‰</label>
            <div style="display: flex; gap: 8px; align-items: center;">
              <select id="spk-select" style="flex: 1; padding: 8px; border: 1px solid #d0d0d0; border-radius: 6px; font-size: 14px;" disabled>
                <option value="default">ç³»çµ±é è¨­è¼¸å‡º</option>
              </select>
              <button id="btn-refresh-outputs" style="padding: 8px 12px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;" title="é‡æ–°æ•´ç†è¼¸å‡ºè£ç½®æ¸…å–®">ğŸ”„</button>
            </div>
            <small id="spk-hint" style="color: #666; display: block; margin-top: 5px;">éƒ¨åˆ†ç€è¦½å™¨éœ€ HTTPS æ‰å¯åˆ‡æ›è¼¸å‡ºè£ç½®</small>
          </div>
          
          <!-- éº¥å…‹é¢¨å¢ç›Š -->
          <div>
            <label style="display: block; margin-bottom: 5px; font-weight: 500;">å‰ç´šå¢ç›Š (Mic Gain)</label>
            <div style="display: flex; align-items: center; gap: 10px;">
              <input type="range" id="mic-gain-slider" min="1" max="6" step="0.1" value="1.0" style="flex: 1;">
              <span id="mic-gain-value" style="min-width: 50px; font-weight: 600;">1.0x</span>
            </div>
            <small style="color: #666;">å¯æ”¹å–„éŸ³é‡åå°å•é¡Œï¼ˆå»ºè­°åœ¨éŒ„éŸ³å‰èª¿æ•´ï¼‰</small>
          </div>
          
          <!-- éŸ³è¨Šè¨­å®š -->
          <div>
            <label style="display: block; margin-bottom: 10px; font-weight: 500;">éŸ³è¨Šè™•ç†</label>
            <div style="display: flex; flex-wrap: wrap; gap: 15px;">
              <label style="display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="chk-agc">
                <span>è‡ªå‹•å¢ç›Šæ§åˆ¶ (AGC)</span>
              </label>
              <label style="display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="chk-echo-cancel">
                <span>å›éŸ³æ¶ˆé™¤</span>
              </label>
              <label style="display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="chk-noise-suppress">
                <span>å™ªéŸ³æŠ‘åˆ¶</span>
              </label>
            </div>
            <small style="color: #666;">é€™äº›é¸é …éœ€è¦åœ¨åˆå§‹åŒ–å‰è¨­å®šï¼ˆé‡æ–°å•Ÿå‹•éŸ³è¨Šç³»çµ±å¾Œç”Ÿæ•ˆï¼‰</small>
          </div>
          
          <!-- éŒ„éŸ³è³‡è¨Š -->
          <div id="recording-info" style="display: none;">
            <label style="display: block; margin-bottom: 5px; font-weight: 500;">éŒ„éŸ³è³‡è¨Š</label>
            <div style="background: white; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 13px;">
              <div>æ™‚é•·ï¼š<span id="info-duration">00:00.000</span></div>
              <div>æ¨£æœ¬æ•¸ï¼š<span id="info-samples">0</span></div>
              <div>æ¡æ¨£ç‡ï¼š<span id="info-samplerate">48000</span> Hz</div>
              <div>æª”æ¡ˆå¤§å°ï¼š<span id="info-filesize">0</span> KB</div>
            </div>
          </div>
        </div>
      </details>
      
      <!-- æ’­æ”¾æ§åˆ¶ -->
      <div class="playback-controls">
        <button id="btn-play" disabled>â–¶ æ’­æ”¾</button>
        <button id="btn-pause" disabled>â¸ æš«åœ</button>
        <button id="btn-download" class="btn-download" disabled>ğŸ’¾ ä¸‹è¼‰éŒ„éŸ³</button>
      </div>
    </div>
    
    <!-- ç‹€æ…‹æ—¥èªŒ -->
    <div class="status-log" id="status-log">
      <div class="log-entry">
        <span class="log-time">[00:00:00]</span>
        <span class="log-info">ğŸ“Š æº–å‚™åˆå§‹åŒ– VoiceBank Recorder...</span>
      </div>
    </div>
    
    <footer>
      <p>
        Built with â¤ï¸ using 
        <a href="https://github.com/cychiang-ntpu/simple-recordrtc-example" target="_blank">VoiceBank Recorder</a>
      </p>
      <p>æ”¯æ´å¹³å°ï¼šBrowser | Electron | Capacitor</p>
    </footer>
  </div>
  
  <!-- è¼‰å…¥ RecordRTC ä¾è³´ï¼ˆå¾ vendor ç›®éŒ„ï¼‰-->
  <script src="../../dist/vendor/RecordRTC.js"></script>
  
  <!-- è¼‰å…¥å»ºç½®å¾Œçš„ VoiceBank Recorder åº« -->
  <script src="../../dist/voicebank-recorder.min.js"></script>
  
  <script>
    // æ—¥èªŒå‡½æ•¸
    const logContainer = document.getElementById('status-log');
    
    function log(message, type = 'info') {
      const time = new Date().toLocaleTimeString('zh-TW');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `
        <span class="log-time">[${time}]</span>
        <span class="log-${type}">${message}</span>
      `;
      logContainer.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }
    
    // å…¨å±€è®Šæ•¸
    let audioEngine = null;
    let waveformRenderer = null;
    let recorderUI = null;
    let isInitialized = false;
    
    // åˆå§‹åŒ– VoiceBank Recorder
    async function initRecorder() {
      try {
        // éš±è—å•Ÿå‹•æŒ‰éˆ•
        const initButton = document.getElementById('init-button');
        if (initButton) {
          initButton.disabled = true;
          initButton.textContent = 'â³ æ­£åœ¨åˆå§‹åŒ–...';
        }
        
        log('ğŸ” æª¢æŸ¥ VoiceBankRecorder åº«...', 'info');
        
        if (typeof VoiceBankRecorder === 'undefined') {
          log('âŒ VoiceBankRecorder æœªè¼‰å…¥ï¼', 'error');
          return;
        }
        
        log('âœ“ VoiceBankRecorder å·²è¼‰å…¥', 'info');
        log(`âœ“ å¯ç”¨æ¨¡çµ„: ${Object.keys(VoiceBankRecorder).join(', ')}`, 'info');
        
        log(' å‰µå»º AudioEngine...', 'info');
        
        // å‰µå»º AudioEngine å¯¦ä¾‹
        audioEngine = new VoiceBankRecorder.AudioEngine({
          audioWorklet: false,  // æš«æ™‚ç¦ç”¨ AudioWorklet ä»¥ç°¡åŒ–æ¸¬è©¦
          sampleRate: 48000,
          channelCount: 1
        });
        
        log('âœ“ AudioEngine å‰µå»ºæˆåŠŸ', 'info');
        
        log('ğŸ”§ åˆå§‹åŒ– AudioEngine...', 'info');
        
        // åˆå§‹åŒ– AudioEngine
        await audioEngine.initialize();
        
        log('âœ“ AudioEngine åˆå§‹åŒ–å®Œæˆ', 'info');
        
        log('ğŸ¨ åˆå§‹åŒ– WaveformRenderer...', 'info');
        
        // æª¢æŸ¥ Canvas å…ƒç´ 
        const liveCanvas = document.getElementById('vbr-live-waveform');
        const vuMeterCanvas = document.getElementById('vbr-vu-meter');
        const accumulatedCanvas = document.getElementById('vbr-accumulated-waveform');
        const overviewCanvas = document.getElementById('vbr-overview-waveform');
        
        log(`âœ“ Canvas å…ƒç´ æª¢æŸ¥: live=${!!liveCanvas}, vu=${!!vuMeterCanvas}, acc=${!!accumulatedCanvas}, overview=${!!overviewCanvas}`, 'info');
        
        if (!liveCanvas || !vuMeterCanvas || !accumulatedCanvas || !overviewCanvas) {
          log('âŒ éƒ¨åˆ† Canvas å…ƒç´ æœªæ‰¾åˆ°ï¼', 'error');
          console.error('Canvas elements:', { liveCanvas, vuMeterCanvas, accumulatedCanvas, overviewCanvas });
        }
        
        // å‰µå»º WaveformRenderer å¯¦ä¾‹
        waveformRenderer = new VoiceBankRecorder.WaveformRenderer({
          liveCanvas: liveCanvas,
          vuMeterCanvas: vuMeterCanvas,
          accumulatedCanvas: accumulatedCanvas,
          overviewCanvas: overviewCanvas,
          audioEngine: audioEngine,
          useWorker: false  // æš«æ™‚ä¸ä½¿ç”¨ Worker
        });
        
        log('âœ“ WaveformRenderer å‰µå»ºæˆåŠŸ', 'info');
        
        log('ğŸ¨ åˆå§‹åŒ– WaveformRenderer çµ„ä»¶...', 'info');
        
        // åˆå§‹åŒ– WaveformRendererï¼ˆé€™æœƒå‰µå»ºå„å€‹æ³¢å½¢çµ„ä»¶ï¼‰
        await waveformRenderer.initialize();
        
        log('âœ“ WaveformRenderer åˆå§‹åŒ–å®Œæˆ', 'info');
        
        // è¨­ç½®æŒ‰éˆ•äº‹ä»¶
        setupButtons();
        
        log('âœ… VoiceBank Recorder åˆå§‹åŒ–å®Œæˆï¼', 'info');
        log('ğŸ‘‰ é»æ“Šã€Œé–‹å§‹éŒ„éŸ³ã€æŒ‰éˆ•é–‹å§‹éŒ„è£½', 'info');
        
        // é¡¯ç¤º UI å®¹å™¨
        document.getElementById('voicebank-container').style.display = 'block';
        
        // éš±è—å•Ÿå‹•æŒ‰éˆ•
        if (initButton) {
          initButton.style.display = 'none';
        }
        
        isInitialized = true;
        
        // å°‡å¯¦ä¾‹ä¿å­˜åˆ°å…¨å±€ï¼ˆæ–¹ä¾¿é™¤éŒ¯ï¼‰
        window.recorderUI = recorderUI;
        window.audioEngine = audioEngine;
        window.waveformRenderer = waveformRenderer;
        
      } catch (error) {
        log(`âŒ åˆå§‹åŒ–å¤±æ•—: ${error.message}`, 'error');
        console.error('Initialization error:', error);
        console.error('Error stack:', error.stack);
        
        // æ¢å¾©å•Ÿå‹•æŒ‰éˆ•
        const initButton = document.getElementById('init-button');
        if (initButton) {
          initButton.disabled = false;
          initButton.textContent = 'ğŸ¤ å•Ÿå‹•éŸ³è¨Šç³»çµ±ï¼ˆé‡è©¦ï¼‰';
        }
      }
    }
    
    // è¨­ç½®æŒ‰éˆ•äº‹ä»¶
    function setupButtons() {
      const btnRecord = document.getElementById('btn-record');
      const btnStop = document.getElementById('btn-stop');
      const btnPlay = document.getElementById('btn-play');
      const btnPause = document.getElementById('btn-pause');
      const btnDownload = document.getElementById('btn-download');
      
      // æ³¢å½¢å·¥å…·åˆ—æŒ‰éˆ•
      const btnZoomIn = document.getElementById('btn-zoom-in');
      const btnZoomOut = document.getElementById('btn-zoom-out');
      const btnZoomReset = document.getElementById('btn-zoom-reset');
      const btnPanLeft = document.getElementById('btn-pan-left');
      const btnPanRight = document.getElementById('btn-pan-right');
      const chkAutoScroll = document.getElementById('chk-auto-scroll');
      
      // Mic Gain æ»‘æ¡¿
      const micGainSlider = document.getElementById('mic-gain-slider');
      const micGainValue = document.getElementById('mic-gain-value');
      
      // Mic Gain èª¿æ•´
      micGainSlider.addEventListener('input', (e) => {
        const gain = parseFloat(e.target.value);
        micGainValue.textContent = gain.toFixed(1) + 'x';
        if (audioEngine && audioEngine.setMicGain) {
          audioEngine.setMicGain(gain);
          log(`ğŸšï¸ å¢ç›Šèª¿æ•´ç‚º ${gain.toFixed(1)}x`, 'info');
        }
      });
      
      // ç¸®æ”¾æ§åˆ¶
      btnZoomIn.addEventListener('click', () => {
        if (waveformRenderer && waveformRenderer.accumulatedWaveform) {
          waveformRenderer.accumulatedWaveform.zoomBySteps(1, 0.5);
          log('ğŸ” æ”¾å¤§æ³¢å½¢', 'info');
        }
      });
      
      btnZoomOut.addEventListener('click', () => {
        if (waveformRenderer && waveformRenderer.accumulatedWaveform) {
          waveformRenderer.accumulatedWaveform.zoomBySteps(-1, 0.5);
          log('ğŸ” ç¸®å°æ³¢å½¢', 'info');
        }
      });
      
      btnZoomReset.addEventListener('click', () => {
        if (waveformRenderer && waveformRenderer.accumulatedWaveform) {
          waveformRenderer.accumulatedWaveform.setZoom(1);
          waveformRenderer.accumulatedWaveform.isAutoScroll = true;
          chkAutoScroll.checked = true;
          log('ğŸ”„ é‡ç½®è¦–åœ–', 'info');
        }
      });
      
      // å¹³ç§»æ§åˆ¶
      btnPanLeft.addEventListener('click', () => {
        if (waveformRenderer && waveformRenderer.accumulatedWaveform) {
          const info = waveformRenderer.accumulatedWaveform.getVisibleSamples();
          waveformRenderer.accumulatedWaveform.panBySamples(-Math.floor(info.visible * 0.2));
          log('â—€ å‘å·¦ç§»å‹•', 'info');
        }
      });
      
      btnPanRight.addEventListener('click', () => {
        if (waveformRenderer && waveformRenderer.accumulatedWaveform) {
          const info = waveformRenderer.accumulatedWaveform.getVisibleSamples();
          waveformRenderer.accumulatedWaveform.panBySamples(Math.floor(info.visible * 0.2));
          log('â–¶ å‘å³ç§»å‹•', 'info');
        }
      });
      
      // è‡ªå‹•æ²å‹•é–‹é—œ
      chkAutoScroll.addEventListener('change', (e) => {
        if (waveformRenderer && waveformRenderer.accumulatedWaveform) {
          waveformRenderer.accumulatedWaveform.isAutoScroll = e.target.checked;
          log(e.target.checked ? 'âœ“ å•Ÿç”¨è‡ªå‹•æ²å‹•' : 'âœ— åœç”¨è‡ªå‹•æ²å‹•', 'info');
        }
      });
      
      // é–‹å§‹éŒ„éŸ³
      btnRecord.addEventListener('click', async () => {
        try {
          log('ğŸ™ï¸ é–‹å§‹éŒ„éŸ³...', 'info');
          
          // DeviceManager å·²ç¶“æ•´åˆåˆ° AudioEngine ä¸­ï¼Œæœƒè‡ªå‹•ä½¿ç”¨é¸æ“‡çš„éº¥å…‹é¢¨
          // ä¸éœ€è¦æ‰‹å‹•è¨­ç½® deviceId
          
          await audioEngine.startRecording();
          btnRecord.disabled = true;
          btnStop.disabled = false;
          log('âœ“ éŒ„éŸ³å·²é–‹å§‹', 'info');
        } catch (error) {
          log(`âŒ éŒ„éŸ³å¤±æ•—: ${error.message}`, 'error');
          console.error('Recording Error:', error);
        }
      });
      
      // åœæ­¢éŒ„éŸ³
      btnStop.addEventListener('click', async () => {
        try {
          log('â¹ï¸ åœæ­¢éŒ„éŸ³...', 'info');
          const blob = await audioEngine.stopRecording();
          btnRecord.disabled = false;
          btnStop.disabled = true;
          btnPlay.disabled = false;
          
          // å•Ÿç”¨æ³¢å½¢å·¥å…·åˆ—æŒ‰éˆ•
          btnZoomIn.disabled = false;
          btnZoomOut.disabled = false;
          btnZoomReset.disabled = false;
          btnPanLeft.disabled = false;
          btnPanRight.disabled = false;
          btnDownload.disabled = false;
          
          log(`âœ“ éŒ„éŸ³å·²åœæ­¢ - ${(blob.size / 1024).toFixed(2)} KB`, 'info');
          
          // æ›´æ–°éŒ„éŸ³è³‡è¨Š
          const recordingInfo = document.getElementById('recording-info');
          const duration = (audioEngine.recordStopTime - audioEngine.recordStartTime) / 1000;
          const samples = audioEngine.pcmTotalSamples || 0;
          const sampleRate = audioEngine.audioContext.sampleRate;
          
          document.getElementById('info-duration').textContent = formatDuration(duration);
          document.getElementById('info-samples').textContent = samples.toLocaleString();
          document.getElementById('info-samplerate').textContent = sampleRate.toLocaleString();
          document.getElementById('info-filesize').textContent = (blob.size / 1024).toFixed(2);
          recordingInfo.style.display = 'block';
          
          // æ¸…ç†èˆŠçš„éŸ³è¨Šè³‡æº
          if (audioPlayer) {
            audioPlayer.pause();
            audioPlayer.src = '';
            audioPlayer = null;
            log('ğŸ—‘ï¸ å·²æ¸…ç†èˆŠçš„æ’­æ”¾å™¨', 'info');
          }
          if (window.recordedUrl) {
            URL.revokeObjectURL(window.recordedUrl);
            log('ğŸ—‘ï¸ å·²é‡‹æ”¾èˆŠçš„éŸ³è¨Š URL', 'info');
          }
          
          // ä¿å­˜æ–°çš„ blob ä»¥ä¾¿æ’­æ”¾
          window.recordedBlob = blob;
          window.recordedUrl = URL.createObjectURL(blob);
          log('ğŸ’¾ æ–°çš„éŒ„éŸ³å·²æº–å‚™æ’­æ”¾', 'success');
        } catch (error) {
          log(`âŒ åœæ­¢å¤±æ•—: ${error.message}`, 'error');
          console.error('Stop Error:', error);
        }
      });
      
      // æ’­æ”¾éŒ„éŸ³
      let audioPlayer = null;
      
      btnPlay.addEventListener('click', async () => {
        try {
          if (!window.recordedUrl) {
            log('âŒ æ²’æœ‰å¯æ’­æ”¾çš„éŒ„éŸ³', 'error');
            return;
          }
          
          log('â–¶ï¸ æ’­æ”¾éŒ„éŸ³...', 'info');
          
          // æ¯æ¬¡æ’­æ”¾éƒ½é‡æ–°å‰µå»ºéŸ³è¨Šæ’­æ”¾å™¨ï¼Œç¢ºä¿ä½¿ç”¨æœ€æ–°çš„éŒ„éŸ³
          if (audioPlayer) {
            audioPlayer.pause();
            audioPlayer.src = '';
            audioPlayer = null;
          }
          
          audioPlayer = new Audio(window.recordedUrl);
          
          // è¨­ç½®äº‹ä»¶ç›£è½å™¨
          audioPlayer.addEventListener('ended', () => {
            btnPlay.disabled = false;
            btnPause.disabled = true;
            log('âœ“ æ’­æ”¾å®Œæˆ', 'info');
          });
          
          // ä½¿ç”¨ DeviceManager è¨­ç½®è¼¸å‡ºè£ç½®
          if (deviceManager) {
            try {
              await deviceManager.setAudioOutputDevice(audioPlayer);
              const selectedOutput = deviceManager.getSelectedOutputDevice();
              const outputName = selectedOutput ? selectedOutput.label : 'ç³»çµ±é è¨­';
              log(`ğŸ”Š ä½¿ç”¨è¼¸å‡ºè£ç½®: ${outputName}`, 'info');
            } catch (err) {
              console.warn('è¨­ç½®è¼¸å‡ºè£ç½®å¤±æ•—:', err);
              log('âš ï¸ è¨­ç½®è¼¸å‡ºè£ç½®å¤±æ•—ï¼Œä½¿ç”¨é è¨­è¼¸å‡º', 'warning');
            }
          }
          
          audioPlayer.play();
          btnPlay.disabled = true;
          btnPause.disabled = false;
          log('âœ“ æ’­æ”¾ä¸­', 'info');
        } catch (error) {
          log(`âŒ æ’­æ”¾å¤±æ•—: ${error.message}`, 'error');
          console.error('Play Error:', error);
        }
      });
      
      // æš«åœæ’­æ”¾
      btnPause.addEventListener('click', () => {
        try {
          if (!audioPlayer) {
            log('âŒ æ²’æœ‰æ­£åœ¨æ’­æ”¾çš„éŸ³è¨Š', 'error');
            return;
          }
          
          log('â¸ï¸ æš«åœæ’­æ”¾...', 'info');
          audioPlayer.pause();
          btnPlay.disabled = false;
          btnPause.disabled = true;
          log('âœ“ å·²æš«åœ', 'info');
        } catch (error) {
          log(`âŒ æš«åœå¤±æ•—: ${error.message}`, 'error');
          console.error('Pause Error:', error);
        }
      });
      
      // ä¸‹è¼‰éŒ„éŸ³
      btnDownload.addEventListener('click', () => {
        try {
          if (!window.recordedBlob) {
            log('âŒ æ²’æœ‰å¯ä¸‹è¼‰çš„éŒ„éŸ³', 'error');
            return;
          }
          
          const now = new Date();
          const timestamp = now.getFullYear() + 
                          String(now.getMonth() + 1).padStart(2, '0') + 
                          String(now.getDate()).padStart(2, '0') + '_' +
                          String(now.getHours()).padStart(2, '0') + 
                          String(now.getMinutes()).padStart(2, '0') + 
                          String(now.getSeconds()).padStart(2, '0');
          const filename = `voicebank_recording_${timestamp}.wav`;
          
          const url = window.recordedUrl;
          const a = document.createElement('a');
          a.style.display = 'none';
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          
          log(`ğŸ’¾ å·²ä¸‹è¼‰: ${filename}`, 'info');
        } catch (error) {
          log(`âŒ ä¸‹è¼‰å¤±æ•—: ${error.message}`, 'error');
          console.error('Download Error:', error);
        }
      });
    }
    
    // ============================================================
    // è£ç½®ç®¡ç†ï¼ˆä½¿ç”¨ DeviceManager APIï¼‰
    // ============================================================
    
    // ä½¿ç”¨ AudioEngine å…§å»ºçš„ DeviceManager
    let deviceManager = null;
    
    // åˆ—èˆ‰éº¥å…‹é¢¨è£ç½®
    async function populateMicDevices() {
      if (!deviceManager) return;
      
      const micSelect = document.getElementById('mic-select');
      const micHint = document.getElementById('mic-hint');
      
      if (!deviceManager.isSupported()) {
        micSelect.innerHTML = '<option>æ­¤ç€è¦½å™¨ä¸æ”¯æ´è£ç½®åˆ—èˆ‰</option>';
        micSelect.disabled = true;
        micHint.textContent = 'æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´åˆ—èˆ‰è£ç½®';
        return;
      }
      
      try {
        // ä½¿ç”¨ DeviceManager åˆ—èˆ‰éº¥å…‹é¢¨
        const microphones = await deviceManager.enumerateMicrophones();
        
        micSelect.innerHTML = '';
        
        if (microphones.length === 0) {
          micSelect.innerHTML = '<option>æœªåµæ¸¬åˆ°éº¥å…‹é¢¨</option>';
          micSelect.disabled = true;
          micHint.textContent = 'è«‹ç¢ºèªéº¥å…‹é¢¨å·²é€£æ¥ä¸¦æˆäºˆæ¬Šé™';
          return;
        }
        
        micSelect.disabled = false;
        
        microphones.forEach((device, index) => {
          const option = document.createElement('option');
          option.value = device.deviceId;
          option.textContent = device.label || `éº¥å…‹é¢¨ ${index + 1}`;
          micSelect.appendChild(option);
        });
        
        // æ¢å¾©ä¸Šæ¬¡é¸æ“‡
        const savedId = deviceManager.getSelectedMicrophoneId();
        log(`ğŸ’¾ å¾ localStorage è®€å–çš„éº¥å…‹é¢¨ ID: ${savedId || '(ç„¡)'}`, 'info');
        
        if (savedId && deviceManager.isDeviceAvailable(savedId, 'microphone')) {
          // ä¸Šæ¬¡çš„è£ç½®ä»ç„¶å¯ç”¨
          micSelect.value = savedId;
          const deviceLabel = micSelect.options[micSelect.selectedIndex].text;
          log(`âœ… æ¢å¾©ä¸Šæ¬¡é¸æ“‡çš„éº¥å…‹é¢¨: ${deviceLabel} (${savedId})`, 'success');
        } else {
          // ä¸Šæ¬¡çš„è£ç½®ä¸å¯ç”¨æˆ–æ²’æœ‰å„²å­˜çš„é¸æ“‡
          if (savedId) {
            log(`âš ï¸ ä¸Šæ¬¡é¸æ“‡çš„éº¥å…‹é¢¨ ${savedId} å·²ä¸å¯ç”¨`, 'warning');
          }
          
          if (microphones.length > 0) {
            // é¸æ“‡ç¬¬ä¸€å€‹å¯ç”¨çš„éº¥å…‹é¢¨ï¼Œä¸¦æ›´æ–° DeviceManager
            const firstDeviceId = microphones[0].deviceId;
            deviceManager.selectMicrophone(firstDeviceId, true); // å„²å­˜åˆ° localStorage
            micSelect.value = firstDeviceId;
            log(`ğŸ¤ é¸æ“‡é è¨­éº¥å…‹é¢¨: ${microphones[0].label} (${firstDeviceId})`, 'info');
          }
        }
        
        micHint.textContent = `æ‰¾åˆ° ${microphones.length} å€‹éº¥å…‹é¢¨è£ç½®`;
        log(`ğŸ“Š å·²åˆ—èˆ‰ ${microphones.length} å€‹éº¥å…‹é¢¨è£ç½®`, 'info');
      } catch (error) {
        console.error('åˆ—èˆ‰éº¥å…‹é¢¨å¤±æ•—:', error);
        micSelect.innerHTML = '<option>éœ€è¦éº¥å…‹é¢¨æ¬Šé™</option>';
        micSelect.disabled = true;
        micHint.textContent = 'è«‹æˆäºˆéº¥å…‹é¢¨æ¬Šé™å¾Œé‡æ–°æ•´ç†';
        log('âŒ åˆ—èˆ‰éº¥å…‹é¢¨å¤±æ•—: ' + error.message, 'error');
      }
    }
    
    // åˆ—èˆ‰è¼¸å‡ºè£ç½®
    async function populateOutputDevices() {
      if (!deviceManager) return;
      
      const spkSelect = document.getElementById('spk-select');
      const spkHint = document.getElementById('spk-hint');
      
      if (!deviceManager.isSupported()) {
        spkSelect.innerHTML = '<option value="default">ç³»çµ±é è¨­è¼¸å‡º</option>';
        spkSelect.disabled = true;
        spkHint.textContent = 'æ­¤ç€è¦½å™¨ä¸æ”¯æ´è¼¸å‡ºè£ç½®åˆ‡æ›';
        return;
      }
      
      try {
        // ä½¿ç”¨ DeviceManager åˆ—èˆ‰è¼¸å‡ºè£ç½®
        const outputs = await deviceManager.enumerateOutputDevices();
        
        spkSelect.innerHTML = '<option value="default">ç³»çµ±é è¨­è¼¸å‡º</option>';
        
        if (outputs.length === 0) {
          spkSelect.disabled = true;
          spkHint.textContent = 'æœªåµæ¸¬åˆ°è¼¸å‡ºè£ç½®æˆ–ç€è¦½å™¨ä¸æ”¯æ´';
          return;
        }
        
        spkSelect.disabled = false;
        
        outputs.forEach((device, index) => {
          const option = document.createElement('option');
          option.value = device.deviceId;
          option.textContent = device.label || `æšè²å™¨ ${index + 1}`;
          spkSelect.appendChild(option);
        });
        
        // æ¢å¾©ä¸Šæ¬¡é¸æ“‡
        const selectedId = deviceManager.getSelectedOutputDeviceId();
        if (selectedId) {
          spkSelect.value = selectedId;
        }
        
        spkHint.textContent = `æ‰¾åˆ° ${outputs.length} å€‹è¼¸å‡ºè£ç½®`;
        log(`ğŸ”Š å·²åˆ—èˆ‰ ${outputs.length} å€‹è¼¸å‡ºè£ç½®`, 'info');
      } catch (error) {
        console.error('åˆ—èˆ‰è¼¸å‡ºè£ç½®å¤±æ•—:', error);
        spkHint.textContent = 'åˆ—èˆ‰è¼¸å‡ºè£ç½®å¤±æ•—';
        log('âŒ åˆ—èˆ‰è¼¸å‡ºè£ç½®å¤±æ•—: ' + error.message, 'error');
      }
    }
    
    // è¨­ç½®è£ç½®é¸æ“‡äº‹ä»¶ç›£è½å™¨
    function setupDeviceListeners() {
      if (!deviceManager) return;
      
      const micSelect = document.getElementById('mic-select');
      const spkSelect = document.getElementById('spk-select');
      const btnRefreshMics = document.getElementById('btn-refresh-mics');
      const btnRefreshOutputs = document.getElementById('btn-refresh-outputs');
      
      // éº¥å…‹é¢¨é¸æ“‡è®Šæ›´
      if (micSelect) {
        micSelect.addEventListener('change', (e) => {
          const deviceId = e.target.value;
          const deviceLabel = e.target.options[e.target.selectedIndex].text;
          
          deviceManager.selectMicrophone(deviceId);
          
          log(`ğŸ¤ å·²é¸æ“‡éº¥å…‹é¢¨: ${deviceLabel}`, 'info');
          log(`ğŸ“ è£ç½® ID: ${deviceId}`, 'info');
          log('âš ï¸ è«‹é‡æ–°å•Ÿå‹•éŒ„éŸ³ä»¥å¥—ç”¨æ–°çš„éº¥å…‹é¢¨è¨­å®š', 'warning');
          
          // é©—è­‰é¸æ“‡æ˜¯å¦æˆåŠŸ
          const selectedId = deviceManager.getSelectedMicrophoneId();
          if (selectedId === deviceId) {
            log(`âœ“ DeviceManager å·²ç¢ºèªé¸æ“‡: ${selectedId}`, 'info');
          } else {
            log(`âŒ DeviceManager é¸æ“‡å¤±æ•—ï¼é æœŸ: ${deviceId}, å¯¦éš›: ${selectedId}`, 'error');
          }
        });
      }
      
      // è¼¸å‡ºè£ç½®é¸æ“‡è®Šæ›´
      if (spkSelect) {
        spkSelect.addEventListener('change', (e) => {
          deviceManager.selectOutputDevice(e.target.value);
          log(`ğŸ”Š å·²è¨­å®šè¼¸å‡ºè£ç½®: ${e.target.value === 'default' ? 'ç³»çµ±é è¨­' : e.target.options[e.target.selectedIndex].text}`, 'info');
        });
      }
      
      // é‡æ–°æ•´ç†éº¥å…‹é¢¨æ¸…å–®
      if (btnRefreshMics) {
        btnRefreshMics.addEventListener('click', () => {
          log('ğŸ”„ é‡æ–°æ•´ç†éº¥å…‹é¢¨æ¸…å–®...', 'info');
          populateMicDevices();
        });
      }
      
      // é‡æ–°æ•´ç†è¼¸å‡ºè£ç½®æ¸…å–®
      if (btnRefreshOutputs) {
        btnRefreshOutputs.addEventListener('click', () => {
          log('ğŸ”„ é‡æ–°æ•´ç†è¼¸å‡ºè£ç½®æ¸…å–®...', 'info');
          populateOutputDevices();
        });
      }
      
      // ç›£è½è£ç½®è®Šæ›´äº‹ä»¶ï¼ˆä½¿ç”¨ DeviceManager çš„äº‹ä»¶ç³»çµ±ï¼‰
      deviceManager.on('devicechange', ({ microphones, outputs }) => {
        log('ğŸ”Œ åµæ¸¬åˆ°è£ç½®è®Šæ›´ï¼Œè‡ªå‹•æ›´æ–°æ¸…å–®', 'info');
        populateMicDevices();
        populateOutputDevices();
      });
      
      // å•Ÿå‹•è£ç½®è®Šæ›´ç›£è½
      deviceManager.startDeviceChangeMonitoring();
    }
    
    // åœ¨åˆå§‹åŒ–å®Œæˆå¾Œåˆ—èˆ‰è£ç½®
    async function initializeDevices() {
      if (!audioEngine || !audioEngine.deviceManager) {
        log('âŒ DeviceManager å°šæœªåˆå§‹åŒ–', 'error');
        return;
      }
      
      // å–å¾— AudioEngine å…§å»ºçš„ DeviceManager
      deviceManager = audioEngine.deviceManager;
      
      log('ğŸ” æ­£åœ¨åˆ—èˆ‰éŸ³è¨Šè£ç½®...', 'info');
      await populateMicDevices();
      await populateOutputDevices();
      setupDeviceListeners();
    }
    
    // ä¿®æ”¹ initRecorder å‡½æ•¸ï¼Œåœ¨åˆå§‹åŒ–å®Œæˆå¾Œåˆ—èˆ‰è£ç½®
    const originalInitRecorder = initRecorder;
    initRecorder = async function() {
      await originalInitRecorder();
      if (isInitialized) {
        await initializeDevices();
      }
    };
    
    // æ ¼å¼åŒ–æ™‚é–“ç‚º MM:SS.mmm
    function formatDuration(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      const ms = Math.floor((seconds % 1) * 1000);
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}.${ms.toString().padStart(3, '0')}`;
    }
    
    // é é¢è¼‰å…¥å¾Œè¨­ç½®æŒ‰éˆ•äº‹ä»¶
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupInitButton);
    } else {
      setupInitButton();
    }
    
    function setupInitButton() {
      const initButton = document.getElementById('init-button');
      if (initButton) {
        initButton.addEventListener('click', initRecorder);
        log('ğŸ“Š æº–å‚™å°±ç·’ï¼Œè«‹é»æ“Šã€Œå•Ÿå‹•éŸ³è¨Šç³»çµ±ã€æŒ‰éˆ•é–‹å§‹', 'info');
      }
    }
  </script>
</body>
</html>
