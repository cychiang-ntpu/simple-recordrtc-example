{"version":3,"file":"voicebank-recorder.min.js","sources":["../src/core/WaveformRenderer.js","../src/storage/StorageAdapter.js","../src/index.js","../src/core/AudioEngine.js","../src/storage/CapacitorAdapter.js","../src/storage/ElectronAdapter.js","../src/storage/IndexedDBAdapter.js","../src/utils/PlatformDetector.js","../src/ui/RecorderUI.js","../src/storage/ServerAdapter.js","../src/storage/index.js"],"sourcesContent":["/**\n * WaveformRenderer.js\n * æ³¢å½¢æ¸²æŸ“æ¨¡çµ„ - æ•´åˆå³æ™‚æ³¢å½¢ã€ç´¯ç©æ³¢å½¢ã€æ¦‚è¦½æ³¢å½¢å’Œ VU Meter\n * \n * @module WaveformRenderer\n * @description æä¾›å®Œæ•´çš„æ³¢å½¢å¯è¦–åŒ–åŠŸèƒ½ï¼ŒåŒ…å«ï¼š\n * - LiveWaveform: å³æ™‚æ³¢å½¢é¡¯ç¤ºï¼ˆå¾ AnalyserNodeï¼‰\n * - VUMeter: éŸ³é‡è¡¨é¡¯ç¤ºï¼ˆRMS/Peak dBFSï¼‰\n * - AccumulatedWaveform: ç´¯ç©æ³¢å½¢ï¼ˆä½¿ç”¨ Worker åŠ é€Ÿï¼‰\n * - OverviewWaveform: å…¨å±€æ¦‚è¦½æ³¢å½¢\n */\n\n/**\n * WaveformRenderer - æ³¢å½¢æ¸²æŸ“ç®¡ç†å™¨\n * çµ±ä¸€ç®¡ç†æ‰€æœ‰æ³¢å½¢çµ„ä»¶çš„åˆå§‹åŒ–ã€æ›´æ–°å’ŒéŠ·æ¯€\n */\nexport class WaveformRenderer {\n    /**\n     * @param {Object} options - é…ç½®é¸é …\n     * @param {HTMLCanvasElement} options.liveCanvas - å³æ™‚æ³¢å½¢ Canvas\n     * @param {HTMLCanvasElement} options.vuMeterCanvas - VU Meter Canvas\n     * @param {HTMLCanvasElement} options.accumulatedCanvas - ç´¯ç©æ³¢å½¢ Canvas\n     * @param {HTMLCanvasElement} options.overviewCanvas - æ¦‚è¦½æ³¢å½¢ Canvas\n     * @param {AnalyserNode} options.analyserNode - Web Audio AnalyserNode\n     * @param {Object} options.audioEngine - AudioEngine å¯¦ä¾‹ï¼ˆå¯é¸ï¼Œæœƒè‡ªå‹•ç²å– analyserNodeï¼‰\n     * @param {string} [options.workerPath] - Worker è…³æœ¬è·¯å¾‘\n     * @param {boolean} [options.useWorker=true] - æ˜¯å¦ä½¿ç”¨ Worker\n     * @param {boolean} [options.showClipMarks=true] - æ˜¯å¦é¡¯ç¤ºå‰Šæ³¢æ¨™è¨˜\n     */\n    constructor(options = {}) {\n        this.options = {\n            workerPath: options.workerPath || 'workers/wf-worker.js',\n            useWorker: options.useWorker !== false,\n            showClipMarks: options.showClipMarks !== false,\n            ...options\n        };\n        \n        // æ”¯æ´å¾ audioEngine ç²å– analyserNode\n        this.audioEngine = options.audioEngine;\n        \n        this.liveWaveform = null;\n        this.vuMeter = null;\n        this.accumulatedWaveform = null;\n        this.overviewWaveform = null;\n        \n        this.isVerticalMode = false;\n        this._overviewUpdateScheduled = false;\n        \n        // å¦‚æœæä¾›äº† audioEngineï¼Œç›£è½éŒ„éŸ³äº‹ä»¶\n        if (this.audioEngine) {\n            this._setupAudioEngineListeners();\n        }\n    }\n    \n    /**\n     * è¨­ç½® AudioEngine äº‹ä»¶ç›£è½\n     * @private\n     */\n    _setupAudioEngineListeners() {\n        if (!this.audioEngine) return;\n        \n        // éŒ„éŸ³é–‹å§‹æ™‚è‡ªå‹•å•Ÿå‹•æ³¢å½¢\n        this.audioEngine.on('recording-start', () => {\n            this.start();\n        });\n        \n        // éŒ„éŸ³åœæ­¢æ™‚åœæ­¢æ³¢å½¢\n        this.audioEngine.on('recording-stop', () => {\n            this.stopLive();\n        });\n        \n        // PCM æ•¸æ“šåˆ°é”æ™‚æ›´æ–°ç´¯ç©æ³¢å½¢\n        this.audioEngine.on('data-available', (data) => {\n            if (data.pcmData && this.accumulatedWaveform) {\n                this.appendPCM(data.pcmData);\n            }\n        });\n    }\n    \n    /**\n     * åˆå§‹åŒ–æ‰€æœ‰æ³¢å½¢çµ„ä»¶\n     */\n    async initialize() {\n        const { liveCanvas, vuMeterCanvas, accumulatedCanvas, overviewCanvas } = this.options;\n        \n        // å¾ audioEngine æˆ– options ç²å– analyserNode\n        let analyserNode = this.options.analyserNode;\n        if (!analyserNode && this.audioEngine && typeof this.audioEngine.getAnalyser === 'function') {\n            analyserNode = this.audioEngine.getAnalyser();\n        }\n        \n        // åˆå§‹åŒ–å³æ™‚æ³¢å½¢\n        if (liveCanvas && analyserNode) {\n            this.liveWaveform = new LiveWaveform(liveCanvas, analyserNode);\n        }\n        \n        // åˆå§‹åŒ– VU Meter\n        if (vuMeterCanvas && analyserNode) {\n            this.vuMeter = new VUMeter(vuMeterCanvas, analyserNode);\n        }\n        \n        // åˆå§‹åŒ–ç´¯ç©æ³¢å½¢\n        if (accumulatedCanvas) {\n            this.accumulatedWaveform = new AccumulatedWaveform(accumulatedCanvas, {\n                workerPath: this.options.workerPath,\n                useWorker: this.options.useWorker,\n                showClipMarks: this.options.showClipMarks\n            });\n        }\n        \n        // åˆå§‹åŒ–æ¦‚è¦½æ³¢å½¢\n        if (overviewCanvas && this.accumulatedWaveform) {\n            this.overviewWaveform = new OverviewWaveform(overviewCanvas, this.accumulatedWaveform);\n        }\n    }\n    \n    /**\n     * é–‹å§‹å³æ™‚æ³¢å½¢é¡¯ç¤º\n     * @param {MediaStream} stream - éº¥å…‹é¢¨åª’é«”æµ\n     * @param {AudioContext} audioContext - Web Audio Context\n     * @param {GainNode} [preGainNode] - å‰ç´šå¢ç›Šç¯€é»ï¼ˆå¯é¸ï¼‰\n     */\n    startLive(stream, audioContext, preGainNode) {\n        if (this.liveWaveform) {\n            this.liveWaveform.start(stream, audioContext, preGainNode);\n        }\n        if (this.vuMeter) {\n            this.vuMeter.start();\n        }\n    }\n    \n    /**\n     * é–‹å§‹æ³¢å½¢é¡¯ç¤ºï¼ˆç°¡åŒ–ç‰ˆï¼Œå¾ audioEngine è‡ªå‹•ç²å–è³‡è¨Šï¼‰\n     */\n    start() {\n        if (!this.audioEngine) {\n            console.warn('No audioEngine provided, cannot start waveform rendering');\n            return;\n        }\n        \n        // ç²å–å¿…è¦è³‡è¨Š\n        const stream = this.audioEngine.microphoneStream;\n        const audioContext = this.audioEngine.audioContext;\n        const preGainNode = this.audioEngine.preGainNode;\n        \n        if (stream && audioContext) {\n            this.startLive(stream, audioContext, preGainNode);\n        }\n    }\n    \n    /**\n     * åœæ­¢å³æ™‚æ³¢å½¢é¡¯ç¤º\n     */\n    stopLive() {\n        if (this.liveWaveform) {\n            this.liveWaveform.stop();\n        }\n        if (this.vuMeter) {\n            this.vuMeter.stop();\n        }\n    }\n    \n    /**\n     * é™„åŠ  PCM æ•¸æ“šåˆ°ç´¯ç©æ³¢å½¢\n     * @param {Float32Array} pcmData - PCM éŸ³è¨Šæ•¸æ“š\n     */\n    appendPCM(pcmData) {\n        if (this.accumulatedWaveform) {\n            this.accumulatedWaveform.append(pcmData);\n            \n            // åŒæ™‚æ›´æ–° OverviewWaveform\n            if (this.overviewWaveform) {\n                // ä½¿ç”¨ requestAnimationFrame é¿å…éåº¦ç¹ªè£½\n                if (!this._overviewUpdateScheduled) {\n                    this._overviewUpdateScheduled = true;\n                    requestAnimationFrame(() => {\n                        if (this.overviewWaveform) {\n                            this.overviewWaveform.draw();\n                        }\n                        this._overviewUpdateScheduled = false;\n                    });\n                }\n            }\n        }\n    }\n    \n    /**\n     * é‡ç½®æ‰€æœ‰æ³¢å½¢\n     */\n    reset() {\n        if (this.accumulatedWaveform) {\n            this.accumulatedWaveform.reset();\n        }\n        if (this.overviewWaveform) {\n            this.overviewWaveform.clear();\n        }\n    }\n    \n    /**\n     * æ¸…é™¤æ‰€æœ‰æ³¢å½¢\n     */\n    clear() {\n        if (this.liveWaveform) {\n            this.liveWaveform.canvasContext.clearRect(0, 0, this.liveWaveform.width, this.liveWaveform.height);\n        }\n        if (this.vuMeter) {\n            this.vuMeter.clear();\n        }\n        if (this.accumulatedWaveform) {\n            this.accumulatedWaveform.clear();\n        }\n        if (this.overviewWaveform) {\n            this.overviewWaveform.clear();\n        }\n    }\n    \n    /**\n     * è¨­å®šå‚ç›´/æ°´å¹³æ¨¡å¼\n     * @param {boolean} isVertical - æ˜¯å¦ç‚ºå‚ç›´æ¨¡å¼\n     */\n    setVerticalMode(isVertical) {\n        this.isVerticalMode = isVertical;\n        \n        // é€šçŸ¥ Worker æ¨¡å¼è®Šæ›´\n        if (this.accumulatedWaveform && this.accumulatedWaveform._worker) {\n            this.accumulatedWaveform._worker.postMessage({\n                type: 'setVerticalMode',\n                verticalMode: isVertical\n            });\n        }\n    }\n    \n    /**\n     * èª¿æ•´ Canvas å°ºå¯¸\n     */\n    resize() {\n        if (this.liveWaveform) {\n            this.liveWaveform.width = this.liveWaveform.canvas.width;\n            this.liveWaveform.height = this.liveWaveform.canvas.height;\n        }\n        if (this.vuMeter) {\n            this.vuMeter.resize();\n        }\n        if (this.accumulatedWaveform) {\n            this.accumulatedWaveform.width = this.accumulatedWaveform.canvas.width;\n            this.accumulatedWaveform.height = this.accumulatedWaveform.canvas.height;\n            if (this.accumulatedWaveform._worker) {\n                this.accumulatedWaveform._worker.postMessage({\n                    type: 'resize',\n                    width: this.accumulatedWaveform.width,\n                    height: this.accumulatedWaveform.height\n                });\n            }\n            this.accumulatedWaveform.draw();\n        }\n        if (this.overviewWaveform) {\n            this.overviewWaveform.width = this.overviewWaveform.canvas.width;\n            this.overviewWaveform.height = this.overviewWaveform.canvas.height;\n            this.overviewWaveform.draw();\n        }\n    }\n    \n    /**\n     * éŠ·æ¯€æ‰€æœ‰çµ„ä»¶ï¼Œé‡‹æ”¾è³‡æº\n     */\n    destroy() {\n        this.stopLive();\n        \n        if (this.accumulatedWaveform && this.accumulatedWaveform._worker) {\n            this.accumulatedWaveform._worker.terminate();\n        }\n        \n        this.liveWaveform = null;\n        this.vuMeter = null;\n        this.accumulatedWaveform = null;\n        this.overviewWaveform = null;\n    }\n}\n\n/* ================================================================\n * LiveWaveform é¡ - å³æ™‚æ³¢å½¢é¡¯ç¤º\n * å¾ AnalyserNode å–å¾—æ™‚åŸŸæ•¸æ“šä¸¦å³æ™‚ç¹ªè£½æ³¢å½¢\n * æ”¯æ´æ°´å¹³å’Œå‚ç›´æ¨¡å¼\n * ================================================================ */\nexport class LiveWaveform {\n    constructor(canvas, analyserNode) {\n        this.canvas = canvas;\n        this.canvasContext = canvas.getContext('2d');\n        this.analyser = analyserNode;\n        this.mediaStreamSource = null;\n        this.animationId = null;\n        this.isRunning = false;\n\n        this.width = canvas.width;\n        this.height = canvas.height;\n\n        this.bufferLength = 0;\n        this.dataArray = null;\n        \n        this.amplification = 3.0;\n\n        this._lastDataArray = null;\n        this._verticalScrollOffset = 0;\n    }\n\n    /**\n     * é–‹å§‹å³æ™‚æ³¢å½¢é¡¯ç¤º\n     * @param {MediaStream} stream - éº¥å…‹é¢¨åª’é«”æµ\n     * @param {AudioContext} audioContext - Web Audio Context\n     * @param {GainNode} [preGainNode] - å‰ç´šå¢ç›Šç¯€é»ï¼ˆå¯é¸ï¼‰\n     */\n    start(stream, audioContext, preGainNode) {\n        if (this.isRunning || !audioContext || !this.analyser) {\n            console.warn('LiveWaveform.start() æ¢ä»¶ä¸æ»¿è¶³:', {\n                isRunning: this.isRunning,\n                hasAudioContext: !!audioContext,\n                hasAnalyser: !!this.analyser\n            });\n            return;\n        }\n\n        console.log('âœ… LiveWaveform é–‹å§‹å•Ÿå‹•...');\n        this.isRunning = true;\n        \n        const self = this;\n\n        // ç¢ºä¿ AudioContext è™•æ–¼é‹è¡Œç‹€æ…‹\n        let contextReady = Promise.resolve();\n        if (audioContext.state === 'suspended') {\n            contextReady = audioContext.resume().catch(function(err) {\n                console.warn('Unable to resume AudioContext:', err);\n            });\n        }\n\n        // ç­‰å¾… AudioContext å°±ç·’å¾Œå†é€£æ¥éº¥å…‹é¢¨\n        contextReady.then(function() {\n            // ç‚ºé¿å…é‡è¤‡é€£ç·šå…ˆæ¸…é™¤èˆŠçš„ source\n            if (self.mediaStreamSource) {\n                self.mediaStreamSource.disconnect();\n            }\n\n            // é€£æ¥éº¥å…‹é¢¨\n            self.mediaStreamSource = audioContext.createMediaStreamSource(stream);\n            if (preGainNode) {\n                try { \n                    self.mediaStreamSource.connect(preGainNode); \n                } catch(e) { \n                    console.warn('connect preGainNode failed', e); \n                }\n            } else {\n                self.mediaStreamSource.connect(self.analyser);\n            }\n\n            // è¨­å®š FFT åƒæ•¸\n            self.analyser.fftSize = 1024;\n            self.bufferLength = self.analyser.fftSize;\n            self.dataArray = new Uint8Array(self.bufferLength);\n\n            console.log('âœ… LiveWaveform éŸ³è¨Šé€£æ¥å®Œæˆï¼Œé–‹å§‹ç¹ªè£½');\n            \n            // ç«‹å³é–‹å§‹ç¹ªè£½\n            self.draw(false); // false = æ°´å¹³æ¨¡å¼\n        });\n    }\n\n    /**\n     * åœæ­¢å³æ™‚æ³¢å½¢é¡¯ç¤º\n     */\n    stop() {\n        if (!this.isRunning) return;\n        \n        this.isRunning = false;\n        \n        if (this.mediaStreamSource) {\n            this.mediaStreamSource.disconnect();\n            this.mediaStreamSource = null;\n        }\n\n        if (this.animationId) {\n            cancelAnimationFrame(this.animationId);\n            this.animationId = null;\n        }\n        \n        this.canvasContext.clearRect(0, 0, this.width, this.height);\n    }\n\n    /**\n     * ç¹ªè£½æ³¢å½¢ï¼ˆæŒçºŒæ›´æ–°ï¼‰\n     * @param {boolean} [isVertical=false] - æ˜¯å¦ç‚ºå‚ç›´æ¨¡å¼\n     */\n    draw(isVertical = false) {\n        if (!this.isRunning || !this.analyser || !this.dataArray) {\n            return;\n        }\n\n        this.animationId = requestAnimationFrame(() => this.draw(isVertical));\n\n        this.analyser.getByteTimeDomainData(this.dataArray);\n\n        if (!isVertical) {\n            // æ°´å¹³æ¨¡å¼\n            this.canvasContext.fillStyle = '#f0f0f0';\n            this.canvasContext.fillRect(0, 0, this.width, this.height);\n\n            this.canvasContext.lineWidth = 2;\n            this.canvasContext.strokeStyle = '#1E88E5';\n            this.canvasContext.beginPath();\n\n            const sliceWidth = this.width / this.bufferLength;\n            let x = 0;\n\n            for (let i = 0; i < this.bufferLength; i++) {\n                const v = (this.dataArray[i] / 128.0 - 1) * this.amplification;\n                const y = (v * this.height / 2) + (this.height / 2);\n\n                if (i === 0) {\n                    this.canvasContext.moveTo(x, y);\n                } else {\n                    this.canvasContext.lineTo(x, y);\n                }\n\n                x += sliceWidth;\n            }\n\n            this.canvasContext.lineTo(this.width, this.height / 2);\n            this.canvasContext.stroke();\n        } else {\n            // å‚ç›´æ¨¡å¼ï¼ˆæ»¾å‹•ç¹ªè£½ï¼‰\n            const scrollSpeed = 2;\n            this._verticalScrollOffset += scrollSpeed;\n            \n            if (this._verticalScrollOffset >= this.height) {\n                this._verticalScrollOffset = 0;\n                this.canvasContext.fillStyle = '#f0f0f0';\n                this.canvasContext.fillRect(0, 0, this.width, this.height);\n            }\n\n            this.canvasContext.lineWidth = 1.5;\n            this.canvasContext.strokeStyle = '#1E88E5';\n            this.canvasContext.beginPath();\n\n            const sliceHeight = this.height / this.bufferLength;\n            let y = 0;\n\n            for (let i = 0; i < this.bufferLength; i++) {\n                const v = (this.dataArray[i] / 128.0 - 1) * this.amplification;\n                const x = (v * this.width / 2) + (this.width / 2);\n\n                if (i === 0) {\n                    this.canvasContext.moveTo(x, y);\n                } else {\n                    this.canvasContext.lineTo(x, y);\n                }\n\n                y += sliceHeight;\n            }\n\n            this.canvasContext.stroke();\n        }\n    }\n}\n\n/* ================================================================\n * VUMeter é¡ - å³æ™‚éŸ³é‡ (RMS/Peak) é¡¯ç¤º\n * è¨ˆç®— RMS èˆ‡ Peakï¼Œè½‰æ›ç‚º dB å€¼ (-90dB ~ 0dB)\n * æä¾› peak hold åŠŸèƒ½ï¼šå³°å€¼ç¶­æŒä¸€æ®µæ™‚é–“å¾Œç·©é™\n * ================================================================ */\nexport class VUMeter {\n    constructor(canvas, analyserNode) {\n        this.canvas = canvas;\n        this.ctx = canvas.getContext('2d');\n        this.analyser = analyserNode;\n        this.bufferLength = 2048;\n        this.timeData = new Float32Array(this.bufferLength);\n        this.levelDb = -90;\n        this.peakDb = -90;\n        this.holdPeakDb = -90;\n        this.lastPeakTime = 0;\n        this.peakHoldMillis = 1500;\n        this.fallRateDbPerSec = 20;\n        this.minDb = -90;\n        this.maxDb = 0;\n        this.animationId = null;\n        this.lastClipTime = 0;\n        this.clipHoldMillis = 2000;\n        this._lastLogTime = 0;\n    }\n\n    _computeLevels() {\n        if (!this.analyser) return { rmsDb: this.minDb, peakDb: this.minDb };\n        \n        const required = this.analyser.fftSize || this.bufferLength;\n        if (this.timeData.length !== required) {\n            this.bufferLength = required;\n            this.timeData = new Float32Array(required);\n        }\n        \n        this.analyser.getFloatTimeDomainData(this.timeData);\n        let sumSquares = 0;\n        let peak = 0;\n        let clipped = false;\n        \n        for (let i = 0; i < this.bufferLength; i++) {\n            let v = this.timeData[i];\n            if (v > 1) v = 1;\n            else if (v < -1) v = -1;\n            sumSquares += v * v;\n            const absV = Math.abs(v);\n            if (absV > peak) peak = absV;\n            if (absV >= 0.995) clipped = true;\n        }\n        \n        const rms = Math.sqrt(sumSquares / this.bufferLength);\n        let rmsDb = rms > 0 ? 20 * Math.log10(rms) : -Infinity;\n        let peakDb = peak > 0 ? 20 * Math.log10(peak) : -Infinity;\n        \n        if (rmsDb < this.minDb) rmsDb = this.minDb;\n        if (rmsDb > this.maxDb) rmsDb = this.maxDb;\n        if (peakDb < this.minDb) peakDb = this.minDb;\n        if (peakDb > this.maxDb) peakDb = this.maxDb;\n        \n        if (clipped) {\n            this.lastClipTime = performance.now ? performance.now() : Date.now();\n        }\n        \n        return { rmsDb, peakDb };\n    }\n\n    resize() {\n        this.clear();\n    }\n\n    clear() {\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    draw(currentDb) {\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        \n        // èƒŒæ™¯\n        ctx.clearRect(0, 0, w, h);\n        const grd = ctx.createLinearGradient(0, 0, w, 0);\n        grd.addColorStop(0, '#2d3748');\n        grd.addColorStop(1, '#1a202c');\n        ctx.fillStyle = grd;\n        ctx.fillRect(0, 0, w, h);\n\n        // dB å°æ‡‰åˆ° 0~1\n        let norm = (currentDb - this.minDb) / (this.maxDb - this.minDb);\n        if (norm < 0) norm = 0;\n        if (norm > 1) norm = 1;\n\n        // å½©è‰²æ¼¸å±¤ (ç¶ ->é»ƒ->ç´…)\n        const barGrad = ctx.createLinearGradient(0, 0, w, 0);\n        barGrad.addColorStop(0, '#38a169');\n        barGrad.addColorStop(0.6, '#d69e2e');\n        barGrad.addColorStop(0.85, '#dd6b20');\n        barGrad.addColorStop(1, '#c53030');\n        ctx.fillStyle = barGrad;\n        const barWidth = Math.round(w * norm);\n        ctx.fillRect(0, 0, barWidth, h);\n\n        // åˆ»åº¦ç·š\n        ctx.save();\n        ctx.strokeStyle = 'rgba(255,255,255,0.15)';\n        ctx.lineWidth = 1;\n        ctx.beginPath();\n        \n        for (let db = this.minDb; db <= this.maxDb; db += 10) {\n            const posNorm = (db - this.minDb) / (this.maxDb - this.minDb);\n            const xPos = Math.round(w * posNorm) + 0.5;\n            \n            if (db === 0) {\n                ctx.strokeStyle = 'rgba(255,255,255,0.35)';\n                ctx.beginPath();\n                ctx.moveTo(xPos, 0);\n                ctx.lineTo(xPos, h);\n                ctx.stroke();\n                ctx.strokeStyle = 'rgba(255,255,255,0.15)';\n            } else {\n                ctx.moveTo(xPos, 0);\n                ctx.lineTo(xPos, h * 0.4);\n                ctx.moveTo(xPos, h);\n                ctx.lineTo(xPos, h * 0.6);\n            }\n            \n            if (db % 20 === 0 || db === -10) {\n                const label = db.toString();\n                ctx.fillStyle = (db === 0) ? '#ffffff' : (db === -10 ? '#ffeb3b' : '#cbd5e0');\n                ctx.font = '10px -apple-system,Segoe UI,sans-serif';\n                ctx.textAlign = 'center';\n                ctx.textBaseline = 'top';\n                ctx.fillText(label, xPos, 1);\n            }\n        }\n        ctx.restore();\n\n        // -10dBFS å€åŸŸé«˜äº®\n        const minus10Norm = (-10 - this.minDb) / (this.maxDb - this.minDb);\n        if (minus10Norm > 0 && minus10Norm < 1) {\n            const minus10X = Math.round(w * minus10Norm);\n            ctx.save();\n            ctx.fillStyle = 'rgba(255,235,59,0.08)';\n            ctx.fillRect(minus10X - 2, 0, 4, h);\n            ctx.restore();\n        }\n\n        // å³°å€¼ hold æŒ‡ç¤ºç·š\n        let holdNorm = (this.holdPeakDb - this.minDb) / (this.maxDb - this.minDb);\n        if (holdNorm < 0) holdNorm = 0;\n        if (holdNorm > 1) holdNorm = 1;\n        const holdX = Math.round(w * holdNorm);\n        ctx.strokeStyle = '#ffffff';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(holdX + 0.5, 0);\n        ctx.lineTo(holdX + 0.5, h);\n        ctx.stroke();\n\n        // æ–‡å­—é¡¯ç¤º\n        ctx.fillStyle = '#f0f0f0';\n        ctx.font = 'bold 12px -apple-system,Segoe UI,sans-serif';\n        ctx.textAlign = 'left';\n        ctx.textBaseline = 'middle';\n        const displayRms = currentDb <= this.minDb ? '-âˆ' : currentDb.toFixed(1);\n        const displayPeak = this.peakDb <= this.minDb ? '-âˆ' : this.peakDb.toFixed(1);\n        const txt = `RMS ${displayRms} dBFS   Peak ${displayPeak} dBFS`;\n        ctx.fillText(txt, 8, h / 2);\n\n        // CLIP æŒ‡ç¤º\n        const now = performance.now ? performance.now() : Date.now();\n        if (this.lastClipTime && (now - this.lastClipTime) < this.clipHoldMillis) {\n            ctx.save();\n            ctx.fillStyle = '#B00020';\n            const badgeW = 42, badgeH = 18;\n            ctx.fillRect(w - badgeW - 8, 4, badgeW, badgeH);\n            ctx.fillStyle = '#fff';\n            ctx.font = 'bold 12px -apple-system,Segoe UI,sans-serif';\n            ctx.textAlign = 'center';\n            ctx.textBaseline = 'middle';\n            ctx.fillText('CLIP', w - badgeW / 2 - 8, 4 + badgeH / 2 + 0.5);\n            ctx.restore();\n        }\n    }\n\n    update() {\n        const levels = this._computeLevels();\n        this.levelDb = levels.rmsDb;\n        this.peakDb = levels.peakDb;\n\n        const now = performance.now();\n        \n        // æ›´æ–° peak hold\n        if (this.peakDb > this.holdPeakDb + 0.5) {\n            this.holdPeakDb = this.peakDb;\n            this.lastPeakTime = now;\n        } else {\n            const elapsed = now - this.lastPeakTime;\n            if (elapsed > this.peakHoldMillis) {\n                const fallSeconds = (elapsed - this.peakHoldMillis) / 1000;\n                const fallAmount = this.fallRateDbPerSec * fallSeconds;\n                this.holdPeakDb = Math.max(this.peakDb, this.holdPeakDb - fallAmount);\n            }\n        }\n        \n        this.draw(this.levelDb);\n    }\n\n    start() {\n        this.stop();\n        \n        if (this.analyser) {\n            const required = this.analyser.fftSize || 2048;\n            if (this.timeData.length !== required) {\n                this.bufferLength = required;\n                this.timeData = new Float32Array(required);\n            }\n        }\n        \n        const self = this;\n        function loop() {\n            self.update();\n            self.animationId = requestAnimationFrame(loop);\n        }\n        loop();\n    }\n\n    stop() {\n        if (this.animationId) {\n            cancelAnimationFrame(this.animationId);\n            this.animationId = null;\n        }\n        this.clear();\n    }\n}\n\n/* ================================================================\n * AccumulatedWaveform é¡ - ç´¯ç©éŸ³è¨Šæ³¢å½¢é¡¯ç¤º\n * æŒçºŒç¹ªè£½ç›®å‰éŒ„è£½å®Œæˆçš„éŸ³è¨Šæ³¢å½¢\n * æ”¯æ´ OffscreenCanvas + Worker åŠ é€Ÿ\n * æ”¯æ´ç¸®æ”¾ã€å¹³ç§»ã€æ’­æ”¾ä½ç½®é¡¯ç¤º\n * ================================================================ */\nexport class AccumulatedWaveform {\n    constructor(canvas, options = {}) {\n        this.canvas = canvas;\n        this.canvasContext = null;\n        this.width = canvas.width;\n        this.height = canvas.height;\n\n        this.targetSampleRate = 5000;\n        this.sourceSampleRate = 48000;\n        this.decimationFactor = 10;\n\n        this.sampleMin = [];\n        this.sampleMax = [];\n        this.sampleCount = 0;\n\n        this.zoomFactor = 1;\n        this.viewStart = 0;\n        this.isAutoScroll = true;\n        this._panRemainder = 0;\n        \n        this.playbackPosition = 0;\n        this.isPlaying = false;\n        this.playbackStartTime = 0;\n        this.playbackStartSample = 0;\n\n        this.rawZoomMode = false;\n        this.rawViewStart = 0;\n        this.rawVisibleRaw = 0;\n\n        this._useWorker = options.useWorker !== false;\n        this._worker = null;\n        this._appendBatchMin = [];\n        this._appendBatchMax = [];\n        this._appendFlushScheduled = false;\n        this.lastDetail = null;\n        this.lastDensity = null;\n        \n        // å˜—è©¦ä½¿ç”¨ OffscreenCanvas + Worker\n        if (this._useWorker && canvas.transferControlToOffscreen && typeof Worker !== 'undefined') {\n            try {\n                const off = canvas.transferControlToOffscreen();\n                this._worker = new Worker(options.workerPath || 'workers/wf-worker.js');\n                \n                this._worker.postMessage({\n                    type: 'init',\n                    canvas: off,\n                    width: this.width,\n                    height: this.height,\n                    verticalMode: false,\n                    showClipMarks: options.showClipMarks !== false,\n                    sourceSampleRate: this.sourceSampleRate,\n                    decimationFactor: this.decimationFactor\n                }, [off]);\n                \n                const self = this;\n                this._worker.onmessage = function(ev) {\n                    const msg = ev.data;\n                    if (!msg) return;\n                    if (msg.type === 'detailUpdate') {\n                        self.lastDetail = msg.detail;\n                        self.lastDensity = msg.density;\n                    }\n                };\n            } catch(e) {\n                console.warn('OffscreenCanvas åˆå§‹åŒ–å¤±æ•—ï¼Œä½¿ç”¨ä¸»ç·šç¨‹ç¹ªè£½:', e);\n                this._useWorker = false;\n            }\n        } else {\n            this._useWorker = false;\n        }\n        \n        // å¦‚æœæ²’æœ‰ä½¿ç”¨ Workerï¼Œç²å– 2D context\n        if (!this._useWorker) {\n            try {\n                this.canvasContext = canvas.getContext('2d');\n            } catch(e) {\n                console.warn('ç„¡æ³•ç²å– canvas context:', e);\n            }\n        }\n        \n        // è¨­ç½®æ»‘é¼ äº’å‹•\n        this._setupMouseInteraction();\n        \n        this.clear();\n    }\n    \n    /**\n     * è¨­ç½®æ»‘é¼ äº’å‹•ï¼ˆå¹³ç§»ã€ç¸®æ”¾ã€é»æ“Šå®šä½ï¼‰\n     * @private\n     */\n    _setupMouseInteraction() {\n        if (!this.canvas) return;\n        \n        let isDragging = false;\n        let dragStartX = 0;\n        let dragStartViewStart = 0;\n        \n        // æ»‘é¼ æŒ‰ä¸‹\n        this.canvas.addEventListener('mousedown', (e) => {\n            isDragging = true;\n            dragStartX = e.offsetX;\n            dragStartViewStart = this.viewStart;\n            this.isAutoScroll = false;\n            this.canvas.style.cursor = 'grabbing';\n        });\n        \n        // æ»‘é¼ ç§»å‹•ï¼ˆæ‹–æ›³ï¼‰\n        this.canvas.addEventListener('mousemove', (e) => {\n            if (!isDragging) return;\n            \n            const deltaX = e.offsetX - dragStartX;\n            const info = this.getVisibleSamples();\n            const samplesPerPixel = info.visible / this.width;\n            const sampleDelta = Math.round(-deltaX * samplesPerPixel);\n            \n            this.viewStart = dragStartViewStart + sampleDelta;\n            this._enforceViewBounds();\n            this.draw();\n        });\n        \n        // æ»‘é¼ æ”¾é–‹\n        this.canvas.addEventListener('mouseup', () => {\n            if (isDragging) {\n                isDragging = false;\n                this.canvas.style.cursor = 'grab';\n            }\n        });\n        \n        // æ»‘é¼ é›¢é–‹ canvas\n        this.canvas.addEventListener('mouseleave', () => {\n            if (isDragging) {\n                isDragging = false;\n                this.canvas.style.cursor = 'default';\n            }\n        });\n        \n        // æ»‘é¼ æ»¾è¼ªï¼ˆç¸®æ”¾ï¼‰\n        this.canvas.addEventListener('wheel', (e) => {\n            e.preventDefault();\n            \n            // è¨ˆç®—æ»‘é¼ ä½ç½®ç›¸å°æ–¼ canvas çš„æ¯”ä¾‹\n            const rect = this.canvas.getBoundingClientRect();\n            const x = e.clientX - rect.left;\n            const anchorRatio = x / this.width;\n            \n            // æ ¹æ“šæ»¾è¼ªæ–¹å‘ç¸®æ”¾\n            const zoomSteps = e.deltaY > 0 ? -1 : 1;\n            this.zoomBySteps(zoomSteps, anchorRatio);\n        });\n        \n        // é»æ“Šå®šä½ï¼ˆè·³åˆ°æ’­æ”¾ä½ç½®ï¼‰\n        this.canvas.addEventListener('click', (e) => {\n            if (isDragging) return; // å¦‚æœæ˜¯æ‹–æ›³çµæŸï¼Œä¸è§¸ç™¼é»æ“Š\n            \n            const info = this.getVisibleSamples();\n            const clickRatio = e.offsetX / this.width;\n            const clickedSample = Math.floor(info.start + clickRatio * info.visible);\n            \n            // è§¸ç™¼è‡ªå®šç¾©äº‹ä»¶ï¼Œè®“å¤–éƒ¨è™•ç†æ’­æ”¾è·³è½‰\n            const event = new CustomEvent('waveform-seek', {\n                detail: {\n                    sample: clickedSample,\n                    time: clickedSample / this.sourceSampleRate\n                }\n            });\n            this.canvas.dispatchEvent(event);\n        });\n        \n        // è¨­ç½® cursor æ¨£å¼\n        this.canvas.style.cursor = 'grab';\n    }\n\n    clear() {\n        if (this._useWorker && this._worker) {\n            this._worker.postMessage({ type: 'reset' });\n            return;\n        }\n        if (!this.canvasContext) return;\n        \n        this.canvasContext.clearRect(0, 0, this.width, this.height);\n        this.canvasContext.fillStyle = '#f0f0f0';\n        this.canvasContext.fillRect(0, 0, this.width, this.height);\n        this.canvasContext.lineWidth = 1;\n        this.canvasContext.strokeStyle = '#d0d0d0';\n        this.canvasContext.beginPath();\n        this.canvasContext.moveTo(0, this.height / 2);\n        this.canvasContext.lineTo(this.width, this.height / 2);\n        this.canvasContext.stroke();\n    }\n\n    reset() {\n        this.sampleMin.length = 0;\n        this.sampleMax.length = 0;\n        this.sampleCount = 0;\n        this.zoomFactor = 1;\n        this.viewStart = 0;\n        this.isAutoScroll = true;\n        this._panRemainder = 0;\n        this.clear();\n    }\n\n    append(audioSamples) {\n        if (!audioSamples || !audioSamples.length) {\n            return;\n        }\n\n        const factor = this.decimationFactor;\n        const total = audioSamples.length;\n        const appendedMin = [];\n        const appendedMax = [];\n        \n        // æ¯ç§’è¨˜éŒ„ä¸€æ¬¡\n        if (!this._lastAppendLog) this._lastAppendLog = 0;\n        const now = Date.now();\n        if (now - this._lastAppendLog > 1000) {\n            console.log('ğŸ“ˆ AccumulatedWaveform.append():', total, 'æ¨£æœ¬ â†’', \n                        Math.floor(total / factor), 'å€å¡Š');\n            this._lastAppendLog = now;\n        }\n        \n        for (let i = 0; i < total; i += factor) {\n            let blockMin = 1.0;\n            let blockMax = -1.0;\n            let blockSum = 0;\n            let blockCount = 0;\n\n            for (let j = 0; j < factor && (i + j) < total; j++) {\n                const sample = audioSamples[i + j];\n                blockSum += sample;\n                blockCount++;\n            }\n\n            const blockMean = blockCount ? (blockSum / blockCount) : 0;\n\n            for (let k = 0; k < blockCount; k++) {\n                const centeredSample = audioSamples[i + k] - blockMean;\n                if (centeredSample < blockMin) {\n                    blockMin = centeredSample;\n                }\n                if (centeredSample > blockMax) {\n                    blockMax = centeredSample;\n                }\n            }\n\n            if (!blockCount) {\n                continue;\n            }\n\n            if (blockMin > blockMax) {\n                blockMin = blockMax = 0;\n            }\n\n            this.sampleMin.push(blockMin);\n            this.sampleMax.push(blockMax);\n            appendedMin.push(blockMin);\n            appendedMax.push(blockMax);\n            this.sampleCount++;\n        }\n\n        if (this.isAutoScroll) {\n            this.scrollToLatest();\n        } else {\n            this._enforceViewBounds();\n        }\n\n        if (this._useWorker && this._worker) {\n            this._appendBatchMin.push(...appendedMin);\n            this._appendBatchMax.push(...appendedMax);\n            if (!this._appendFlushScheduled) {\n                this._appendFlushScheduled = true;\n                const self = this;\n                const flush = () => self._flushAppendBatch();\n                if (typeof requestAnimationFrame === 'function') {\n                    requestAnimationFrame(flush);\n                } else {\n                    setTimeout(flush, 32);\n                }\n            }\n        }\n        \n        this.draw();\n    }\n\n    _flushAppendBatch() {\n        if (!this._worker || this._appendBatchMin.length === 0) {\n            this._appendFlushScheduled = false;\n            return;\n        }\n        \n        this._worker.postMessage({\n            type: 'append',\n            minArr: this._appendBatchMin,\n            maxArr: this._appendBatchMax\n        });\n        \n        this._appendBatchMin = [];\n        this._appendBatchMax = [];\n        this._appendFlushScheduled = false;\n    }\n\n    draw() {\n        if (this._useWorker && this._worker) {\n            this._worker.postMessage({\n                type: 'draw',\n                zoomFactor: this.zoomFactor,\n                viewStart: this.viewStart,\n                playbackPosition: this.playbackPosition,\n                isPlaying: this.isPlaying\n            });\n            return;\n        }\n        \n        if (!this.canvasContext) return;\n        \n        // ä¸»ç·šç¨‹ç¹ªè£½\n        this.clear();\n        \n        const total = this.sampleMin.length;\n        if (!total) return;\n        \n        const visibleSamples = Math.min(total, Math.round(total / this.zoomFactor));\n        const start = Math.min(this.viewStart, Math.max(0, total - visibleSamples));\n        const end = Math.min(total, start + visibleSamples);\n        const centerY = this.height / 2;\n        \n        // ç¹ªè£½æ³¢å½¢ - æ‰¹æ¬¡è™•ç†\n        this.canvasContext.strokeStyle = '#1E88E5';\n        this.canvasContext.lineWidth = 1;\n        this.canvasContext.beginPath();\n        \n        for (let i = start; i < end; i++) {\n            const x = Math.floor(((i - start) / visibleSamples) * this.width) + 0.5;\n            const yMin = Math.floor(centerY - (this.sampleMax[i] * centerY * 0.95));\n            const yMax = Math.floor(centerY - (this.sampleMin[i] * centerY * 0.95));\n            \n            // ç¹ªè£½å‚ç›´ç·šæ®µ\n            this.canvasContext.moveTo(x, yMin);\n            this.canvasContext.lineTo(x, yMax);\n        }\n        \n        this.canvasContext.stroke();\n        \n        // ç¹ªè£½ä¸­ç·š\n        this.canvasContext.strokeStyle = '#d0d0d0';\n        this.canvasContext.lineWidth = 1;\n        this.canvasContext.beginPath();\n        this.canvasContext.moveTo(0, centerY + 0.5);\n        this.canvasContext.lineTo(this.width, centerY + 0.5);\n        this.canvasContext.stroke();\n    }\n\n    getVisibleSamples() {\n        const total = this.sampleCount;\n        if (total === 0) return { start: 0, end: 0, visible: 0 };\n        \n        const minVis = this._getMinVisibleSamples(total);\n        let visible = Math.max(minVis, Math.round(total / this.zoomFactor));\n        if (visible > total) visible = total;\n        \n        let start = this.viewStart;\n        if (start + visible > total) start = total - visible;\n        if (start < 0) start = 0;\n        \n        const end = Math.min(total, start + visible);\n        return { start, end, visible };\n    }\n\n    _getMinVisibleSamples(total) {\n        return Math.max(1, Math.floor(this.width / 2));\n    }\n\n    _enforceViewBounds() {\n        const info = this.getVisibleSamples();\n        this.viewStart = info.start;\n    }\n\n    scrollToLatest() {\n        const total = this.sampleCount;\n        if (total === 0) return;\n        \n        const minVis = this._getMinVisibleSamples(total);\n        let visible = Math.max(minVis, Math.round(total / this.zoomFactor));\n        if (visible > total) visible = total;\n        \n        this.viewStart = total - visible;\n        if (this.viewStart < 0) this.viewStart = 0;\n    }\n\n    setZoom(targetZoom, anchorSample) {\n        if (targetZoom < 1) targetZoom = 1;\n        const maxZoom = Math.max(1, this.sampleCount / this._getMinVisibleSamples(this.sampleCount));\n        if (targetZoom > maxZoom) targetZoom = maxZoom;\n        \n        const oldInfo = this.getVisibleSamples();\n        this.zoomFactor = targetZoom;\n        const newInfo = this.getVisibleSamples();\n        \n        if (typeof anchorSample === 'number' && anchorSample >= 0) {\n            const oldRatio = (anchorSample - oldInfo.start) / oldInfo.visible;\n            const desiredStart = anchorSample - oldRatio * newInfo.visible;\n            this.viewStart = Math.max(0, Math.min(this.sampleCount - newInfo.visible, desiredStart));\n        }\n        \n        this._enforceViewBounds();\n        this.draw();\n    }\n\n    zoomBySteps(stepCount, anchorRatio = 0.5) {\n        if (stepCount === 0) return;\n        \n        const zoomStep = 1.2;\n        const oldInfo = this.getVisibleSamples();\n        const anchorSample = oldInfo.start + anchorRatio * oldInfo.visible;\n        \n        let newZoom = this.zoomFactor;\n        if (stepCount > 0) {\n            newZoom *= Math.pow(zoomStep, stepCount);\n        } else {\n            newZoom /= Math.pow(zoomStep, -stepCount);\n        }\n        \n        this.setZoom(newZoom, anchorSample);\n    }\n\n    panBySamples(sampleDelta) {\n        if (sampleDelta === 0) return;\n        \n        this.isAutoScroll = false;\n        this.viewStart += sampleDelta;\n        this._enforceViewBounds();\n        this.draw();\n    }\n\n    panByPixels(pixelDelta) {\n        if (pixelDelta === 0) return;\n        \n        const info = this.getVisibleSamples();\n        const samplesPerPixel = info.visible / this.width;\n        const totalDelta = pixelDelta * samplesPerPixel + this._panRemainder;\n        const intDelta = Math.round(totalDelta);\n        this._panRemainder = totalDelta - intDelta;\n        \n        this.panBySamples(intDelta);\n    }\n\n    resetView() {\n        this.zoomFactor = 1;\n        this.viewStart = 0;\n        this.isAutoScroll = true;\n        this._panRemainder = 0;\n        this.scrollToLatest();\n        this.draw();\n    }\n\n    setSourceSampleRate(sampleRate) {\n        this.sourceSampleRate = sampleRate || 48000;\n        this.decimationFactor = Math.max(1, Math.round(this.sourceSampleRate / this.targetSampleRate));\n        \n        if (this._worker) {\n            this._worker.postMessage({\n                type: 'setSampleRate',\n                sourceSampleRate: this.sourceSampleRate,\n                decimationFactor: this.decimationFactor\n            });\n        }\n    }\n\n    _getSamplePair(index) {\n        if (index < 0 || index >= this.sampleCount) {\n            return { min: 0, max: 0 };\n        }\n        return {\n            min: this.sampleMin[index],\n            max: this.sampleMax[index]\n        };\n    }\n\n    setPlaybackPosition(sampleIndex) {\n        this.playbackPosition = sampleIndex;\n        this.draw();\n    }\n\n    setRawZoomMode(enabled) {\n        this.rawZoomMode = !!enabled;\n    }\n\n    startPlayback(startSample, sampleRate) {\n        this.isPlaying = true;\n        this.playbackStartSample = startSample || 0;\n        this.playbackStartTime = performance.now ? performance.now() : Date.now();\n        this.playbackPosition = this.playbackStartSample;\n        \n        const self = this;\n        const sr = sampleRate || this.sourceSampleRate;\n        \n        function updatePosition() {\n            if (!self.isPlaying) return;\n            \n            const now = performance.now ? performance.now() : Date.now();\n            const elapsed = (now - self.playbackStartTime) / 1000;\n            const rawSamples = elapsed * sr;\n            const decimatedPos = self.playbackStartSample + Math.floor(rawSamples / self.decimationFactor);\n            \n            self.playbackPosition = decimatedPos;\n            self.draw();\n            \n            requestAnimationFrame(updatePosition);\n        }\n        \n        requestAnimationFrame(updatePosition);\n    }\n\n    stopPlayback() {\n        this.isPlaying = false;\n        this.playbackPosition = 0;\n        this.draw();\n    }\n\n    _updatePlaybackPosition() {\n        if (!this.isPlaying) return;\n        \n        const now = performance.now ? performance.now() : Date.now();\n        const elapsed = (now - this.playbackStartTime) / 1000;\n        const rawSamples = elapsed * this.sourceSampleRate;\n        const decimatedPos = this.playbackStartSample + Math.floor(rawSamples / this.decimationFactor);\n        \n        this.playbackPosition = decimatedPos;\n    }\n}\n\n/* ================================================================\n * OverviewWaveform é¡ - å…¨å±€æ³¢å½¢æ¦‚è¦½\n * é¡¯ç¤ºæ•´å€‹éŒ„éŸ³çš„æ³¢å½¢æ¦‚è¦½ï¼Œä¸¦æ¨™ç¤ºç•¶å‰å¯è¦–ç¯„åœ\n * ================================================================ */\nexport class OverviewWaveform {\n    constructor(canvas, accumulatedWaveform) {\n        this.canvas = canvas;\n        this.ctx = canvas.getContext('2d');\n        this.accumulatedWaveform = accumulatedWaveform;\n        this.width = canvas.width;\n        this.height = canvas.height;\n        \n        // æš«æ™‚ç¦ç”¨ Worker æ¨¡å¼ï¼Œä½¿ç”¨ä¸»ç·šç¨‹ç¹ªè£½\n        this._useWorker = false;\n        this._workerRef = null;\n        this._warnedNoData = false;\n        this._lastTotal = 0;\n        \n        // è¨­ç½®æ»‘é¼ äº’å‹•\n        this._setupMouseInteraction();\n        \n        // æ³¨æ„ï¼šå¦‚æœè¦å•Ÿç”¨ Workerï¼Œéœ€è¦ç¢ºä¿ canvas å°šæœªç²å– context\n        // ä¸” accumulatedWaveform å·²æˆåŠŸè½‰ç§»å…¶ canvas æ§åˆ¶æ¬Š\n    }\n    \n    /**\n     * è¨­ç½®æ»‘é¼ äº’å‹•ï¼ˆé»æ“Šè·³è½‰ã€æ‹–æ›³å¯è¦–ç¯„åœï¼‰\n     * @private\n     */\n    _setupMouseInteraction() {\n        if (!this.canvas) return;\n        \n        let isDragging = false;\n        \n        // æ»‘é¼ æŒ‰ä¸‹ - é»æ“Šæˆ–é–‹å§‹æ‹–æ›³\n        this.canvas.addEventListener('mousedown', (e) => {\n            const acc = this.accumulatedWaveform;\n            if (!acc || acc.sampleCount === 0) return;\n            \n            isDragging = true;\n            this._handleSeek(e.offsetX);\n            this.canvas.style.cursor = 'grabbing';\n        });\n        \n        // æ»‘é¼ ç§»å‹• - æ‹–æ›³æ›´æ–°\n        this.canvas.addEventListener('mousemove', (e) => {\n            if (!isDragging) return;\n            this._handleSeek(e.offsetX);\n        });\n        \n        // æ»‘é¼ æ”¾é–‹\n        this.canvas.addEventListener('mouseup', () => {\n            isDragging = false;\n            this.canvas.style.cursor = 'pointer';\n        });\n        \n        // æ»‘é¼ é›¢é–‹\n        this.canvas.addEventListener('mouseleave', () => {\n            if (isDragging) {\n                isDragging = false;\n                this.canvas.style.cursor = 'pointer';\n            }\n        });\n        \n        // è¨­ç½® cursor æ¨£å¼\n        this.canvas.style.cursor = 'pointer';\n    }\n    \n    /**\n     * è™•ç†é»æ“Š/æ‹–æ›³è·³è½‰\n     * @private\n     */\n    _handleSeek(clickX) {\n        const acc = this.accumulatedWaveform;\n        if (!acc || acc.sampleCount === 0) return;\n        \n        const total = acc.sampleCount;\n        const clickRatio = Math.max(0, Math.min(1, clickX / this.width));\n        const targetSample = Math.floor(clickRatio * total);\n        \n        // æ›´æ–° accumulated waveform çš„è¦–åœ–ä½ç½®\n        const info = acc.getVisibleSamples();\n        const halfVisible = Math.floor(info.visible / 2);\n        acc.viewStart = Math.max(0, Math.min(total - info.visible, targetSample - halfVisible));\n        acc.isAutoScroll = false;\n        acc._enforceViewBounds();\n        acc.draw();\n        \n        // é‡ç¹ª overview ä»¥æ›´æ–°å¯è¦–ç¯„åœæŒ‡ç¤ºå™¨\n        this.draw();\n        \n        // è§¸ç™¼è‡ªå®šç¾©äº‹ä»¶\n        const event = new CustomEvent('overview-seek', {\n            detail: {\n                sample: targetSample,\n                time: targetSample / acc.sourceSampleRate\n            }\n        });\n        this.canvas.dispatchEvent(event);\n    }\n\n    clear() {\n        if (this._useWorker && this._workerRef) {\n            this._workerRef.postMessage({ type: 'clearOverview' });\n            return;\n        }\n        \n        this.ctx.clearRect(0, 0, this.width, this.height);\n        this.ctx.fillStyle = '#f5f5f5';\n        this.ctx.fillRect(0, 0, this.width, this.height);\n    }\n\n    draw() {\n        if (this._useWorker && this._workerRef) {\n            // Worker æœƒè‡ªå‹•åŒæ­¥ç¹ªè£½ overview\n            return;\n        }\n        \n        // ä¸»ç·šç¨‹ç¹ªè£½\n        this.clear();\n        \n        const acc = this.accumulatedWaveform;\n        if (!acc || acc.sampleCount === 0) {\n            console.log('âš ï¸ OverviewWaveform: æ²’æœ‰æ•¸æ“šå¯é¡¯ç¤º', {\n                hasAcc: !!acc,\n                sampleCount: acc ? acc.sampleCount : 0\n            });\n            return;\n        }\n        \n        const total = acc.sampleCount;\n        const info = acc.getVisibleSamples();\n        \n        console.log('ğŸ“Š OverviewWaveform ç¹ªè£½:', {\n            total,\n            visibleStart: info.start,\n            visibleEnd: info.end,\n            canvasWidth: this.width,\n            canvasHeight: this.height\n        });\n        \n        // ç¹ªè£½å…¨å±€æ³¢å½¢\n        this.ctx.strokeStyle = '#64b5f6';\n        this.ctx.lineWidth = 1;\n        \n        const samplesPerPixel = total / this.width;\n        for (let x = 0; x < this.width; x++) {\n            const sampleIndex = Math.floor(x * samplesPerPixel);\n            if (sampleIndex >= total) break;\n            \n            const sample = acc._getSamplePair(sampleIndex);\n            const centerY = this.height / 2;\n            const yMin = Math.floor(centerY - (sample.max * centerY * 0.9));\n            const yMax = Math.floor(centerY - (sample.min * centerY * 0.9));\n            \n            // ç¹ªè£½å‚ç›´ç·š\n            this.ctx.beginPath();\n            this.ctx.moveTo(x, yMin);\n            this.ctx.lineTo(x, yMax);\n            this.ctx.stroke();\n        }\n        \n        // ç¹ªè£½ä¸­ç·š\n        this.ctx.strokeStyle = '#e0e0e0';\n        this.ctx.lineWidth = 1;\n        this.ctx.beginPath();\n        this.ctx.moveTo(0, this.height / 2);\n        this.ctx.lineTo(this.width, this.height / 2);\n        this.ctx.stroke();\n        \n        // ç¹ªè£½å¯è¦–ç¯„åœæŒ‡ç¤ºå™¨\n        const viewStartX = Math.floor((info.start / total) * this.width);\n        const viewEndX = Math.floor((info.end / total) * this.width);\n        const viewWidth = Math.max(2, viewEndX - viewStartX);\n        \n        // åŠé€æ˜è¦†è“‹\n        this.ctx.fillStyle = 'rgba(33, 150, 243, 0.15)';\n        this.ctx.fillRect(viewStartX, 0, viewWidth, this.height);\n        \n        // é‚Šæ¡†\n        this.ctx.strokeStyle = '#2196F3';\n        this.ctx.lineWidth = 2;\n        this.ctx.strokeRect(viewStartX, 0, viewWidth, this.height);\n        \n        console.log('âœ… OverviewWaveform ç¹ªè£½å®Œæˆ');\n    }\n}\n\n// å°å‡ºæ‰€æœ‰é¡åˆ¥\nexport default WaveformRenderer;\n","/**\n * StorageAdapter - å„²å­˜é©é…å™¨åŸºé¡\n * å®šç¾©çµ±ä¸€çš„å„²å­˜ä»‹é¢ï¼Œæ”¯æ´å¤šç¨®å„²å­˜å¾Œç«¯\n */\n\nexport class StorageAdapter {\n  /**\n   * å„²å­˜éŸ³è¨Šæª”æ¡ˆ\n   * @param {Blob} blob - éŸ³è¨Š Blob ç‰©ä»¶\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @param {Object} metadata - å…ƒæ•¸æ“šï¼ˆå¯é¸ï¼‰\n   * @returns {Promise<string>} æª”æ¡ˆ ID æˆ– URL\n   */\n  async save(blob, filename, metadata = {}) {\n    throw new Error('save() must be implemented by subclass');\n  }\n  \n  /**\n   * è¼‰å…¥éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} id - æª”æ¡ˆ ID æˆ–åç¨±\n   * @returns {Promise<Blob>} éŸ³è¨Š Blob ç‰©ä»¶\n   */\n  async load(id) {\n    throw new Error('load() must be implemented by subclass');\n  }\n  \n  /**\n   * åˆªé™¤éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} id - æª”æ¡ˆ ID æˆ–åç¨±\n   * @returns {Promise<boolean>} æ˜¯å¦æˆåŠŸåˆªé™¤\n   */\n  async delete(id) {\n    throw new Error('delete() must be implemented by subclass');\n  }\n  \n  /**\n   * åˆ—å‡ºæ‰€æœ‰æª”æ¡ˆ\n   * @returns {Promise<Array>} æª”æ¡ˆåˆ—è¡¨\n   */\n  async list() {\n    throw new Error('list() must be implemented by subclass');\n  }\n  \n  /**\n   * æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨\n   * @param {string} id - æª”æ¡ˆ ID æˆ–åç¨±\n   * @returns {Promise<boolean>}\n   */\n  async exists(id) {\n    try {\n      await this.load(id);\n      return true;\n    } catch (error) {\n      return false;\n    }\n  }\n  \n  /**\n   * æ¸…ç©ºæ‰€æœ‰æª”æ¡ˆï¼ˆè¬¹æ…ä½¿ç”¨ï¼‰\n   * @returns {Promise<number>} åˆªé™¤çš„æª”æ¡ˆæ•¸é‡\n   */\n  async clear() {\n    const files = await this.list();\n    let count = 0;\n    \n    for (const file of files) {\n      try {\n        await this.delete(file.id || file.filename);\n        count++;\n      } catch (error) {\n        console.error('Failed to delete file:', file, error);\n      }\n    }\n    \n    return count;\n  }\n}\n\nexport default StorageAdapter;\n","/**\n * VoiceBank Recorder - ä¸»å…¥å£é»\n * è·¨å¹³å°éŸ³è¨ŠéŒ„éŸ³åº«\n * \n * @version 1.0.0\n * @author VoiceBank Team\n * @license MIT\n */\n\n// åŒ¯å‡ºæ ¸å¿ƒæ¨¡çµ„\nexport { AudioEngine } from './core/AudioEngine.js';\nexport { WaveformRenderer } from './core/WaveformRenderer.js';\n\n// åŒ¯å‡º UI æ¨¡çµ„\nexport { RecorderUI } from './ui/RecorderUI.js';\n\n// åŒ¯å‡ºå„²å­˜æ¨¡çµ„\nexport {\n  StorageAdapter,\n  IndexedDBAdapter,\n  ServerAdapter,\n  ElectronAdapter,\n  CapacitorAdapter,\n  StorageFactory\n} from './storage/index.js';\n\n// åŒ¯å‡ºå·¥å…·æ¨¡çµ„\nexport { PlatformDetector } from './utils/PlatformDetector.js';\n\n/**\n * VoiceBankRecorder - ä¸»é¡åˆ¥\n * æä¾›çµ±ä¸€çš„ API ä»‹é¢\n */\nexport class VoiceBankRecorder {\n  /**\n   * å»ºæ§‹å‡½æ•¸\n   * @param {Object} options - é…ç½®é¸é …\n   * @param {string|HTMLElement} options.container - å®¹å™¨é¸æ“‡å™¨æˆ–å…ƒç´ \n   * @param {string} options.layout - ä½ˆå±€æ¨¡å¼ ('horizontal'|'vertical'|'auto')\n   * @param {string} options.theme - ä¸»é¡Œ ('light'|'dark')\n   * @param {Object} options.audio - éŸ³è¨Šé…ç½®\n   * @param {Object} options.waveform - æ³¢å½¢é…ç½®\n   * @param {Object} options.storage - å„²å­˜é…ç½®\n   * @param {Object} options.callbacks - äº‹ä»¶å›èª¿\n   */\n  constructor(options = {}) {\n    this.options = this.mergeOptions(options);\n    this.initialized = false;\n    \n    // åˆå§‹åŒ–å„²å­˜é©é…å™¨\n    this.storage = this.createStorageAdapter(this.options.storage);\n    \n    // ç‹€æ…‹\n    this.isRecording = false;\n    this.isPaused = false;\n    this.currentBlob = null;\n    \n    // å¦‚æœæä¾›äº†å®¹å™¨ï¼Œåˆå§‹åŒ– UI\n    if (this.options.container) {\n      this.initializeUI();\n    }\n  }\n  \n  /**\n   * åˆä½µé…ç½®é¸é …\n   * @param {Object} options - ç”¨æˆ¶é¸é …\n   * @returns {Object} åˆä½µå¾Œçš„é¸é …\n   */\n  mergeOptions(options) {\n    const defaults = {\n      container: null,\n      layout: 'auto',\n      theme: 'light',\n      \n      audio: {\n        sampleRate: 48000,\n        channels: 1,\n        agc: false,\n        gain: 1.0\n      },\n      \n      waveform: {\n        showOverview: true,\n        showAccumulated: true,\n        showLive: true,\n        decimation: 10,\n        colors: {\n          waveform: '#1E88E5',\n          selection: '#4CAF50',\n          playback: '#FF0000'\n        }\n      },\n      \n      storage: {\n        type: 'auto'\n      },\n      \n      callbacks: {\n        onRecordStart: () => {},\n        onRecordStop: () => {},\n        onRecordPause: () => {},\n        onRecordResume: () => {},\n        onPlayStart: () => {},\n        onPlayStop: () => {},\n        onError: (error) => console.error('VoiceBankRecorder error:', error)\n      }\n    };\n    \n    // æ·±åº¦åˆä½µ\n    return this.deepMerge(defaults, options);\n  }\n  \n  /**\n   * æ·±åº¦åˆä½µç‰©ä»¶\n   * @param {Object} target - ç›®æ¨™ç‰©ä»¶\n   * @param {Object} source - ä¾†æºç‰©ä»¶\n   * @returns {Object}\n   */\n  deepMerge(target, source) {\n    const result = { ...target };\n    \n    for (const key in source) {\n      if (source[key] instanceof Object && !Array.isArray(source[key])) {\n        result[key] = this.deepMerge(result[key] || {}, source[key]);\n      } else {\n        result[key] = source[key];\n      }\n    }\n    \n    return result;\n  }\n  \n  /**\n   * å‰µå»ºå„²å­˜é©é…å™¨\n   * @param {Object} storageConfig - å„²å­˜é…ç½®\n   * @returns {StorageAdapter}\n   */\n  createStorageAdapter(storageConfig) {\n    const { StorageFactory } = require('./storage/index.js');\n    return StorageFactory.create({\n      type: storageConfig.type || 'auto',\n      options: storageConfig\n    });\n  }\n  \n  /**\n   * åˆå§‹åŒ– UI\n   */\n  initializeUI() {\n    // TODO: å¯¦ä½œ UI åˆå§‹åŒ–\n    // é€™å°‡åœ¨å¾ŒçºŒéšæ®µå¯¦ä½œ\n    console.log('UI initialization - to be implemented');\n  }\n  \n  /**\n   * é–‹å§‹éŒ„éŸ³\n   * @returns {Promise<void>}\n   */\n  async startRecording() {\n    try {\n      if (this.isRecording) {\n        throw new Error('Already recording');\n      }\n      \n      // TODO: å¯¦ä½œéŒ„éŸ³é‚è¼¯\n      this.isRecording = true;\n      this.options.callbacks.onRecordStart();\n      \n      console.log('Recording started');\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åœæ­¢éŒ„éŸ³\n   * @returns {Promise<Blob>}\n   */\n  async stopRecording() {\n    try {\n      if (!this.isRecording) {\n        throw new Error('Not recording');\n      }\n      \n      // TODO: å¯¦ä½œåœæ­¢éŒ„éŸ³é‚è¼¯\n      this.isRecording = false;\n      \n      // æ¨¡æ“¬è¿”å› Blobï¼ˆå¯¦éš›æœƒå¾ AudioEngine ç²å–ï¼‰\n      this.currentBlob = null; // TODO: å¯¦éš›çš„ Blob\n      \n      this.options.callbacks.onRecordStop(this.currentBlob);\n      \n      console.log('Recording stopped');\n      return this.currentBlob;\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * æš«åœéŒ„éŸ³\n   * @returns {Promise<void>}\n   */\n  async pauseRecording() {\n    try {\n      if (!this.isRecording || this.isPaused) {\n        throw new Error('Cannot pause');\n      }\n      \n      this.isPaused = true;\n      this.options.callbacks.onRecordPause();\n      \n      console.log('Recording paused');\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * æ¢å¾©éŒ„éŸ³\n   * @returns {Promise<void>}\n   */\n  async resumeRecording() {\n    try {\n      if (!this.isRecording || !this.isPaused) {\n        throw new Error('Cannot resume');\n      }\n      \n      this.isPaused = false;\n      this.options.callbacks.onRecordResume();\n      \n      console.log('Recording resumed');\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * æ’­æ”¾éŒ„éŸ³\n   * @returns {Promise<void>}\n   */\n  async play() {\n    try {\n      // TODO: å¯¦ä½œæ’­æ”¾é‚è¼¯\n      this.options.callbacks.onPlayStart();\n      \n      console.log('Playback started');\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åœæ­¢æ’­æ”¾\n   * @returns {Promise<void>}\n   */\n  async stop() {\n    try {\n      // TODO: å¯¦ä½œåœæ­¢æ’­æ”¾é‚è¼¯\n      this.options.callbacks.onPlayStop();\n      \n      console.log('Playback stopped');\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * å„²å­˜éŒ„éŸ³\n   * @param {Blob} blob - éŸ³è¨Š Blobï¼ˆå¯é¸ï¼Œä½¿ç”¨ç•¶å‰éŒ„éŸ³ï¼‰\n   * @param {string} filename - æª”æ¡ˆåç¨±ï¼ˆå¯é¸ï¼Œè‡ªå‹•ç”Ÿæˆï¼‰\n   * @param {Object} metadata - å…ƒæ•¸æ“šï¼ˆå¯é¸ï¼‰\n   * @returns {Promise<string>} æª”æ¡ˆ ID\n   */\n  async saveRecording(blob = null, filename = null, metadata = {}) {\n    try {\n      const blobToSave = blob || this.currentBlob;\n      \n      if (!blobToSave) {\n        throw new Error('No recording to save');\n      }\n      \n      const filenameToUse = filename || `recording-${Date.now()}.wav`;\n      \n      const id = await this.storage.save(blobToSave, filenameToUse, metadata);\n      \n      console.log('Recording saved:', id);\n      return id;\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * è¼‰å…¥éŒ„éŸ³\n   * @param {string} id - æª”æ¡ˆ ID\n   * @returns {Promise<Blob>}\n   */\n  async loadRecording(id) {\n    try {\n      const blob = await this.storage.load(id);\n      this.currentBlob = blob;\n      \n      console.log('Recording loaded:', id);\n      return blob;\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆªé™¤éŒ„éŸ³\n   * @param {string} id - æª”æ¡ˆ ID\n   * @returns {Promise<boolean>}\n   */\n  async deleteRecording(id) {\n    try {\n      const result = await this.storage.delete(id);\n      \n      console.log('Recording deleted:', id);\n      return result;\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆ—å‡ºæ‰€æœ‰éŒ„éŸ³\n   * @returns {Promise<Array>}\n   */\n  async listRecordings() {\n    try {\n      const recordings = await this.storage.list();\n      \n      console.log('Recordings listed:', recordings.length);\n      return recordings;\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * å–å¾—ç•¶å‰éŒ„éŸ³ Blob\n   * @returns {Blob|null}\n   */\n  getCurrentBlob() {\n    return this.currentBlob;\n  }\n  \n  /**\n   * éŠ·æ¯€å¯¦ä¾‹\n   */\n  destroy() {\n    // TODO: æ¸…ç†è³‡æº\n    this.isRecording = false;\n    this.isPaused = false;\n    this.currentBlob = null;\n    \n    if (this.storage && typeof this.storage.close === 'function') {\n      this.storage.close();\n    }\n    \n    console.log('VoiceBankRecorder destroyed');\n  }\n}\n\n// é è¨­å°å‡º\nexport default VoiceBankRecorder;\n\n/**\n * ç‰ˆæœ¬è³‡è¨Š\n */\nexport const VERSION = '1.0.0';\n\n/**\n * å»ºç½®è³‡è¨Š\n */\nexport const BUILD_INFO = {\n  version: VERSION,\n  date: new Date().toISOString(),\n  name: 'VoiceBank Recorder'\n};\n","/**\n * AudioEngine - è·¨å¹³å°éŸ³è¨ŠéŒ„éŸ³å¼•æ“\n * \n * åŠŸèƒ½ï¼š\n * - å°è£ Web Audio API (AudioContext, AudioWorklet)\n * - æ”¯æ´ RecordRTC éŒ„éŸ³ (WAV æ ¼å¼)\n * - è‡ªå‹•è™•ç† AudioWorklet èˆ‡ ScriptProcessor fallback\n * - æä¾›éŒ„éŸ³æ§åˆ¶ (é–‹å§‹/åœæ­¢/æš«åœ/ç¹¼çºŒ)\n * - äº‹ä»¶é©…å‹•æ¶æ§‹ (recording-start, data-available, recording-stop ç­‰)\n * - éº¥å…‹é¢¨è¼¸å…¥ç®¡ç†èˆ‡å‰ç´šå¢ç›Šæ§åˆ¶\n * \n * @example\n * const engine = new AudioEngine({\n *   sampleRate: 48000,\n *   autoGainControl: false,\n *   micGain: 1.0\n * });\n * \n * engine.on('recording-start', () => console.log('Started'));\n * engine.on('data-available', (pcmData) => console.log('PCM chunk', pcmData));\n * engine.on('recording-stop', (blob) => console.log('Finished', blob));\n * \n * await engine.initialize();\n * await engine.startRecording();\n * // ... éŒ„éŸ³ä¸­ ...\n * await engine.stopRecording();\n */\n\nexport class AudioEngine {\n    /**\n     * å‰µå»º AudioEngine å¯¦ä¾‹\n     * @param {Object} options - é…ç½®é¸é …\n     * @param {number} [options.sampleRate=48000] - æ¡æ¨£ç‡\n     * @param {boolean} [options.autoGainControl=false] - è‡ªå‹•å¢ç›Šæ§åˆ¶\n     * @param {boolean} [options.echoCancellation=false] - å›éŸ³æ¶ˆé™¤\n     * @param {boolean} [options.noiseSuppression=false] - å™ªéŸ³æŠ‘åˆ¶\n     * @param {number} [options.micGain=1.0] - å‰ç´šå¢ç›Š (1.0-6.0)\n     * @param {string} [options.deviceId] - éº¥å…‹é¢¨è¨­å‚™ ID\n     * @param {string} [options.workletPath='assets/js/worklet/pcm-collector.js'] - AudioWorklet æ¨¡çµ„è·¯å¾‘\n     * @param {boolean} [options.preferWorklet=true] - å„ªå…ˆä½¿ç”¨ AudioWorkletï¼ˆæ”¯æ´æ™‚ï¼‰\n     */\n    constructor(options = {}) {\n        // é…ç½®é¸é …\n        this.config = {\n            sampleRate: options.sampleRate || 48000,\n            autoGainControl: options.autoGainControl !== undefined ? options.autoGainControl : false,\n            echoCancellation: options.echoCancellation !== undefined ? options.echoCancellation : false,\n            noiseSuppression: options.noiseSuppression !== undefined ? options.noiseSuppression : false,\n            micGain: options.micGain || 1.0,\n            deviceId: options.deviceId || null,\n            workletPath: options.workletPath || 'assets/js/worklet/pcm-collector.js',\n            preferWorklet: options.preferWorklet !== undefined ? options.preferWorklet : true\n        };\n\n        // Web Audio API ç‰©ä»¶\n        this.audioContext = null;\n        this.analyser = null;\n        this.preGainNode = null;\n        this.mediaDest = null;\n        this.analyserSilencer = null;\n\n        // AudioWorklet ç›¸é—œ\n        this.workletSupported = false;\n        this.workletLoaded = false;\n        this.pcmCollectorNode = null;\n        this.usingWorklet = false;\n\n        // PCM æ•¸æ“šæ”¶é›† (AudioWorklet æ¨¡å¼)\n        this.pcmChunks = [];\n        this.pcmTotalSamples = 0;\n\n        // RecordRTC éŒ„éŸ³å™¨\n        this.recorder = null;\n        \n        // RecordRTC æ¨¡å¼ PCM æ¡é›†\n        this._pcmCaptureInterval = null;\n\n        // éº¥å…‹é¢¨ä¸²æµ\n        this.micStream = null;\n\n        // éŒ„éŸ³ç‹€æ…‹\n        this.isRecording = false;\n        this.isPaused = false;\n        this.isInitialized = false;\n\n        // æ™‚é–“æˆ³è¨˜\n        this.recordStartTime = 0;\n        this.recordStopTime = 0;\n        this.recordWallStartMs = 0;\n        this.recordWallStopMs = 0;\n\n        // æœ€å¾Œçš„éŒ„éŸ³çµæœ\n        this.latestBlob = null;\n        this.latestUrl = null;\n\n        // äº‹ä»¶ç›£è½å™¨\n        this._eventListeners = {};\n    }\n\n    /**\n     * åˆå§‹åŒ–éŸ³è¨Šå¼•æ“\n     * å‰µå»º AudioContextã€Analyserã€Gain ç¯€é»ç­‰\n     * @returns {Promise<void>}\n     */\n    async initialize() {\n        if (this.isInitialized) {\n            return;\n        }\n\n        try {\n            // å‰µå»º AudioContext\n            const AudioContextClass = window.AudioContext || window.webkitAudioContext;\n            this.audioContext = new AudioContextClass({ sampleRate: this.config.sampleRate });\n\n            // å‰µå»ºåˆ†æå™¨ç¯€é»\n            this.analyser = this.audioContext.createAnalyser();\n            this.analyser.fftSize = 256;\n\n            // å‰µå»ºå‰ç´šå¢ç›Šç¯€é»\n            this.preGainNode = this.audioContext.createGain();\n            this.preGainNode.gain.value = this.config.micGain;\n\n            // å‰µå»º MediaStreamDestinationï¼ˆä¾› RecordRTC ä½¿ç”¨ï¼‰\n            this.mediaDest = this.audioContext.createMediaStreamDestination();\n\n            // é€£æ¥ç¯€é»ï¼špreGain -> analyser -> silencer -> destination\n            this.preGainNode.connect(this.analyser);\n            this.preGainNode.connect(this.mediaDest);\n\n            // å‰µå»ºéœéŸ³ç¯€é»ï¼ˆé¿å…å›æˆï¼‰\n            this.analyserSilencer = this.audioContext.createGain();\n            this.analyserSilencer.gain.value = 0;\n            this.analyser.connect(this.analyserSilencer);\n            this.analyserSilencer.connect(this.audioContext.destination);\n\n            // æª¢æ¸¬ AudioWorklet æ”¯æ´\n            this.workletSupported = !!(\n                this.audioContext.audioWorklet && \n                window.AudioWorkletNode\n            );\n\n            // è¼‰å…¥ AudioWorklet æ¨¡çµ„ï¼ˆå¦‚æœæ”¯æ´ä¸”åå¥½ä½¿ç”¨ï¼‰\n            if (this.workletSupported && this.config.preferWorklet) {\n                try {\n                    await this.audioContext.audioWorklet.addModule(this.config.workletPath);\n                    this.workletLoaded = true;\n                    this._emit('worklet-loaded', { path: this.config.workletPath });\n                } catch (error) {\n                    console.warn('è¼‰å…¥ AudioWorklet æ¨¡çµ„å¤±æ•—ï¼Œå°‡å›é€€åˆ° RecordRTC:', error);\n                    this.workletLoaded = false;\n                    this._emit('worklet-load-failed', { error });\n                }\n            }\n\n            // æ¢å¾© AudioContextï¼ˆå¦‚æœæš«åœï¼‰\n            if (this.audioContext.state === 'suspended') {\n                await this.audioContext.resume();\n            }\n\n            this.isInitialized = true;\n            this._emit('initialized', {\n                sampleRate: this.audioContext.sampleRate,\n                state: this.audioContext.state,\n                workletSupported: this.workletSupported,\n                workletLoaded: this.workletLoaded\n            });\n\n        } catch (error) {\n            this._emit('error', { stage: 'initialize', error });\n            throw error;\n        }\n    }\n\n    /**\n     * é–‹å§‹éŒ„éŸ³\n     * @returns {Promise<void>}\n     */\n    async startRecording() {\n        if (!this.isInitialized) {\n            throw new Error('AudioEngine å°šæœªåˆå§‹åŒ–ï¼Œè«‹å…ˆèª¿ç”¨ initialize()');\n        }\n\n        if (this.isRecording) {\n            throw new Error('å·²ç¶“åœ¨éŒ„éŸ³ä¸­');\n        }\n\n        try {\n            // ç¢ºä¿ AudioContext æ˜¯æ´»èºç‹€æ…‹\n            if (this.audioContext.state === 'suspended') {\n                await this.audioContext.resume();\n            }\n\n            // ç²å–éº¥å…‹é¢¨\n            await this._captureMicrophone();\n\n            // é‡ç½® PCM æ•¸æ“šæ”¶é›†\n            this.pcmChunks = [];\n            this.pcmTotalSamples = 0;\n\n            // æ¸…ç†èˆŠçš„éŒ„éŸ³çµæœ\n            if (this.latestUrl) {\n                URL.revokeObjectURL(this.latestUrl);\n                this.latestUrl = null;\n            }\n            this.latestBlob = null;\n\n            // è¨˜éŒ„é–‹å§‹æ™‚é–“\n            this.recordStartTime = Date.now();\n            this.recordWallStartMs = performance.now();\n            this.recordStopTime = 0;\n            this.recordWallStopMs = 0;\n\n            // æ±ºå®šä½¿ç”¨ AudioWorklet æˆ– RecordRTC\n            const useWorklet = this.workletLoaded && this.config.preferWorklet;\n\n            if (useWorklet) {\n                await this._startWorkletRecording();\n            } else {\n                await this._startRecordRTCRecording();\n            }\n\n            this.isRecording = true;\n            this.isPaused = false;\n\n            this._emit('recording-start', {\n                timestamp: this.recordStartTime,\n                mode: useWorklet ? 'worklet' : 'recordrtc',\n                sampleRate: this.audioContext.sampleRate\n            });\n\n        } catch (error) {\n            this._emit('error', { stage: 'start-recording', error });\n            throw error;\n        }\n    }\n\n    /**\n     * åœæ­¢éŒ„éŸ³\n     * @returns {Promise<Blob>} éŒ„éŸ³çš„ Blob\n     */\n    async stopRecording() {\n        if (!this.isRecording) {\n            throw new Error('ç›®å‰æ²’æœ‰åœ¨éŒ„éŸ³');\n        }\n\n        try {\n            this.isRecording = false;\n            this.recordStopTime = Date.now();\n            this.recordWallStopMs = performance.now();\n\n            let blob;\n\n            if (this.usingWorklet) {\n                blob = await this._stopWorkletRecording();\n            } else if (this.recorder) {\n                blob = await this._stopRecordRTCRecording();\n            } else {\n                throw new Error('æ²’æœ‰å¯ç”¨çš„éŒ„éŸ³å™¨');\n            }\n\n            // åœæ­¢éº¥å…‹é¢¨\n            this._stopMicrophone();\n\n            // å„²å­˜çµæœ\n            this.latestBlob = blob;\n            this.latestUrl = URL.createObjectURL(blob);\n\n            const duration = (this.recordStopTime - this.recordStartTime) / 1000;\n\n            this._emit('recording-stop', {\n                blob,\n                url: this.latestUrl,\n                duration,\n                samples: this.pcmTotalSamples,\n                sampleRate: this.audioContext.sampleRate\n            });\n\n            return blob;\n\n        } catch (error) {\n            this._emit('error', { stage: 'stop-recording', error });\n            throw error;\n        }\n    }\n\n    /**\n     * æš«åœéŒ„éŸ³ï¼ˆåƒ… RecordRTC æ¨¡å¼æ”¯æ´ï¼‰\n     */\n    pauseRecording() {\n        if (!this.isRecording) {\n            throw new Error('ç›®å‰æ²’æœ‰åœ¨éŒ„éŸ³');\n        }\n\n        if (this.usingWorklet) {\n            throw new Error('AudioWorklet æ¨¡å¼ä¸æ”¯æ´æš«åœåŠŸèƒ½');\n        }\n\n        if (this.recorder && typeof this.recorder.pauseRecording === 'function') {\n            this.recorder.pauseRecording();\n            this.isPaused = true;\n            this._emit('recording-paused', { timestamp: Date.now() });\n        } else {\n            throw new Error('æš«åœåŠŸèƒ½ä¸å¯ç”¨');\n        }\n    }\n\n    /**\n     * ç¹¼çºŒéŒ„éŸ³ï¼ˆåƒ… RecordRTC æ¨¡å¼æ”¯æ´ï¼‰\n     */\n    resumeRecording() {\n        if (!this.isPaused) {\n            throw new Error('éŒ„éŸ³æ²’æœ‰æš«åœ');\n        }\n\n        if (this.recorder && typeof this.recorder.resumeRecording === 'function') {\n            this.recorder.resumeRecording();\n            this.isPaused = false;\n            this._emit('recording-resumed', { timestamp: Date.now() });\n        } else {\n            throw new Error('ç¹¼çºŒéŒ„éŸ³åŠŸèƒ½ä¸å¯ç”¨');\n        }\n    }\n\n    /**\n     * å–å¾—æœ€æ–°çš„éŒ„éŸ³æ•¸æ“š\n     * @returns {Object} { blob, url, duration, samples }\n     */\n    getLatestRecording() {\n        return {\n            blob: this.latestBlob,\n            url: this.latestUrl,\n            duration: this.latestBlob ? (this.recordStopTime - this.recordStartTime) / 1000 : 0,\n            samples: this.pcmTotalSamples,\n            sampleRate: this.audioContext ? this.audioContext.sampleRate : 0\n        };\n    }\n\n    /**\n     * å–å¾— PCM æ•¸æ“šè¦–çª—ï¼ˆåƒ… AudioWorklet æ¨¡å¼ï¼‰\n     * @param {number} start - èµ·å§‹æ¨£æœ¬ç´¢å¼•\n     * @param {number} count - æ¨£æœ¬æ•¸é‡\n     * @returns {Float32Array|null}\n     */\n    getPcmWindow(start, count) {\n        if (!this.usingWorklet || !this.pcmChunks.length) {\n            return null;\n        }\n\n        if (start < 0) start = 0;\n        const total = this.pcmTotalSamples;\n        if (start >= total) return new Float32Array(0);\n\n        const end = Math.min(total, start + count);\n        const out = new Float32Array(end - start);\n        let offset = 0;\n        let passed = 0;\n\n        for (let i = 0; i < this.pcmChunks.length && passed < end; i++) {\n            const chunk = this.pcmChunks[i];\n            if (!chunk || !chunk.length) continue;\n\n            const cLen = chunk.length;\n            const cStart = passed;\n            const cEnd = passed + cLen;\n\n            if (cEnd <= start) {\n                passed = cEnd;\n                continue;\n            }\n\n            const segStart = Math.max(start, cStart);\n            const segEnd = Math.min(end, cEnd);\n\n            if (segEnd > segStart) {\n                const localStart = segStart - cStart;\n                const slice = chunk.subarray(localStart, localStart + (segEnd - segStart));\n                out.set(slice, offset);\n                offset += slice.length;\n            }\n\n            passed = cEnd;\n            if (segEnd >= end) break;\n        }\n\n        return out;\n    }\n\n    /**\n     * å–å¾— Analyser ç¯€é»ï¼ˆä¾›å¤–éƒ¨æ³¢å½¢é¡¯ç¤ºä½¿ç”¨ï¼‰\n     * @returns {AnalyserNode|null}\n     */\n    getAnalyser() {\n        return this.analyser;\n    }\n\n    /**\n     * å–å¾— AudioContext\n     * @returns {AudioContext|null}\n     */\n    getAudioContext() {\n        return this.audioContext;\n    }\n\n    /**\n     * å–å¾—éº¥å…‹é¢¨åª’é«”æµ\n     * @returns {MediaStream|null}\n     */\n    get microphoneStream() {\n        return this.micStream;\n    }\n\n    /**\n     * è¨­å®šå‰ç´šå¢ç›Š\n     * @param {number} gain - å¢ç›Šå€¼ (1.0-6.0)\n     */\n    setMicGain(gain) {\n        gain = Math.max(1.0, Math.min(6.0, gain));\n        this.config.micGain = gain;\n\n        if (this.preGainNode) {\n            this.preGainNode.gain.value = gain;\n        }\n\n        this._emit('mic-gain-changed', { gain });\n    }\n\n    /**\n     * é‡‹æ”¾è³‡æº\n     */\n    dispose() {\n        if (this.isRecording) {\n            this.stopRecording().catch(console.error);\n        }\n\n        this._stopMicrophone();\n        this._stopPcmCapture();\n\n        if (this.latestUrl) {\n            URL.revokeObjectURL(this.latestUrl);\n            this.latestUrl = null;\n        }\n\n        if (this.audioContext) {\n            this.audioContext.close().catch(console.error);\n            this.audioContext = null;\n        }\n\n        this.analyser = null;\n        this.preGainNode = null;\n        this.mediaDest = null;\n        this.analyserSilencer = null;\n        this.pcmCollectorNode = null;\n        this.recorder = null;\n\n        this.pcmChunks = [];\n        this.pcmTotalSamples = 0;\n\n        this.isInitialized = false;\n\n        this._emit('disposed');\n    }\n\n    // ============================================================\n    // äº‹ä»¶ç³»çµ±\n    // ============================================================\n\n    /**\n     * è¨»å†Šäº‹ä»¶ç›£è½å™¨\n     * @param {string} event - äº‹ä»¶åç¨±\n     * @param {Function} handler - è™•ç†å‡½æ•¸\n     */\n    on(event, handler) {\n        if (!this._eventListeners[event]) {\n            this._eventListeners[event] = [];\n        }\n        this._eventListeners[event].push(handler);\n    }\n\n    /**\n     * ç§»é™¤äº‹ä»¶ç›£è½å™¨\n     * @param {string} event - äº‹ä»¶åç¨±\n     * @param {Function} handler - è™•ç†å‡½æ•¸\n     */\n    off(event, handler) {\n        if (!this._eventListeners[event]) return;\n\n        const index = this._eventListeners[event].indexOf(handler);\n        if (index > -1) {\n            this._eventListeners[event].splice(index, 1);\n        }\n    }\n\n    /**\n     * è§¸ç™¼äº‹ä»¶ï¼ˆå…§éƒ¨ä½¿ç”¨ï¼‰\n     * @private\n     */\n    _emit(event, data) {\n        if (!this._eventListeners[event]) return;\n\n        this._eventListeners[event].forEach(handler => {\n            try {\n                handler(data);\n            } catch (error) {\n                console.error(`äº‹ä»¶è™•ç†å™¨éŒ¯èª¤ [${event}]:`, error);\n            }\n        });\n    }\n\n    // ============================================================\n    // ç§æœ‰æ–¹æ³• - éº¥å…‹é¢¨æ•ç²\n    // ============================================================\n\n    async _captureMicrophone() {\n        const constraints = {\n            audio: {\n                echoCancellation: this.config.echoCancellation,\n                noiseSuppression: this.config.noiseSuppression,\n                autoGainControl: this.config.autoGainControl\n            },\n            video: false\n        };\n\n        // åŠ å…¥è¨­å‚™ ID é™åˆ¶ï¼ˆå¦‚æœæœ‰æŒ‡å®šï¼‰\n        if (this.config.deviceId) {\n            constraints.audio.deviceId = { exact: this.config.deviceId };\n        }\n\n        try {\n            this.micStream = await navigator.mediaDevices.getUserMedia(constraints);\n\n            // iOS è‡ªå‹•å¢ç›Šèª¿æ•´\n            this._applyIOSMicGainAdjustment();\n\n            // é€£æ¥éº¥å…‹é¢¨åˆ°å‰ç´šå¢ç›Šç¯€é»\n            const source = this.audioContext.createMediaStreamSource(this.micStream);\n            source.connect(this.preGainNode);\n\n            this._emit('microphone-captured', {\n                deviceId: this.config.deviceId,\n                constraints\n            });\n\n        } catch (error) {\n            // å¦‚æœæŒ‡å®šè¨­å‚™å¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨é è¨­è¨­å‚™\n            if (error.name === 'OverconstrainedError' || error.name === 'NotFoundError') {\n                console.warn('æŒ‡å®šçš„éº¥å…‹é¢¨ç„¡æ³•ä½¿ç”¨ï¼Œå˜—è©¦é è¨­è¨­å‚™');\n\n                delete constraints.audio.deviceId;\n                this.micStream = await navigator.mediaDevices.getUserMedia(constraints);\n\n                this._applyIOSMicGainAdjustment();\n\n                const source = this.audioContext.createMediaStreamSource(this.micStream);\n                source.connect(this.preGainNode);\n\n                this._emit('microphone-captured-fallback', { constraints });\n            } else {\n                throw error;\n            }\n        }\n    }\n\n    _stopMicrophone() {\n        if (this.micStream) {\n            this.micStream.getTracks().forEach(track => {\n                try {\n                    track.stop();\n                } catch (error) {\n                    console.warn('åœæ­¢éº¥å…‹é¢¨è»Œé“å¤±æ•—:', error);\n                }\n            });\n            this.micStream = null;\n        }\n    }\n\n    _applyIOSMicGainAdjustment() {\n        // iOS ä¸Š AGC é—œé–‰æ™‚éŸ³é‡åä½ï¼Œè‡ªå‹•æå‡å¢ç›Š\n        try {\n            const ua = navigator.userAgent || '';\n            const isIOS = /iphone|ipad|ipod/i.test(ua);\n\n            if (isIOS && !this.config.autoGainControl) {\n                if (Math.abs(this.config.micGain - 1.0) < 0.0001) {\n                    this.setMicGain(3.5);\n                    this._emit('ios-gain-adjusted', { gain: 3.5 });\n                }\n            }\n        } catch (error) {\n            console.warn('iOS å¢ç›Šèª¿æ•´å¤±æ•—:', error);\n        }\n    }\n\n    // ============================================================\n    // ç§æœ‰æ–¹æ³• - AudioWorklet éŒ„éŸ³\n    // ============================================================\n\n    async _startWorkletRecording() {\n        try {\n            // å‰µå»º AudioWorkletNode\n            this.pcmCollectorNode = new AudioWorkletNode(\n                this.audioContext,\n                'pcm-collector-processor'\n            );\n\n            // ç›£è½ PCM æ•¸æ“š\n            this.pcmCollectorNode.port.onmessage = (event) => {\n                const { type, pcmData } = event.data;\n\n                if (type === 'pcm-data' && pcmData) {\n                    this.pcmChunks.push(new Float32Array(pcmData));\n                    this.pcmTotalSamples += pcmData.length;\n\n                    this._emit('data-available', {\n                        pcmData: new Float32Array(pcmData),\n                        totalSamples: this.pcmTotalSamples,\n                        mode: 'worklet'\n                    });\n                }\n            };\n\n            // é€£æ¥ç¯€é»ï¼špreGain -> pcmCollector -> analyser\n            this.preGainNode.connect(this.pcmCollectorNode);\n            this.pcmCollectorNode.connect(this.audioContext.destination);\n\n            this.usingWorklet = true;\n\n        } catch (error) {\n            console.error('AudioWorklet å•Ÿå‹•å¤±æ•—ï¼Œå›é€€åˆ° RecordRTC:', error);\n            this.usingWorklet = false;\n            await this._startRecordRTCRecording();\n        }\n    }\n\n    async _stopWorkletRecording() {\n        try {\n            // æ–·é–‹ AudioWorkletNode\n            if (this.pcmCollectorNode) {\n                this.pcmCollectorNode.port.onmessage = null;\n                this.preGainNode.disconnect(this.pcmCollectorNode);\n                this.pcmCollectorNode.disconnect();\n                this.pcmCollectorNode = null;\n            }\n\n            // åˆä½µ PCM æ•¸æ“šä¸¦è½‰æ›ç‚º WAV\n            if (this.pcmChunks.length === 0) {\n                throw new Error('æ²’æœ‰éŒ„éŸ³æ•¸æ“š');\n            }\n\n            const merged = new Float32Array(this.pcmTotalSamples);\n            let offset = 0;\n\n            for (const chunk of this.pcmChunks) {\n                merged.set(chunk, offset);\n                offset += chunk.length;\n            }\n\n            // è½‰æ›ç‚º 16-bit PCM WAV\n            const wavBuffer = this._buildWavFromFloat32Mono(\n                merged,\n                this.audioContext.sampleRate\n            );\n\n            const blob = new Blob([wavBuffer], { type: 'audio/wav' });\n\n            this.usingWorklet = false;\n\n            return blob;\n\n        } catch (error) {\n            console.error('AudioWorklet åœæ­¢å¤±æ•—:', error);\n            throw error;\n        }\n    }\n\n    // ============================================================\n    // ç§æœ‰æ–¹æ³• - RecordRTC éŒ„éŸ³\n    // ============================================================\n\n    async _startRecordRTCRecording() {\n        return new Promise((resolve, reject) => {\n            try {\n                // æª¢æŸ¥ RecordRTC æ˜¯å¦å¯ç”¨\n                if (typeof RecordRTC === 'undefined') {\n                    reject(new Error('RecordRTC æœªè¼‰å…¥'));\n                    return;\n                }\n\n                const recordStream = this.mediaDest.stream || this.micStream;\n\n                this.recorder = RecordRTC(recordStream, {\n                    type: 'audio',\n                    mimeType: 'audio/wav',\n                    recorderType: StereoAudioRecorder,\n                    numberOfAudioChannels: 1,\n                    bufferSize: 4096,\n                    timeSlice: 100,\n                    ondataavailable: (blob) => {\n                        this._emit('data-available', {\n                            blob,\n                            mode: 'recordrtc'\n                        });\n                    }\n                });\n\n                this.recorder.startRecording();\n                this.usingWorklet = false;\n\n                // å•Ÿå‹• PCM æ•¸æ“šæ¡é›†å¾ªç’°ï¼ˆç”¨æ–¼ç´¯ç©æ³¢å½¢ï¼‰\n                this._startPcmCapture();\n\n                resolve();\n\n            } catch (error) {\n                reject(error);\n            }\n        });\n    }\n\n    async _stopRecordRTCRecording() {\n        return new Promise((resolve, reject) => {\n            try {\n                if (!this.recorder) {\n                    reject(new Error('RecordRTC éŒ„éŸ³å™¨ä¸å­˜åœ¨'));\n                    return;\n                }\n\n                // åœæ­¢ PCM æ•¸æ“šæ¡é›†å¾ªç’°\n                this._stopPcmCapture();\n\n                this.recorder.stopRecording(() => {\n                    try {\n                        const blob = this.recorder.getBlob();\n\n                        // æ¸…ç†éŒ„éŸ³å™¨\n                        this.recorder = null;\n\n                        resolve(blob);\n                    } catch (error) {\n                        reject(error);\n                    }\n                });\n\n            } catch (error) {\n                reject(error);\n            }\n        });\n    }\n\n    /**\n     * å•Ÿå‹• PCM æ•¸æ“šæ¡é›†ï¼ˆRecordRTC æ¨¡å¼ä½¿ç”¨ï¼‰\n     * @private\n     */\n    _startPcmCapture() {\n        if (!this.analyser) return;\n\n        const bufferLength = this.analyser.fftSize;\n        const dataArray = new Float32Array(bufferLength);\n        \n        // æ¯ 100ms æ¡é›†ä¸€æ¬¡ PCM æ•¸æ“š\n        this._pcmCaptureInterval = setInterval(() => {\n            if (!this.isRecording || !this.analyser) {\n                return;\n            }\n\n            // å¾ AnalyserNode è®€å–æ™‚åŸŸæ•¸æ“š\n            this.analyser.getFloatTimeDomainData(dataArray);\n            \n            // è¤‡è£½æ•¸æ“šä»¥é¿å…è¢«è¦†è“‹\n            const pcmChunk = new Float32Array(dataArray);\n            \n            // å„²å­˜åˆ° pcmChunks\n            this.pcmChunks.push(pcmChunk);\n            this.pcmTotalSamples += pcmChunk.length;\n\n            // ç™¼é€äº‹ä»¶çµ¦ WaveformRenderer\n            this._emit('data-available', {\n                pcmData: pcmChunk,\n                totalSamples: this.pcmTotalSamples,\n                mode: 'recordrtc-pcm'\n            });\n        }, 100);\n    }\n\n    /**\n     * åœæ­¢ PCM æ•¸æ“šæ¡é›†\n     * @private\n     */\n    _stopPcmCapture() {\n        if (this._pcmCaptureInterval) {\n            clearInterval(this._pcmCaptureInterval);\n            this._pcmCaptureInterval = null;\n        }\n    }\n\n    // ============================================================\n    // ç§æœ‰æ–¹æ³• - WAV æ ¼å¼è½‰æ›\n    // ============================================================\n\n    _buildWavFromFloat32Mono(float32Data, sampleRate) {\n        const numSamples = float32Data.length;\n        const buffer = new ArrayBuffer(44 + numSamples * 2);\n        const view = new DataView(buffer);\n\n        // WAV Header\n        this._writeString(view, 0, 'RIFF');\n        view.setUint32(4, 36 + numSamples * 2, true);\n        this._writeString(view, 8, 'WAVE');\n        this._writeString(view, 12, 'fmt ');\n        view.setUint32(16, 16, true); // fmt chunk size\n        view.setUint16(20, 1, true);  // audio format (PCM)\n        view.setUint16(22, 1, true);  // number of channels\n        view.setUint32(24, sampleRate, true);\n        view.setUint32(28, sampleRate * 2, true); // byte rate\n        view.setUint16(32, 2, true);  // block align\n        view.setUint16(34, 16, true); // bits per sample\n        this._writeString(view, 36, 'data');\n        view.setUint32(40, numSamples * 2, true);\n\n        // PCM Data (float32 -> int16)\n        let offset = 44;\n        for (let i = 0; i < numSamples; i++) {\n            const sample = Math.max(-1, Math.min(1, float32Data[i]));\n            const int16 = sample < 0 ? sample * 0x8000 : sample * 0x7FFF;\n            view.setInt16(offset, int16, true);\n            offset += 2;\n        }\n\n        return buffer;\n    }\n\n    _writeString(view, offset, string) {\n        for (let i = 0; i < string.length; i++) {\n            view.setUint8(offset + i, string.charCodeAt(i));\n        }\n    }\n}\n\nexport default AudioEngine;\n","/**\n * CapacitorAdapter - Capacitor æª”æ¡ˆç³»çµ±å„²å­˜é©é…å™¨\n * ä½¿ç”¨ Capacitor Filesystem Plugin åœ¨ç§»å‹•è£ç½®ä¸Šå„²å­˜æª”æ¡ˆ\n */\n\nimport { StorageAdapter } from './StorageAdapter.js';\n\nexport class CapacitorAdapter extends StorageAdapter {\n  /**\n   * å»ºæ§‹å‡½æ•¸\n   * @param {string} directory - å„²å­˜ç›®éŒ„åç¨±\n   */\n  constructor(directory = 'recordings') {\n    super();\n    this.directory = directory;\n    \n    // æª¢æŸ¥ Capacitor æ˜¯å¦å¯ç”¨\n    if (typeof window === 'undefined' || !window.Capacitor) {\n      throw new Error('Capacitor not available. Make sure Capacitor is properly initialized.');\n    }\n    \n    this.Capacitor = window.Capacitor;\n    this.initialized = false;\n  }\n  \n  /**\n   * åˆå§‹åŒ–ï¼ˆç¢ºä¿ç›®éŒ„å­˜åœ¨ï¼‰\n   * @returns {Promise<void>}\n   */\n  async initialize() {\n    if (this.initialized) return;\n    \n    try {\n      const { Filesystem, Directory } = this.Capacitor.Plugins;\n      \n      // å˜—è©¦è®€å–ç›®éŒ„ï¼Œå¦‚æœä¸å­˜åœ¨å‰‡å‰µå»º\n      try {\n        await Filesystem.readdir({\n          path: this.directory,\n          directory: Directory.Documents\n        });\n      } catch (e) {\n        // ç›®éŒ„ä¸å­˜åœ¨ï¼Œå‰µå»ºå®ƒ\n        await Filesystem.mkdir({\n          path: this.directory,\n          directory: Directory.Documents,\n          recursive: true\n        });\n      }\n      \n      this.initialized = true;\n    } catch (error) {\n      console.error('Capacitor initialization error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * å„²å­˜éŸ³è¨Šæª”æ¡ˆ\n   * @param {Blob} blob - éŸ³è¨Š Blob\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @param {Object} metadata - å…ƒæ•¸æ“š\n   * @returns {Promise<string>} æª”æ¡ˆåç¨±\n   */\n  async save(blob, filename, metadata = {}) {\n    await this.initialize();\n    \n    try {\n      const { Filesystem, Directory } = this.Capacitor.Plugins;\n      \n      // è½‰æ› Blob ç‚º base64\n      const base64Data = await this.blobToBase64(blob);\n      \n      // å„²å­˜éŸ³è¨Šæª”æ¡ˆ\n      await Filesystem.writeFile({\n        path: `${this.directory}/${filename}`,\n        data: base64Data,\n        directory: Directory.Documents\n      });\n      \n      // å„²å­˜å…ƒæ•¸æ“š\n      if (metadata && Object.keys(metadata).length > 0) {\n        const metadataWithDefaults = {\n          ...metadata,\n          size: blob.size,\n          type: blob.type,\n          timestamp: Date.now()\n        };\n        \n        await Filesystem.writeFile({\n          path: `${this.directory}/${filename}.meta.json`,\n          data: JSON.stringify(metadataWithDefaults),\n          directory: Directory.Documents,\n          encoding: 'utf8'\n        });\n      }\n      \n      return filename;\n    } catch (error) {\n      console.error('Capacitor save error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * è¼‰å…¥éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @returns {Promise<Blob>}\n   */\n  async load(filename) {\n    await this.initialize();\n    \n    try {\n      const { Filesystem, Directory } = this.Capacitor.Plugins;\n      \n      const result = await Filesystem.readFile({\n        path: `${this.directory}/${filename}`,\n        directory: Directory.Documents\n      });\n      \n      // å°‡ base64 è½‰æ›ç‚º Blob\n      return this.base64ToBlob(result.data, 'audio/wav');\n    } catch (error) {\n      console.error('Capacitor load error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆªé™¤éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @returns {Promise<boolean>}\n   */\n  async delete(filename) {\n    await this.initialize();\n    \n    try {\n      const { Filesystem, Directory } = this.Capacitor.Plugins;\n      \n      // åˆªé™¤éŸ³è¨Šæª”æ¡ˆ\n      await Filesystem.deleteFile({\n        path: `${this.directory}/${filename}`,\n        directory: Directory.Documents\n      });\n      \n      // å˜—è©¦åˆªé™¤å…ƒæ•¸æ“šï¼ˆå¦‚æœå­˜åœ¨ï¼‰\n      try {\n        await Filesystem.deleteFile({\n          path: `${this.directory}/${filename}.meta.json`,\n          directory: Directory.Documents\n        });\n      } catch (e) {\n        // å…ƒæ•¸æ“šå¯èƒ½ä¸å­˜åœ¨ï¼Œå¿½ç•¥éŒ¯èª¤\n      }\n      \n      return true;\n    } catch (error) {\n      console.error('Capacitor delete error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆ—å‡ºæ‰€æœ‰æª”æ¡ˆ\n   * @returns {Promise<Array>}\n   */\n  async list() {\n    await this.initialize();\n    \n    try {\n      const { Filesystem, Directory } = this.Capacitor.Plugins;\n      \n      const result = await Filesystem.readdir({\n        path: this.directory,\n        directory: Directory.Documents\n      });\n      \n      // éæ¿¾æ‰å…ƒæ•¸æ“šæª”æ¡ˆï¼Œåªä¿ç•™éŸ³è¨Šæª”æ¡ˆ\n      const audioFiles = result.files.filter(f => !f.endsWith('.meta.json'));\n      \n      // ç‚ºæ¯å€‹æª”æ¡ˆè¼‰å…¥å…ƒæ•¸æ“š\n      const recordings = await Promise.all(\n        audioFiles.map(async (filename) => {\n          let metadata = {};\n          \n          try {\n            const metaResult = await Filesystem.readFile({\n              path: `${this.directory}/${filename}.meta.json`,\n              directory: Directory.Documents,\n              encoding: 'utf8'\n            });\n            metadata = JSON.parse(metaResult.data);\n          } catch (e) {\n            // æ²’æœ‰å…ƒæ•¸æ“š\n          }\n          \n          return {\n            id: filename,\n            filename: filename,\n            metadata: metadata,\n            timestamp: metadata.timestamp || 0,\n            date: metadata.timestamp ? new Date(metadata.timestamp) : null,\n            size: metadata.size || 0,\n            type: metadata.type || 'audio/wav'\n          };\n        })\n      );\n      \n      // æŒ‰æ™‚é–“æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰\n      recordings.sort((a, b) => b.timestamp - a.timestamp);\n      \n      return recordings;\n    } catch (error) {\n      console.error('Capacitor list error:', error);\n      return [];\n    }\n  }\n  \n  /**\n   * å–å¾—æª”æ¡ˆçš„ URIï¼ˆç”¨æ–¼æ’­æ”¾ï¼‰\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @returns {Promise<string>} æª”æ¡ˆ URI\n   */\n  async getUri(filename) {\n    await this.initialize();\n    \n    try {\n      const { Filesystem, Directory } = this.Capacitor.Plugins;\n      \n      const result = await Filesystem.getUri({\n        path: `${this.directory}/${filename}`,\n        directory: Directory.Documents\n      });\n      \n      return result.uri;\n    } catch (error) {\n      console.error('Capacitor getUri error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * Blob è½‰ base64\n   * @param {Blob} blob\n   * @returns {Promise<string>}\n   */\n  blobToBase64(blob) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        // ç§»é™¤ data:audio/wav;base64, å‰ç¶´\n        const base64 = reader.result.split(',')[1];\n        resolve(base64);\n      };\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }\n  \n  /**\n   * base64 è½‰ Blob\n   * @param {string} base64\n   * @param {string} mimeType\n   * @returns {Blob}\n   */\n  base64ToBlob(base64, mimeType = 'audio/wav') {\n    const byteCharacters = atob(base64);\n    const byteNumbers = new Array(byteCharacters.length);\n    \n    for (let i = 0; i < byteCharacters.length; i++) {\n      byteNumbers[i] = byteCharacters.charCodeAt(i);\n    }\n    \n    const byteArray = new Uint8Array(byteNumbers);\n    return new Blob([byteArray], { type: mimeType });\n  }\n  \n  /**\n   * å–å¾—å„²å­˜ç©ºé–“è³‡è¨Š\n   * @returns {Promise<Object>}\n   */\n  async getStorageInfo() {\n    const recordings = await this.list();\n    const totalSize = recordings.reduce((sum, r) => sum + (r.size || 0), 0);\n    \n    return {\n      count: recordings.length,\n      totalSize: totalSize,\n      totalSizeMB: (totalSize / (1024 * 1024)).toFixed(2),\n      recordings: recordings\n    };\n  }\n}\n\nexport default CapacitorAdapter;\n","/**\n * ElectronAdapter - Electron æª”æ¡ˆç³»çµ±å„²å­˜é©é…å™¨\n * ä½¿ç”¨ Electron çš„ IPC é€šè¨Šèˆ‡ä¸»é€²ç¨‹é€²è¡Œæª”æ¡ˆæ“ä½œ\n */\n\nimport { StorageAdapter } from './StorageAdapter.js';\n\nexport class ElectronAdapter extends StorageAdapter {\n  /**\n   * å»ºæ§‹å‡½æ•¸\n   * @param {string} savePath - é è¨­å„²å­˜è·¯å¾‘ï¼ˆç›¸å°æ–¼ç”¨æˆ¶æ–‡ä»¶ç›®éŒ„ï¼‰\n   */\n  constructor(savePath = 'recordings') {\n    super();\n    this.savePath = savePath;\n    \n    // æª¢æŸ¥ Electron API æ˜¯å¦å¯ç”¨\n    if (typeof window === 'undefined' || !window.electronAPI) {\n      throw new Error('Electron API not available. Make sure preload script is properly configured.');\n    }\n    \n    this.electronAPI = window.electronAPI;\n  }\n  \n  /**\n   * å„²å­˜éŸ³è¨Šæª”æ¡ˆ\n   * @param {Blob} blob - éŸ³è¨Š Blob\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @param {Object} metadata - å…ƒæ•¸æ“š\n   * @returns {Promise<string>} æª”æ¡ˆè·¯å¾‘\n   */\n  async save(blob, filename, metadata = {}) {\n    try {\n      // å°‡ Blob è½‰æ›ç‚º ArrayBuffer\n      const arrayBuffer = await blob.arrayBuffer();\n      \n      // è½‰æ›ç‚ºæ™®é€šé™£åˆ—ï¼ˆä»¥ä¾¿é€šé IPC å‚³éï¼‰\n      const buffer = Array.from(new Uint8Array(arrayBuffer));\n      \n      // å‘¼å« Electron API\n      const result = await this.electronAPI.saveRecording({\n        filename,\n        buffer,\n        metadata: {\n          ...metadata,\n          size: blob.size,\n          type: blob.type,\n          timestamp: Date.now()\n        }\n      });\n      \n      if (result.success) {\n        return result.id || result.path;\n      } else {\n        throw new Error(result.error || 'Save failed');\n      }\n    } catch (error) {\n      console.error('Electron save error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * è¼‰å…¥éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} filePath - æª”æ¡ˆè·¯å¾‘\n   * @returns {Promise<Blob>}\n   */\n  async load(filePath) {\n    try {\n      // å¾ Electron è®€å–æª”æ¡ˆ\n      const buffer = await this.electronAPI.loadRecording(filePath);\n      \n      // å°‡ Buffer è½‰æ›ç‚º Blob\n      const uint8Array = new Uint8Array(buffer);\n      return new Blob([uint8Array], { type: 'audio/wav' });\n    } catch (error) {\n      console.error('Electron load error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆªé™¤éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} filePath - æª”æ¡ˆè·¯å¾‘\n   * @returns {Promise<boolean>}\n   */\n  async delete(filePath) {\n    try {\n      const result = await this.electronAPI.deleteRecording(filePath);\n      return result.success;\n    } catch (error) {\n      console.error('Electron delete error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆ—å‡ºæ‰€æœ‰æª”æ¡ˆ\n   * @param {string} directory - ç›®éŒ„è·¯å¾‘ï¼ˆå¯é¸ï¼‰\n   * @returns {Promise<Array>}\n   */\n  async list(directory = null) {\n    try {\n      const recordings = await this.electronAPI.listRecordings(directory);\n      return recordings || [];\n    } catch (error) {\n      console.error('Electron list error:', error);\n      return [];\n    }\n  }\n  \n  /**\n   * é–‹å•Ÿæª”æ¡ˆé¸æ“‡å°è©±æ¡†\n   * @returns {Promise<string|null>} é¸æ“‡çš„æª”æ¡ˆè·¯å¾‘\n   */\n  async openFile() {\n    try {\n      if (this.electronAPI.openFile) {\n        return await this.electronAPI.openFile();\n      }\n      throw new Error('openFile API not available');\n    } catch (error) {\n      console.error('Electron openFile error:', error);\n      return null;\n    }\n  }\n  \n  /**\n   * é–‹å•Ÿå¦å­˜ç‚ºå°è©±æ¡†\n   * @param {Blob} blob - è¦å„²å­˜çš„ Blob\n   * @param {string} defaultFilename - é è¨­æª”æ¡ˆåç¨±\n   * @returns {Promise<string|null>} å„²å­˜çš„æª”æ¡ˆè·¯å¾‘\n   */\n  async saveAs(blob, defaultFilename = 'recording.wav') {\n    try {\n      const arrayBuffer = await blob.arrayBuffer();\n      const buffer = Array.from(new Uint8Array(arrayBuffer));\n      \n      if (this.electronAPI.saveAs) {\n        const result = await this.electronAPI.saveAs({\n          filename: defaultFilename,\n          buffer\n        });\n        \n        return result.success ? result.path : null;\n      }\n      \n      // å¦‚æœæ²’æœ‰ saveAs APIï¼Œä½¿ç”¨é è¨­çš„ save\n      return await this.save(blob, defaultFilename);\n    } catch (error) {\n      console.error('Electron saveAs error:', error);\n      return null;\n    }\n  }\n  \n  /**\n   * åœ¨æª”æ¡ˆç®¡ç†å™¨ä¸­é¡¯ç¤ºæª”æ¡ˆ\n   * @param {string} filePath - æª”æ¡ˆè·¯å¾‘\n   * @returns {Promise<boolean>}\n   */\n  async showInFolder(filePath) {\n    try {\n      if (this.electronAPI.showInFolder) {\n        await this.electronAPI.showInFolder(filePath);\n        return true;\n      }\n      return false;\n    } catch (error) {\n      console.error('Electron showInFolder error:', error);\n      return false;\n    }\n  }\n}\n\nexport default ElectronAdapter;\n","/**\n * IndexedDBAdapter - IndexedDB å„²å­˜å¯¦ç¾\n * ç”¨æ–¼ç€è¦½å™¨ç«¯æœ¬åœ°å„²å­˜ï¼Œç„¡éœ€ä¼ºæœå™¨\n */\n\nimport { StorageAdapter } from './StorageAdapter.js';\n\nexport class IndexedDBAdapter extends StorageAdapter {\n  /**\n   * å»ºæ§‹å‡½æ•¸\n   * @param {string} dbName - è³‡æ–™åº«åç¨±\n   * @param {string} storeName - å„²å­˜å€åç¨±\n   * @param {number} version - è³‡æ–™åº«ç‰ˆæœ¬\n   */\n  constructor(dbName = 'VoiceBankDB', storeName = 'recordings', version = 1) {\n    super();\n    this.dbName = dbName;\n    this.storeName = storeName;\n    this.version = version;\n    this.db = null;\n  }\n  \n  /**\n   * åˆå§‹åŒ–è³‡æ–™åº«\n   * @returns {Promise<IDBDatabase>}\n   */\n  async initialize() {\n    if (this.db) {\n      return this.db;\n    }\n    \n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(this.dbName, this.version);\n      \n      request.onerror = () => {\n        reject(new Error(`Failed to open IndexedDB: ${request.error}`));\n      };\n      \n      request.onsuccess = () => {\n        this.db = request.result;\n        resolve(this.db);\n      };\n      \n      request.onupgradeneeded = (event) => {\n        const db = event.target.result;\n        \n        // å‰µå»ºç‰©ä»¶å„²å­˜å€ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰\n        if (!db.objectStoreNames.contains(this.storeName)) {\n          const store = db.createObjectStore(this.storeName, { \n            keyPath: 'id', \n            autoIncrement: true \n          });\n          \n          // å‰µå»ºç´¢å¼•\n          store.createIndex('filename', 'filename', { unique: false });\n          store.createIndex('timestamp', 'timestamp', { unique: false });\n          store.createIndex('duration', 'duration', { unique: false });\n        }\n      };\n    });\n  }\n  \n  /**\n   * å„²å­˜éŸ³è¨Šæª”æ¡ˆ\n   * @param {Blob} blob - éŸ³è¨Š Blob\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @param {Object} metadata - å…ƒæ•¸æ“š\n   * @returns {Promise<string>} æª”æ¡ˆ ID\n   */\n  async save(blob, filename, metadata = {}) {\n    await this.initialize();\n    \n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([this.storeName], 'readwrite');\n      const store = transaction.objectStore(this.storeName);\n      \n      const record = {\n        filename: filename,\n        blob: blob,\n        size: blob.size,\n        type: blob.type,\n        timestamp: Date.now(),\n        metadata: metadata\n      };\n      \n      const request = store.add(record);\n      \n      request.onsuccess = () => {\n        resolve(String(request.result));\n      };\n      \n      request.onerror = () => {\n        reject(new Error(`Failed to save recording: ${request.error}`));\n      };\n      \n      transaction.onerror = () => {\n        reject(new Error(`Transaction failed: ${transaction.error}`));\n      };\n    });\n  }\n  \n  /**\n   * è¼‰å…¥éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} id - æª”æ¡ˆ ID\n   * @returns {Promise<Blob>}\n   */\n  async load(id) {\n    await this.initialize();\n    \n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([this.storeName], 'readonly');\n      const store = transaction.objectStore(this.storeName);\n      const request = store.get(Number(id));\n      \n      request.onsuccess = () => {\n        const record = request.result;\n        if (record && record.blob) {\n          resolve(record.blob);\n        } else {\n          reject(new Error(`Recording not found: ${id}`));\n        }\n      };\n      \n      request.onerror = () => {\n        reject(new Error(`Failed to load recording: ${request.error}`));\n      };\n    });\n  }\n  \n  /**\n   * åˆªé™¤éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} id - æª”æ¡ˆ ID\n   * @returns {Promise<boolean>}\n   */\n  async delete(id) {\n    await this.initialize();\n    \n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([this.storeName], 'readwrite');\n      const store = transaction.objectStore(this.storeName);\n      const request = store.delete(Number(id));\n      \n      request.onsuccess = () => {\n        resolve(true);\n      };\n      \n      request.onerror = () => {\n        reject(new Error(`Failed to delete recording: ${request.error}`));\n      };\n    });\n  }\n  \n  /**\n   * åˆ—å‡ºæ‰€æœ‰æª”æ¡ˆ\n   * @returns {Promise<Array>}\n   */\n  async list() {\n    await this.initialize();\n    \n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([this.storeName], 'readonly');\n      const store = transaction.objectStore(this.storeName);\n      const request = store.getAll();\n      \n      request.onsuccess = () => {\n        const records = request.result.map(record => ({\n          id: String(record.id),\n          filename: record.filename,\n          size: record.size,\n          type: record.type,\n          timestamp: record.timestamp,\n          date: new Date(record.timestamp),\n          metadata: record.metadata || {}\n        }));\n        resolve(records);\n      };\n      \n      request.onerror = () => {\n        reject(new Error(`Failed to list recordings: ${request.error}`));\n      };\n    });\n  }\n  \n  /**\n   * æ ¹æ“šæª”åæœå°‹\n   * @param {string} filename - æª”æ¡ˆåç¨±ï¼ˆæ”¯æ´éƒ¨åˆ†åŒ¹é…ï¼‰\n   * @returns {Promise<Array>}\n   */\n  async searchByFilename(filename) {\n    const allRecords = await this.list();\n    return allRecords.filter(record => \n      record.filename.toLowerCase().includes(filename.toLowerCase())\n    );\n  }\n  \n  /**\n   * å–å¾—å„²å­˜ç©ºé–“ä½¿ç”¨æƒ…æ³\n   * @returns {Promise<Object>}\n   */\n  async getStorageInfo() {\n    const records = await this.list();\n    const totalSize = records.reduce((sum, record) => sum + record.size, 0);\n    \n    return {\n      count: records.length,\n      totalSize: totalSize,\n      totalSizeMB: (totalSize / (1024 * 1024)).toFixed(2),\n      records: records\n    };\n  }\n  \n  /**\n   * æ¸…ç©ºæ‰€æœ‰éŒ„éŸ³\n   * @returns {Promise<number>} åˆªé™¤çš„æ•¸é‡\n   */\n  async clear() {\n    await this.initialize();\n    \n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([this.storeName], 'readwrite');\n      const store = transaction.objectStore(this.storeName);\n      \n      // å…ˆå–å¾—æ•¸é‡\n      const countRequest = store.count();\n      \n      countRequest.onsuccess = () => {\n        const count = countRequest.result;\n        \n        // æ¸…ç©ºå„²å­˜å€\n        const clearRequest = store.clear();\n        \n        clearRequest.onsuccess = () => {\n          resolve(count);\n        };\n        \n        clearRequest.onerror = () => {\n          reject(new Error(`Failed to clear recordings: ${clearRequest.error}`));\n        };\n      };\n      \n      countRequest.onerror = () => {\n        reject(new Error(`Failed to count recordings: ${countRequest.error}`));\n      };\n    });\n  }\n  \n  /**\n   * å–å¾—ç€è¦½å™¨å„²å­˜ç©ºé–“é…é¡è³‡è¨Šï¼ˆå¦‚æœå¯ç”¨ï¼‰\n   * @returns {Promise<Object|null>}\n   */\n  async getStorageEstimate() {\n    if ('storage' in navigator && 'estimate' in navigator.storage) {\n      try {\n        const estimate = await navigator.storage.estimate();\n        return {\n          usage: estimate.usage,\n          quota: estimate.quota,\n          usageMB: (estimate.usage / (1024 * 1024)).toFixed(2),\n          quotaMB: (estimate.quota / (1024 * 1024)).toFixed(2),\n          usagePercent: ((estimate.usage / estimate.quota) * 100).toFixed(2)\n        };\n      } catch (error) {\n        console.warn('Failed to get storage estimate:', error);\n        return null;\n      }\n    }\n    return null;\n  }\n  \n  /**\n   * é—œé–‰è³‡æ–™åº«é€£æ¥\n   */\n  close() {\n    if (this.db) {\n      this.db.close();\n      this.db = null;\n    }\n  }\n}\n\nexport default IndexedDBAdapter;\n","/**\n * PlatformDetector - å¹³å°åµæ¸¬å·¥å…·\n * è‡ªå‹•åµæ¸¬ç•¶å‰é‹è¡Œç’°å¢ƒï¼ˆBrowser/Electron/Capacitorï¼‰\n */\n\nexport class PlatformDetector {\n  /**\n   * åµæ¸¬ç•¶å‰å¹³å°\n   * @returns {string} 'browser' | 'electron' | 'capacitor'\n   */\n  static detect() {\n    // æª¢æŸ¥æ˜¯å¦ç‚º Electron\n    if (typeof window !== 'undefined' && window.electronAPI) {\n      return 'electron';\n    }\n    \n    // æª¢æŸ¥æ˜¯å¦ç‚º Electronï¼ˆå¦ä¸€ç¨®æ–¹å¼ï¼‰\n    if (typeof process !== 'undefined' && process.versions && process.versions.electron) {\n      return 'electron';\n    }\n    \n    // æª¢æŸ¥æ˜¯å¦ç‚º Capacitor\n    if (typeof window !== 'undefined' && window.Capacitor) {\n      return 'capacitor';\n    }\n    \n    // é è¨­ç‚ºç€è¦½å™¨\n    return 'browser';\n  }\n  \n  /**\n   * æª¢æŸ¥æ˜¯å¦ç‚º Electron ç’°å¢ƒ\n   * @returns {boolean}\n   */\n  static isElectron() {\n    return this.detect() === 'electron';\n  }\n  \n  /**\n   * æª¢æŸ¥æ˜¯å¦ç‚º Capacitor ç’°å¢ƒ\n   * @returns {boolean}\n   */\n  static isCapacitor() {\n    return this.detect() === 'capacitor';\n  }\n  \n  /**\n   * æª¢æŸ¥æ˜¯å¦ç‚ºç€è¦½å™¨ç’°å¢ƒ\n   * @returns {boolean}\n   */\n  static isBrowser() {\n    return this.detect() === 'browser';\n  }\n  \n  /**\n   * æª¢æŸ¥æ˜¯å¦ç‚ºç§»å‹•è£ç½®\n   * @returns {boolean}\n   */\n  static isMobile() {\n    if (typeof window === 'undefined' || !window.navigator) {\n      return false;\n    }\n    \n    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n      window.navigator.userAgent\n    );\n  }\n  \n  /**\n   * æª¢æŸ¥æ˜¯å¦æ”¯æ´ AudioWorklet\n   * @returns {boolean}\n   */\n  static supportsAudioWorklet() {\n    if (typeof window === 'undefined' || !window.AudioContext) {\n      return false;\n    }\n    \n    const AudioContextClass = window.AudioContext || window.webkitAudioContext;\n    return 'audioWorklet' in AudioContextClass.prototype;\n  }\n  \n  /**\n   * æª¢æŸ¥æ˜¯å¦æ”¯æ´ OffscreenCanvas\n   * @returns {boolean}\n   */\n  static supportsOffscreenCanvas() {\n    return typeof OffscreenCanvas !== 'undefined';\n  }\n  \n  /**\n   * å–å¾—å¹³å°è³‡è¨Š\n   * @returns {Object}\n   */\n  static getInfo() {\n    return {\n      platform: this.detect(),\n      isElectron: this.isElectron(),\n      isCapacitor: this.isCapacitor(),\n      isBrowser: this.isBrowser(),\n      isMobile: this.isMobile(),\n      supportsAudioWorklet: this.supportsAudioWorklet(),\n      supportsOffscreenCanvas: this.supportsOffscreenCanvas(),\n      userAgent: typeof navigator !== 'undefined' ? navigator.userAgent : 'unknown'\n    };\n  }\n}\n\nexport default PlatformDetector;\n","/**\n * RecorderUI.js\n * VoiceBank Recorder ä¸» UI æ§åˆ¶å™¨\n * \n * è·è²¬ï¼š\n * - ç®¡ç†æ‰€æœ‰ UI å…ƒç´ å’Œç‹€æ…‹\n * - å”èª¿ AudioEngine å’Œ WaveformRenderer\n * - è™•ç†ç”¨æˆ¶äº¤äº’äº‹ä»¶\n * - æ›´æ–° UI é¡¯ç¤º\n * \n * @module RecorderUI\n * @requires AudioEngine\n * @requires WaveformRenderer\n */\n\n/**\n * RecorderUI é¡ - ä¸» UI æ§åˆ¶å™¨\n */\nexport class RecorderUI {\n  /**\n   * å»ºæ§‹å‡½æ•¸\n   * @param {string|HTMLElement} container - å®¹å™¨é¸æ“‡å™¨æˆ–å…ƒç´ \n   * @param {Object} options - é…ç½®é¸é …\n   * @param {AudioEngine} options.audioEngine - éŸ³è¨Šå¼•æ“å¯¦ä¾‹\n   * @param {WaveformRenderer} options.waveformRenderer - æ³¢å½¢æ¸²æŸ“å™¨å¯¦ä¾‹\n   * @param {Object} options.callbacks - å›èª¿å‡½æ•¸\n   */\n  constructor(container, options = {}) {\n    // å®¹å™¨å…ƒç´ \n    this.container = typeof container === 'string' \n      ? document.querySelector(container) \n      : container;\n    \n    if (!this.container) {\n      throw new Error('Container element not found');\n    }\n    \n    // æ ¸å¿ƒæ¨¡çµ„å¼•ç”¨\n    this.audioEngine = options.audioEngine;\n    this.waveformRenderer = options.waveformRenderer;\n    \n    // é…ç½®é¸é …\n    this.options = {\n      layout: options.layout || 'auto', // 'horizontal', 'vertical', 'auto'\n      theme: options.theme || 'light',  // 'light', 'dark'\n      showOverview: options.showOverview !== false,\n      ...options\n    };\n    \n    // å›èª¿å‡½æ•¸\n    this.callbacks = {\n      onRecordStart: options.onRecordStart || (() => {}),\n      onRecordStop: options.onRecordStop || (() => {}),\n      onPlayStart: options.onPlayStart || (() => {}),\n      onPlayStop: options.onPlayStop || (() => {}),\n      onError: options.onError || ((error) => console.error('UI Error:', error)),\n      ...options.callbacks\n    };\n    \n    // UI å…ƒç´ å¼•ç”¨ï¼ˆåˆå§‹åŒ–å¾Œå¡«å……ï¼‰\n    this.elements = {};\n    \n    // ç‹€æ…‹\n    this.state = {\n      isRecording: false,\n      isPlaying: false,\n      isPaused: false,\n      hasRecording: false,\n      duration: 0,\n      sampleCount: 0\n    };\n    \n    // å­æ§åˆ¶å™¨ï¼ˆå¯é¸ï¼‰\n    this.controlPanel = null;\n    this.playbackController = null;\n    this.layoutManager = null;\n  }\n  \n  /**\n   * åˆå§‹åŒ– UI\n   */\n  async initialize() {\n    try {\n      // 1. æ¸²æŸ“ UI çµæ§‹\n      this.renderUI();\n      \n      // 2. ç²å– DOM å…ƒç´ å¼•ç”¨\n      this.cacheElements();\n      \n      // 3. ç¶å®šäº‹ä»¶è™•ç†å™¨\n      this.bindEvents();\n      \n      // 4. åˆå§‹åŒ–å­æ§åˆ¶å™¨ï¼ˆå¦‚æœéœ€è¦ï¼‰\n      this.initializeSubControllers();\n      \n      // 5. æ‡‰ç”¨åˆå§‹è¨­å®š\n      this.applyInitialSettings();\n      \n      // 6. é€£æ¥æ ¸å¿ƒæ¨¡çµ„äº‹ä»¶\n      this.connectCoreModules();\n      \n      console.log('âœ… RecorderUI initialized');\n    } catch (error) {\n      this.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * æ¸²æŸ“ UI çµæ§‹\n   * æ³¨æ„ï¼šé€™æ˜¯ç°¡åŒ–ç‰ˆï¼Œå¯¦éš›æ‡‰è©²å¾ public/index.html æå–å®Œæ•´ HTML\n   */\n  renderUI() {\n    this.container.innerHTML = `\n      <div class=\"voicebank-recorder\" data-layout=\"${this.options.layout}\" data-theme=\"${this.options.theme}\">\n        <!-- æ§åˆ¶é¢æ¿ -->\n        <div class=\"recorder-controls\">\n          <button id=\"vbr-btn-record\" class=\"btn-record\">\n            <span class=\"icon\">â—</span>\n            <span class=\"label\">é–‹å§‹éŒ„éŸ³</span>\n          </button>\n          \n          <div class=\"recording-info\">\n            <span id=\"vbr-recording-duration\">00:00.0</span>\n            <span id=\"vbr-sample-count\">0 samples</span>\n          </div>\n        </div>\n        \n        <!-- æ³¢å½¢å®¹å™¨ -->\n        <div class=\"waveform-wrapper\" id=\"vbr-waveform-wrapper\">\n          <!-- å³æ™‚æ³¢å½¢ -->\n          <div class=\"waveform-section\">\n            <label>å³æ™‚æ³¢å½¢</label>\n            <canvas id=\"vbr-live-waveform\" width=\"800\" height=\"120\"></canvas>\n          </div>\n          \n          <!-- VU Meter -->\n          <div class=\"waveform-section\">\n            <label>éŸ³é‡è¡¨</label>\n            <canvas id=\"vbr-vu-meter\" width=\"800\" height=\"50\"></canvas>\n          </div>\n          \n          <!-- ç´¯ç©æ³¢å½¢ -->\n          <div class=\"waveform-section\">\n            <label>ç´¯ç©æ³¢å½¢</label>\n            <canvas id=\"vbr-accumulated-waveform\" width=\"800\" height=\"200\"></canvas>\n          </div>\n          \n          <!-- æ¦‚è¦½æ³¢å½¢ -->\n          ${this.options.showOverview ? `\n          <div class=\"waveform-section\">\n            <label>æ¦‚è¦½æ³¢å½¢</label>\n            <canvas id=\"vbr-overview-waveform\" width=\"800\" height=\"80\"></canvas>\n          </div>\n          ` : ''}\n        </div>\n        \n        <!-- æ’­æ”¾æ§åˆ¶ -->\n        <div class=\"playback-controls\">\n          <button id=\"vbr-btn-play\" class=\"btn-play\" disabled>\n            <span class=\"icon\">â–¶</span>\n            <span class=\"label\">æ’­æ”¾</span>\n          </button>\n          <button id=\"vbr-btn-pause\" class=\"btn-pause\" disabled>\n            <span class=\"icon\">â¸</span>\n            <span class=\"label\">æš«åœ</span>\n          </button>\n          <button id=\"vbr-btn-stop\" class=\"btn-stop\" disabled>\n            <span class=\"icon\">â¹</span>\n            <span class=\"label\">åœæ­¢</span>\n          </button>\n        </div>\n        \n        <!-- å·¥å…·åˆ— -->\n        <div class=\"toolbar\">\n          <button id=\"vbr-btn-save\" class=\"btn-save\" disabled>\n            <span class=\"icon\">ğŸ’¾</span>\n            <span class=\"label\">å„²å­˜</span>\n          </button>\n          <button id=\"vbr-btn-clear\" class=\"btn-clear\" disabled>\n            <span class=\"icon\">ğŸ—‘ï¸</span>\n            <span class=\"label\">æ¸…é™¤</span>\n          </button>\n          <button id=\"vbr-btn-layout-toggle\" class=\"btn-layout-toggle\">\n            <span class=\"icon\">ğŸ”„</span>\n            <span class=\"label\">åˆ‡æ›ä½ˆå±€</span>\n          </button>\n        </div>\n      </div>\n    `;\n  }\n  \n  /**\n   * ç·©å­˜ DOM å…ƒç´ å¼•ç”¨\n   */\n  cacheElements() {\n    this.elements = {\n      // æŒ‰éˆ•\n      btnRecord: document.getElementById('vbr-btn-record'),\n      btnPlay: document.getElementById('vbr-btn-play'),\n      btnPause: document.getElementById('vbr-btn-pause'),\n      btnStop: document.getElementById('vbr-btn-stop'),\n      btnSave: document.getElementById('vbr-btn-save'),\n      btnClear: document.getElementById('vbr-btn-clear'),\n      btnLayoutToggle: document.getElementById('vbr-btn-layout-toggle'),\n      \n      // é¡¯ç¤ºå…ƒç´ \n      recordingDuration: document.getElementById('vbr-recording-duration'),\n      sampleCount: document.getElementById('vbr-sample-count'),\n      waveformWrapper: document.getElementById('vbr-waveform-wrapper'),\n      \n      // Canvas å…ƒç´ \n      liveCanvas: document.getElementById('vbr-live-waveform'),\n      vuMeterCanvas: document.getElementById('vbr-vu-meter'),\n      accumulatedCanvas: document.getElementById('vbr-accumulated-waveform'),\n      overviewCanvas: document.getElementById('vbr-overview-waveform')\n    };\n  }\n  \n  /**\n   * ç¶å®šäº‹ä»¶è™•ç†å™¨\n   */\n  bindEvents() {\n    // éŒ„éŸ³æŒ‰éˆ•\n    if (this.elements.btnRecord) {\n      this.elements.btnRecord.addEventListener('click', () => {\n        this.handleRecordToggle();\n      });\n    }\n    \n    // æ’­æ”¾æ§åˆ¶æŒ‰éˆ•\n    if (this.elements.btnPlay) {\n      this.elements.btnPlay.addEventListener('click', () => {\n        this.handlePlay();\n      });\n    }\n    \n    if (this.elements.btnPause) {\n      this.elements.btnPause.addEventListener('click', () => {\n        this.handlePause();\n      });\n    }\n    \n    if (this.elements.btnStop) {\n      this.elements.btnStop.addEventListener('click', () => {\n        this.handleStop();\n      });\n    }\n    \n    // å·¥å…·æŒ‰éˆ•\n    if (this.elements.btnSave) {\n      this.elements.btnSave.addEventListener('click', () => {\n        this.handleSave();\n      });\n    }\n    \n    if (this.elements.btnClear) {\n      this.elements.btnClear.addEventListener('click', () => {\n        this.handleClear();\n      });\n    }\n    \n    if (this.elements.btnLayoutToggle) {\n      this.elements.btnLayoutToggle.addEventListener('click', () => {\n        this.handleLayoutToggle();\n      });\n    }\n    \n    // è¦–çª—å¤§å°è®Šæ›´\n    window.addEventListener('resize', () => {\n      this.handleResize();\n    });\n  }\n  \n  /**\n   * åˆå§‹åŒ–å­æ§åˆ¶å™¨ï¼ˆå¯é¸ï¼‰\n   */\n  initializeSubControllers() {\n    // é€™è£¡å¯ä»¥åˆå§‹åŒ–å…¶ä»– UI å­æ§åˆ¶å™¨\n    // ä¾‹å¦‚ï¼šthis.controlPanel = new ControlPanel(this);\n    // ç›®å‰å…ˆä¿æŒç°¡å–®\n  }\n  \n  /**\n   * æ‡‰ç”¨åˆå§‹è¨­å®š\n   */\n  applyInitialSettings() {\n    // æ‡‰ç”¨ä½ˆå±€\n    this.applyLayout(this.options.layout);\n    \n    // æ‡‰ç”¨ä¸»é¡Œ\n    this.applyTheme(this.options.theme);\n    \n    // åˆå§‹åŒ–æŒ‰éˆ•ç‹€æ…‹\n    this.updateButtonStates();\n  }\n  \n  /**\n   * é€£æ¥æ ¸å¿ƒæ¨¡çµ„äº‹ä»¶\n   */\n  connectCoreModules() {\n    if (!this.audioEngine || !this.waveformRenderer) {\n      console.warn('Core modules not provided, UI will have limited functionality');\n      return;\n    }\n    \n    // AudioEngine äº‹ä»¶\n    this.audioEngine.on('recording-start', () => {\n      this.onRecordingStart();\n    });\n    \n    this.audioEngine.on('recording-stop', (data) => {\n      this.onRecordingStop(data);\n    });\n    \n    this.audioEngine.on('data-available', (data) => {\n      this.onDataAvailable(data);\n    });\n    \n    this.audioEngine.on('error', (error) => {\n      this.onAudioError(error);\n    });\n  }\n  \n  // ==================== äº‹ä»¶è™•ç†å™¨ ====================\n  \n  /**\n   * è™•ç†éŒ„éŸ³æŒ‰éˆ•åˆ‡æ›\n   */\n  async handleRecordToggle() {\n    try {\n      if (this.state.isRecording) {\n        // åœæ­¢éŒ„éŸ³\n        await this.audioEngine.stopRecording();\n      } else {\n        // é–‹å§‹éŒ„éŸ³\n        await this.audioEngine.startRecording();\n      }\n    } catch (error) {\n      this.callbacks.onError(error);\n      this.showError('éŒ„éŸ³æ“ä½œå¤±æ•—ï¼š' + error.message);\n    }\n  }\n  \n  /**\n   * è™•ç†æ’­æ”¾\n   */\n  async handlePlay() {\n    try {\n      // TODO: å¯¦ç¾æ’­æ”¾é‚è¼¯\n      console.log('Play recording');\n      this.callbacks.onPlayStart();\n    } catch (error) {\n      this.callbacks.onError(error);\n    }\n  }\n  \n  /**\n   * è™•ç†æš«åœ\n   */\n  async handlePause() {\n    try {\n      // TODO: å¯¦ç¾æš«åœé‚è¼¯\n      console.log('Pause playback');\n    } catch (error) {\n      this.callbacks.onError(error);\n    }\n  }\n  \n  /**\n   * è™•ç†åœæ­¢\n   */\n  async handleStop() {\n    try {\n      // TODO: å¯¦ç¾åœæ­¢é‚è¼¯\n      console.log('Stop playback');\n      this.callbacks.onPlayStop();\n    } catch (error) {\n      this.callbacks.onError(error);\n    }\n  }\n  \n  /**\n   * è™•ç†å„²å­˜\n   */\n  async handleSave() {\n    try {\n      // TODO: å¯¦ç¾å„²å­˜é‚è¼¯\n      console.log('Save recording');\n    } catch (error) {\n      this.callbacks.onError(error);\n    }\n  }\n  \n  /**\n   * è™•ç†æ¸…é™¤\n   */\n  async handleClear() {\n    if (!confirm('ç¢ºå®šè¦æ¸…é™¤ç•¶å‰éŒ„éŸ³å—ï¼Ÿ')) {\n      return;\n    }\n    \n    try {\n      // æ¸…é™¤æ³¢å½¢\n      if (this.waveformRenderer) {\n        this.waveformRenderer.reset();\n      }\n      \n      // é‡ç½®ç‹€æ…‹\n      this.state.hasRecording = false;\n      this.state.duration = 0;\n      this.state.sampleCount = 0;\n      \n      // æ›´æ–°é¡¯ç¤º\n      this.updateDurationDisplay();\n      this.updateButtonStates();\n      \n      console.log('Recording cleared');\n    } catch (error) {\n      this.callbacks.onError(error);\n    }\n  }\n  \n  /**\n   * è™•ç†ä½ˆå±€åˆ‡æ›\n   */\n  handleLayoutToggle() {\n    const currentLayout = this.container.dataset.layout;\n    const newLayout = currentLayout === 'horizontal' ? 'vertical' : 'horizontal';\n    this.applyLayout(newLayout);\n  }\n  \n  /**\n   * è™•ç†è¦–çª—å¤§å°è®Šæ›´\n   */\n  handleResize() {\n    // èª¿æ•´ Canvas å°ºå¯¸\n    if (this.waveformRenderer) {\n      this.waveformRenderer.resize();\n    }\n  }\n  \n  // ==================== æ ¸å¿ƒæ¨¡çµ„äº‹ä»¶å›èª¿ ====================\n  \n  /**\n   * éŒ„éŸ³é–‹å§‹å›èª¿\n   */\n  onRecordingStart() {\n    this.state.isRecording = true;\n    this.state.hasRecording = true;\n    \n    // æ›´æ–° UI\n    this.setRecordingState(true);\n    this.updateButtonStates();\n    \n    // å•Ÿå‹•æ³¢å½¢é¡¯ç¤º\n    if (this.waveformRenderer) {\n      // WaveformRenderer æœƒè‡ªå‹•å¾ AudioEngine ç²å–æ•¸æ“š\n    }\n    \n    // å›èª¿\n    this.callbacks.onRecordStart();\n    \n    console.log('ğŸ™ï¸ Recording started');\n  }\n  \n  /**\n   * éŒ„éŸ³åœæ­¢å›èª¿\n   */\n  onRecordingStop(data) {\n    this.state.isRecording = false;\n    \n    // æ›´æ–° UI\n    this.setRecordingState(false);\n    this.updateButtonStates();\n    \n    // å›èª¿\n    this.callbacks.onRecordStop(data);\n    \n    console.log('â¹ï¸ Recording stopped', data);\n  }\n  \n  /**\n   * æ•¸æ“šå¯ç”¨å›èª¿\n   */\n  onDataAvailable(data) {\n    // æ›´æ–°æ™‚é•·å’Œæ¨£æœ¬æ•¸\n    if (data.duration !== undefined) {\n      this.state.duration = data.duration;\n    }\n    if (data.sampleCount !== undefined) {\n      this.state.sampleCount = data.sampleCount;\n    }\n    \n    // æ›´æ–°é¡¯ç¤º\n    this.updateDurationDisplay();\n  }\n  \n  /**\n   * éŸ³è¨ŠéŒ¯èª¤å›èª¿\n   */\n  onAudioError(error) {\n    this.showError('éŸ³è¨ŠéŒ¯èª¤ï¼š' + error.message);\n    this.callbacks.onError(error);\n  }\n  \n  // ==================== UI æ›´æ–°æ–¹æ³• ====================\n  \n  /**\n   * è¨­å®šéŒ„éŸ³ç‹€æ…‹\n   * @param {boolean} isRecording - æ˜¯å¦æ­£åœ¨éŒ„éŸ³\n   */\n  setRecordingState(isRecording) {\n    const btn = this.elements.btnRecord;\n    if (!btn) return;\n    \n    if (isRecording) {\n      btn.classList.add('recording');\n      btn.querySelector('.icon').textContent = 'â¹';\n      btn.querySelector('.label').textContent = 'åœæ­¢éŒ„éŸ³';\n    } else {\n      btn.classList.remove('recording');\n      btn.querySelector('.icon').textContent = 'â—';\n      btn.querySelector('.label').textContent = 'é–‹å§‹éŒ„éŸ³';\n    }\n  }\n  \n  /**\n   * æ›´æ–°æŒ‰éˆ•ç‹€æ…‹\n   */\n  updateButtonStates() {\n    const { isRecording, isPlaying, isPaused, hasRecording } = this.state;\n    \n    // éŒ„éŸ³æŒ‰éˆ•ï¼šæ’­æ”¾æ™‚ç¦ç”¨\n    if (this.elements.btnRecord) {\n      this.elements.btnRecord.disabled = isPlaying;\n    }\n    \n    // æ’­æ”¾æ§åˆ¶æŒ‰éˆ•ï¼šæ²’æœ‰éŒ„éŸ³æ™‚ç¦ç”¨\n    if (this.elements.btnPlay) {\n      this.elements.btnPlay.disabled = !hasRecording || isRecording || isPlaying;\n    }\n    \n    if (this.elements.btnPause) {\n      this.elements.btnPause.disabled = !isPlaying || isPaused;\n    }\n    \n    if (this.elements.btnStop) {\n      this.elements.btnStop.disabled = !isPlaying && !isPaused;\n    }\n    \n    // å·¥å…·æŒ‰éˆ•\n    if (this.elements.btnSave) {\n      this.elements.btnSave.disabled = !hasRecording || isRecording;\n    }\n    \n    if (this.elements.btnClear) {\n      this.elements.btnClear.disabled = !hasRecording || isRecording;\n    }\n  }\n  \n  /**\n   * æ›´æ–°æ™‚é•·é¡¯ç¤º\n   */\n  updateDurationDisplay() {\n    if (this.elements.recordingDuration) {\n      this.elements.recordingDuration.textContent = this.formatDuration(this.state.duration);\n    }\n    \n    if (this.elements.sampleCount) {\n      this.elements.sampleCount.textContent = `${this.state.sampleCount.toLocaleString()} samples`;\n    }\n  }\n  \n  /**\n   * æ ¼å¼åŒ–æ™‚é•·\n   * @param {number} seconds - ç§’æ•¸\n   * @returns {string} æ ¼å¼åŒ–å¾Œçš„æ™‚é•· (MM:SS.S)\n   */\n  formatDuration(seconds) {\n    const minutes = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    const decimal = Math.floor((seconds % 1) * 10);\n    \n    return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}.${decimal}`;\n  }\n  \n  /**\n   * æ‡‰ç”¨ä½ˆå±€\n   * @param {string} layout - 'horizontal', 'vertical', 'auto'\n   */\n  applyLayout(layout) {\n    if (layout === 'auto') {\n      // è‡ªå‹•åµæ¸¬\n      layout = window.innerWidth > window.innerHeight ? 'horizontal' : 'vertical';\n    }\n    \n    this.container.dataset.layout = layout;\n    this.options.layout = layout;\n    \n    // é€šçŸ¥ WaveformRenderer\n    if (this.waveformRenderer) {\n      this.waveformRenderer.setVerticalMode(layout === 'vertical');\n    }\n    \n    console.log(`ğŸ“ Layout changed to: ${layout}`);\n  }\n  \n  /**\n   * æ‡‰ç”¨ä¸»é¡Œ\n   * @param {string} theme - 'light', 'dark'\n   */\n  applyTheme(theme) {\n    this.container.dataset.theme = theme;\n    this.options.theme = theme;\n    \n    console.log(`ğŸ¨ Theme changed to: ${theme}`);\n  }\n  \n  /**\n   * é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯\n   * @param {string} message - éŒ¯èª¤è¨Šæ¯\n   */\n  showError(message) {\n    // ç°¡å–®çš„éŒ¯èª¤é¡¯ç¤ºï¼ˆå¯ä»¥æ“´å±•ç‚ºæ›´å¥½çš„ UIï¼‰\n    alert('éŒ¯èª¤ï¼š' + message);\n  }\n  \n  /**\n   * é¡¯ç¤ºé€šçŸ¥\n   * @param {string} message - é€šçŸ¥è¨Šæ¯\n   * @param {number} duration - æŒçºŒæ™‚é–“ï¼ˆæ¯«ç§’ï¼‰\n   */\n  showNotice(message, duration = 3000) {\n    // ç°¡å–®çš„é€šçŸ¥é¡¯ç¤ºï¼ˆå¯ä»¥æ“´å±•ç‚ºæ›´å¥½çš„ UIï¼‰\n    console.log('ğŸ“¢ Notice:', message);\n  }\n  \n  // ==================== å…¬é–‹ API ====================\n  \n  /**\n   * å–å¾—ç•¶å‰ç‹€æ…‹\n   * @returns {Object} ç‹€æ…‹ç‰©ä»¶\n   */\n  getState() {\n    return { ...this.state };\n  }\n  \n  /**\n   * è¨­å®šé¸é …\n   * @param {Object} options - é¸é …ç‰©ä»¶\n   */\n  setOptions(options) {\n    this.options = { ...this.options, ...options };\n    \n    // æ‡‰ç”¨è®Šæ›´\n    if (options.layout) {\n      this.applyLayout(options.layout);\n    }\n    if (options.theme) {\n      this.applyTheme(options.theme);\n    }\n  }\n  \n  /**\n   * éŠ·æ¯€ UI\n   */\n  destroy() {\n    // ç§»é™¤äº‹ä»¶ç›£è½å™¨\n    // ï¼ˆç°¡åŒ–ç‰ˆï¼Œå¯¦éš›æ‡‰è©²è¨˜éŒ„æ‰€æœ‰ç›£è½å™¨ä¸¦é€ä¸€ç§»é™¤ï¼‰\n    \n    // æ¸…ç©ºå®¹å™¨\n    if (this.container) {\n      this.container.innerHTML = '';\n    }\n    \n    // æ¸…ç©ºå¼•ç”¨\n    this.elements = {};\n    this.audioEngine = null;\n    this.waveformRenderer = null;\n    \n    console.log('ğŸ—‘ï¸ RecorderUI destroyed');\n  }\n}\n\nexport default RecorderUI;\n","/**\n * ServerAdapter - ä¼ºæœå™¨å„²å­˜é©é…å™¨\n * æ”¯æ´ PHP/Node.js ç­‰å¾Œç«¯å„²å­˜æ–¹æ¡ˆ\n */\n\nimport { StorageAdapter } from './StorageAdapter.js';\n\nexport class ServerAdapter extends StorageAdapter {\n  /**\n   * å»ºæ§‹å‡½æ•¸\n   * @param {Object} config - é…ç½®é¸é …\n   * @param {string} config.baseURL - åŸºç¤ URL\n   * @param {string} config.saveEndpoint - ä¸Šå‚³ç«¯é»\n   * @param {string} config.loadEndpoint - ä¸‹è¼‰ç«¯é»\n   * @param {string} config.deleteEndpoint - åˆªé™¤ç«¯é»\n   * @param {string} config.listEndpoint - åˆ—è¡¨ç«¯é»ï¼ˆå¯é¸ï¼‰\n   */\n  constructor(config = {}) {\n    super();\n    this.baseURL = config.baseURL || '';\n    this.saveEndpoint = config.saveEndpoint || '/backend/save.php';\n    this.loadEndpoint = config.loadEndpoint || '/public/uploads/';\n    this.deleteEndpoint = config.deleteEndpoint || '/backend/delete.php';\n    this.listEndpoint = config.listEndpoint || '/api/recordings';\n    this.headers = config.headers || {};\n  }\n  \n  /**\n   * å„²å­˜éŸ³è¨Šæª”æ¡ˆ\n   * @param {Blob} blob - éŸ³è¨Š Blob\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @param {Object} metadata - å…ƒæ•¸æ“š\n   * @returns {Promise<string>} æª”æ¡ˆåç¨±\n   */\n  async save(blob, filename, metadata = {}) {\n    const formData = new FormData();\n    formData.append('audio-blob', blob);\n    formData.append('audio-filename', filename);\n    \n    if (metadata && Object.keys(metadata).length > 0) {\n      formData.append('metadata', JSON.stringify(metadata));\n    }\n    \n    try {\n      const response = await fetch(this.baseURL + this.saveEndpoint, {\n        method: 'POST',\n        body: formData,\n        headers: this.headers\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Upload failed: ${response.status} ${response.statusText}`);\n      }\n      \n      const result = await response.text();\n      \n      // æª¢æŸ¥ PHP ç«¯é»çš„å›æ‡‰ï¼ˆé€šå¸¸æ˜¯ 'success'ï¼‰\n      if (result.toLowerCase().includes('success')) {\n        return filename;\n      } else {\n        throw new Error(`Server error: ${result}`);\n      }\n    } catch (error) {\n      console.error('Save error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * è¼‰å…¥éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @returns {Promise<Blob>}\n   */\n  async load(filename) {\n    try {\n      const url = this.baseURL + this.loadEndpoint + filename;\n      const response = await fetch(url, {\n        headers: this.headers\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Load failed: ${response.status} ${response.statusText}`);\n      }\n      \n      return await response.blob();\n    } catch (error) {\n      console.error('Load error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆªé™¤éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @returns {Promise<boolean>}\n   */\n  async delete(filename) {\n    try {\n      const response = await fetch(this.baseURL + this.deleteEndpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.headers\n        },\n        body: JSON.stringify({ filename })\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Delete failed: ${response.status} ${response.statusText}`);\n      }\n      \n      const result = await response.text();\n      return result.toLowerCase().includes('success');\n    } catch (error) {\n      console.error('Delete error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆ—å‡ºæ‰€æœ‰æª”æ¡ˆ\n   * @returns {Promise<Array>}\n   */\n  async list() {\n    try {\n      const response = await fetch(this.baseURL + this.listEndpoint, {\n        headers: this.headers\n      });\n      \n      if (!response.ok) {\n        throw new Error(`List failed: ${response.status} ${response.statusText}`);\n      }\n      \n      const data = await response.json();\n      return Array.isArray(data) ? data : [];\n    } catch (error) {\n      console.error('List error:', error);\n      // å¦‚æœå¾Œç«¯ä¸æ”¯æ´ list æ“ä½œï¼Œè¿”å›ç©ºé™£åˆ—\n      return [];\n    }\n  }\n  \n  /**\n   * ä½¿ç”¨ XMLHttpRequest ä¸Šå‚³ï¼ˆå¸¶é€²åº¦å›èª¿ï¼‰\n   * @param {Blob} blob - éŸ³è¨Š Blob\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @param {Object} metadata - å…ƒæ•¸æ“š\n   * @param {Function} onProgress - é€²åº¦å›èª¿ (percent)\n   * @returns {Promise<string>}\n   */\n  async saveWithProgress(blob, filename, metadata = {}, onProgress = null) {\n    return new Promise((resolve, reject) => {\n      const formData = new FormData();\n      formData.append('audio-blob', blob);\n      formData.append('audio-filename', filename);\n      \n      if (metadata && Object.keys(metadata).length > 0) {\n        formData.append('metadata', JSON.stringify(metadata));\n      }\n      \n      const xhr = new XMLHttpRequest();\n      \n      // é€²åº¦äº‹ä»¶\n      if (onProgress) {\n        xhr.upload.addEventListener('progress', (e) => {\n          if (e.lengthComputable) {\n            const percent = (e.loaded / e.total) * 100;\n            onProgress(percent);\n          }\n        });\n      }\n      \n      // å®Œæˆäº‹ä»¶\n      xhr.addEventListener('load', () => {\n        if (xhr.status >= 200 && xhr.status < 300) {\n          const result = xhr.responseText;\n          if (result.toLowerCase().includes('success')) {\n            resolve(filename);\n          } else {\n            reject(new Error(`Server error: ${result}`));\n          }\n        } else {\n          reject(new Error(`Upload failed: ${xhr.status} ${xhr.statusText}`));\n        }\n      });\n      \n      // éŒ¯èª¤äº‹ä»¶\n      xhr.addEventListener('error', () => {\n        reject(new Error('Network error during upload'));\n      });\n      \n      // å–æ¶ˆäº‹ä»¶\n      xhr.addEventListener('abort', () => {\n        reject(new Error('Upload cancelled'));\n      });\n      \n      // ç™¼é€è«‹æ±‚\n      xhr.open('POST', this.baseURL + this.saveEndpoint);\n      \n      // è¨­å®šè‡ªå®šç¾© headers\n      Object.keys(this.headers).forEach(key => {\n        xhr.setRequestHeader(key, this.headers[key]);\n      });\n      \n      xhr.send(formData);\n    });\n  }\n}\n\nexport default ServerAdapter;\n","/**\n * Storage Module - å„²å­˜æ¨¡çµ„çµ±ä¸€å…¥å£\n * åŒ¯å‡ºæ‰€æœ‰å„²å­˜é©é…å™¨\n */\n\nexport { StorageAdapter } from './StorageAdapter.js';\nexport { IndexedDBAdapter } from './IndexedDBAdapter.js';\nexport { ServerAdapter } from './ServerAdapter.js';\nexport { ElectronAdapter } from './ElectronAdapter.js';\nexport { CapacitorAdapter } from './CapacitorAdapter.js';\n\n/**\n * StorageFactory - å„²å­˜é©é…å™¨å·¥å» \n * æ ¹æ“šé…ç½®è‡ªå‹•å‰µå»ºé©ç•¶çš„å„²å­˜é©é…å™¨\n */\nexport class StorageFactory {\n  /**\n   * å‰µå»ºå„²å­˜é©é…å™¨\n   * @param {Object} config - é…ç½®é¸é …\n   * @param {string} config.type - å„²å­˜é¡å‹ ('browser'|'electron'|'capacitor'|'server'|'auto')\n   * @param {Object} config.options - é©é…å™¨ç‰¹å®šé¸é …\n   * @returns {StorageAdapter}\n   */\n  static create(config = {}) {\n    const type = config.type || 'auto';\n    const options = config.options || {};\n    \n    // è‡ªå‹•åµæ¸¬\n    if (type === 'auto') {\n      return this.createAuto(options);\n    }\n    \n    // æ ¹æ“šé¡å‹å‰µå»º\n    switch (type.toLowerCase()) {\n      case 'browser':\n      case 'indexeddb':\n        const { IndexedDBAdapter } = require('./IndexedDBAdapter.js');\n        return new IndexedDBAdapter(\n          options.dbName,\n          options.storeName,\n          options.version\n        );\n      \n      case 'electron':\n        const { ElectronAdapter } = require('./ElectronAdapter.js');\n        return new ElectronAdapter(options.savePath);\n      \n      case 'capacitor':\n        const { CapacitorAdapter } = require('./CapacitorAdapter.js');\n        return new CapacitorAdapter(options.directory);\n      \n      case 'server':\n      case 'php':\n      case 'nodejs':\n        const { ServerAdapter } = require('./ServerAdapter.js');\n        return new ServerAdapter(options);\n      \n      default:\n        throw new Error(`Unknown storage type: ${type}`);\n    }\n  }\n  \n  /**\n   * è‡ªå‹•å‰µå»ºé©é…å™¨ï¼ˆæ ¹æ“šç’°å¢ƒï¼‰\n   * @param {Object} options - é¸é …\n   * @returns {StorageAdapter}\n   */\n  static createAuto(options = {}) {\n    // æª¢æŸ¥ Electron\n    if (typeof window !== 'undefined' && window.electronAPI) {\n      const { ElectronAdapter } = require('./ElectronAdapter.js');\n      return new ElectronAdapter(options.savePath);\n    }\n    \n    // æª¢æŸ¥ Capacitor\n    if (typeof window !== 'undefined' && window.Capacitor) {\n      const { CapacitorAdapter } = require('./CapacitorAdapter.js');\n      return new CapacitorAdapter(options.directory);\n    }\n    \n    // é è¨­ä½¿ç”¨ IndexedDBï¼ˆç€è¦½å™¨ï¼‰\n    const { IndexedDBAdapter } = require('./IndexedDBAdapter.js');\n    return new IndexedDBAdapter(\n      options.dbName,\n      options.storeName,\n      options.version\n    );\n  }\n}\n\nexport default StorageFactory;\n"],"names":["LiveWaveform","constructor","canvas","analyserNode","this","canvasContext","getContext","analyser","mediaStreamSource","animationId","isRunning","width","height","bufferLength","dataArray","amplification","_lastDataArray","_verticalScrollOffset","start","stream","audioContext","preGainNode","console","warn","hasAudioContext","hasAnalyser","log","self","contextReady","Promise","resolve","state","resume","catch","err","then","disconnect","createMediaStreamSource","connect","e","fftSize","Uint8Array","draw","stop","cancelAnimationFrame","clearRect","isVertical","requestAnimationFrame","getByteTimeDomainData","scrollSpeed","fillStyle","fillRect","lineWidth","strokeStyle","beginPath","sliceHeight","y","i","x","moveTo","lineTo","stroke","sliceWidth","VUMeter","ctx","timeData","Float32Array","levelDb","peakDb","holdPeakDb","lastPeakTime","peakHoldMillis","fallRateDbPerSec","minDb","maxDb","lastClipTime","clipHoldMillis","_lastLogTime","_computeLevels","rmsDb","required","length","getFloatTimeDomainData","sumSquares","peak","clipped","v","absV","Math","abs","rms","sqrt","log10","Infinity","performance","now","Date","resize","clear","currentDb","w","h","grd","createLinearGradient","addColorStop","norm","barGrad","barWidth","round","save","db","posNorm","xPos","label","toString","font","textAlign","textBaseline","fillText","restore","minus10Norm","minus10X","holdNorm","holdX","txt","toFixed","badgeW","badgeH","update","levels","elapsed","fallSeconds","fallAmount","max","loop","AccumulatedWaveform","options","targetSampleRate","sourceSampleRate","decimationFactor","sampleMin","sampleMax","sampleCount","zoomFactor","viewStart","isAutoScroll","_panRemainder","playbackPosition","isPlaying","playbackStartTime","playbackStartSample","rawZoomMode","rawViewStart","rawVisibleRaw","_useWorker","useWorker","_worker","_appendBatchMin","_appendBatchMax","_appendFlushScheduled","lastDetail","lastDensity","transferControlToOffscreen","Worker","off","workerPath","postMessage","type","verticalMode","showClipMarks","onmessage","ev","msg","data","detail","density","_setupMouseInteraction","isDragging","dragStartX","dragStartViewStart","addEventListener","offsetX","style","cursor","deltaX","samplesPerPixel","getVisibleSamples","visible","sampleDelta","_enforceViewBounds","preventDefault","rect","getBoundingClientRect","anchorRatio","clientX","left","zoomSteps","deltaY","zoomBySteps","info","clickRatio","clickedSample","floor","event","CustomEvent","sample","time","dispatchEvent","reset","append","audioSamples","factor","total","appendedMin","appendedMax","_lastAppendLog","blockMin","blockMax","blockSum","blockCount","j","blockMean","k","centeredSample","push","scrollToLatest","flush","_flushAppendBatch","setTimeout","minArr","maxArr","visibleSamples","min","end","centerY","yMin","yMax","minVis","_getMinVisibleSamples","setZoom","targetZoom","anchorSample","maxZoom","oldInfo","newInfo","desiredStart","stepCount","newZoom","pow","panBySamples","panByPixels","pixelDelta","totalDelta","intDelta","resetView","setSourceSampleRate","sampleRate","_getSamplePair","index","setPlaybackPosition","sampleIndex","setRawZoomMode","enabled","startPlayback","startSample","sr","updatePosition","rawSamples","decimatedPos","stopPlayback","_updatePlaybackPosition","OverviewWaveform","accumulatedWaveform","_workerRef","_warnedNoData","_lastTotal","acc","_handleSeek","clickX","targetSample","halfVisible","hasAcc","visibleStart","visibleEnd","canvasWidth","canvasHeight","viewStartX","viewEndX","viewWidth","strokeRect","StorageAdapter","blob","filename","metadata","Error","load","id","delete","list","exists","error","files","count","file","VoiceBankRecorder","mergeOptions","initialized","storage","createStorageAdapter","isRecording","isPaused","currentBlob","container","initializeUI","defaults","layout","theme","audio","channels","agc","gain","waveform","showOverview","showAccumulated","showLive","decimation","colors","selection","playback","callbacks","onRecordStart","onRecordStop","onRecordPause","onRecordResume","onPlayStart","onPlayStop","onError","deepMerge","target","source","result","key","Object","Array","isArray","storageConfig","StorageFactory","require","create","startRecording","stopRecording","pauseRecording","resumeRecording","play","saveRecording","blobToSave","filenameToUse","loadRecording","deleteRecording","listRecordings","recordings","getCurrentBlob","destroy","close","VERSION","BUILD_INFO","version","date","toISOString","name","config","autoGainControl","undefined","echoCancellation","noiseSuppression","micGain","deviceId","workletPath","preferWorklet","mediaDest","analyserSilencer","workletSupported","workletLoaded","pcmCollectorNode","usingWorklet","pcmChunks","pcmTotalSamples","recorder","_pcmCaptureInterval","micStream","isInitialized","recordStartTime","recordStopTime","recordWallStartMs","recordWallStopMs","latestBlob","latestUrl","_eventListeners","initialize","AudioContextClass","window","AudioContext","webkitAudioContext","createAnalyser","createGain","value","createMediaStreamDestination","destination","audioWorklet","AudioWorkletNode","addModule","_emit","path","stage","_captureMicrophone","URL","revokeObjectURL","useWorklet","_startWorkletRecording","_startRecordRTCRecording","timestamp","mode","_stopWorkletRecording","_stopRecordRTCRecording","_stopMicrophone","createObjectURL","duration","url","samples","getLatestRecording","getPcmWindow","out","offset","passed","chunk","cStart","cEnd","segStart","segEnd","localStart","slice","subarray","set","getAnalyser","getAudioContext","microphoneStream","setMicGain","dispose","_stopPcmCapture","on","handler","indexOf","splice","forEach","constraints","video","exact","navigator","mediaDevices","getUserMedia","_applyIOSMicGainAdjustment","getTracks","track","ua","userAgent","test","port","pcmData","totalSamples","merged","wavBuffer","_buildWavFromFloat32Mono","Blob","reject","RecordRTC","recordStream","mimeType","recorderType","StereoAudioRecorder","numberOfAudioChannels","bufferSize","timeSlice","ondataavailable","_startPcmCapture","getBlob","setInterval","pcmChunk","clearInterval","float32Data","numSamples","buffer","ArrayBuffer","view","DataView","_writeString","setUint32","setUint16","int16","setInt16","string","setUint8","charCodeAt","directory","super","Capacitor","Filesystem","Directory","Plugins","readdir","Documents","mkdir","recursive","base64Data","blobToBase64","writeFile","keys","metadataWithDefaults","size","JSON","stringify","encoding","readFile","base64ToBlob","deleteFile","audioFiles","filter","f","endsWith","all","map","async","metaResult","parse","sort","a","b","getUri","uri","reader","FileReader","onloadend","base64","split","onerror","readAsDataURL","byteCharacters","atob","byteNumbers","byteArray","getStorageInfo","totalSize","reduce","sum","r","totalSizeMB","savePath","electronAPI","arrayBuffer","from","success","filePath","uint8Array","openFile","saveAs","defaultFilename","showInFolder","dbName","storeName","request","indexedDB","open","onsuccess","onupgradeneeded","objectStoreNames","contains","store","createObjectStore","keyPath","autoIncrement","createIndex","unique","transaction","objectStore","record","add","String","get","Number","getAll","records","searchByFilename","toLowerCase","includes","countRequest","clearRequest","getStorageEstimate","estimate","usage","quota","usageMB","quotaMB","usagePercent","detect","process","versions","electron","isElectron","isCapacitor","isBrowser","isMobile","supportsAudioWorklet","prototype","supportsOffscreenCanvas","OffscreenCanvas","getInfo","platform","document","querySelector","audioEngine","waveformRenderer","elements","hasRecording","controlPanel","playbackController","layoutManager","renderUI","cacheElements","bindEvents","initializeSubControllers","applyInitialSettings","connectCoreModules","innerHTML","btnRecord","getElementById","btnPlay","btnPause","btnStop","btnSave","btnClear","btnLayoutToggle","recordingDuration","waveformWrapper","liveCanvas","vuMeterCanvas","accumulatedCanvas","overviewCanvas","handleRecordToggle","handlePlay","handlePause","handleStop","handleSave","handleClear","handleLayoutToggle","handleResize","applyLayout","applyTheme","updateButtonStates","onRecordingStart","onRecordingStop","onDataAvailable","onAudioError","showError","message","confirm","updateDurationDisplay","newLayout","dataset","setRecordingState","btn","classList","textContent","remove","disabled","formatDuration","toLocaleString","seconds","minutes","secs","decimal","padStart","innerWidth","innerHeight","setVerticalMode","alert","showNotice","getState","setOptions","baseURL","saveEndpoint","loadEndpoint","deleteEndpoint","listEndpoint","headers","formData","FormData","response","fetch","method","body","ok","status","statusText","text","json","saveWithProgress","onProgress","xhr","XMLHttpRequest","upload","lengthComputable","percent","loaded","responseText","setRequestHeader","send","createAuto","IndexedDBAdapter","ElectronAdapter","CapacitorAdapter","ServerAdapter","liveWaveform","vuMeter","overviewWaveform","isVerticalMode","_overviewUpdateScheduled","_setupAudioEngineListeners","stopLive","appendPCM","startLive","terminate"],"mappings":";;;;;;;;;;;wPA4RO,MAAMA,EACTC,WAAAA,CAAYC,EAAQC,GAChBC,KAAKF,OAASA,EACdE,KAAKC,cAAgBH,EAAOI,WAAW,MACvCF,KAAKG,SAAWJ,EAChBC,KAAKI,kBAAoB,KACzBJ,KAAKK,YAAc,KACnBL,KAAKM,WAAY,EAEjBN,KAAKO,MAAQT,EAAOS,MACpBP,KAAKQ,OAASV,EAAOU,OAErBR,KAAKS,aAAe,EACpBT,KAAKU,UAAY,KAEjBV,KAAKW,cAAgB,EAErBX,KAAKY,eAAiB,KACtBZ,KAAKa,sBAAwB,CACjC,CAQAC,KAAAA,CAAMC,EAAQC,EAAcC,GACxB,GAAIjB,KAAKM,YAAcU,IAAiBhB,KAAKG,SAMzC,YALAe,QAAQC,KAAK,8BAA+B,CACxCb,UAAWN,KAAKM,UAChBc,kBAAmBJ,EACnBK,cAAerB,KAAKG,WAK5Be,QAAQI,IAAI,0BACZtB,KAAKM,WAAY,EAEjB,MAAMiB,EAAOvB,KAGb,IAAIwB,EAAeC,QAAQC,UACA,cAAvBV,EAAaW,QACbH,EAAeR,EAAaY,SAASC,MAAM,SAASC,GAChDZ,QAAQC,KAAK,iCAAkCW,EACnD,IAIJN,EAAaO,KAAK,WAQd,GANIR,EAAKnB,mBACLmB,EAAKnB,kBAAkB4B,aAI3BT,EAAKnB,kBAAoBY,EAAaiB,wBAAwBlB,GAC1DE,EACA,IACIM,EAAKnB,kBAAkB8B,QAAQjB,EACnC,CAAE,MAAMkB,GACJjB,QAAQC,KAAK,6BAA8BgB,EAC/C,MAEAZ,EAAKnB,kBAAkB8B,QAAQX,EAAKpB,UAIxCoB,EAAKpB,SAASiC,QAAU,KACxBb,EAAKd,aAAec,EAAKpB,SAASiC,QAClCb,EAAKb,UAAY,IAAI2B,WAAWd,EAAKd,cAErCS,QAAQI,IAAI,8BAGZC,EAAKe,MAAK,EACd,EACJ,CAKAC,IAAAA,GACSvC,KAAKM,YAEVN,KAAKM,WAAY,EAEbN,KAAKI,oBACLJ,KAAKI,kBAAkB4B,aACvBhC,KAAKI,kBAAoB,MAGzBJ,KAAKK,cACLmC,qBAAqBxC,KAAKK,aAC1BL,KAAKK,YAAc,MAGvBL,KAAKC,cAAcwC,UAAU,EAAG,EAAGzC,KAAKO,MAAOP,KAAKQ,QACxD,CAMA8B,IAAAA,CAAKI,GAAa,GACd,GAAK1C,KAAKM,WAAcN,KAAKG,UAAaH,KAAKU,UAQ/C,GAJAV,KAAKK,YAAcsC,sBAAsB,IAAM3C,KAAKsC,KAAKI,IAEzD1C,KAAKG,SAASyC,sBAAsB5C,KAAKU,WAEpCgC,EA2BE,CAEH,MAAMG,EAAc,EACpB7C,KAAKa,uBAAyBgC,EAE1B7C,KAAKa,uBAAyBb,KAAKQ,SACnCR,KAAKa,sBAAwB,EAC7Bb,KAAKC,cAAc6C,UAAY,UAC/B9C,KAAKC,cAAc8C,SAAS,EAAG,EAAG/C,KAAKO,MAAOP,KAAKQ,SAGvDR,KAAKC,cAAc+C,UAAY,IAC/BhD,KAAKC,cAAcgD,YAAc,UACjCjD,KAAKC,cAAciD,YAEnB,MAAMC,EAAcnD,KAAKQ,OAASR,KAAKS,aACvC,IAAI2C,EAAI,EAER,IAAK,IAAIC,EAAI,EAAGA,EAAIrD,KAAKS,aAAc4C,IAAK,CACxC,MACMC,GADKtD,KAAKU,UAAU2C,GAAK,IAAQ,GAAKrD,KAAKW,cAClCX,KAAKO,MAAQ,EAAMP,KAAKO,MAAQ,EAErC,IAAN8C,EACArD,KAAKC,cAAcsD,OAAOD,EAAGF,GAE7BpD,KAAKC,cAAcuD,OAAOF,EAAGF,GAGjCA,GAAKD,CACT,CAEAnD,KAAKC,cAAcwD,QACvB,KA3DiB,CAEbzD,KAAKC,cAAc6C,UAAY,UAC/B9C,KAAKC,cAAc8C,SAAS,EAAG,EAAG/C,KAAKO,MAAOP,KAAKQ,QAEnDR,KAAKC,cAAc+C,UAAY,EAC/BhD,KAAKC,cAAcgD,YAAc,UACjCjD,KAAKC,cAAciD,YAEnB,MAAMQ,EAAa1D,KAAKO,MAAQP,KAAKS,aACrC,IAAI6C,EAAI,EAER,IAAK,IAAID,EAAI,EAAGA,EAAIrD,KAAKS,aAAc4C,IAAK,CACxC,MACMD,GADKpD,KAAKU,UAAU2C,GAAK,IAAQ,GAAKrD,KAAKW,cAClCX,KAAKQ,OAAS,EAAMR,KAAKQ,OAAS,EAEvC,IAAN6C,EACArD,KAAKC,cAAcsD,OAAOD,EAAGF,GAE7BpD,KAAKC,cAAcuD,OAAOF,EAAGF,GAGjCE,GAAKI,CACT,CAEA1D,KAAKC,cAAcuD,OAAOxD,KAAKO,MAAOP,KAAKQ,OAAS,GACpDR,KAAKC,cAAcwD,QACvB,CAiCJ,EAQG,MAAME,EACT9D,WAAAA,CAAYC,EAAQC,GAChBC,KAAKF,OAASA,EACdE,KAAK4D,IAAM9D,EAAOI,WAAW,MAC7BF,KAAKG,SAAWJ,EAChBC,KAAKS,aAAe,KACpBT,KAAK6D,SAAW,IAAIC,aAAa9D,KAAKS,cACtCT,KAAK+D,SAAU,GACf/D,KAAKgE,QAAS,GACdhE,KAAKiE,YAAa,GAClBjE,KAAKkE,aAAe,EACpBlE,KAAKmE,eAAiB,KACtBnE,KAAKoE,iBAAmB,GACxBpE,KAAKqE,OAAQ,GACbrE,KAAKsE,MAAQ,EACbtE,KAAKK,YAAc,KACnBL,KAAKuE,aAAe,EACpBvE,KAAKwE,eAAiB,IACtBxE,KAAKyE,aAAe,CACxB,CAEAC,cAAAA,GACI,IAAK1E,KAAKG,SAAU,MAAO,CAAEwE,MAAO3E,KAAKqE,MAAOL,OAAQhE,KAAKqE,OAE7D,MAAMO,EAAW5E,KAAKG,SAASiC,SAAWpC,KAAKS,aAC3CT,KAAK6D,SAASgB,SAAWD,IACzB5E,KAAKS,aAAemE,EACpB5E,KAAK6D,SAAW,IAAIC,aAAac,IAGrC5E,KAAKG,SAAS2E,uBAAuB9E,KAAK6D,UAC1C,IAAIkB,EAAa,EACbC,EAAO,EACPC,GAAU,EAEd,IAAK,IAAI5B,EAAI,EAAGA,EAAIrD,KAAKS,aAAc4C,IAAK,CACxC,IAAI6B,EAAIlF,KAAK6D,SAASR,GAClB6B,EAAI,EAAGA,EAAI,EACNA,OAAQA,GAAI,GACrBH,GAAcG,EAAIA,EAClB,MAAMC,EAAOC,KAAKC,IAAIH,GAClBC,EAAOH,IAAMA,EAAOG,GACpBA,GAAQ,OAAOF,GAAU,EACjC,CAEA,MAAMK,EAAMF,KAAKG,KAAKR,EAAa/E,KAAKS,cACxC,IAAIkE,EAAQW,EAAM,EAAI,GAAKF,KAAKI,MAAMF,IAAQG,IAC1CzB,EAASgB,EAAO,EAAI,GAAKI,KAAKI,MAAMR,IAASS,IAWjD,OATId,EAAQ3E,KAAKqE,QAAOM,EAAQ3E,KAAKqE,OACjCM,EAAQ3E,KAAKsE,QAAOK,EAAQ3E,KAAKsE,OACjCN,EAAShE,KAAKqE,QAAOL,EAAShE,KAAKqE,OACnCL,EAAShE,KAAKsE,QAAON,EAAShE,KAAKsE,OAEnCW,IACAjF,KAAKuE,aAAemB,YAAYC,IAAMD,YAAYC,MAAQC,KAAKD,OAG5D,CAAEhB,QAAOX,SACpB,CAEA6B,MAAAA,GACI7F,KAAK8F,OACT,CAEAA,KAAAA,GACI9F,KAAK4D,IAAInB,UAAU,EAAG,EAAGzC,KAAKF,OAAOS,MAAOP,KAAKF,OAAOU,OAC5D,CAEA8B,IAAAA,CAAKyD,GACD,MAAMnC,EAAM5D,KAAK4D,IACXoC,EAAIhG,KAAKF,OAAOS,MAChB0F,EAAIjG,KAAKF,OAAOU,OAGtBoD,EAAInB,UAAU,EAAG,EAAGuD,EAAGC,GACvB,MAAMC,EAAMtC,EAAIuC,qBAAqB,EAAG,EAAGH,EAAG,GAC9CE,EAAIE,aAAa,EAAG,WACpBF,EAAIE,aAAa,EAAG,WACpBxC,EAAId,UAAYoD,EAChBtC,EAAIb,SAAS,EAAG,EAAGiD,EAAGC,GAGtB,IAAII,GAAQN,EAAY/F,KAAKqE,QAAUrE,KAAKsE,MAAQtE,KAAKqE,OACrDgC,EAAO,IAAGA,EAAO,GACjBA,EAAO,IAAGA,EAAO,GAGrB,MAAMC,EAAU1C,EAAIuC,qBAAqB,EAAG,EAAGH,EAAG,GAClDM,EAAQF,aAAa,EAAG,WACxBE,EAAQF,aAAa,GAAK,WAC1BE,EAAQF,aAAa,IAAM,WAC3BE,EAAQF,aAAa,EAAG,WACxBxC,EAAId,UAAYwD,EAChB,MAAMC,EAAWnB,KAAKoB,MAAMR,EAAIK,GAChCzC,EAAIb,SAAS,EAAG,EAAGwD,EAAUN,GAG7BrC,EAAI6C,OACJ7C,EAAIX,YAAc,yBAClBW,EAAIZ,UAAY,EAChBY,EAAIV,YAEJ,IAAK,IAAIwD,EAAK1G,KAAKqE,MAAOqC,GAAM1G,KAAKsE,MAAOoC,GAAM,GAAI,CAClD,MAAMC,GAAWD,EAAK1G,KAAKqE,QAAUrE,KAAKsE,MAAQtE,KAAKqE,OACjDuC,EAAOxB,KAAKoB,MAAMR,EAAIW,GAAW,GAgBvC,GAdW,IAAPD,GACA9C,EAAIX,YAAc,yBAClBW,EAAIV,YACJU,EAAIL,OAAOqD,EAAM,GACjBhD,EAAIJ,OAAOoD,EAAMX,GACjBrC,EAAIH,SACJG,EAAIX,YAAc,2BAElBW,EAAIL,OAAOqD,EAAM,GACjBhD,EAAIJ,OAAOoD,EAAU,GAAJX,GACjBrC,EAAIL,OAAOqD,EAAMX,GACjBrC,EAAIJ,OAAOoD,EAAU,GAAJX,IAGjBS,EAAK,IAAO,IAAY,KAAPA,EAAY,CAC7B,MAAMG,EAAQH,EAAGI,WACjBlD,EAAId,UAAoB,IAAP4D,EAAY,WAAoB,KAAPA,EAAa,UAAY,UACnE9C,EAAImD,KAAO,yCACXnD,EAAIoD,UAAY,SAChBpD,EAAIqD,aAAe,MACnBrD,EAAIsD,SAASL,EAAOD,EAAM,EAC9B,CACJ,CACAhD,EAAIuD,UAGJ,MAAMC,IAAe,GAAMpH,KAAKqE,QAAUrE,KAAKsE,MAAQtE,KAAKqE,OAC5D,GAAI+C,EAAc,GAAKA,EAAc,EAAG,CACpC,MAAMC,EAAWjC,KAAKoB,MAAMR,EAAIoB,GAChCxD,EAAI6C,OACJ7C,EAAId,UAAY,wBAChBc,EAAIb,SAASsE,EAAW,EAAG,EAAG,EAAGpB,GACjCrC,EAAIuD,SACR,CAGA,IAAIG,GAAYtH,KAAKiE,WAAajE,KAAKqE,QAAUrE,KAAKsE,MAAQtE,KAAKqE,OAC/DiD,EAAW,IAAGA,EAAW,GACzBA,EAAW,IAAGA,EAAW,GAC7B,MAAMC,EAAQnC,KAAKoB,MAAMR,EAAIsB,GAC7B1D,EAAIX,YAAc,UAClBW,EAAIZ,UAAY,EAChBY,EAAIV,YACJU,EAAIL,OAAOgE,EAAQ,GAAK,GACxB3D,EAAIJ,OAAO+D,EAAQ,GAAKtB,GACxBrC,EAAIH,SAGJG,EAAId,UAAY,UAChBc,EAAImD,KAAO,8CACXnD,EAAIoD,UAAY,OAChBpD,EAAIqD,aAAe,SACnB,MAEMO,EAAM,OAFOzB,GAAa/F,KAAKqE,MAAQ,KAAO0B,EAAU0B,QAAQ,kBAClDzH,KAAKgE,QAAUhE,KAAKqE,MAAQ,KAAOrE,KAAKgE,OAAOyD,QAAQ,UAE3E7D,EAAIsD,SAASM,EAAK,EAAGvB,EAAI,GAGzB,MAAMN,EAAMD,YAAYC,IAAMD,YAAYC,MAAQC,KAAKD,MACvD,GAAI3F,KAAKuE,cAAiBoB,EAAM3F,KAAKuE,aAAgBvE,KAAKwE,eAAgB,CACtEZ,EAAI6C,OACJ7C,EAAId,UAAY,UAChB,MAAM4E,EAAS,GAAIC,EAAS,GAC5B/D,EAAIb,SAASiD,EAAI0B,EAAS,EAAG,EAAGA,EAAQC,GACxC/D,EAAId,UAAY,OAChBc,EAAImD,KAAO,8CACXnD,EAAIoD,UAAY,SAChBpD,EAAIqD,aAAe,SACnBrD,EAAIsD,SAAS,OAAQlB,EAAI0B,EAAS,EAAI,EAAG,EAAIC,EAAS,EAAI,IAC1D/D,EAAIuD,SACR,CACJ,CAEAS,MAAAA,GACI,MAAMC,EAAS7H,KAAK0E,iBACpB1E,KAAK+D,QAAU8D,EAAOlD,MACtB3E,KAAKgE,OAAS6D,EAAO7D,OAErB,MAAM2B,EAAMD,YAAYC,MAGxB,GAAI3F,KAAKgE,OAAShE,KAAKiE,WAAa,GAChCjE,KAAKiE,WAAajE,KAAKgE,OACvBhE,KAAKkE,aAAeyB,MACjB,CACH,MAAMmC,EAAUnC,EAAM3F,KAAKkE,aAC3B,GAAI4D,EAAU9H,KAAKmE,eAAgB,CAC/B,MAAM4D,GAAeD,EAAU9H,KAAKmE,gBAAkB,IAChD6D,EAAahI,KAAKoE,iBAAmB2D,EAC3C/H,KAAKiE,WAAamB,KAAK6C,IAAIjI,KAAKgE,OAAQhE,KAAKiE,WAAa+D,EAC9D,CACJ,CAEAhI,KAAKsC,KAAKtC,KAAK+D,QACnB,CAEAjD,KAAAA,GAGI,GAFAd,KAAKuC,OAEDvC,KAAKG,SAAU,CACf,MAAMyE,EAAW5E,KAAKG,SAASiC,SAAW,KACtCpC,KAAK6D,SAASgB,SAAWD,IACzB5E,KAAKS,aAAemE,EACpB5E,KAAK6D,SAAW,IAAIC,aAAac,GAEzC,CAEA,MAAMrD,EAAOvB,MACb,SAASkI,IACL3G,EAAKqG,SACLrG,EAAKlB,YAAcsC,sBAAsBuF,EAC7C,CACAA,EACJ,CAEA3F,IAAAA,GACQvC,KAAKK,cACLmC,qBAAqBxC,KAAKK,aAC1BL,KAAKK,YAAc,MAEvBL,KAAK8F,OACT,EASG,MAAMqC,EACTtI,WAAAA,CAAYC,EAAQsI,EAAU,IAqC1B,GApCApI,KAAKF,OAASA,EACdE,KAAKC,cAAgB,KACrBD,KAAKO,MAAQT,EAAOS,MACpBP,KAAKQ,OAASV,EAAOU,OAErBR,KAAKqI,iBAAmB,IACxBrI,KAAKsI,iBAAmB,KACxBtI,KAAKuI,iBAAmB,GAExBvI,KAAKwI,UAAY,GACjBxI,KAAKyI,UAAY,GACjBzI,KAAK0I,YAAc,EAEnB1I,KAAK2I,WAAa,EAClB3I,KAAK4I,UAAY,EACjB5I,KAAK6I,cAAe,EACpB7I,KAAK8I,cAAgB,EAErB9I,KAAK+I,iBAAmB,EACxB/I,KAAKgJ,WAAY,EACjBhJ,KAAKiJ,kBAAoB,EACzBjJ,KAAKkJ,oBAAsB,EAE3BlJ,KAAKmJ,aAAc,EACnBnJ,KAAKoJ,aAAe,EACpBpJ,KAAKqJ,cAAgB,EAErBrJ,KAAKsJ,YAAmC,IAAtBlB,EAAQmB,UAC1BvJ,KAAKwJ,QAAU,KACfxJ,KAAKyJ,gBAAkB,GACvBzJ,KAAK0J,gBAAkB,GACvB1J,KAAK2J,uBAAwB,EAC7B3J,KAAK4J,WAAa,KAClB5J,KAAK6J,YAAc,KAGf7J,KAAKsJ,YAAcxJ,EAAOgK,4BAAgD,oBAAXC,OAC/D,IACI,MAAMC,EAAMlK,EAAOgK,6BACnB9J,KAAKwJ,QAAU,IAAIO,OAAO3B,EAAQ6B,YAAc,wBAEhDjK,KAAKwJ,QAAQU,YAAY,CACrBC,KAAM,OACNrK,OAAQkK,EACRzJ,MAAOP,KAAKO,MACZC,OAAQR,KAAKQ,OACb4J,cAAc,EACdC,eAAyC,IAA1BjC,EAAQiC,cACvB/B,iBAAkBtI,KAAKsI,iBACvBC,iBAAkBvI,KAAKuI,kBACxB,CAACyB,IAEJ,MAAMzI,EAAOvB,KACbA,KAAKwJ,QAAQc,UAAY,SAASC,GAC9B,MAAMC,EAAMD,EAAGE,KACVD,GACY,iBAAbA,EAAIL,OACJ5I,EAAKqI,WAAaY,EAAIE,OACtBnJ,EAAKsI,YAAcW,EAAIG,QAE/B,CACJ,CAAE,MAAMxI,GACJjB,QAAQC,KAAK,iCAAkCgB,GAC/CnC,KAAKsJ,YAAa,CACtB,MAEAtJ,KAAKsJ,YAAa,EAItB,IAAKtJ,KAAKsJ,WACN,IACItJ,KAAKC,cAAgBH,EAAOI,WAAW,KAC3C,CAAE,MAAMiC,GACJjB,QAAQC,KAAK,uBAAwBgB,EACzC,CAIJnC,KAAK4K,yBAEL5K,KAAK8F,OACT,CAMA8E,sBAAAA,GACI,IAAK5K,KAAKF,OAAQ,OAElB,IAAI+K,GAAa,EACbC,EAAa,EACbC,EAAqB,EAGzB/K,KAAKF,OAAOkL,iBAAiB,YAAc7I,IACvC0I,GAAa,EACbC,EAAa3I,EAAE8I,QACfF,EAAqB/K,KAAK4I,UAC1B5I,KAAK6I,cAAe,EACpB7I,KAAKF,OAAOoL,MAAMC,OAAS,aAI/BnL,KAAKF,OAAOkL,iBAAiB,YAAc7I,IACvC,IAAK0I,EAAY,OAEjB,MAAMO,EAASjJ,EAAE8I,QAAUH,EAErBO,EADOrL,KAAKsL,oBACWC,QAAUvL,KAAKO,MACtCiL,EAAcpG,KAAKoB,OAAO4E,EAASC,GAEzCrL,KAAK4I,UAAYmC,EAAqBS,EACtCxL,KAAKyL,qBACLzL,KAAKsC,SAITtC,KAAKF,OAAOkL,iBAAiB,UAAW,KAChCH,IACAA,GAAa,EACb7K,KAAKF,OAAOoL,MAAMC,OAAS,UAKnCnL,KAAKF,OAAOkL,iBAAiB,aAAc,KACnCH,IACAA,GAAa,EACb7K,KAAKF,OAAOoL,MAAMC,OAAS,aAKnCnL,KAAKF,OAAOkL,iBAAiB,QAAU7I,IACnCA,EAAEuJ,iBAGF,MAAMC,EAAO3L,KAAKF,OAAO8L,wBAEnBC,GADI1J,EAAE2J,QAAUH,EAAKI,MACH/L,KAAKO,MAGvByL,EAAY7J,EAAE8J,OAAS,GAAI,EAAK,EACtCjM,KAAKkM,YAAYF,EAAWH,KAIhC7L,KAAKF,OAAOkL,iBAAiB,QAAU7I,IACnC,GAAI0I,EAAY,OAEhB,MAAMsB,EAAOnM,KAAKsL,oBACZc,EAAajK,EAAE8I,QAAUjL,KAAKO,MAC9B8L,EAAgBjH,KAAKkH,MAAMH,EAAKrL,MAAQsL,EAAaD,EAAKZ,SAG1DgB,EAAQ,IAAIC,YAAY,gBAAiB,CAC3C9B,OAAQ,CACJ+B,OAAQJ,EACRK,KAAML,EAAgBrM,KAAKsI,oBAGnCtI,KAAKF,OAAO6M,cAAcJ,KAI9BvM,KAAKF,OAAOoL,MAAMC,OAAS,MAC/B,CAEArF,KAAAA,GACQ9F,KAAKsJ,YAActJ,KAAKwJ,QACxBxJ,KAAKwJ,QAAQU,YAAY,CAAEC,KAAM,UAGhCnK,KAAKC,gBAEVD,KAAKC,cAAcwC,UAAU,EAAG,EAAGzC,KAAKO,MAAOP,KAAKQ,QACpDR,KAAKC,cAAc6C,UAAY,UAC/B9C,KAAKC,cAAc8C,SAAS,EAAG,EAAG/C,KAAKO,MAAOP,KAAKQ,QACnDR,KAAKC,cAAc+C,UAAY,EAC/BhD,KAAKC,cAAcgD,YAAc,UACjCjD,KAAKC,cAAciD,YACnBlD,KAAKC,cAAcsD,OAAO,EAAGvD,KAAKQ,OAAS,GAC3CR,KAAKC,cAAcuD,OAAOxD,KAAKO,MAAOP,KAAKQ,OAAS,GACpDR,KAAKC,cAAcwD,SACvB,CAEAmJ,KAAAA,GACI5M,KAAKwI,UAAU3D,OAAS,EACxB7E,KAAKyI,UAAU5D,OAAS,EACxB7E,KAAK0I,YAAc,EACnB1I,KAAK2I,WAAa,EAClB3I,KAAK4I,UAAY,EACjB5I,KAAK6I,cAAe,EACpB7I,KAAK8I,cAAgB,EACrB9I,KAAK8F,OACT,CAEA+G,MAAAA,CAAOC,GACH,IAAKA,IAAiBA,EAAajI,OAC/B,OAGJ,MAAMkI,EAAS/M,KAAKuI,iBACdyE,EAAQF,EAAajI,OACrBoI,EAAc,GACdC,EAAc,GAGflN,KAAKmN,iBAAgBnN,KAAKmN,eAAiB,GAChD,MAAMxH,EAAMC,KAAKD,MACbA,EAAM3F,KAAKmN,eAAiB,MAC5BjM,QAAQI,IAAI,mCAAoC0L,EAAO,OAC3C5H,KAAKkH,MAAMU,EAAQD,GAAS,MACxC/M,KAAKmN,eAAiBxH,GAG1B,IAAK,IAAItC,EAAI,EAAGA,EAAI2J,EAAO3J,GAAK0J,EAAQ,CACpC,IAAIK,EAAW,EACXC,GAAW,EACXC,EAAW,EACXC,EAAa,EAEjB,IAAK,IAAIC,EAAI,EAAGA,EAAIT,GAAW1J,EAAImK,EAAKR,EAAOQ,IAAK,CAEhDF,GADeR,EAAazJ,EAAImK,GAEhCD,GACJ,CAEA,MAAME,EAAYF,EAAcD,EAAWC,EAAc,EAEzD,IAAK,IAAIG,EAAI,EAAGA,EAAIH,EAAYG,IAAK,CACjC,MAAMC,EAAiBb,EAAazJ,EAAIqK,GAAKD,EACzCE,EAAiBP,IACjBA,EAAWO,GAEXA,EAAiBN,IACjBA,EAAWM,EAEnB,CAEKJ,IAIDH,EAAWC,IACXD,EAAWC,EAAW,GAG1BrN,KAAKwI,UAAUoF,KAAKR,GACpBpN,KAAKyI,UAAUmF,KAAKP,GACpBJ,EAAYW,KAAKR,GACjBF,EAAYU,KAAKP,GACjBrN,KAAK0I,cACT,CAQA,GANI1I,KAAK6I,aACL7I,KAAK6N,iBAEL7N,KAAKyL,qBAGLzL,KAAKsJ,YAActJ,KAAKwJ,UACxBxJ,KAAKyJ,gBAAgBmE,QAAQX,GAC7BjN,KAAK0J,gBAAgBkE,QAAQV,IACxBlN,KAAK2J,uBAAuB,CAC7B3J,KAAK2J,uBAAwB,EAC7B,MAAMpI,EAAOvB,KACP8N,EAAQA,IAAMvM,EAAKwM,oBACY,mBAA1BpL,sBACPA,sBAAsBmL,GAEtBE,WAAWF,EAAO,GAE1B,CAGJ9N,KAAKsC,MACT,CAEAyL,iBAAAA,GACS/N,KAAKwJ,SAA2C,IAAhCxJ,KAAKyJ,gBAAgB5E,QAK1C7E,KAAKwJ,QAAQU,YAAY,CACrBC,KAAM,SACN8D,OAAQjO,KAAKyJ,gBACbyE,OAAQlO,KAAK0J,kBAGjB1J,KAAKyJ,gBAAkB,GACvBzJ,KAAK0J,gBAAkB,GACvB1J,KAAK2J,uBAAwB,GAZzB3J,KAAK2J,uBAAwB,CAarC,CAEArH,IAAAA,GACI,GAAItC,KAAKsJ,YAActJ,KAAKwJ,QAQxB,YAPAxJ,KAAKwJ,QAAQU,YAAY,CACrBC,KAAM,OACNxB,WAAY3I,KAAK2I,WACjBC,UAAW5I,KAAK4I,UAChBG,iBAAkB/I,KAAK+I,iBACvBC,UAAWhJ,KAAKgJ,YAKxB,IAAKhJ,KAAKC,cAAe,OAGzBD,KAAK8F,QAEL,MAAMkH,EAAQhN,KAAKwI,UAAU3D,OAC7B,IAAKmI,EAAO,OAEZ,MAAMmB,EAAiB/I,KAAKgJ,IAAIpB,EAAO5H,KAAKoB,MAAMwG,EAAQhN,KAAK2I,aACzD7H,EAAQsE,KAAKgJ,IAAIpO,KAAK4I,UAAWxD,KAAK6C,IAAI,EAAG+E,EAAQmB,IACrDE,EAAMjJ,KAAKgJ,IAAIpB,EAAOlM,EAAQqN,GAC9BG,EAAUtO,KAAKQ,OAAS,EAG9BR,KAAKC,cAAcgD,YAAc,UACjCjD,KAAKC,cAAc+C,UAAY,EAC/BhD,KAAKC,cAAciD,YAEnB,IAAK,IAAIG,EAAIvC,EAAOuC,EAAIgL,EAAKhL,IAAK,CAC9B,MAAMC,EAAI8B,KAAKkH,OAAQjJ,EAAIvC,GAASqN,EAAkBnO,KAAKO,OAAS,GAC9DgO,EAAOnJ,KAAKkH,MAAMgC,EAAWtO,KAAKyI,UAAUpF,GAAKiL,EAAU,KAC3DE,EAAOpJ,KAAKkH,MAAMgC,EAAWtO,KAAKwI,UAAUnF,GAAKiL,EAAU,KAGjEtO,KAAKC,cAAcsD,OAAOD,EAAGiL,GAC7BvO,KAAKC,cAAcuD,OAAOF,EAAGkL,EACjC,CAEAxO,KAAKC,cAAcwD,SAGnBzD,KAAKC,cAAcgD,YAAc,UACjCjD,KAAKC,cAAc+C,UAAY,EAC/BhD,KAAKC,cAAciD,YACnBlD,KAAKC,cAAcsD,OAAO,EAAG+K,EAAU,IACvCtO,KAAKC,cAAcuD,OAAOxD,KAAKO,MAAO+N,EAAU,IAChDtO,KAAKC,cAAcwD,QACvB,CAEA6H,iBAAAA,GACI,MAAM0B,EAAQhN,KAAK0I,YACnB,GAAc,IAAVsE,EAAa,MAAO,CAAElM,MAAO,EAAGuN,IAAK,EAAG9C,QAAS,GAErD,MAAMkD,EAASzO,KAAK0O,sBAAsB1B,GAC1C,IAAIzB,EAAUnG,KAAK6C,IAAIwG,EAAQrJ,KAAKoB,MAAMwG,EAAQhN,KAAK2I,aACnD4C,EAAUyB,IAAOzB,EAAUyB,GAE/B,IAAIlM,EAAQd,KAAK4I,UACb9H,EAAQyK,EAAUyB,IAAOlM,EAAQkM,EAAQzB,GACzCzK,EAAQ,IAAGA,EAAQ,GAGvB,MAAO,CAAEA,QAAOuN,IADJjJ,KAAKgJ,IAAIpB,EAAOlM,EAAQyK,GACfA,UACzB,CAEAmD,qBAAAA,CAAsB1B,GAClB,OAAO5H,KAAK6C,IAAI,EAAG7C,KAAKkH,MAAMtM,KAAKO,MAAQ,GAC/C,CAEAkL,kBAAAA,GACI,MAAMU,EAAOnM,KAAKsL,oBAClBtL,KAAK4I,UAAYuD,EAAKrL,KAC1B,CAEA+M,cAAAA,GACI,MAAMb,EAAQhN,KAAK0I,YACnB,GAAc,IAAVsE,EAAa,OAEjB,MAAMyB,EAASzO,KAAK0O,sBAAsB1B,GAC1C,IAAIzB,EAAUnG,KAAK6C,IAAIwG,EAAQrJ,KAAKoB,MAAMwG,EAAQhN,KAAK2I,aACnD4C,EAAUyB,IAAOzB,EAAUyB,GAE/BhN,KAAK4I,UAAYoE,EAAQzB,EACrBvL,KAAK4I,UAAY,IAAG5I,KAAK4I,UAAY,EAC7C,CAEA+F,OAAAA,CAAQC,EAAYC,GACZD,EAAa,IAAGA,EAAa,GACjC,MAAME,EAAU1J,KAAK6C,IAAI,EAAGjI,KAAK0I,YAAc1I,KAAK0O,sBAAsB1O,KAAK0I,cAC3EkG,EAAaE,IAASF,EAAaE,GAEvC,MAAMC,EAAU/O,KAAKsL,oBACrBtL,KAAK2I,WAAaiG,EAClB,MAAMI,EAAUhP,KAAKsL,oBAErB,GAA4B,iBAAjBuD,GAA6BA,GAAgB,EAAG,CACvD,MACMI,EAAeJ,GADHA,EAAeE,EAAQjO,OAASiO,EAAQxD,QACXyD,EAAQzD,QACvDvL,KAAK4I,UAAYxD,KAAK6C,IAAI,EAAG7C,KAAKgJ,IAAIpO,KAAK0I,YAAcsG,EAAQzD,QAAS0D,GAC9E,CAEAjP,KAAKyL,qBACLzL,KAAKsC,MACT,CAEA4J,WAAAA,CAAYgD,EAAWrD,EAAc,IACjC,GAAkB,IAAdqD,EAAiB,OAErB,MACMH,EAAU/O,KAAKsL,oBACfuD,EAAeE,EAAQjO,MAAQ+K,EAAckD,EAAQxD,QAE3D,IAAI4D,EAAUnP,KAAK2I,WACfuG,EAAY,EACZC,GAAW/J,KAAKgK,IANH,IAMiBF,GAE9BC,GAAW/J,KAAKgK,IARH,KAQkBF,GAGnClP,KAAK2O,QAAQQ,EAASN,EAC1B,CAEAQ,YAAAA,CAAa7D,GACW,IAAhBA,IAEJxL,KAAK6I,cAAe,EACpB7I,KAAK4I,WAAa4C,EAClBxL,KAAKyL,qBACLzL,KAAKsC,OACT,CAEAgN,WAAAA,CAAYC,GACR,GAAmB,IAAfA,EAAkB,OAEtB,MAEMC,EAAaD,GAFNvP,KAAKsL,oBACWC,QAAUvL,KAAKO,OACMP,KAAK8I,cACjD2G,EAAWrK,KAAKoB,MAAMgJ,GAC5BxP,KAAK8I,cAAgB0G,EAAaC,EAElCzP,KAAKqP,aAAaI,EACtB,CAEAC,SAAAA,GACI1P,KAAK2I,WAAa,EAClB3I,KAAK4I,UAAY,EACjB5I,KAAK6I,cAAe,EACpB7I,KAAK8I,cAAgB,EACrB9I,KAAK6N,iBACL7N,KAAKsC,MACT,CAEAqN,mBAAAA,CAAoBC,GAChB5P,KAAKsI,iBAAmBsH,GAAc,KACtC5P,KAAKuI,iBAAmBnD,KAAK6C,IAAI,EAAG7C,KAAKoB,MAAMxG,KAAKsI,iBAAmBtI,KAAKqI,mBAExErI,KAAKwJ,SACLxJ,KAAKwJ,QAAQU,YAAY,CACrBC,KAAM,gBACN7B,iBAAkBtI,KAAKsI,iBACvBC,iBAAkBvI,KAAKuI,kBAGnC,CAEAsH,cAAAA,CAAeC,GACX,OAAIA,EAAQ,GAAKA,GAAS9P,KAAK0I,YACpB,CAAE0F,IAAK,EAAGnG,IAAK,GAEnB,CACHmG,IAAKpO,KAAKwI,UAAUsH,GACpB7H,IAAKjI,KAAKyI,UAAUqH,GAE5B,CAEAC,mBAAAA,CAAoBC,GAChBhQ,KAAK+I,iBAAmBiH,EACxBhQ,KAAKsC,MACT,CAEA2N,cAAAA,CAAeC,GACXlQ,KAAKmJ,cAAgB+G,CACzB,CAEAC,aAAAA,CAAcC,EAAaR,GACvB5P,KAAKgJ,WAAY,EACjBhJ,KAAKkJ,oBAAsBkH,GAAe,EAC1CpQ,KAAKiJ,kBAAoBvD,YAAYC,IAAMD,YAAYC,MAAQC,KAAKD,MACpE3F,KAAK+I,iBAAmB/I,KAAKkJ,oBAE7B,MAAM3H,EAAOvB,KACPqQ,EAAKT,GAAc5P,KAAKsI,iBAgB9B3F,sBAdA,SAAS2N,IACL,IAAK/O,EAAKyH,UAAW,OAErB,MAEMuH,IAFM7K,YAAYC,IAAMD,YAAYC,MAAQC,KAAKD,OAChCpE,EAAK0H,mBAAqB,IACpBoH,EACvBG,EAAejP,EAAK2H,oBAAsB9D,KAAKkH,MAAMiE,EAAahP,EAAKgH,kBAE7EhH,EAAKwH,iBAAmByH,EACxBjP,EAAKe,OAELK,sBAAsB2N,EAC1B,EAGJ,CAEAG,YAAAA,GACIzQ,KAAKgJ,WAAY,EACjBhJ,KAAK+I,iBAAmB,EACxB/I,KAAKsC,MACT,CAEAoO,uBAAAA,GACI,IAAK1Q,KAAKgJ,UAAW,OAErB,MAEMuH,IAFM7K,YAAYC,IAAMD,YAAYC,MAAQC,KAAKD,OAChC3F,KAAKiJ,mBAAqB,IACpBjJ,KAAKsI,iBAC5BkI,EAAexQ,KAAKkJ,oBAAsB9D,KAAKkH,MAAMiE,EAAavQ,KAAKuI,kBAE7EvI,KAAK+I,iBAAmByH,CAC5B,EAOG,MAAMG,EACT9Q,WAAAA,CAAYC,EAAQ8Q,GAChB5Q,KAAKF,OAASA,EACdE,KAAK4D,IAAM9D,EAAOI,WAAW,MAC7BF,KAAK4Q,oBAAsBA,EAC3B5Q,KAAKO,MAAQT,EAAOS,MACpBP,KAAKQ,OAASV,EAAOU,OAGrBR,KAAKsJ,YAAa,EAClBtJ,KAAK6Q,WAAa,KAClB7Q,KAAK8Q,eAAgB,EACrB9Q,KAAK+Q,WAAa,EAGlB/Q,KAAK4K,wBAIT,CAMAA,sBAAAA,GACI,IAAK5K,KAAKF,OAAQ,OAElB,IAAI+K,GAAa,EAGjB7K,KAAKF,OAAOkL,iBAAiB,YAAc7I,IACvC,MAAM6O,EAAMhR,KAAK4Q,oBACZI,GAA2B,IAApBA,EAAItI,cAEhBmC,GAAa,EACb7K,KAAKiR,YAAY9O,EAAE8I,SACnBjL,KAAKF,OAAOoL,MAAMC,OAAS,cAI/BnL,KAAKF,OAAOkL,iBAAiB,YAAc7I,IAClC0I,GACL7K,KAAKiR,YAAY9O,EAAE8I,WAIvBjL,KAAKF,OAAOkL,iBAAiB,UAAW,KACpCH,GAAa,EACb7K,KAAKF,OAAOoL,MAAMC,OAAS,YAI/BnL,KAAKF,OAAOkL,iBAAiB,aAAc,KACnCH,IACAA,GAAa,EACb7K,KAAKF,OAAOoL,MAAMC,OAAS,aAKnCnL,KAAKF,OAAOoL,MAAMC,OAAS,SAC/B,CAMA8F,WAAAA,CAAYC,GACR,MAAMF,EAAMhR,KAAK4Q,oBACjB,IAAKI,GAA2B,IAApBA,EAAItI,YAAmB,OAEnC,MAAMsE,EAAQgE,EAAItI,YACZ0D,EAAahH,KAAK6C,IAAI,EAAG7C,KAAKgJ,IAAI,EAAG8C,EAASlR,KAAKO,QACnD4Q,EAAe/L,KAAKkH,MAAMF,EAAaY,GAGvCb,EAAO6E,EAAI1F,oBACX8F,EAAchM,KAAKkH,MAAMH,EAAKZ,QAAU,GAC9CyF,EAAIpI,UAAYxD,KAAK6C,IAAI,EAAG7C,KAAKgJ,IAAIpB,EAAQb,EAAKZ,QAAS4F,EAAeC,IAC1EJ,EAAInI,cAAe,EACnBmI,EAAIvF,qBACJuF,EAAI1O,OAGJtC,KAAKsC,OAGL,MAAMiK,EAAQ,IAAIC,YAAY,gBAAiB,CAC3C9B,OAAQ,CACJ+B,OAAQ0E,EACRzE,KAAMyE,EAAeH,EAAI1I,oBAGjCtI,KAAKF,OAAO6M,cAAcJ,EAC9B,CAEAzG,KAAAA,GACQ9F,KAAKsJ,YAActJ,KAAK6Q,WACxB7Q,KAAK6Q,WAAW3G,YAAY,CAAEC,KAAM,mBAIxCnK,KAAK4D,IAAInB,UAAU,EAAG,EAAGzC,KAAKO,MAAOP,KAAKQ,QAC1CR,KAAK4D,IAAId,UAAY,UACrB9C,KAAK4D,IAAIb,SAAS,EAAG,EAAG/C,KAAKO,MAAOP,KAAKQ,QAC7C,CAEA8B,IAAAA,GACI,GAAItC,KAAKsJ,YAActJ,KAAK6Q,WAExB,OAIJ7Q,KAAK8F,QAEL,MAAMkL,EAAMhR,KAAK4Q,oBACjB,IAAKI,GAA2B,IAApBA,EAAItI,YAKZ,YAJAxH,QAAQI,IAAI,+BAAgC,CACxC+P,SAAUL,EACVtI,YAAasI,EAAMA,EAAItI,YAAc,IAK7C,MAAMsE,EAAQgE,EAAItI,YACZyD,EAAO6E,EAAI1F,oBAEjBpK,QAAQI,IAAI,0BAA2B,CACnC0L,QACAsE,aAAcnF,EAAKrL,MACnByQ,WAAYpF,EAAKkC,IACjBmD,YAAaxR,KAAKO,MAClBkR,aAAczR,KAAKQ,SAIvBR,KAAK4D,IAAIX,YAAc,UACvBjD,KAAK4D,IAAIZ,UAAY,EAErB,MAAMqI,EAAkB2B,EAAQhN,KAAKO,MACrC,IAAK,IAAI+C,EAAI,EAAGA,EAAItD,KAAKO,MAAO+C,IAAK,CACjC,MAAM0M,EAAc5K,KAAKkH,MAAMhJ,EAAI+H,GACnC,GAAI2E,GAAehD,EAAO,MAE1B,MAAMP,EAASuE,EAAInB,eAAeG,GAC5B1B,EAAUtO,KAAKQ,OAAS,EACxB+N,EAAOnJ,KAAKkH,MAAMgC,EAAW7B,EAAOxE,IAAMqG,EAAU,IACpDE,EAAOpJ,KAAKkH,MAAMgC,EAAW7B,EAAO2B,IAAME,EAAU,IAG1DtO,KAAK4D,IAAIV,YACTlD,KAAK4D,IAAIL,OAAOD,EAAGiL,GACnBvO,KAAK4D,IAAIJ,OAAOF,EAAGkL,GACnBxO,KAAK4D,IAAIH,QACb,CAGAzD,KAAK4D,IAAIX,YAAc,UACvBjD,KAAK4D,IAAIZ,UAAY,EACrBhD,KAAK4D,IAAIV,YACTlD,KAAK4D,IAAIL,OAAO,EAAGvD,KAAKQ,OAAS,GACjCR,KAAK4D,IAAIJ,OAAOxD,KAAKO,MAAOP,KAAKQ,OAAS,GAC1CR,KAAK4D,IAAIH,SAGT,MAAMiO,EAAatM,KAAKkH,MAAOH,EAAKrL,MAAQkM,EAAShN,KAAKO,OACpDoR,EAAWvM,KAAKkH,MAAOH,EAAKkC,IAAMrB,EAAShN,KAAKO,OAChDqR,EAAYxM,KAAK6C,IAAI,EAAG0J,EAAWD,GAGzC1R,KAAK4D,IAAId,UAAY,2BACrB9C,KAAK4D,IAAIb,SAAS2O,EAAY,EAAGE,EAAW5R,KAAKQ,QAGjDR,KAAK4D,IAAIX,YAAc,UACvBjD,KAAK4D,IAAIZ,UAAY,EACrBhD,KAAK4D,IAAIiO,WAAWH,EAAY,EAAGE,EAAW5R,KAAKQ,QAEnDU,QAAQI,IAAI,0BAChB,ECt4CG,MAAMwQ,EAQX,UAAMrL,CAAKsL,EAAMC,EAAUC,EAAW,CAAA,GACpC,MAAM,IAAIC,MAAM,yCAClB,CAOA,UAAMC,CAAKC,GACT,MAAM,IAAIF,MAAM,yCAClB,CAOA,YAAMG,CAAOD,GACX,MAAM,IAAIF,MAAM,2CAClB,CAMA,UAAMI,GACJ,MAAM,IAAIJ,MAAM,yCAClB,CAOA,YAAMK,CAAOH,GACX,IAEE,aADMpS,KAAKmS,KAAKC,IACT,CACT,CAAE,MAAOI,GACP,OAAO,CACT,CACF,CAMA,WAAM1M,GACJ,MAAM2M,QAAczS,KAAKsS,OACzB,IAAII,EAAQ,EAEZ,IAAK,MAAMC,KAAQF,EACjB,UACQzS,KAAKqS,OAAOM,EAAKP,IAAMO,EAAKX,UAClCU,GACF,CAAE,MAAOF,GACPtR,QAAQsR,MAAM,yBAA0BG,EAAMH,EAChD,CAGF,OAAOE,CACT,EC1CK,MAAME,EAYX/S,WAAAA,CAAYuI,EAAU,IACpBpI,KAAKoI,QAAUpI,KAAK6S,aAAazK,GACjCpI,KAAK8S,aAAc,EAGnB9S,KAAK+S,QAAU/S,KAAKgT,qBAAqBhT,KAAKoI,QAAQ2K,SAGtD/S,KAAKiT,aAAc,EACnBjT,KAAKkT,UAAW,EAChBlT,KAAKmT,YAAc,KAGfnT,KAAKoI,QAAQgL,WACfpT,KAAKqT,cAET,CAOAR,YAAAA,CAAazK,GACX,MAAMkL,EAAW,CACfF,UAAW,KACXG,OAAQ,OACRC,MAAO,QAEPC,MAAO,CACL7D,WAAY,KACZ8D,SAAU,EACVC,KAAK,EACLC,KAAM,GAGRC,SAAU,CACRC,cAAc,EACdC,iBAAiB,EACjBC,UAAU,EACVC,WAAY,GACZC,OAAQ,CACNL,SAAU,UACVM,UAAW,UACXC,SAAU,YAIdrB,QAAS,CACP5I,KAAM,QAGRkK,UAAW,CACTC,cAAeA,OACfC,aAAcA,OACdC,cAAeA,OACfC,eAAgBA,OAChBC,YAAaA,OACbC,WAAYA,OACZC,QAAUpC,GAAUtR,QAAQsR,MAAM,2BAA4BA,KAKlE,OAAOxS,KAAK6U,UAAUvB,EAAUlL,EAClC,CAQAyM,SAAAA,CAAUC,EAAQC,GAChB,MAAMC,EAAS,IAAKF,GAEpB,IAAK,MAAMG,KAAOF,EACZA,EAAOE,aAAgBC,SAAWC,MAAMC,QAAQL,EAAOE,IACzDD,EAAOC,GAAOjV,KAAK6U,UAAUG,EAAOC,IAAQ,CAAA,EAAIF,EAAOE,IAEvDD,EAAOC,GAAOF,EAAOE,GAIzB,OAAOD,CACT,CAOAhC,oBAAAA,CAAqBqC,GACnB,MAAMC,eAAEA,GAAmBC,QAAQ,sBACnC,OAAOD,EAAeE,OAAO,CAC3BrL,KAAMkL,EAAclL,MAAQ,OAC5B/B,QAASiN,GAEb,CAKAhC,YAAAA,GAGEnS,QAAQI,IAAI,wCACd,CAMA,oBAAMmU,GACJ,IACE,GAAIzV,KAAKiT,YACP,MAAM,IAAIf,MAAM,qBAIlBlS,KAAKiT,aAAc,EACnBjT,KAAKoI,QAAQiM,UAAUC,gBAEvBpT,QAAQI,IAAI,oBACd,CAAE,MAAOkR,GAEP,MADAxS,KAAKoI,QAAQiM,UAAUO,QAAQpC,GACzBA,CACR,CACF,CAMA,mBAAMkD,GACJ,IACE,IAAK1V,KAAKiT,YACR,MAAM,IAAIf,MAAM,iBAYlB,OARAlS,KAAKiT,aAAc,EAGnBjT,KAAKmT,YAAc,KAEnBnT,KAAKoI,QAAQiM,UAAUE,aAAavU,KAAKmT,aAEzCjS,QAAQI,IAAI,qBACLtB,KAAKmT,WACd,CAAE,MAAOX,GAEP,MADAxS,KAAKoI,QAAQiM,UAAUO,QAAQpC,GACzBA,CACR,CACF,CAMA,oBAAMmD,GACJ,IACE,IAAK3V,KAAKiT,aAAejT,KAAKkT,SAC5B,MAAM,IAAIhB,MAAM,gBAGlBlS,KAAKkT,UAAW,EAChBlT,KAAKoI,QAAQiM,UAAUG,gBAEvBtT,QAAQI,IAAI,mBACd,CAAE,MAAOkR,GAEP,MADAxS,KAAKoI,QAAQiM,UAAUO,QAAQpC,GACzBA,CACR,CACF,CAMA,qBAAMoD,GACJ,IACE,IAAK5V,KAAKiT,cAAgBjT,KAAKkT,SAC7B,MAAM,IAAIhB,MAAM,iBAGlBlS,KAAKkT,UAAW,EAChBlT,KAAKoI,QAAQiM,UAAUI,iBAEvBvT,QAAQI,IAAI,oBACd,CAAE,MAAOkR,GAEP,MADAxS,KAAKoI,QAAQiM,UAAUO,QAAQpC,GACzBA,CACR,CACF,CAMA,UAAMqD,GACJ,IAEE7V,KAAKoI,QAAQiM,UAAUK,cAEvBxT,QAAQI,IAAI,mBACd,CAAE,MAAOkR,GAEP,MADAxS,KAAKoI,QAAQiM,UAAUO,QAAQpC,GACzBA,CACR,CACF,CAMA,UAAMjQ,GACJ,IAEEvC,KAAKoI,QAAQiM,UAAUM,aAEvBzT,QAAQI,IAAI,mBACd,CAAE,MAAOkR,GAEP,MADAxS,KAAKoI,QAAQiM,UAAUO,QAAQpC,GACzBA,CACR,CACF,CASA,mBAAMsD,CAAc/D,EAAO,KAAMC,EAAW,KAAMC,EAAW,IAC3D,IACE,MAAM8D,EAAahE,GAAQ/R,KAAKmT,YAEhC,IAAK4C,EACH,MAAM,IAAI7D,MAAM,wBAGlB,MAAM8D,EAAgBhE,GAAY,aAAapM,KAAKD,YAE9CyM,QAAWpS,KAAK+S,QAAQtM,KAAKsP,EAAYC,EAAe/D,GAG9D,OADA/Q,QAAQI,IAAI,mBAAoB8Q,GACzBA,CACT,CAAE,MAAOI,GAEP,MADAxS,KAAKoI,QAAQiM,UAAUO,QAAQpC,GACzBA,CACR,CACF,CAOA,mBAAMyD,CAAc7D,GAClB,IACE,MAAML,QAAa/R,KAAK+S,QAAQZ,KAAKC,GAIrC,OAHApS,KAAKmT,YAAcpB,EAEnB7Q,QAAQI,IAAI,oBAAqB8Q,GAC1BL,CACT,CAAE,MAAOS,GAEP,MADAxS,KAAKoI,QAAQiM,UAAUO,QAAQpC,GACzBA,CACR,CACF,CAOA,qBAAM0D,CAAgB9D,GACpB,IACE,MAAM4C,QAAehV,KAAK+S,QAAQV,OAAOD,GAGzC,OADAlR,QAAQI,IAAI,qBAAsB8Q,GAC3B4C,CACT,CAAE,MAAOxC,GAEP,MADAxS,KAAKoI,QAAQiM,UAAUO,QAAQpC,GACzBA,CACR,CACF,CAMA,oBAAM2D,GACJ,IACE,MAAMC,QAAmBpW,KAAK+S,QAAQT,OAGtC,OADApR,QAAQI,IAAI,qBAAsB8U,EAAWvR,QACtCuR,CACT,CAAE,MAAO5D,GAEP,MADAxS,KAAKoI,QAAQiM,UAAUO,QAAQpC,GACzBA,CACR,CACF,CAMA6D,cAAAA,GACE,OAAOrW,KAAKmT,WACd,CAKAmD,OAAAA,GAEEtW,KAAKiT,aAAc,EACnBjT,KAAKkT,UAAW,EAChBlT,KAAKmT,YAAc,KAEfnT,KAAK+S,SAAyC,mBAAvB/S,KAAK+S,QAAQwD,OACtCvW,KAAK+S,QAAQwD,QAGfrV,QAAQI,IAAI,8BACd,EASK,MAAMkV,EAAU,QAKVC,EAAa,CACxBC,QAASF,EACTG,MAAM,IAAI/Q,MAAOgR,cACjBC,KAAM,oCC1WD,MAaHhX,WAAAA,CAAYuI,EAAU,IAElBpI,KAAK8W,OAAS,CACVlH,WAAYxH,EAAQwH,YAAc,KAClCmH,qBAA6CC,IAA5B5O,EAAQ2O,iBAAgC3O,EAAQ2O,gBACjEE,sBAA+CD,IAA7B5O,EAAQ6O,kBAAiC7O,EAAQ6O,iBACnEC,sBAA+CF,IAA7B5O,EAAQ8O,kBAAiC9O,EAAQ8O,iBACnEC,QAAS/O,EAAQ+O,SAAW,EAC5BC,SAAUhP,EAAQgP,UAAY,KAC9BC,YAAajP,EAAQiP,aAAe,qCACpCC,mBAAyCN,IAA1B5O,EAAQkP,eAA8BlP,EAAQkP,eAIjEtX,KAAKgB,aAAe,KACpBhB,KAAKG,SAAW,KAChBH,KAAKiB,YAAc,KACnBjB,KAAKuX,UAAY,KACjBvX,KAAKwX,iBAAmB,KAGxBxX,KAAKyX,kBAAmB,EACxBzX,KAAK0X,eAAgB,EACrB1X,KAAK2X,iBAAmB,KACxB3X,KAAK4X,cAAe,EAGpB5X,KAAK6X,UAAY,GACjB7X,KAAK8X,gBAAkB,EAGvB9X,KAAK+X,SAAW,KAGhB/X,KAAKgY,oBAAsB,KAG3BhY,KAAKiY,UAAY,KAGjBjY,KAAKiT,aAAc,EACnBjT,KAAKkT,UAAW,EAChBlT,KAAKkY,eAAgB,EAGrBlY,KAAKmY,gBAAkB,EACvBnY,KAAKoY,eAAiB,EACtBpY,KAAKqY,kBAAoB,EACzBrY,KAAKsY,iBAAmB,EAGxBtY,KAAKuY,WAAa,KAClBvY,KAAKwY,UAAY,KAGjBxY,KAAKyY,gBAAkB,CAAA,CAC3B,CAOA,gBAAMC,GACF,IAAI1Y,KAAKkY,cAIT,IAEI,MAAMS,EAAoBC,OAAOC,cAAgBD,OAAOE,mBA+BxD,GA9BA9Y,KAAKgB,aAAe,IAAI2X,EAAkB,CAAE/I,WAAY5P,KAAK8W,OAAOlH,aAGpE5P,KAAKG,SAAWH,KAAKgB,aAAa+X,iBAClC/Y,KAAKG,SAASiC,QAAU,IAGxBpC,KAAKiB,YAAcjB,KAAKgB,aAAagY,aACrChZ,KAAKiB,YAAY2S,KAAKqF,MAAQjZ,KAAK8W,OAAOK,QAG1CnX,KAAKuX,UAAYvX,KAAKgB,aAAakY,+BAGnClZ,KAAKiB,YAAYiB,QAAQlC,KAAKG,UAC9BH,KAAKiB,YAAYiB,QAAQlC,KAAKuX,WAG9BvX,KAAKwX,iBAAmBxX,KAAKgB,aAAagY,aAC1ChZ,KAAKwX,iBAAiB5D,KAAKqF,MAAQ,EACnCjZ,KAAKG,SAAS+B,QAAQlC,KAAKwX,kBAC3BxX,KAAKwX,iBAAiBtV,QAAQlC,KAAKgB,aAAamY,aAGhDnZ,KAAKyX,oBACDzX,KAAKgB,aAAaoY,eAClBR,OAAOS,kBAIPrZ,KAAKyX,kBAAoBzX,KAAK8W,OAAOQ,cACrC,UACUtX,KAAKgB,aAAaoY,aAAaE,UAAUtZ,KAAK8W,OAAOO,aAC3DrX,KAAK0X,eAAgB,EACrB1X,KAAKuZ,MAAM,iBAAkB,CAAEC,KAAMxZ,KAAK8W,OAAOO,aACrD,CAAE,MAAO7E,GACLtR,QAAQC,KAAK,uCAAwCqR,GACrDxS,KAAK0X,eAAgB,EACrB1X,KAAKuZ,MAAM,sBAAuB,CAAE/G,SACxC,CAI4B,cAA5BxS,KAAKgB,aAAaW,aACZ3B,KAAKgB,aAAaY,SAG5B5B,KAAKkY,eAAgB,EACrBlY,KAAKuZ,MAAM,cAAe,CACtB3J,WAAY5P,KAAKgB,aAAa4O,WAC9BjO,MAAO3B,KAAKgB,aAAaW,MACzB8V,iBAAkBzX,KAAKyX,iBACvBC,cAAe1X,KAAK0X,eAG5B,CAAE,MAAOlF,GAEL,MADAxS,KAAKuZ,MAAM,QAAS,CAAEE,MAAO,aAAcjH,UACrCA,CACV,CACJ,CAMA,oBAAMiD,GACF,IAAKzV,KAAKkY,cACN,MAAM,IAAIhG,MAAM,uCAGpB,GAAIlS,KAAKiT,YACL,MAAM,IAAIf,MAAM,UAGpB,IAEoC,cAA5BlS,KAAKgB,aAAaW,aACZ3B,KAAKgB,aAAaY,eAItB5B,KAAK0Z,qBAGX1Z,KAAK6X,UAAY,GACjB7X,KAAK8X,gBAAkB,EAGnB9X,KAAKwY,YACLmB,IAAIC,gBAAgB5Z,KAAKwY,WACzBxY,KAAKwY,UAAY,MAErBxY,KAAKuY,WAAa,KAGlBvY,KAAKmY,gBAAkBvS,KAAKD,MAC5B3F,KAAKqY,kBAAoB3S,YAAYC,MACrC3F,KAAKoY,eAAiB,EACtBpY,KAAKsY,iBAAmB,EAGxB,MAAMuB,EAAa7Z,KAAK0X,eAAiB1X,KAAK8W,OAAOQ,cAEjDuC,QACM7Z,KAAK8Z,+BAEL9Z,KAAK+Z,2BAGf/Z,KAAKiT,aAAc,EACnBjT,KAAKkT,UAAW,EAEhBlT,KAAKuZ,MAAM,kBAAmB,CAC1BS,UAAWha,KAAKmY,gBAChB8B,KAAMJ,EAAa,UAAY,YAC/BjK,WAAY5P,KAAKgB,aAAa4O,YAGtC,CAAE,MAAO4C,GAEL,MADAxS,KAAKuZ,MAAM,QAAS,CAAEE,MAAO,kBAAmBjH,UAC1CA,CACV,CACJ,CAMA,mBAAMkD,GACF,IAAK1V,KAAKiT,YACN,MAAM,IAAIf,MAAM,WAGpB,IAKI,IAAIH,EAEJ,GANA/R,KAAKiT,aAAc,EACnBjT,KAAKoY,eAAiBxS,KAAKD,MAC3B3F,KAAKsY,iBAAmB5S,YAAYC,MAIhC3F,KAAK4X,aACL7F,QAAa/R,KAAKka,4BACf,KAAIla,KAAK+X,SAGZ,MAAM,IAAI7F,MAAM,YAFhBH,QAAa/R,KAAKma,yBAGtB,CAGAna,KAAKoa,kBAGLpa,KAAKuY,WAAaxG,EAClB/R,KAAKwY,UAAYmB,IAAIU,gBAAgBtI,GAErC,MAAMuI,GAAYta,KAAKoY,eAAiBpY,KAAKmY,iBAAmB,IAUhE,OARAnY,KAAKuZ,MAAM,iBAAkB,CACzBxH,OACAwI,IAAKva,KAAKwY,UACV8B,WACAE,QAASxa,KAAK8X,gBACdlI,WAAY5P,KAAKgB,aAAa4O,aAG3BmC,CAEX,CAAE,MAAOS,GAEL,MADAxS,KAAKuZ,MAAM,QAAS,CAAEE,MAAO,iBAAkBjH,UACzCA,CACV,CACJ,CAKAmD,cAAAA,GACI,IAAK3V,KAAKiT,YACN,MAAM,IAAIf,MAAM,WAGpB,GAAIlS,KAAK4X,aACL,MAAM,IAAI1F,MAAM,0BAGpB,IAAIlS,KAAK+X,UAAoD,mBAAjC/X,KAAK+X,SAASpC,eAKtC,MAAM,IAAIzD,MAAM,WAJhBlS,KAAK+X,SAASpC,iBACd3V,KAAKkT,UAAW,EAChBlT,KAAKuZ,MAAM,mBAAoB,CAAES,UAAWpU,KAAKD,OAIzD,CAKAiQ,eAAAA,GACI,IAAK5V,KAAKkT,SACN,MAAM,IAAIhB,MAAM,UAGpB,IAAIlS,KAAK+X,UAAqD,mBAAlC/X,KAAK+X,SAASnC,gBAKtC,MAAM,IAAI1D,MAAM,aAJhBlS,KAAK+X,SAASnC,kBACd5V,KAAKkT,UAAW,EAChBlT,KAAKuZ,MAAM,oBAAqB,CAAES,UAAWpU,KAAKD,OAI1D,CAMA8U,kBAAAA,GACI,MAAO,CACH1I,KAAM/R,KAAKuY,WACXgC,IAAKva,KAAKwY,UACV8B,SAAUta,KAAKuY,YAAcvY,KAAKoY,eAAiBpY,KAAKmY,iBAAmB,IAAO,EAClFqC,QAASxa,KAAK8X,gBACdlI,WAAY5P,KAAKgB,aAAehB,KAAKgB,aAAa4O,WAAa,EAEvE,CAQA8K,YAAAA,CAAa5Z,EAAO4R,GAChB,IAAK1S,KAAK4X,eAAiB5X,KAAK6X,UAAUhT,OACtC,OAAO,KAGP/D,EAAQ,IAAGA,EAAQ,GACvB,MAAMkM,EAAQhN,KAAK8X,gBACnB,GAAIhX,GAASkM,EAAO,OAAO,IAAIlJ,aAAa,GAE5C,MAAMuK,EAAMjJ,KAAKgJ,IAAIpB,EAAOlM,EAAQ4R,GAC9BiI,EAAM,IAAI7W,aAAauK,EAAMvN,GACnC,IAAI8Z,EAAS,EACTC,EAAS,EAEb,IAAK,IAAIxX,EAAI,EAAGA,EAAIrD,KAAK6X,UAAUhT,QAAUgW,EAASxM,EAAKhL,IAAK,CAC5D,MAAMyX,EAAQ9a,KAAK6X,UAAUxU,GAC7B,IAAKyX,IAAUA,EAAMjW,OAAQ,SAE7B,MACMkW,EAASF,EACTG,EAAOH,EAFAC,EAAMjW,OAInB,GAAImW,GAAQla,EAAO,CACf+Z,EAASG,EACT,QACJ,CAEA,MAAMC,EAAW7V,KAAK6C,IAAInH,EAAOia,GAC3BG,EAAS9V,KAAKgJ,IAAIC,EAAK2M,GAE7B,GAAIE,EAASD,EAAU,CACnB,MAAME,EAAaF,EAAWF,EACxBK,EAAQN,EAAMO,SAASF,EAAYA,GAAcD,EAASD,IAChEN,EAAIW,IAAIF,EAAOR,GACfA,GAAUQ,EAAMvW,MACpB,CAGA,GADAgW,EAASG,EACLE,GAAU7M,EAAK,KACvB,CAEA,OAAOsM,CACX,CAMAY,WAAAA,GACI,OAAOvb,KAAKG,QAChB,CAMAqb,eAAAA,GACI,OAAOxb,KAAKgB,YAChB,CAMA,oBAAIya,GACA,OAAOzb,KAAKiY,SAChB,CAMAyD,UAAAA,CAAW9H,GACPA,EAAOxO,KAAK6C,IAAI,EAAK7C,KAAKgJ,IAAI,EAAKwF,IACnC5T,KAAK8W,OAAOK,QAAUvD,EAElB5T,KAAKiB,cACLjB,KAAKiB,YAAY2S,KAAKqF,MAAQrF,GAGlC5T,KAAKuZ,MAAM,mBAAoB,CAAE3F,QACrC,CAKA+H,OAAAA,GACQ3b,KAAKiT,aACLjT,KAAK0V,gBAAgB7T,MAAMX,QAAQsR,OAGvCxS,KAAKoa,kBACLpa,KAAK4b,kBAED5b,KAAKwY,YACLmB,IAAIC,gBAAgB5Z,KAAKwY,WACzBxY,KAAKwY,UAAY,MAGjBxY,KAAKgB,eACLhB,KAAKgB,aAAauV,QAAQ1U,MAAMX,QAAQsR,OACxCxS,KAAKgB,aAAe,MAGxBhB,KAAKG,SAAW,KAChBH,KAAKiB,YAAc,KACnBjB,KAAKuX,UAAY,KACjBvX,KAAKwX,iBAAmB,KACxBxX,KAAK2X,iBAAmB,KACxB3X,KAAK+X,SAAW,KAEhB/X,KAAK6X,UAAY,GACjB7X,KAAK8X,gBAAkB,EAEvB9X,KAAKkY,eAAgB,EAErBlY,KAAKuZ,MAAM,WACf,CAWAsC,EAAAA,CAAGtP,EAAOuP,GACD9b,KAAKyY,gBAAgBlM,KACtBvM,KAAKyY,gBAAgBlM,GAAS,IAElCvM,KAAKyY,gBAAgBlM,GAAOqB,KAAKkO,EACrC,CAOA9R,GAAAA,CAAIuC,EAAOuP,GACP,IAAK9b,KAAKyY,gBAAgBlM,GAAQ,OAElC,MAAMuD,EAAQ9P,KAAKyY,gBAAgBlM,GAAOwP,QAAQD,GAC9ChM,GAAQ,GACR9P,KAAKyY,gBAAgBlM,GAAOyP,OAAOlM,EAAO,EAElD,CAMAyJ,KAAAA,CAAMhN,EAAO9B,GACJzK,KAAKyY,gBAAgBlM,IAE1BvM,KAAKyY,gBAAgBlM,GAAO0P,QAAQH,IAChC,IACIA,EAAQrR,EACZ,CAAE,MAAO+H,GACLtR,QAAQsR,MAAM,YAAYjG,MAAWiG,EACzC,GAER,CAMA,wBAAMkH,GACF,MAAMwC,EAAc,CAChBzI,MAAO,CACHwD,iBAAkBjX,KAAK8W,OAAOG,iBAC9BC,iBAAkBlX,KAAK8W,OAAOI,iBAC9BH,gBAAiB/W,KAAK8W,OAAOC,iBAEjCoF,OAAO,GAIPnc,KAAK8W,OAAOM,WACZ8E,EAAYzI,MAAM2D,SAAW,CAAEgF,MAAOpc,KAAK8W,OAAOM,WAGtD,IACIpX,KAAKiY,gBAAkBoE,UAAUC,aAAaC,aAAaL,GAG3Dlc,KAAKwc,6BAGUxc,KAAKgB,aAAaiB,wBAAwBjC,KAAKiY,WACvD/V,QAAQlC,KAAKiB,aAEpBjB,KAAKuZ,MAAM,sBAAuB,CAC9BnC,SAAUpX,KAAK8W,OAAOM,SACtB8E,eAGR,CAAE,MAAO1J,GAEL,GAAmB,yBAAfA,EAAMqE,MAAkD,kBAAfrE,EAAMqE,KAa/C,MAAMrE,EAZNtR,QAAQC,KAAK,4BAEN+a,EAAYzI,MAAM2D,SACzBpX,KAAKiY,gBAAkBoE,UAAUC,aAAaC,aAAaL,GAE3Dlc,KAAKwc,6BAEUxc,KAAKgB,aAAaiB,wBAAwBjC,KAAKiY,WACvD/V,QAAQlC,KAAKiB,aAEpBjB,KAAKuZ,MAAM,+BAAgC,CAAE2C,eAIrD,CACJ,CAEA9B,eAAAA,GACQpa,KAAKiY,YACLjY,KAAKiY,UAAUwE,YAAYR,QAAQS,IAC/B,IACIA,EAAMna,MACV,CAAE,MAAOiQ,GACLtR,QAAQC,KAAK,aAAcqR,EAC/B,IAEJxS,KAAKiY,UAAY,KAEzB,CAEAuE,0BAAAA,GAEI,IACI,MAAMG,EAAKN,UAAUO,WAAa,GACpB,oBAAoBC,KAAKF,KAEzB3c,KAAK8W,OAAOC,iBAClB3R,KAAKC,IAAIrF,KAAK8W,OAAOK,QAAU,GAAO,OACtCnX,KAAK0b,WAAW,KAChB1b,KAAKuZ,MAAM,oBAAqB,CAAE3F,KAAM,MAGpD,CAAE,MAAOpB,GACLtR,QAAQC,KAAK,cAAeqR,EAChC,CACJ,CAMA,4BAAMsH,GACF,IAEI9Z,KAAK2X,iBAAmB,IAAI0B,iBACxBrZ,KAAKgB,aACL,2BAIJhB,KAAK2X,iBAAiBmF,KAAKxS,UAAaiC,IACpC,MAAMpC,KAAEA,EAAI4S,QAAEA,GAAYxQ,EAAM9B,KAEnB,aAATN,GAAuB4S,IACvB/c,KAAK6X,UAAUjK,KAAK,IAAI9J,aAAaiZ,IACrC/c,KAAK8X,iBAAmBiF,EAAQlY,OAEhC7E,KAAKuZ,MAAM,iBAAkB,CACzBwD,QAAS,IAAIjZ,aAAaiZ,GAC1BC,aAAchd,KAAK8X,gBACnBmC,KAAM,cAMlBja,KAAKiB,YAAYiB,QAAQlC,KAAK2X,kBAC9B3X,KAAK2X,iBAAiBzV,QAAQlC,KAAKgB,aAAamY,aAEhDnZ,KAAK4X,cAAe,CAExB,CAAE,MAAOpF,GACLtR,QAAQsR,MAAM,mCAAoCA,GAClDxS,KAAK4X,cAAe,QACd5X,KAAK+Z,0BACf,CACJ,CAEA,2BAAMG,GACF,IAUI,GARIla,KAAK2X,mBACL3X,KAAK2X,iBAAiBmF,KAAKxS,UAAY,KACvCtK,KAAKiB,YAAYe,WAAWhC,KAAK2X,kBACjC3X,KAAK2X,iBAAiB3V,aACtBhC,KAAK2X,iBAAmB,MAIE,IAA1B3X,KAAK6X,UAAUhT,OACf,MAAM,IAAIqN,MAAM,UAGpB,MAAM+K,EAAS,IAAInZ,aAAa9D,KAAK8X,iBACrC,IAAI8C,EAAS,EAEb,IAAK,MAAME,KAAS9a,KAAK6X,UACrBoF,EAAO3B,IAAIR,EAAOF,GAClBA,GAAUE,EAAMjW,OAIpB,MAAMqY,EAAYld,KAAKmd,yBACnBF,EACAjd,KAAKgB,aAAa4O,YAGhBmC,EAAO,IAAIqL,KAAK,CAACF,GAAY,CAAE/S,KAAM,cAI3C,OAFAnK,KAAK4X,cAAe,EAEb7F,CAEX,CAAE,MAAOS,GAEL,MADAtR,QAAQsR,MAAM,qBAAsBA,GAC9BA,CACV,CACJ,CAMA,8BAAMuH,GACF,OAAO,IAAItY,QAAQ,CAACC,EAAS2b,KACzB,IAEI,GAAyB,oBAAdC,UAEP,YADAD,EAAO,IAAInL,MAAM,kBAIrB,MAAMqL,EAAevd,KAAKuX,UAAUxW,QAAUf,KAAKiY,UAEnDjY,KAAK+X,SAAWuF,UAAUC,EAAc,CACpCpT,KAAM,QACNqT,SAAU,YACVC,aAAcC,oBACdC,sBAAuB,EACvBC,WAAY,KACZC,UAAW,IACXC,gBAAkB/L,IACd/R,KAAKuZ,MAAM,iBAAkB,CACzBxH,OACAkI,KAAM,iBAKlBja,KAAK+X,SAAStC,iBACdzV,KAAK4X,cAAe,EAGpB5X,KAAK+d,mBAELrc,GAEJ,CAAE,MAAO8Q,GACL6K,EAAO7K,EACX,GAER,CAEA,6BAAM2H,GACF,OAAO,IAAI1Y,QAAQ,CAACC,EAAS2b,KACzB,IACI,IAAKrd,KAAK+X,SAEN,YADAsF,EAAO,IAAInL,MAAM,qBAKrBlS,KAAK4b,kBAEL5b,KAAK+X,SAASrC,cAAc,KACxB,IACI,MAAM3D,EAAO/R,KAAK+X,SAASiG,UAG3Bhe,KAAK+X,SAAW,KAEhBrW,EAAQqQ,EACZ,CAAE,MAAOS,GACL6K,EAAO7K,EACX,GAGR,CAAE,MAAOA,GACL6K,EAAO7K,EACX,GAER,CAMAuL,gBAAAA,GACI,IAAK/d,KAAKG,SAAU,OAEpB,MAAMM,EAAeT,KAAKG,SAASiC,QAC7B1B,EAAY,IAAIoD,aAAarD,GAGnCT,KAAKgY,oBAAsBiG,YAAY,KACnC,IAAKje,KAAKiT,cAAgBjT,KAAKG,SAC3B,OAIJH,KAAKG,SAAS2E,uBAAuBpE,GAGrC,MAAMwd,EAAW,IAAIpa,aAAapD,GAGlCV,KAAK6X,UAAUjK,KAAKsQ,GACpBle,KAAK8X,iBAAmBoG,EAASrZ,OAGjC7E,KAAKuZ,MAAM,iBAAkB,CACzBwD,QAASmB,EACTlB,aAAchd,KAAK8X,gBACnBmC,KAAM,mBAEX,IACP,CAMA2B,eAAAA,GACQ5b,KAAKgY,sBACLmG,cAAcne,KAAKgY,qBACnBhY,KAAKgY,oBAAsB,KAEnC,CAMAmF,wBAAAA,CAAyBiB,EAAaxO,GAClC,MAAMyO,EAAaD,EAAYvZ,OACzByZ,EAAS,IAAIC,YAAY,GAAkB,EAAbF,GAC9BG,EAAO,IAAIC,SAASH,GAG1Bte,KAAK0e,aAAaF,EAAM,EAAG,QAC3BA,EAAKG,UAAU,EAAG,GAAkB,EAAbN,GAAgB,GACvCre,KAAK0e,aAAaF,EAAM,EAAG,QAC3Bxe,KAAK0e,aAAaF,EAAM,GAAI,QAC5BA,EAAKG,UAAU,GAAI,IAAI,GACvBH,EAAKI,UAAU,GAAI,GAAG,GACtBJ,EAAKI,UAAU,GAAI,GAAG,GACtBJ,EAAKG,UAAU,GAAI/O,GAAY,GAC/B4O,EAAKG,UAAU,GAAiB,EAAb/O,GAAgB,GACnC4O,EAAKI,UAAU,GAAI,GAAG,GACtBJ,EAAKI,UAAU,GAAI,IAAI,GACvB5e,KAAK0e,aAAaF,EAAM,GAAI,QAC5BA,EAAKG,UAAU,GAAiB,EAAbN,GAAgB,GAGnC,IAAIzD,EAAS,GACb,IAAK,IAAIvX,EAAI,EAAGA,EAAIgb,EAAYhb,IAAK,CACjC,MAAMoJ,EAASrH,KAAK6C,OAAQ7C,KAAKgJ,IAAI,EAAGgQ,EAAY/a,KAC9Cwb,EAAQpS,EAAS,EAAa,MAATA,EAA2B,MAATA,EAC7C+R,EAAKM,SAASlE,EAAQiE,GAAO,GAC7BjE,GAAU,CACd,CAEA,OAAO0D,CACX,CAEAI,YAAAA,CAAaF,EAAM5D,EAAQmE,GACvB,IAAK,IAAI1b,EAAI,EAAGA,EAAI0b,EAAOla,OAAQxB,IAC/Bmb,EAAKQ,SAASpE,EAASvX,EAAG0b,EAAOE,WAAW5b,GAEpD,qCC3zBG,cAA+ByO,EAKpCjS,WAAAA,CAAYqf,EAAY,cAKtB,GAJAC,QACAnf,KAAKkf,UAAYA,EAGK,oBAAXtG,SAA2BA,OAAOwG,UAC3C,MAAM,IAAIlN,MAAM,yEAGlBlS,KAAKof,UAAYxG,OAAOwG,UACxBpf,KAAK8S,aAAc,CACrB,CAMA,gBAAM4F,GACJ,IAAI1Y,KAAK8S,YAET,IACE,MAAMuM,WAAEA,EAAUC,UAAEA,GAActf,KAAKof,UAAUG,QAGjD,UACQF,EAAWG,QAAQ,CACvBhG,KAAMxZ,KAAKkf,UACXA,UAAWI,EAAUG,WAEzB,CAAE,MAAOtd,SAEDkd,EAAWK,MAAM,CACrBlG,KAAMxZ,KAAKkf,UACXA,UAAWI,EAAUG,UACrBE,WAAW,GAEf,CAEA3f,KAAK8S,aAAc,CACrB,CAAE,MAAON,GAEP,MADAtR,QAAQsR,MAAM,kCAAmCA,GAC3CA,CACR,CACF,CASA,UAAM/L,CAAKsL,EAAMC,EAAUC,EAAW,CAAA,SAC9BjS,KAAK0Y,aAEX,IACE,MAAM2G,WAAEA,EAAUC,UAAEA,GAActf,KAAKof,UAAUG,QAG3CK,QAAmB5f,KAAK6f,aAAa9N,GAU3C,SAPMsN,EAAWS,UAAU,CACzBtG,KAAM,GAAGxZ,KAAKkf,aAAalN,IAC3BvH,KAAMmV,EACNV,UAAWI,EAAUG,YAInBxN,GAAYiD,OAAO6K,KAAK9N,GAAUpN,OAAS,EAAG,CAChD,MAAMmb,EAAuB,IACxB/N,EACHgO,KAAMlO,EAAKkO,KACX9V,KAAM4H,EAAK5H,KACX6P,UAAWpU,KAAKD,aAGZ0Z,EAAWS,UAAU,CACzBtG,KAAM,GAAGxZ,KAAKkf,aAAalN,cAC3BvH,KAAMyV,KAAKC,UAAUH,GACrBd,UAAWI,EAAUG,UACrBW,SAAU,QAEd,CAEA,OAAOpO,CACT,CAAE,MAAOQ,GAEP,MADAtR,QAAQsR,MAAM,wBAAyBA,GACjCA,CACR,CACF,CAOA,UAAML,CAAKH,SACHhS,KAAK0Y,aAEX,IACE,MAAM2G,WAAEA,EAAUC,UAAEA,GAActf,KAAKof,UAAUG,QAE3CvK,QAAeqK,EAAWgB,SAAS,CACvC7G,KAAM,GAAGxZ,KAAKkf,aAAalN,IAC3BkN,UAAWI,EAAUG,YAIvB,OAAOzf,KAAKsgB,aAAatL,EAAOvK,KAAM,YACxC,CAAE,MAAO+H,GAEP,MADAtR,QAAQsR,MAAM,wBAAyBA,GACjCA,CACR,CACF,CAOA,YAAMH,CAAOL,SACLhS,KAAK0Y,aAEX,IACE,MAAM2G,WAAEA,EAAUC,UAAEA,GAActf,KAAKof,UAAUG,cAG3CF,EAAWkB,WAAW,CAC1B/G,KAAM,GAAGxZ,KAAKkf,aAAalN,IAC3BkN,UAAWI,EAAUG,YAIvB,UACQJ,EAAWkB,WAAW,CAC1B/G,KAAM,GAAGxZ,KAAKkf,aAAalN,cAC3BkN,UAAWI,EAAUG,WAEzB,CAAE,MAAOtd,GACP,CAGF,OAAO,CACT,CAAE,MAAOqQ,GAEP,MADAtR,QAAQsR,MAAM,0BAA2BA,GACnCA,CACR,CACF,CAMA,UAAMF,SACEtS,KAAK0Y,aAEX,IACE,MAAM2G,WAAEA,EAAUC,UAAEA,GAActf,KAAKof,UAAUG,QAQ3CiB,SANenB,EAAWG,QAAQ,CACtChG,KAAMxZ,KAAKkf,UACXA,UAAWI,EAAUG,aAIGhN,MAAMgO,OAAOC,IAAMA,EAAEC,SAAS,eAGlDvK,QAAmB3U,QAAQmf,IAC/BJ,EAAWK,IAAIC,UACb,IAAI7O,EAAW,CAAA,EAEf,IACE,MAAM8O,QAAmB1B,EAAWgB,SAAS,CAC3C7G,KAAM,GAAGxZ,KAAKkf,aAAalN,cAC3BkN,UAAWI,EAAUG,UACrBW,SAAU,SAEZnO,EAAWiO,KAAKc,MAAMD,EAAWtW,KACnC,CAAE,MAAOtI,GACP,CAGF,MAAO,CACLiQ,GAAIJ,EACJA,SAAUA,EACVC,SAAUA,EACV+H,UAAW/H,EAAS+H,WAAa,EACjCrD,KAAM1E,EAAS+H,UAAY,IAAIpU,KAAKqM,EAAS+H,WAAa,KAC1DiG,KAAMhO,EAASgO,MAAQ,EACvB9V,KAAM8H,EAAS9H,MAAQ,gBAQ7B,OAFAiM,EAAW6K,KAAK,CAACC,EAAGC,IAAMA,EAAEnH,UAAYkH,EAAElH,WAEnC5D,CACT,CAAE,MAAO5D,GAEP,OADAtR,QAAQsR,MAAM,wBAAyBA,GAChC,EACT,CACF,CAOA,YAAM4O,CAAOpP,SACLhS,KAAK0Y,aAEX,IACE,MAAM2G,WAAEA,EAAUC,UAAEA,GAActf,KAAKof,UAAUG,QAOjD,aALqBF,EAAW+B,OAAO,CACrC5H,KAAM,GAAGxZ,KAAKkf,aAAalN,IAC3BkN,UAAWI,EAAUG,aAGT4B,GAChB,CAAE,MAAO7O,GAEP,MADAtR,QAAQsR,MAAM,0BAA2BA,GACnCA,CACR,CACF,CAOAqN,YAAAA,CAAa9N,GACX,OAAO,IAAItQ,QAAQ,CAACC,EAAS2b,KAC3B,MAAMiE,EAAS,IAAIC,WACnBD,EAAOE,UAAY,KAEjB,MAAMC,EAASH,EAAOtM,OAAO0M,MAAM,KAAK,GACxChgB,EAAQ+f,IAEVH,EAAOK,QAAUtE,EACjBiE,EAAOM,cAAc7P,IAEzB,CAQAuO,YAAAA,CAAamB,EAAQjE,EAAW,aAC9B,MAAMqE,EAAiBC,KAAKL,GACtBM,EAAc,IAAI5M,MAAM0M,EAAehd,QAE7C,IAAK,IAAIxB,EAAI,EAAGA,EAAIwe,EAAehd,OAAQxB,IACzC0e,EAAY1e,GAAKwe,EAAe5C,WAAW5b,GAG7C,MAAM2e,EAAY,IAAI3f,WAAW0f,GACjC,OAAO,IAAI3E,KAAK,CAAC4E,GAAY,CAAE7X,KAAMqT,GACvC,CAMA,oBAAMyE,GACJ,MAAM7L,QAAmBpW,KAAKsS,OACxB4P,EAAY9L,EAAW+L,OAAO,CAACC,EAAKC,IAAMD,GAAOC,EAAEpC,MAAQ,GAAI,GAErE,MAAO,CACLvN,MAAO0D,EAAWvR,OAClBqd,UAAWA,EACXI,aAAcJ,EAAS,SAAkBza,QAAQ,GACjD2O,WAAYA,EAEhB,qBC5RK,cAA8BtE,EAKnCjS,WAAAA,CAAY0iB,EAAW,cAKrB,GAJApD,QACAnf,KAAKuiB,SAAWA,EAGM,oBAAX3J,SAA2BA,OAAO4J,YAC3C,MAAM,IAAItQ,MAAM,gFAGlBlS,KAAKwiB,YAAc5J,OAAO4J,WAC5B,CASA,UAAM/b,CAAKsL,EAAMC,EAAUC,EAAW,CAAA,GACpC,IAEE,MAAMwQ,QAAoB1Q,EAAK0Q,cAGzBnE,EAASnJ,MAAMuN,KAAK,IAAIrgB,WAAWogB,IAGnCzN,QAAehV,KAAKwiB,YAAY1M,cAAc,CAClD9D,WACAsM,SACArM,SAAU,IACLA,EACHgO,KAAMlO,EAAKkO,KACX9V,KAAM4H,EAAK5H,KACX6P,UAAWpU,KAAKD,SAIpB,GAAIqP,EAAO2N,QACT,OAAO3N,EAAO5C,IAAM4C,EAAOwE,KAE3B,MAAM,IAAItH,MAAM8C,EAAOxC,OAAS,cAEpC,CAAE,MAAOA,GAEP,MADAtR,QAAQsR,MAAM,uBAAwBA,GAChCA,CACR,CACF,CAOA,UAAML,CAAKyQ,GACT,IAEE,MAAMtE,QAAete,KAAKwiB,YAAYvM,cAAc2M,GAG9CC,EAAa,IAAIxgB,WAAWic,GAClC,OAAO,IAAIlB,KAAK,CAACyF,GAAa,CAAE1Y,KAAM,aACxC,CAAE,MAAOqI,GAEP,MADAtR,QAAQsR,MAAM,uBAAwBA,GAChCA,CACR,CACF,CAOA,YAAMH,CAAOuQ,GACX,IAEE,aADqB5iB,KAAKwiB,YAAYtM,gBAAgB0M,IACxCD,OAChB,CAAE,MAAOnQ,GAEP,MADAtR,QAAQsR,MAAM,yBAA0BA,GAClCA,CACR,CACF,CAOA,UAAMF,CAAK4M,EAAY,MACrB,IAEE,aADyBlf,KAAKwiB,YAAYrM,eAAe+I,IACpC,EACvB,CAAE,MAAO1M,GAEP,OADAtR,QAAQsR,MAAM,uBAAwBA,GAC/B,EACT,CACF,CAMA,cAAMsQ,GACJ,IACE,GAAI9iB,KAAKwiB,YAAYM,SACnB,aAAa9iB,KAAKwiB,YAAYM,WAEhC,MAAM,IAAI5Q,MAAM,6BAClB,CAAE,MAAOM,GAEP,OADAtR,QAAQsR,MAAM,2BAA4BA,GACnC,IACT,CACF,CAQA,YAAMuQ,CAAOhR,EAAMiR,EAAkB,iBACnC,IACE,MAAMP,QAAoB1Q,EAAK0Q,cACzBnE,EAASnJ,MAAMuN,KAAK,IAAIrgB,WAAWogB,IAEzC,GAAIziB,KAAKwiB,YAAYO,OAAQ,CAC3B,MAAM/N,QAAehV,KAAKwiB,YAAYO,OAAO,CAC3C/Q,SAAUgR,EACV1E,WAGF,OAAOtJ,EAAO2N,QAAU3N,EAAOwE,KAAO,IACxC,CAGA,aAAaxZ,KAAKyG,KAAKsL,EAAMiR,EAC/B,CAAE,MAAOxQ,GAEP,OADAtR,QAAQsR,MAAM,yBAA0BA,GACjC,IACT,CACF,CAOA,kBAAMyQ,CAAaL,GACjB,IACE,QAAI5iB,KAAKwiB,YAAYS,qBACbjjB,KAAKwiB,YAAYS,aAAaL,IAC7B,EAGX,CAAE,MAAOpQ,GAEP,OADAtR,QAAQsR,MAAM,+BAAgCA,IACvC,CACT,CACF,sBCpKK,cAA+BV,EAOpCjS,WAAAA,CAAYqjB,EAAS,cAAeC,EAAY,aAAczM,EAAU,GACtEyI,QACAnf,KAAKkjB,OAASA,EACdljB,KAAKmjB,UAAYA,EACjBnjB,KAAK0W,QAAUA,EACf1W,KAAK0G,GAAK,IACZ,CAMA,gBAAMgS,GACJ,OAAI1Y,KAAK0G,GACA1G,KAAK0G,GAGP,IAAIjF,QAAQ,CAACC,EAAS2b,KAC3B,MAAM+F,EAAUC,UAAUC,KAAKtjB,KAAKkjB,OAAQljB,KAAK0W,SAEjD0M,EAAQzB,QAAU,KAChBtE,EAAO,IAAInL,MAAM,6BAA6BkR,EAAQ5Q,WAGxD4Q,EAAQG,UAAY,KAClBvjB,KAAK0G,GAAK0c,EAAQpO,OAClBtT,EAAQ1B,KAAK0G,KAGf0c,EAAQI,gBAAmBjX,IACzB,MAAM7F,EAAK6F,EAAMuI,OAAOE,OAGxB,IAAKtO,EAAG+c,iBAAiBC,SAAS1jB,KAAKmjB,WAAY,CACjD,MAAMQ,EAAQjd,EAAGkd,kBAAkB5jB,KAAKmjB,UAAW,CACjDU,QAAS,KACTC,eAAe,IAIjBH,EAAMI,YAAY,WAAY,WAAY,CAAEC,QAAQ,IACpDL,EAAMI,YAAY,YAAa,YAAa,CAAEC,QAAQ,IACtDL,EAAMI,YAAY,WAAY,WAAY,CAAEC,QAAQ,GACtD,IAGN,CASA,UAAMvd,CAAKsL,EAAMC,EAAUC,EAAW,CAAA,GAGpC,aAFMjS,KAAK0Y,aAEJ,IAAIjX,QAAQ,CAACC,EAAS2b,KAC3B,MAAM4G,EAAcjkB,KAAK0G,GAAGud,YAAY,CAACjkB,KAAKmjB,WAAY,aACpDQ,EAAQM,EAAYC,YAAYlkB,KAAKmjB,WAErCgB,EAAS,CACbnS,SAAUA,EACVD,KAAMA,EACNkO,KAAMlO,EAAKkO,KACX9V,KAAM4H,EAAK5H,KACX6P,UAAWpU,KAAKD,MAChBsM,SAAUA,GAGNmR,EAAUO,EAAMS,IAAID,GAE1Bf,EAAQG,UAAY,KAClB7hB,EAAQ2iB,OAAOjB,EAAQpO,UAGzBoO,EAAQzB,QAAU,KAChBtE,EAAO,IAAInL,MAAM,6BAA6BkR,EAAQ5Q,WAGxDyR,EAAYtC,QAAU,KACpBtE,EAAO,IAAInL,MAAM,uBAAuB+R,EAAYzR,YAG1D,CAOA,UAAML,CAAKC,GAGT,aAFMpS,KAAK0Y,aAEJ,IAAIjX,QAAQ,CAACC,EAAS2b,KAC3B,MAEM+F,EAFcpjB,KAAK0G,GAAGud,YAAY,CAACjkB,KAAKmjB,WAAY,YAChCe,YAAYlkB,KAAKmjB,WACrBmB,IAAIC,OAAOnS,IAEjCgR,EAAQG,UAAY,KAClB,MAAMY,EAASf,EAAQpO,OACnBmP,GAAUA,EAAOpS,KACnBrQ,EAAQyiB,EAAOpS,MAEfsL,EAAO,IAAInL,MAAM,wBAAwBE,OAI7CgR,EAAQzB,QAAU,KAChBtE,EAAO,IAAInL,MAAM,6BAA6BkR,EAAQ5Q,YAG5D,CAOA,YAAMH,CAAOD,GAGX,aAFMpS,KAAK0Y,aAEJ,IAAIjX,QAAQ,CAACC,EAAS2b,KAC3B,MAEM+F,EAFcpjB,KAAK0G,GAAGud,YAAY,CAACjkB,KAAKmjB,WAAY,aAChCe,YAAYlkB,KAAKmjB,WACrB9Q,OAAOkS,OAAOnS,IAEpCgR,EAAQG,UAAY,KAClB7hB,GAAQ,IAGV0hB,EAAQzB,QAAU,KAChBtE,EAAO,IAAInL,MAAM,+BAA+BkR,EAAQ5Q,YAG9D,CAMA,UAAMF,GAGJ,aAFMtS,KAAK0Y,aAEJ,IAAIjX,QAAQ,CAACC,EAAS2b,KAC3B,MAEM+F,EAFcpjB,KAAK0G,GAAGud,YAAY,CAACjkB,KAAKmjB,WAAY,YAChCe,YAAYlkB,KAAKmjB,WACrBqB,SAEtBpB,EAAQG,UAAY,KAClB,MAAMkB,EAAUrB,EAAQpO,OAAO6L,IAAIsD,IAAM,CACvC/R,GAAIiS,OAAOF,EAAO/R,IAClBJ,SAAUmS,EAAOnS,SACjBiO,KAAMkE,EAAOlE,KACb9V,KAAMga,EAAOha,KACb6P,UAAWmK,EAAOnK,UAClBrD,KAAM,IAAI/Q,KAAKue,EAAOnK,WACtB/H,SAAUkS,EAAOlS,UAAY,CAAA,KAE/BvQ,EAAQ+iB,IAGVrB,EAAQzB,QAAU,KAChBtE,EAAO,IAAInL,MAAM,8BAA8BkR,EAAQ5Q,YAG7D,CAOA,sBAAMkS,CAAiB1S,GAErB,aADyBhS,KAAKsS,QACZmO,OAAO0D,GACvBA,EAAOnS,SAAS2S,cAAcC,SAAS5S,EAAS2S,eAEpD,CAMA,oBAAM1C,GACJ,MAAMwC,QAAgBzkB,KAAKsS,OACrB4P,EAAYuC,EAAQtC,OAAO,CAACC,EAAK+B,IAAW/B,EAAM+B,EAAOlE,KAAM,GAErE,MAAO,CACLvN,MAAO+R,EAAQ5f,OACfqd,UAAWA,EACXI,aAAcJ,EAAS,SAAkBza,QAAQ,GACjDgd,QAASA,EAEb,CAMA,WAAM3e,GAGJ,aAFM9F,KAAK0Y,aAEJ,IAAIjX,QAAQ,CAACC,EAAS2b,KAC3B,MACMsG,EADc3jB,KAAK0G,GAAGud,YAAY,CAACjkB,KAAKmjB,WAAY,aAChCe,YAAYlkB,KAAKmjB,WAGrC0B,EAAelB,EAAMjR,QAE3BmS,EAAatB,UAAY,KACvB,MAAM7Q,EAAQmS,EAAa7P,OAGrB8P,EAAenB,EAAM7d,QAE3Bgf,EAAavB,UAAY,KACvB7hB,EAAQgR,IAGVoS,EAAanD,QAAU,KACrBtE,EAAO,IAAInL,MAAM,+BAA+B4S,EAAatS,YAIjEqS,EAAalD,QAAU,KACrBtE,EAAO,IAAInL,MAAM,+BAA+B2S,EAAarS,YAGnE,CAMA,wBAAMuS,GACJ,GAAI,YAAa1I,WAAa,aAAcA,UAAUtJ,QACpD,IACE,MAAMiS,QAAiB3I,UAAUtJ,QAAQiS,WACzC,MAAO,CACLC,MAAOD,EAASC,MAChBC,MAAOF,EAASE,MAChBC,SAAUH,EAASC,MAAK,SAAkBxd,QAAQ,GAClD2d,SAAUJ,EAASE,MAAK,SAAkBzd,QAAQ,GAClD4d,cAAgBL,EAASC,MAAQD,EAASE,MAAS,KAAKzd,QAAQ,GAEpE,CAAE,MAAO+K,GAEP,OADAtR,QAAQC,KAAK,kCAAmCqR,GACzC,IACT,CAEF,OAAO,IACT,CAKA+D,KAAAA,GACMvW,KAAK0G,KACP1G,KAAK0G,GAAG6P,QACRvW,KAAK0G,GAAK,KAEd,sBChRK,MAKL,aAAO4e,GAEL,MAAsB,oBAAX1M,QAA0BA,OAAO4J,aAKrB,oBAAZ+C,SAA2BA,QAAQC,UAAYD,QAAQC,SAASC,SAJlE,WASa,oBAAX7M,QAA0BA,OAAOwG,UACnC,YAIF,SACT,CAMA,iBAAOsG,GACL,MAAyB,aAAlB1lB,KAAKslB,QACd,CAMA,kBAAOK,GACL,MAAyB,cAAlB3lB,KAAKslB,QACd,CAMA,gBAAOM,GACL,MAAyB,YAAlB5lB,KAAKslB,QACd,CAMA,eAAOO,GACL,QAAsB,oBAAXjN,SAA2BA,OAAOyD,YAItC,iEAAiEQ,KACtEjE,OAAOyD,UAAUO,UAErB,CAMA,2BAAOkJ,GACL,GAAsB,oBAAXlN,SAA2BA,OAAOC,aAC3C,OAAO,EAIT,MAAO,iBADmBD,OAAOC,cAAgBD,OAAOE,oBACbiN,SAC7C,CAMA,8BAAOC,GACL,MAAkC,oBAApBC,eAChB,CAMA,cAAOC,GACL,MAAO,CACLC,SAAUnmB,KAAKslB,SACfI,WAAY1lB,KAAK0lB,aACjBC,YAAa3lB,KAAK2lB,cAClBC,UAAW5lB,KAAK4lB,YAChBC,SAAU7lB,KAAK6lB,WACfC,qBAAsB9lB,KAAK8lB,uBAC3BE,wBAAyBhmB,KAAKgmB,0BAC9BpJ,UAAgC,oBAAdP,UAA4BA,UAAUO,UAAY,UAExE,gBCtFK,MASL/c,WAAAA,CAAYuT,EAAWhL,EAAU,IAM/B,GAJApI,KAAKoT,UAAiC,iBAAdA,EACpBgT,SAASC,cAAcjT,GACvBA,GAECpT,KAAKoT,UACR,MAAM,IAAIlB,MAAM,+BAIlBlS,KAAKsmB,YAAcle,EAAQke,YAC3BtmB,KAAKumB,iBAAmBne,EAAQme,iBAGhCvmB,KAAKoI,QAAU,CACbmL,OAAQnL,EAAQmL,QAAU,OAC1BC,MAAOpL,EAAQoL,OAAS,QACxBM,cAAuC,IAAzB1L,EAAQ0L,gBACnB1L,GAILpI,KAAKqU,UAAY,CACfC,cAAelM,EAAQkM,eAAa,MAAa,GACjDC,aAAcnM,EAAQmM,cAAY,MAAa,GAC/CG,YAAatM,EAAQsM,aAAW,MAAa,GAC7CC,WAAYvM,EAAQuM,YAAU,MAAa,GAC3CC,QAASxM,EAAQwM,UAAapC,GAAUtR,QAAQsR,MAAM,YAAaA,OAChEpK,EAAQiM,WAIbrU,KAAKwmB,SAAW,CAAA,EAGhBxmB,KAAK2B,MAAQ,CACXsR,aAAa,EACbjK,WAAW,EACXkK,UAAU,EACVuT,cAAc,EACdnM,SAAU,EACV5R,YAAa,GAIf1I,KAAK0mB,aAAe,KACpB1mB,KAAK2mB,mBAAqB,KAC1B3mB,KAAK4mB,cAAgB,IACvB,CAKA,gBAAMlO,GACJ,IAEE1Y,KAAK6mB,WAGL7mB,KAAK8mB,gBAGL9mB,KAAK+mB,aAGL/mB,KAAKgnB,2BAGLhnB,KAAKinB,uBAGLjnB,KAAKknB,qBAELhmB,QAAQI,IAAI,2BACd,CAAE,MAAOkR,GAEP,MADAxS,KAAKqU,UAAUO,QAAQpC,GACjBA,CACR,CACF,CAMAqU,QAAAA,GACE7mB,KAAKoT,UAAU+T,UAAY,wDACsBnnB,KAAKoI,QAAQmL,uBAAuBvT,KAAKoI,QAAQoL,iuCAmC1FxT,KAAKoI,QAAQ0L,aAAe,8LAK1B,suCAoCZ,CAKAgT,aAAAA,GACE9mB,KAAKwmB,SAAW,CAEdY,UAAWhB,SAASiB,eAAe,kBACnCC,QAASlB,SAASiB,eAAe,gBACjCE,SAAUnB,SAASiB,eAAe,iBAClCG,QAASpB,SAASiB,eAAe,gBACjCI,QAASrB,SAASiB,eAAe,gBACjCK,SAAUtB,SAASiB,eAAe,iBAClCM,gBAAiBvB,SAASiB,eAAe,yBAGzCO,kBAAmBxB,SAASiB,eAAe,0BAC3C3e,YAAa0d,SAASiB,eAAe,oBACrCQ,gBAAiBzB,SAASiB,eAAe,wBAGzCS,WAAY1B,SAASiB,eAAe,qBACpCU,cAAe3B,SAASiB,eAAe,gBACvCW,kBAAmB5B,SAASiB,eAAe,4BAC3CY,eAAgB7B,SAASiB,eAAe,yBAE5C,CAKAN,UAAAA,GAEM/mB,KAAKwmB,SAASY,WAChBpnB,KAAKwmB,SAASY,UAAUpc,iBAAiB,QAAS,KAChDhL,KAAKkoB,uBAKLloB,KAAKwmB,SAASc,SAChBtnB,KAAKwmB,SAASc,QAAQtc,iBAAiB,QAAS,KAC9ChL,KAAKmoB,eAILnoB,KAAKwmB,SAASe,UAChBvnB,KAAKwmB,SAASe,SAASvc,iBAAiB,QAAS,KAC/ChL,KAAKooB,gBAILpoB,KAAKwmB,SAASgB,SAChBxnB,KAAKwmB,SAASgB,QAAQxc,iBAAiB,QAAS,KAC9ChL,KAAKqoB,eAKLroB,KAAKwmB,SAASiB,SAChBznB,KAAKwmB,SAASiB,QAAQzc,iBAAiB,QAAS,KAC9ChL,KAAKsoB,eAILtoB,KAAKwmB,SAASkB,UAChB1nB,KAAKwmB,SAASkB,SAAS1c,iBAAiB,QAAS,KAC/ChL,KAAKuoB,gBAILvoB,KAAKwmB,SAASmB,iBAChB3nB,KAAKwmB,SAASmB,gBAAgB3c,iBAAiB,QAAS,KACtDhL,KAAKwoB,uBAKT5P,OAAO5N,iBAAiB,SAAU,KAChChL,KAAKyoB,gBAET,CAKAzB,wBAAAA,GAGE,CAMFC,oBAAAA,GAEEjnB,KAAK0oB,YAAY1oB,KAAKoI,QAAQmL,QAG9BvT,KAAK2oB,WAAW3oB,KAAKoI,QAAQoL,OAG7BxT,KAAK4oB,oBACP,CAKA1B,kBAAAA,GACOlnB,KAAKsmB,aAAgBtmB,KAAKumB,kBAM/BvmB,KAAKsmB,YAAYzK,GAAG,kBAAmB,KACrC7b,KAAK6oB,qBAGP7oB,KAAKsmB,YAAYzK,GAAG,iBAAmBpR,IACrCzK,KAAK8oB,gBAAgBre,KAGvBzK,KAAKsmB,YAAYzK,GAAG,iBAAmBpR,IACrCzK,KAAK+oB,gBAAgBte,KAGvBzK,KAAKsmB,YAAYzK,GAAG,QAAUrJ,IAC5BxS,KAAKgpB,aAAaxW,MAlBlBtR,QAAQC,KAAK,gEAoBjB,CAOA,wBAAM+mB,GACJ,IACMloB,KAAK2B,MAAMsR,kBAEPjT,KAAKsmB,YAAY5Q,sBAGjB1V,KAAKsmB,YAAY7Q,gBAE3B,CAAE,MAAOjD,GACPxS,KAAKqU,UAAUO,QAAQpC,GACvBxS,KAAKipB,UAAU,UAAYzW,EAAM0W,QACnC,CACF,CAKA,gBAAMf,GACJ,IAEEjnB,QAAQI,IAAI,kBACZtB,KAAKqU,UAAUK,aACjB,CAAE,MAAOlC,GACPxS,KAAKqU,UAAUO,QAAQpC,EACzB,CACF,CAKA,iBAAM4V,GACJ,IAEElnB,QAAQI,IAAI,iBACd,CAAE,MAAOkR,GACPxS,KAAKqU,UAAUO,QAAQpC,EACzB,CACF,CAKA,gBAAM6V,GACJ,IAEEnnB,QAAQI,IAAI,iBACZtB,KAAKqU,UAAUM,YACjB,CAAE,MAAOnC,GACPxS,KAAKqU,UAAUO,QAAQpC,EACzB,CACF,CAKA,gBAAM8V,GACJ,IAEEpnB,QAAQI,IAAI,iBACd,CAAE,MAAOkR,GACPxS,KAAKqU,UAAUO,QAAQpC,EACzB,CACF,CAKA,iBAAM+V,GACJ,GAAKY,QAAQ,eAIb,IAEMnpB,KAAKumB,kBACPvmB,KAAKumB,iBAAiB3Z,QAIxB5M,KAAK2B,MAAM8kB,cAAe,EAC1BzmB,KAAK2B,MAAM2Y,SAAW,EACtBta,KAAK2B,MAAM+G,YAAc,EAGzB1I,KAAKopB,wBACLppB,KAAK4oB,qBAEL1nB,QAAQI,IAAI,oBACd,CAAE,MAAOkR,GACPxS,KAAKqU,UAAUO,QAAQpC,EACzB,CACF,CAKAgW,kBAAAA,GACE,MACMa,EAA8B,eADdrpB,KAAKoT,UAAUkW,QAAQ/V,OACM,WAAa,aAChEvT,KAAK0oB,YAAYW,EACnB,CAKAZ,YAAAA,GAEMzoB,KAAKumB,kBACPvmB,KAAKumB,iBAAiB1gB,QAE1B,CAOAgjB,gBAAAA,GACE7oB,KAAK2B,MAAMsR,aAAc,EACzBjT,KAAK2B,MAAM8kB,cAAe,EAG1BzmB,KAAKupB,mBAAkB,GACvBvpB,KAAK4oB,qBAGD5oB,KAAKumB,iBAKTvmB,KAAKqU,UAAUC,gBAEfpT,QAAQI,IAAI,wBACd,CAKAwnB,eAAAA,CAAgBre,GACdzK,KAAK2B,MAAMsR,aAAc,EAGzBjT,KAAKupB,mBAAkB,GACvBvpB,KAAK4oB,qBAGL5oB,KAAKqU,UAAUE,aAAa9J,GAE5BvJ,QAAQI,IAAI,uBAAwBmJ,EACtC,CAKAse,eAAAA,CAAgBte,QAEQuM,IAAlBvM,EAAK6P,WACPta,KAAK2B,MAAM2Y,SAAW7P,EAAK6P,eAEJtD,IAArBvM,EAAK/B,cACP1I,KAAK2B,MAAM+G,YAAc+B,EAAK/B,aAIhC1I,KAAKopB,uBACP,CAKAJ,YAAAA,CAAaxW,GACXxS,KAAKipB,UAAU,QAAUzW,EAAM0W,SAC/BlpB,KAAKqU,UAAUO,QAAQpC,EACzB,CAQA+W,iBAAAA,CAAkBtW,GAChB,MAAMuW,EAAMxpB,KAAKwmB,SAASY,UACrBoC,IAEDvW,GACFuW,EAAIC,UAAUrF,IAAI,aAClBoF,EAAInD,cAAc,SAASqD,YAAc,IACzCF,EAAInD,cAAc,UAAUqD,YAAc,SAE1CF,EAAIC,UAAUE,OAAO,aACrBH,EAAInD,cAAc,SAASqD,YAAc,IACzCF,EAAInD,cAAc,UAAUqD,YAAc,QAE9C,CAKAd,kBAAAA,GACE,MAAM3V,YAAEA,EAAWjK,UAAEA,EAASkK,SAAEA,EAAQuT,aAAEA,GAAiBzmB,KAAK2B,MAG5D3B,KAAKwmB,SAASY,YAChBpnB,KAAKwmB,SAASY,UAAUwC,SAAW5gB,GAIjChJ,KAAKwmB,SAASc,UAChBtnB,KAAKwmB,SAASc,QAAQsC,UAAYnD,GAAgBxT,GAAejK,GAG/DhJ,KAAKwmB,SAASe,WAChBvnB,KAAKwmB,SAASe,SAASqC,UAAY5gB,GAAakK,GAG9ClT,KAAKwmB,SAASgB,UAChBxnB,KAAKwmB,SAASgB,QAAQoC,UAAY5gB,IAAckK,GAI9ClT,KAAKwmB,SAASiB,UAChBznB,KAAKwmB,SAASiB,QAAQmC,UAAYnD,GAAgBxT,GAGhDjT,KAAKwmB,SAASkB,WAChB1nB,KAAKwmB,SAASkB,SAASkC,UAAYnD,GAAgBxT,EAEvD,CAKAmW,qBAAAA,GACMppB,KAAKwmB,SAASoB,oBAChB5nB,KAAKwmB,SAASoB,kBAAkB8B,YAAc1pB,KAAK6pB,eAAe7pB,KAAK2B,MAAM2Y,WAG3Eta,KAAKwmB,SAAS9d,cAChB1I,KAAKwmB,SAAS9d,YAAYghB,YAAc,GAAG1pB,KAAK2B,MAAM+G,YAAYohB,2BAEtE,CAOAD,cAAAA,CAAeE,GACb,MAAMC,EAAU5kB,KAAKkH,MAAMyd,EAAU,IAC/BE,EAAO7kB,KAAKkH,MAAMyd,EAAU,IAC5BG,EAAU9kB,KAAKkH,MAAOyd,EAAU,EAAK,IAE3C,MAAO,GAAGC,EAAQljB,WAAWqjB,SAAS,EAAG,QAAQF,EAAKnjB,WAAWqjB,SAAS,EAAG,QAAQD,GACvF,CAMAxB,WAAAA,CAAYnV,GACK,SAAXA,IAEFA,EAASqF,OAAOwR,WAAaxR,OAAOyR,YAAc,aAAe,YAGnErqB,KAAKoT,UAAUkW,QAAQ/V,OAASA,EAChCvT,KAAKoI,QAAQmL,OAASA,EAGlBvT,KAAKumB,kBACPvmB,KAAKumB,iBAAiB+D,gBAA2B,aAAX/W,GAGxCrS,QAAQI,IAAI,yBAAyBiS,IACvC,CAMAoV,UAAAA,CAAWnV,GACTxT,KAAKoT,UAAUkW,QAAQ9V,MAAQA,EAC/BxT,KAAKoI,QAAQoL,MAAQA,EAErBtS,QAAQI,IAAI,wBAAwBkS,IACtC,CAMAyV,SAAAA,CAAUC,GAERqB,MAAM,MAAQrB,EAChB,CAOAsB,UAAAA,CAAWtB,EAAS5O,EAAW,KAE7BpZ,QAAQI,IAAI,aAAc4nB,EAC5B,CAQAuB,QAAAA,GACE,MAAO,IAAKzqB,KAAK2B,MACnB,CAMA+oB,UAAAA,CAAWtiB,GACTpI,KAAKoI,QAAU,IAAKpI,KAAKoI,WAAYA,GAGjCA,EAAQmL,QACVvT,KAAK0oB,YAAYtgB,EAAQmL,QAEvBnL,EAAQoL,OACVxT,KAAK2oB,WAAWvgB,EAAQoL,MAE5B,CAKA8C,OAAAA,GAKMtW,KAAKoT,YACPpT,KAAKoT,UAAU+T,UAAY,IAI7BnnB,KAAKwmB,SAAW,CAAA,EAChBxmB,KAAKsmB,YAAc,KACnBtmB,KAAKumB,iBAAmB,KAExBrlB,QAAQI,IAAI,2BACd,mBCnqBK,cAA4BwQ,EAUjCjS,WAAAA,CAAYiX,EAAS,IACnBqI,QACAnf,KAAK2qB,QAAU7T,EAAO6T,SAAW,GACjC3qB,KAAK4qB,aAAe9T,EAAO8T,cAAgB,oBAC3C5qB,KAAK6qB,aAAe/T,EAAO+T,cAAgB,mBAC3C7qB,KAAK8qB,eAAiBhU,EAAOgU,gBAAkB,sBAC/C9qB,KAAK+qB,aAAejU,EAAOiU,cAAgB,kBAC3C/qB,KAAKgrB,QAAUlU,EAAOkU,SAAW,CAAA,CACnC,CASA,UAAMvkB,CAAKsL,EAAMC,EAAUC,EAAW,CAAA,GACpC,MAAMgZ,EAAW,IAAIC,SACrBD,EAASpe,OAAO,aAAckF,GAC9BkZ,EAASpe,OAAO,iBAAkBmF,GAE9BC,GAAYiD,OAAO6K,KAAK9N,GAAUpN,OAAS,GAC7ComB,EAASpe,OAAO,WAAYqT,KAAKC,UAAUlO,IAG7C,IACE,MAAMkZ,QAAiBC,MAAMprB,KAAK2qB,QAAU3qB,KAAK4qB,aAAc,CAC7DS,OAAQ,OACRC,KAAML,EACND,QAAShrB,KAAKgrB,UAGhB,IAAKG,EAASI,GACZ,MAAM,IAAIrZ,MAAM,kBAAkBiZ,EAASK,UAAUL,EAASM,cAGhE,MAAMzW,QAAemW,EAASO,OAG9B,GAAI1W,EAAO2P,cAAcC,SAAS,WAChC,OAAO5S,EAEP,MAAM,IAAIE,MAAM,iBAAiB8C,IAErC,CAAE,MAAOxC,GAEP,MADAtR,QAAQsR,MAAM,cAAeA,GACvBA,CACR,CACF,CAOA,UAAML,CAAKH,GACT,IACE,MAAMuI,EAAMva,KAAK2qB,QAAU3qB,KAAK6qB,aAAe7Y,EACzCmZ,QAAiBC,MAAM7Q,EAAK,CAChCyQ,QAAShrB,KAAKgrB,UAGhB,IAAKG,EAASI,GACZ,MAAM,IAAIrZ,MAAM,gBAAgBiZ,EAASK,UAAUL,EAASM,cAG9D,aAAaN,EAASpZ,MACxB,CAAE,MAAOS,GAEP,MADAtR,QAAQsR,MAAM,cAAeA,GACvBA,CACR,CACF,CAOA,YAAMH,CAAOL,GACX,IACE,MAAMmZ,QAAiBC,MAAMprB,KAAK2qB,QAAU3qB,KAAK8qB,eAAgB,CAC/DO,OAAQ,OACRL,QAAS,CACP,eAAgB,sBACbhrB,KAAKgrB,SAEVM,KAAMpL,KAAKC,UAAU,CAAEnO,eAGzB,IAAKmZ,EAASI,GACZ,MAAM,IAAIrZ,MAAM,kBAAkBiZ,EAASK,UAAUL,EAASM,cAIhE,aADqBN,EAASO,QAChB/G,cAAcC,SAAS,UACvC,CAAE,MAAOpS,GAEP,MADAtR,QAAQsR,MAAM,gBAAiBA,GACzBA,CACR,CACF,CAMA,UAAMF,GACJ,IACE,MAAM6Y,QAAiBC,MAAMprB,KAAK2qB,QAAU3qB,KAAK+qB,aAAc,CAC7DC,QAAShrB,KAAKgrB,UAGhB,IAAKG,EAASI,GACZ,MAAM,IAAIrZ,MAAM,gBAAgBiZ,EAASK,UAAUL,EAASM,cAG9D,MAAMhhB,QAAa0gB,EAASQ,OAC5B,OAAOxW,MAAMC,QAAQ3K,GAAQA,EAAO,EACtC,CAAE,MAAO+H,GAGP,OAFAtR,QAAQsR,MAAM,cAAeA,GAEtB,EACT,CACF,CAUA,sBAAMoZ,CAAiB7Z,EAAMC,EAAUC,EAAW,CAAA,EAAI4Z,EAAa,MACjE,OAAO,IAAIpqB,QAAQ,CAACC,EAAS2b,KAC3B,MAAM4N,EAAW,IAAIC,SACrBD,EAASpe,OAAO,aAAckF,GAC9BkZ,EAASpe,OAAO,iBAAkBmF,GAE9BC,GAAYiD,OAAO6K,KAAK9N,GAAUpN,OAAS,GAC7ComB,EAASpe,OAAO,WAAYqT,KAAKC,UAAUlO,IAG7C,MAAM6Z,EAAM,IAAIC,eAGZF,GACFC,EAAIE,OAAOhhB,iBAAiB,WAAa7I,IACvC,GAAIA,EAAE8pB,iBAAkB,CACtB,MAAMC,EAAW/pB,EAAEgqB,OAAShqB,EAAE6K,MAAS,IACvC6e,EAAWK,EACb,IAKJJ,EAAI9gB,iBAAiB,OAAQ,KAC3B,GAAI8gB,EAAIN,QAAU,KAAOM,EAAIN,OAAS,IAAK,CACzC,MAAMxW,EAAS8W,EAAIM,aACfpX,EAAO2P,cAAcC,SAAS,WAChCljB,EAAQsQ,GAERqL,EAAO,IAAInL,MAAM,iBAAiB8C,KAEtC,MACEqI,EAAO,IAAInL,MAAM,kBAAkB4Z,EAAIN,UAAUM,EAAIL,iBAKzDK,EAAI9gB,iBAAiB,QAAS,KAC5BqS,EAAO,IAAInL,MAAM,kCAInB4Z,EAAI9gB,iBAAiB,QAAS,KAC5BqS,EAAO,IAAInL,MAAM,uBAInB4Z,EAAIxI,KAAK,OAAQtjB,KAAK2qB,QAAU3qB,KAAK4qB,cAGrC1V,OAAO6K,KAAK/f,KAAKgrB,SAAS/O,QAAQhH,IAChC6W,EAAIO,iBAAiBpX,EAAKjV,KAAKgrB,QAAQ/V,MAGzC6W,EAAIQ,KAAKrB,IAEb,uCC/LK,MAQL,aAAOzV,CAAOsB,EAAS,IACrB,MAAM3M,EAAO2M,EAAO3M,MAAQ,OACtB/B,EAAU0O,EAAO1O,SAAW,CAAA,EAGlC,GAAa,SAAT+B,EACF,OAAOnK,KAAKusB,WAAWnkB,GAIzB,OAAQ+B,EAAKwa,eACX,IAAK,UACL,IAAK,YACH,MAAM6H,iBAAEA,GAAqBjX,QAAQ,yBACrC,OAAO,IAAIiX,EACTpkB,EAAQ8a,OACR9a,EAAQ+a,UACR/a,EAAQsO,SAGZ,IAAK,WACH,MAAM+V,gBAAEA,GAAoBlX,QAAQ,wBACpC,OAAO,IAAIkX,EAAgBrkB,EAAQma,UAErC,IAAK,YACH,MAAMmK,iBAAEA,GAAqBnX,QAAQ,yBACrC,OAAO,IAAImX,EAAiBtkB,EAAQ8W,WAEtC,IAAK,SACL,IAAK,MACL,IAAK,SACH,MAAMyN,cAAEA,GAAkBpX,QAAQ,sBAClC,OAAO,IAAIoX,EAAcvkB,GAE3B,QACE,MAAM,IAAI8J,MAAM,yBAAyB/H,KAE/C,CAOA,iBAAOoiB,CAAWnkB,EAAU,IAE1B,GAAsB,oBAAXwQ,QAA0BA,OAAO4J,YAAa,CACvD,MAAMiK,gBAAEA,GAAoBlX,QAAQ,wBACpC,OAAO,IAAIkX,EAAgBrkB,EAAQma,SACrC,CAGA,GAAsB,oBAAX3J,QAA0BA,OAAOwG,UAAW,CACrD,MAAMsN,iBAAEA,GAAqBnX,QAAQ,yBACrC,OAAO,IAAImX,EAAiBtkB,EAAQ8W,UACtC,CAGA,MAAMsN,iBAAEA,GAAqBjX,QAAQ,yBACrC,OAAO,IAAIiX,EACTpkB,EAAQ8a,OACR9a,EAAQ+a,UACR/a,EAAQsO,QAEZ,wDVvEK,MAaH7W,WAAAA,CAAYuI,EAAU,IAClBpI,KAAKoI,QAAU,CACX6B,WAAY7B,EAAQ6B,YAAc,uBAClCV,WAAiC,IAAtBnB,EAAQmB,UACnBc,eAAyC,IAA1BjC,EAAQiC,iBACpBjC,GAIPpI,KAAKsmB,YAAcle,EAAQke,YAE3BtmB,KAAK4sB,aAAe,KACpB5sB,KAAK6sB,QAAU,KACf7sB,KAAK4Q,oBAAsB,KAC3B5Q,KAAK8sB,iBAAmB,KAExB9sB,KAAK+sB,gBAAiB,EACtB/sB,KAAKgtB,0BAA2B,EAG5BhtB,KAAKsmB,aACLtmB,KAAKitB,4BAEb,CAMAA,0BAAAA,GACSjtB,KAAKsmB,cAGVtmB,KAAKsmB,YAAYzK,GAAG,kBAAmB,KACnC7b,KAAKc,UAITd,KAAKsmB,YAAYzK,GAAG,iBAAkB,KAClC7b,KAAKktB,aAITltB,KAAKsmB,YAAYzK,GAAG,iBAAmBpR,IAC/BA,EAAKsS,SAAW/c,KAAK4Q,qBACrB5Q,KAAKmtB,UAAU1iB,EAAKsS,WAGhC,CAKA,gBAAMrE,GACF,MAAMoP,WAAEA,EAAUC,cAAEA,EAAaC,kBAAEA,EAAiBC,eAAEA,GAAmBjoB,KAAKoI,QAG9E,IAAIrI,EAAeC,KAAKoI,QAAQrI,cAC3BA,GAAgBC,KAAKsmB,aAAuD,mBAAjCtmB,KAAKsmB,YAAY/K,cAC7Dxb,EAAeC,KAAKsmB,YAAY/K,eAIhCuM,GAAc/nB,IACdC,KAAK4sB,aAAe,IAAIhtB,EAAakoB,EAAY/nB,IAIjDgoB,GAAiBhoB,IACjBC,KAAK6sB,QAAU,IAAIlpB,EAAQokB,EAAehoB,IAI1CioB,IACAhoB,KAAK4Q,oBAAsB,IAAIzI,EAAoB6f,EAAmB,CAClE/d,WAAYjK,KAAKoI,QAAQ6B,WACzBV,UAAWvJ,KAAKoI,QAAQmB,UACxBc,cAAerK,KAAKoI,QAAQiC,iBAKhC4d,GAAkBjoB,KAAK4Q,sBACvB5Q,KAAK8sB,iBAAmB,IAAInc,EAAiBsX,EAAgBjoB,KAAK4Q,qBAE1E,CAQAwc,SAAAA,CAAUrsB,EAAQC,EAAcC,GACxBjB,KAAK4sB,cACL5sB,KAAK4sB,aAAa9rB,MAAMC,EAAQC,EAAcC,GAE9CjB,KAAK6sB,SACL7sB,KAAK6sB,QAAQ/rB,OAErB,CAKAA,KAAAA,GACI,IAAKd,KAAKsmB,YAEN,YADAplB,QAAQC,KAAK,4DAKjB,MAAMJ,EAASf,KAAKsmB,YAAY7K,iBAC1Bza,EAAehB,KAAKsmB,YAAYtlB,aAChCC,EAAcjB,KAAKsmB,YAAYrlB,YAEjCF,GAAUC,GACVhB,KAAKotB,UAAUrsB,EAAQC,EAAcC,EAE7C,CAKAisB,QAAAA,GACQltB,KAAK4sB,cACL5sB,KAAK4sB,aAAarqB,OAElBvC,KAAK6sB,SACL7sB,KAAK6sB,QAAQtqB,MAErB,CAMA4qB,SAAAA,CAAUpQ,GACF/c,KAAK4Q,sBACL5Q,KAAK4Q,oBAAoB/D,OAAOkQ,GAG5B/c,KAAK8sB,mBAEA9sB,KAAKgtB,2BACNhtB,KAAKgtB,0BAA2B,EAChCrqB,sBAAsB,KACd3C,KAAK8sB,kBACL9sB,KAAK8sB,iBAAiBxqB,OAE1BtC,KAAKgtB,0BAA2B,MAKpD,CAKApgB,KAAAA,GACQ5M,KAAK4Q,qBACL5Q,KAAK4Q,oBAAoBhE,QAEzB5M,KAAK8sB,kBACL9sB,KAAK8sB,iBAAiBhnB,OAE9B,CAKAA,KAAAA,GACQ9F,KAAK4sB,cACL5sB,KAAK4sB,aAAa3sB,cAAcwC,UAAU,EAAG,EAAGzC,KAAK4sB,aAAarsB,MAAOP,KAAK4sB,aAAapsB,QAE3FR,KAAK6sB,SACL7sB,KAAK6sB,QAAQ/mB,QAEb9F,KAAK4Q,qBACL5Q,KAAK4Q,oBAAoB9K,QAEzB9F,KAAK8sB,kBACL9sB,KAAK8sB,iBAAiBhnB,OAE9B,CAMAwkB,eAAAA,CAAgB5nB,GACZ1C,KAAK+sB,eAAiBrqB,EAGlB1C,KAAK4Q,qBAAuB5Q,KAAK4Q,oBAAoBpH,SACrDxJ,KAAK4Q,oBAAoBpH,QAAQU,YAAY,CACzCC,KAAM,kBACNC,aAAc1H,GAG1B,CAKAmD,MAAAA,GACQ7F,KAAK4sB,eACL5sB,KAAK4sB,aAAarsB,MAAQP,KAAK4sB,aAAa9sB,OAAOS,MACnDP,KAAK4sB,aAAapsB,OAASR,KAAK4sB,aAAa9sB,OAAOU,QAEpDR,KAAK6sB,SACL7sB,KAAK6sB,QAAQhnB,SAEb7F,KAAK4Q,sBACL5Q,KAAK4Q,oBAAoBrQ,MAAQP,KAAK4Q,oBAAoB9Q,OAAOS,MACjEP,KAAK4Q,oBAAoBpQ,OAASR,KAAK4Q,oBAAoB9Q,OAAOU,OAC9DR,KAAK4Q,oBAAoBpH,SACzBxJ,KAAK4Q,oBAAoBpH,QAAQU,YAAY,CACzCC,KAAM,SACN5J,MAAOP,KAAK4Q,oBAAoBrQ,MAChCC,OAAQR,KAAK4Q,oBAAoBpQ,SAGzCR,KAAK4Q,oBAAoBtO,QAEzBtC,KAAK8sB,mBACL9sB,KAAK8sB,iBAAiBvsB,MAAQP,KAAK8sB,iBAAiBhtB,OAAOS,MAC3DP,KAAK8sB,iBAAiBtsB,OAASR,KAAK8sB,iBAAiBhtB,OAAOU,OAC5DR,KAAK8sB,iBAAiBxqB,OAE9B,CAKAgU,OAAAA,GACItW,KAAKktB,WAEDltB,KAAK4Q,qBAAuB5Q,KAAK4Q,oBAAoBpH,SACrDxJ,KAAK4Q,oBAAoBpH,QAAQ6jB,YAGrCrtB,KAAK4sB,aAAe,KACpB5sB,KAAK6sB,QAAU,KACf7sB,KAAK4Q,oBAAsB,KAC3B5Q,KAAK8sB,iBAAmB,IAC5B"}