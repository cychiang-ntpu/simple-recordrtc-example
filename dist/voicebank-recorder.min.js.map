{"version":3,"file":"voicebank-recorder.min.js","sources":["../src/core/DeviceManager.js","../src/core/WaveformRenderer.js","../src/storage/StorageAdapter.js","../src/index.js","../src/core/AudioEngine.js","../src/storage/CapacitorAdapter.js","../src/storage/ElectronAdapter.js","../src/storage/IndexedDBAdapter.js","../src/utils/PlatformDetector.js","../src/ui/RecorderUI.js","../src/storage/ServerAdapter.js","../src/storage/index.js"],"sourcesContent":["/**\n * DeviceManager.js\n * éŸ³è¨Šè£ç½®ç®¡ç†æ¨¡çµ„ - è™•ç†éº¥å…‹é¢¨å’Œè¼¸å‡ºè£ç½®çš„åˆ—èˆ‰ã€é¸æ“‡ã€è¨˜æ†¶\n * \n * @module DeviceManager\n * @description æä¾›å®Œæ•´çš„éŸ³è¨Šè£ç½®ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…å«ï¼š\n * - è£ç½®åˆ—èˆ‰ (enumerateDevices)\n * - è£ç½®é¸æ“‡èˆ‡è¨˜æ†¶ (localStorage)\n * - è£ç½®è®Šæ›´åµæ¸¬ (devicechange event)\n * - è·¨å¹³å°ç›¸å®¹æ€§è™•ç†\n */\n\n/**\n * DeviceManager - éŸ³è¨Šè£ç½®ç®¡ç†å™¨\n * çµ±ä¸€ç®¡ç†éº¥å…‹é¢¨å’Œè¼¸å‡ºè£ç½®çš„åˆ—èˆ‰ã€é¸æ“‡èˆ‡æŒä¹…åŒ–\n */\nexport class DeviceManager {\n    /**\n     * @param {Object} options - é…ç½®é¸é …\n     * @param {string} [options.micStorageKey='preferredMicDeviceId'] - éº¥å…‹é¢¨åå¥½è¨­å®šçš„ localStorage key\n     * @param {string} [options.outputStorageKey='preferredOutputDeviceId'] - è¼¸å‡ºè£ç½®åå¥½è¨­å®šçš„ localStorage key\n     * @param {boolean} [options.autoLoadPreferences=true] - æ˜¯å¦è‡ªå‹•è¼‰å…¥ä¸Šæ¬¡çš„åå¥½è¨­å®š\n     * @param {boolean} [options.autoRequestPermission=true] - åˆ—èˆ‰å‰æ˜¯å¦è‡ªå‹•è«‹æ±‚éº¥å…‹é¢¨æ¬Šé™\n     */\n    constructor(options = {}) {\n        this.options = {\n            micStorageKey: 'preferredMicDeviceId',\n            outputStorageKey: 'preferredOutputDeviceId',\n            autoLoadPreferences: true,\n            autoRequestPermission: true,\n            ...options\n        };\n        \n        // è£ç½®æ¸…å–®\n        this.microphoneDevices = [];\n        this.outputDevices = [];\n        \n        // ç•¶å‰é¸æ“‡çš„è£ç½® ID\n        this.selectedMicDeviceId = '';\n        this.selectedOutputDeviceId = 'default';\n        \n        // äº‹ä»¶ç›£è½å™¨\n        this._eventListeners = {\n            'devicechange': [],\n            'micchange': [],\n            'outputchange': []\n        };\n        \n        // è£ç½®è®Šæ›´ç›£è½å™¨\n        this._deviceChangeListener = null;\n        \n        // è‡ªå‹•è¼‰å…¥åå¥½è¨­å®š\n        if (this.options.autoLoadPreferences) {\n            this.loadPreferences();\n        }\n    }\n    \n    /**\n     * å¾ localStorage è¼‰å…¥ä¸Šæ¬¡çš„è£ç½®åå¥½è¨­å®š\n     */\n    loadPreferences() {\n        console.log('[DeviceManager] loadPreferences è¢«å‘¼å«');\n        \n        try {\n            const savedMicId = localStorage.getItem(this.options.micStorageKey);\n            const savedOutputId = localStorage.getItem(this.options.outputStorageKey);\n            \n            console.log(`[DeviceManager] localStorage ä¸­çš„å€¼:`);\n            console.log(`  - ${this.options.micStorageKey}: \"${savedMicId}\"`);\n            console.log(`  - ${this.options.outputStorageKey}: \"${savedOutputId}\"`);\n            \n            if (savedMicId) {\n                this.selectedMicDeviceId = savedMicId;\n                console.log(`[DeviceManager] å·²è¼‰å…¥éº¥å…‹é¢¨åå¥½: ${savedMicId}`);\n            } else {\n                console.log(`[DeviceManager] æ²’æœ‰å„²å­˜çš„éº¥å…‹é¢¨åå¥½`);\n            }\n            \n            if (savedOutputId) {\n                this.selectedOutputDeviceId = savedOutputId;\n                console.log(`[DeviceManager] å·²è¼‰å…¥è¼¸å‡ºè£ç½®åå¥½: ${savedOutputId}`);\n            } else {\n                console.log(`[DeviceManager] æ²’æœ‰å„²å­˜çš„è¼¸å‡ºè£ç½®åå¥½ï¼Œä½¿ç”¨ default`);\n            }\n        } catch (error) {\n            console.warn('[DeviceManager] Failed to load device preferences:', error);\n        }\n    }\n    \n    /**\n     * å„²å­˜è£ç½®åå¥½è¨­å®šåˆ° localStorage\n     * @param {string} type - 'microphone' æˆ– 'output'\n     * @param {string} deviceId - è£ç½® ID\n     */\n    savePreference(type, deviceId) {\n        try {\n            if (type === 'microphone') {\n                localStorage.setItem(this.options.micStorageKey, deviceId);\n                this.selectedMicDeviceId = deviceId;\n            } else if (type === 'output') {\n                localStorage.setItem(this.options.outputStorageKey, deviceId);\n                this.selectedOutputDeviceId = deviceId;\n            }\n        } catch (error) {\n            console.warn('Failed to save device preference:', error);\n        }\n    }\n    \n    /**\n     * æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´è£ç½®åˆ—èˆ‰\n     * @returns {boolean}\n     */\n    isSupported() {\n        return !!(navigator.mediaDevices && navigator.mediaDevices.enumerateDevices);\n    }\n    \n    /**\n     * è«‹æ±‚éº¥å…‹é¢¨æ¬Šé™ï¼ˆå¿…è¦æ™‚ï¼‰\n     * @returns {Promise<void>}\n     */\n    async requestMicrophonePermission() {\n        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n            throw new Error('getUserMedia is not supported in this browser');\n        }\n        \n        try {\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n            // ç«‹å³åœæ­¢æ‰€æœ‰ trackï¼Œåªæ˜¯ç‚ºäº†ç²å–æ¬Šé™\n            stream.getTracks().forEach(track => track.stop());\n        } catch (error) {\n            throw new Error(`Failed to request microphone permission: ${error.message}`);\n        }\n    }\n    \n    /**\n     * åˆ—èˆ‰æ‰€æœ‰éº¥å…‹é¢¨è£ç½®\n     * @param {boolean} [requestPermission=true] - æ˜¯å¦å…ˆè«‹æ±‚æ¬Šé™\n     * @returns {Promise<Array>} éº¥å…‹é¢¨è£ç½®æ¸…å–®\n     */\n    async enumerateMicrophones(requestPermission = this.options.autoRequestPermission) {\n        if (!this.isSupported()) {\n            throw new Error('Device enumeration is not supported in this browser');\n        }\n        \n        try {\n            // å¦‚æœéœ€è¦ï¼Œå…ˆè«‹æ±‚æ¬Šé™\n            if (requestPermission) {\n                try {\n                    await this.requestMicrophonePermission();\n                } catch (error) {\n                    // å¿½ç•¥æ¬Šé™éŒ¯èª¤ï¼Œç¹¼çºŒå˜—è©¦åˆ—èˆ‰ï¼ˆå¯èƒ½å·²ç¶“æœ‰æ¬Šé™ï¼‰\n                    console.warn('Permission request failed, continuing anyway:', error);\n                }\n            }\n            \n            // åˆ—èˆ‰æ‰€æœ‰è£ç½®\n            const devices = await navigator.mediaDevices.enumerateDevices();\n            this.microphoneDevices = devices.filter(device => device.kind === 'audioinput');\n            \n            return this.microphoneDevices;\n        } catch (error) {\n            throw new Error(`Failed to enumerate microphones: ${error.message}`);\n        }\n    }\n    \n    /**\n     * åˆ—èˆ‰æ‰€æœ‰è¼¸å‡ºè£ç½®\n     * @returns {Promise<Array>} è¼¸å‡ºè£ç½®æ¸…å–®\n     */\n    async enumerateOutputDevices() {\n        if (!this.isSupported()) {\n            throw new Error('Device enumeration is not supported in this browser');\n        }\n        \n        try {\n            const devices = await navigator.mediaDevices.enumerateDevices();\n            this.outputDevices = devices.filter(device => device.kind === 'audiooutput');\n            \n            return this.outputDevices;\n        } catch (error) {\n            throw new Error(`Failed to enumerate output devices: ${error.message}`);\n        }\n    }\n    \n    /**\n     * åˆ—èˆ‰æ‰€æœ‰è£ç½®ï¼ˆéº¥å…‹é¢¨ + è¼¸å‡ºï¼‰\n     * @param {boolean} [requestPermission=true] - æ˜¯å¦å…ˆè«‹æ±‚éº¥å…‹é¢¨æ¬Šé™\n     * @returns {Promise<Object>} { microphones, outputs }\n     */\n    async enumerateAllDevices(requestPermission = this.options.autoRequestPermission) {\n        const [microphones, outputs] = await Promise.all([\n            this.enumerateMicrophones(requestPermission),\n            this.enumerateOutputDevices()\n        ]);\n        \n        return { microphones, outputs };\n    }\n    \n    /**\n     * é¸æ“‡éº¥å…‹é¢¨è£ç½®\n     * @param {string} deviceId - è£ç½® ID\n     * @param {boolean} [save=true] - æ˜¯å¦å„²å­˜åå¥½è¨­å®š\n     */\n    selectMicrophone(deviceId, save = true) {\n        console.log(`[DeviceManager] selectMicrophone è¢«å‘¼å«:`, { deviceId, save });\n        console.log(`[DeviceManager] è®Šæ›´å‰: selectedMicDeviceId = \"${this.selectedMicDeviceId}\"`);\n        \n        this.selectedMicDeviceId = deviceId;\n        \n        console.log(`[DeviceManager] è®Šæ›´å¾Œ: selectedMicDeviceId = \"${this.selectedMicDeviceId}\"`);\n        \n        if (save) {\n            this.savePreference('microphone', deviceId);\n            console.log(`[DeviceManager] å·²å„²å­˜è‡³ localStorage (${this.options.micStorageKey})`);\n        }\n        \n        // è§¸ç™¼ micchange äº‹ä»¶\n        this._emit('micchange', { deviceId });\n    }\n    \n    /**\n     * é¸æ“‡è¼¸å‡ºè£ç½®\n     * @param {string} deviceId - è£ç½® ID\n     * @param {boolean} [save=true] - æ˜¯å¦å„²å­˜åå¥½è¨­å®š\n     */\n    selectOutputDevice(deviceId, save = true) {\n        this.selectedOutputDeviceId = deviceId;\n        \n        if (save) {\n            this.savePreference('output', deviceId);\n        }\n        \n        // è§¸ç™¼ outputchange äº‹ä»¶\n        this._emit('outputchange', { deviceId });\n    }\n    \n    /**\n     * å–å¾—ç•¶å‰é¸æ“‡çš„éº¥å…‹é¢¨è£ç½® ID\n     * @returns {string}\n     */\n    getSelectedMicrophoneId() {\n        return this.selectedMicDeviceId;\n    }\n    \n    /**\n     * å–å¾—ç•¶å‰é¸æ“‡çš„è¼¸å‡ºè£ç½® ID\n     * @returns {string}\n     */\n    getSelectedOutputDeviceId() {\n        return this.selectedOutputDeviceId;\n    }\n    \n    /**\n     * å–å¾—ç•¶å‰é¸æ“‡çš„éº¥å…‹é¢¨è£ç½®è³‡è¨Š\n     * @returns {MediaDeviceInfo|null}\n     */\n    getSelectedMicrophone() {\n        return this.microphoneDevices.find(device => device.deviceId === this.selectedMicDeviceId) || null;\n    }\n    \n    /**\n     * å–å¾—ç•¶å‰é¸æ“‡çš„è¼¸å‡ºè£ç½®è³‡è¨Š\n     * @returns {MediaDeviceInfo|null}\n     */\n    getSelectedOutputDevice() {\n        return this.outputDevices.find(device => device.deviceId === this.selectedOutputDeviceId) || null;\n    }\n    \n    /**\n     * å»ºç«‹é©ç”¨æ–¼ getUserMedia çš„ç´„æŸæ¢ä»¶\n     * @param {Object} [additionalConstraints={}] - é¡å¤–çš„éŸ³è¨Šç´„æŸ\n     * @returns {Object} MediaStreamConstraints\n     */\n    getMicrophoneConstraints(additionalConstraints = {}) {\n        console.log(`[DeviceManager] getMicrophoneConstraints è¢«å‘¼å«`);\n        console.log(`[DeviceManager] ç•¶å‰ selectedMicDeviceId = \"${this.selectedMicDeviceId}\"`);\n        \n        const constraints = {\n            audio: {\n                ...additionalConstraints\n            },\n            video: false\n        };\n        \n        // å¦‚æœæœ‰é¸æ“‡ç‰¹å®šè£ç½®ï¼ŒåŠ å…¥ deviceId ç´„æŸ\n        if (this.selectedMicDeviceId) {\n            constraints.audio.deviceId = { exact: this.selectedMicDeviceId };\n            console.log(`[DeviceManager] å·²åŠ å…¥ deviceId ç´„æŸ: ${this.selectedMicDeviceId}`);\n        } else {\n            console.log(`[DeviceManager] æ²’æœ‰é¸æ“‡ç‰¹å®šè£ç½®ï¼Œä½¿ç”¨ç³»çµ±é è¨­`);\n        }\n        \n        return constraints;\n    }\n    \n    /**\n     * ç‚º Audio å…ƒç´ è¨­å®šè¼¸å‡ºè£ç½®\n     * @param {HTMLAudioElement} audioElement - Audio å…ƒç´ \n     * @param {string} [deviceId] - è£ç½® IDï¼ˆä¸æä¾›å‰‡ä½¿ç”¨ç•¶å‰é¸æ“‡çš„è£ç½®ï¼‰\n     * @returns {Promise<void>}\n     */\n    async setAudioOutputDevice(audioElement, deviceId) {\n        const targetDeviceId = deviceId || this.selectedOutputDeviceId;\n        \n        // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´ setSinkId\n        if (typeof audioElement.setSinkId !== 'function') {\n            console.warn('setSinkId is not supported in this browser');\n            return;\n        }\n        \n        try {\n            await audioElement.setSinkId(targetDeviceId);\n        } catch (error) {\n            throw new Error(`Failed to set audio output device: ${error.message}`);\n        }\n    }\n    \n    /**\n     * æª¢æŸ¥æŒ‡å®šè£ç½®æ˜¯å¦ä»ç„¶å­˜åœ¨\n     * @param {string} deviceId - è£ç½® ID\n     * @param {string} type - 'microphone' æˆ– 'output'\n     * @returns {boolean}\n     */\n    isDeviceAvailable(deviceId, type) {\n        const devices = type === 'microphone' ? this.microphoneDevices : this.outputDevices;\n        return devices.some(device => device.deviceId === deviceId);\n    }\n    \n    /**\n     * å•Ÿå‹•è£ç½®è®Šæ›´ç›£è½\n     * ç•¶è£ç½®æ’æ‹”æ™‚è‡ªå‹•é‡æ–°åˆ—èˆ‰\n     */\n    startDeviceChangeMonitoring() {\n        if (!navigator.mediaDevices || this._deviceChangeListener) {\n            return; // ä¸æ”¯æ´æˆ–å·²ç¶“åœ¨ç›£è½\n        }\n        \n        this._deviceChangeListener = async () => {\n            try {\n                // é‡æ–°åˆ—èˆ‰è£ç½®\n                await this.enumerateAllDevices(false); // ä¸éœ€è¦é‡æ–°è«‹æ±‚æ¬Šé™\n                \n                // è§¸ç™¼ devicechange äº‹ä»¶\n                this._emit('devicechange', {\n                    microphones: this.microphoneDevices,\n                    outputs: this.outputDevices\n                });\n            } catch (error) {\n                console.error('Device change enumeration failed:', error);\n            }\n        };\n        \n        navigator.mediaDevices.addEventListener('devicechange', this._deviceChangeListener);\n    }\n    \n    /**\n     * åœæ­¢è£ç½®è®Šæ›´ç›£è½\n     */\n    stopDeviceChangeMonitoring() {\n        if (this._deviceChangeListener && navigator.mediaDevices) {\n            navigator.mediaDevices.removeEventListener('devicechange', this._deviceChangeListener);\n            this._deviceChangeListener = null;\n        }\n    }\n    \n    /**\n     * è¨»å†Šäº‹ä»¶ç›£è½å™¨\n     * @param {string} event - äº‹ä»¶åç¨± ('devicechange', 'micchange', 'outputchange')\n     * @param {function} callback - å›èª¿å‡½æ•¸\n     */\n    on(event, callback) {\n        if (!this._eventListeners[event]) {\n            console.warn(`Unknown event: ${event}`);\n            return;\n        }\n        \n        this._eventListeners[event].push(callback);\n    }\n    \n    /**\n     * ç§»é™¤äº‹ä»¶ç›£è½å™¨\n     * @param {string} event - äº‹ä»¶åç¨±\n     * @param {function} callback - å›èª¿å‡½æ•¸\n     */\n    off(event, callback) {\n        if (!this._eventListeners[event]) {\n            return;\n        }\n        \n        const index = this._eventListeners[event].indexOf(callback);\n        if (index > -1) {\n            this._eventListeners[event].splice(index, 1);\n        }\n    }\n    \n    /**\n     * è§¸ç™¼äº‹ä»¶\n     * @private\n     */\n    _emit(event, data) {\n        if (!this._eventListeners[event]) {\n            return;\n        }\n        \n        this._eventListeners[event].forEach(callback => {\n            try {\n                callback(data);\n            } catch (error) {\n                console.error(`Error in ${event} event handler:`, error);\n            }\n        });\n    }\n    \n    /**\n     * éŠ·æ¯€ DeviceManagerï¼Œæ¸…ç†è³‡æº\n     */\n    destroy() {\n        this.stopDeviceChangeMonitoring();\n        this._eventListeners = {\n            'devicechange': [],\n            'micchange': [],\n            'outputchange': []\n        };\n        this.microphoneDevices = [];\n        this.outputDevices = [];\n    }\n}\n\nexport default DeviceManager;\n","/**\n * WaveformRenderer.js\n * æ³¢å½¢æ¸²æŸ“æ¨¡çµ„ - æ•´åˆå³æ™‚æ³¢å½¢ã€ç´¯ç©æ³¢å½¢ã€æ¦‚è¦½æ³¢å½¢å’Œ VU Meter\n * \n * @module WaveformRenderer\n * @description æä¾›å®Œæ•´çš„æ³¢å½¢å¯è¦–åŒ–åŠŸèƒ½ï¼ŒåŒ…å«ï¼š\n * - LiveWaveform: å³æ™‚æ³¢å½¢é¡¯ç¤ºï¼ˆå¾ AnalyserNodeï¼‰\n * - VUMeter: éŸ³é‡è¡¨é¡¯ç¤ºï¼ˆRMS/Peak dBFSï¼‰\n * - AccumulatedWaveform: ç´¯ç©æ³¢å½¢ï¼ˆä½¿ç”¨ Worker åŠ é€Ÿï¼‰\n * - OverviewWaveform: å…¨å±€æ¦‚è¦½æ³¢å½¢\n */\n\n/**\n * WaveformRenderer - æ³¢å½¢æ¸²æŸ“ç®¡ç†å™¨\n * çµ±ä¸€ç®¡ç†æ‰€æœ‰æ³¢å½¢çµ„ä»¶çš„åˆå§‹åŒ–ã€æ›´æ–°å’ŒéŠ·æ¯€\n */\nexport class WaveformRenderer {\n    /**\n     * @param {Object} options - é…ç½®é¸é …\n     * @param {HTMLCanvasElement} options.liveCanvas - å³æ™‚æ³¢å½¢ Canvas\n     * @param {HTMLCanvasElement} options.vuMeterCanvas - VU Meter Canvas\n     * @param {HTMLCanvasElement} options.accumulatedCanvas - ç´¯ç©æ³¢å½¢ Canvas\n     * @param {HTMLCanvasElement} options.overviewCanvas - æ¦‚è¦½æ³¢å½¢ Canvas\n     * @param {AnalyserNode} options.analyserNode - Web Audio AnalyserNode\n     * @param {Object} options.audioEngine - AudioEngine å¯¦ä¾‹ï¼ˆå¯é¸ï¼Œæœƒè‡ªå‹•ç²å– analyserNodeï¼‰\n     * @param {string} [options.workerPath] - Worker è…³æœ¬è·¯å¾‘\n     * @param {boolean} [options.useWorker=true] - æ˜¯å¦ä½¿ç”¨ Worker\n     * @param {boolean} [options.showClipMarks=true] - æ˜¯å¦é¡¯ç¤ºå‰Šæ³¢æ¨™è¨˜\n     */\n    constructor(options = {}) {\n        this.options = {\n            workerPath: options.workerPath || 'workers/wf-worker.js',\n            useWorker: options.useWorker !== false,\n            showClipMarks: options.showClipMarks !== false,\n            ...options\n        };\n        \n        // æ”¯æ´å¾ audioEngine ç²å– analyserNode\n        this.audioEngine = options.audioEngine;\n        \n        this.liveWaveform = null;\n        this.vuMeter = null;\n        this.accumulatedWaveform = null;\n        this.overviewWaveform = null;\n        \n        this.isVerticalMode = false;\n        this._overviewUpdateScheduled = false;\n        \n        // å¦‚æœæä¾›äº† audioEngineï¼Œç›£è½éŒ„éŸ³äº‹ä»¶\n        if (this.audioEngine) {\n            this._setupAudioEngineListeners();\n        }\n    }\n    \n    /**\n     * è¨­ç½® AudioEngine äº‹ä»¶ç›£è½\n     * @private\n     */\n    _setupAudioEngineListeners() {\n        if (!this.audioEngine) return;\n        \n        // éŒ„éŸ³é–‹å§‹æ™‚è‡ªå‹•å•Ÿå‹•æ³¢å½¢\n        this.audioEngine.on('recording-start', () => {\n            this.start();\n        });\n        \n        // éŒ„éŸ³åœæ­¢æ™‚åœæ­¢æ³¢å½¢\n        this.audioEngine.on('recording-stop', () => {\n            this.stopLive();\n        });\n        \n        // PCM æ•¸æ“šåˆ°é”æ™‚æ›´æ–°ç´¯ç©æ³¢å½¢\n        this.audioEngine.on('data-available', (data) => {\n            if (data.pcmData && this.accumulatedWaveform) {\n                this.appendPCM(data.pcmData);\n            }\n        });\n    }\n    \n    /**\n     * åˆå§‹åŒ–æ‰€æœ‰æ³¢å½¢çµ„ä»¶\n     */\n    async initialize() {\n        const { liveCanvas, vuMeterCanvas, accumulatedCanvas, overviewCanvas } = this.options;\n        \n        // å¾ audioEngine æˆ– options ç²å– analyserNode\n        let analyserNode = this.options.analyserNode;\n        if (!analyserNode && this.audioEngine && typeof this.audioEngine.getAnalyser === 'function') {\n            analyserNode = this.audioEngine.getAnalyser();\n        }\n        \n        // åˆå§‹åŒ–å³æ™‚æ³¢å½¢\n        if (liveCanvas && analyserNode) {\n            this.liveWaveform = new LiveWaveform(liveCanvas, analyserNode);\n        }\n        \n        // åˆå§‹åŒ– VU Meter\n        if (vuMeterCanvas && analyserNode) {\n            this.vuMeter = new VUMeter(vuMeterCanvas, analyserNode);\n        }\n        \n        // åˆå§‹åŒ–ç´¯ç©æ³¢å½¢\n        if (accumulatedCanvas) {\n            this.accumulatedWaveform = new AccumulatedWaveform(accumulatedCanvas, {\n                workerPath: this.options.workerPath,\n                useWorker: this.options.useWorker,\n                showClipMarks: this.options.showClipMarks\n            });\n        }\n        \n        // åˆå§‹åŒ–æ¦‚è¦½æ³¢å½¢\n        if (overviewCanvas && this.accumulatedWaveform) {\n            this.overviewWaveform = new OverviewWaveform(overviewCanvas, this.accumulatedWaveform);\n        }\n    }\n    \n    /**\n     * é–‹å§‹å³æ™‚æ³¢å½¢é¡¯ç¤º\n     * @param {MediaStream} stream - éº¥å…‹é¢¨åª’é«”æµ\n     * @param {AudioContext} audioContext - Web Audio Context\n     * @param {GainNode} [preGainNode] - å‰ç´šå¢ç›Šç¯€é»ï¼ˆå¯é¸ï¼‰\n     */\n    startLive(stream, audioContext, preGainNode) {\n        if (this.liveWaveform) {\n            this.liveWaveform.start(stream, audioContext, preGainNode);\n        }\n        if (this.vuMeter) {\n            this.vuMeter.start();\n        }\n    }\n    \n    /**\n     * é–‹å§‹æ³¢å½¢é¡¯ç¤ºï¼ˆç°¡åŒ–ç‰ˆï¼Œå¾ audioEngine è‡ªå‹•ç²å–è³‡è¨Šï¼‰\n     */\n    start() {\n        if (!this.audioEngine) {\n            console.warn('No audioEngine provided, cannot start waveform rendering');\n            return;\n        }\n        \n        // ç²å–å¿…è¦è³‡è¨Š\n        const stream = this.audioEngine.microphoneStream;\n        const audioContext = this.audioEngine.audioContext;\n        const preGainNode = this.audioEngine.preGainNode;\n        \n        if (stream && audioContext) {\n            this.startLive(stream, audioContext, preGainNode);\n        }\n    }\n    \n    /**\n     * åœæ­¢å³æ™‚æ³¢å½¢é¡¯ç¤º\n     */\n    stopLive() {\n        if (this.liveWaveform) {\n            this.liveWaveform.stop();\n        }\n        if (this.vuMeter) {\n            this.vuMeter.stop();\n        }\n    }\n    \n    /**\n     * é™„åŠ  PCM æ•¸æ“šåˆ°ç´¯ç©æ³¢å½¢\n     * @param {Float32Array} pcmData - PCM éŸ³è¨Šæ•¸æ“š\n     */\n    appendPCM(pcmData) {\n        if (this.accumulatedWaveform) {\n            this.accumulatedWaveform.append(pcmData);\n            \n            // åŒæ™‚æ›´æ–° OverviewWaveform\n            if (this.overviewWaveform) {\n                // ä½¿ç”¨ requestAnimationFrame é¿å…éåº¦ç¹ªè£½\n                if (!this._overviewUpdateScheduled) {\n                    this._overviewUpdateScheduled = true;\n                    requestAnimationFrame(() => {\n                        if (this.overviewWaveform) {\n                            this.overviewWaveform.draw();\n                        }\n                        this._overviewUpdateScheduled = false;\n                    });\n                }\n            }\n        }\n    }\n    \n    /**\n     * é‡ç½®æ‰€æœ‰æ³¢å½¢\n     */\n    reset() {\n        if (this.accumulatedWaveform) {\n            this.accumulatedWaveform.reset();\n        }\n        if (this.overviewWaveform) {\n            this.overviewWaveform.clear();\n        }\n    }\n    \n    /**\n     * æ¸…é™¤æ‰€æœ‰æ³¢å½¢\n     */\n    clear() {\n        if (this.liveWaveform) {\n            this.liveWaveform.canvasContext.clearRect(0, 0, this.liveWaveform.width, this.liveWaveform.height);\n        }\n        if (this.vuMeter) {\n            this.vuMeter.clear();\n        }\n        if (this.accumulatedWaveform) {\n            this.accumulatedWaveform.clear();\n        }\n        if (this.overviewWaveform) {\n            this.overviewWaveform.clear();\n        }\n    }\n    \n    /**\n     * è¨­å®šå‚ç›´/æ°´å¹³æ¨¡å¼\n     * @param {boolean} isVertical - æ˜¯å¦ç‚ºå‚ç›´æ¨¡å¼\n     */\n    setVerticalMode(isVertical) {\n        this.isVerticalMode = isVertical;\n        \n        // é€šçŸ¥ Worker æ¨¡å¼è®Šæ›´\n        if (this.accumulatedWaveform && this.accumulatedWaveform._worker) {\n            this.accumulatedWaveform._worker.postMessage({\n                type: 'setVerticalMode',\n                verticalMode: isVertical\n            });\n        }\n    }\n    \n    /**\n     * èª¿æ•´ Canvas å°ºå¯¸\n     */\n    resize() {\n        if (this.liveWaveform) {\n            this.liveWaveform.width = this.liveWaveform.canvas.width;\n            this.liveWaveform.height = this.liveWaveform.canvas.height;\n        }\n        if (this.vuMeter) {\n            this.vuMeter.resize();\n        }\n        if (this.accumulatedWaveform) {\n            this.accumulatedWaveform.width = this.accumulatedWaveform.canvas.width;\n            this.accumulatedWaveform.height = this.accumulatedWaveform.canvas.height;\n            if (this.accumulatedWaveform._worker) {\n                this.accumulatedWaveform._worker.postMessage({\n                    type: 'resize',\n                    width: this.accumulatedWaveform.width,\n                    height: this.accumulatedWaveform.height\n                });\n            }\n            this.accumulatedWaveform.draw();\n        }\n        if (this.overviewWaveform) {\n            this.overviewWaveform.width = this.overviewWaveform.canvas.width;\n            this.overviewWaveform.height = this.overviewWaveform.canvas.height;\n            this.overviewWaveform.draw();\n        }\n    }\n    \n    /**\n     * éŠ·æ¯€æ‰€æœ‰çµ„ä»¶ï¼Œé‡‹æ”¾è³‡æº\n     */\n    destroy() {\n        this.stopLive();\n        \n        if (this.accumulatedWaveform && this.accumulatedWaveform._worker) {\n            this.accumulatedWaveform._worker.terminate();\n        }\n        \n        this.liveWaveform = null;\n        this.vuMeter = null;\n        this.accumulatedWaveform = null;\n        this.overviewWaveform = null;\n    }\n}\n\n/* ================================================================\n * LiveWaveform é¡ - å³æ™‚æ³¢å½¢é¡¯ç¤º\n * å¾ AnalyserNode å–å¾—æ™‚åŸŸæ•¸æ“šä¸¦å³æ™‚ç¹ªè£½æ³¢å½¢\n * æ”¯æ´æ°´å¹³å’Œå‚ç›´æ¨¡å¼\n * ================================================================ */\nexport class LiveWaveform {\n    constructor(canvas, analyserNode) {\n        this.canvas = canvas;\n        this.canvasContext = canvas.getContext('2d');\n        this.analyser = analyserNode;\n        this.mediaStreamSource = null;\n        this.animationId = null;\n        this.isRunning = false;\n\n        this.width = canvas.width;\n        this.height = canvas.height;\n\n        this.bufferLength = 0;\n        this.dataArray = null;\n        \n        this.amplification = 3.0;\n\n        this._lastDataArray = null;\n        this._verticalScrollOffset = 0;\n    }\n\n    /**\n     * é–‹å§‹å³æ™‚æ³¢å½¢é¡¯ç¤º\n     * @param {MediaStream} stream - éº¥å…‹é¢¨åª’é«”æµ\n     * @param {AudioContext} audioContext - Web Audio Context\n     * @param {GainNode} [preGainNode] - å‰ç´šå¢ç›Šç¯€é»ï¼ˆå¯é¸ï¼‰\n     */\n    start(stream, audioContext, preGainNode) {\n        if (this.isRunning || !audioContext || !this.analyser) {\n            console.warn('LiveWaveform.start() æ¢ä»¶ä¸æ»¿è¶³:', {\n                isRunning: this.isRunning,\n                hasAudioContext: !!audioContext,\n                hasAnalyser: !!this.analyser\n            });\n            return;\n        }\n\n        console.log('âœ… LiveWaveform é–‹å§‹å•Ÿå‹•...');\n        this.isRunning = true;\n        \n        const self = this;\n\n        // ç¢ºä¿ AudioContext è™•æ–¼é‹è¡Œç‹€æ…‹\n        let contextReady = Promise.resolve();\n        if (audioContext.state === 'suspended') {\n            contextReady = audioContext.resume().catch(function(err) {\n                console.warn('Unable to resume AudioContext:', err);\n            });\n        }\n\n        // ç­‰å¾… AudioContext å°±ç·’å¾Œå†é€£æ¥éº¥å…‹é¢¨\n        contextReady.then(function() {\n            // ç‚ºé¿å…é‡è¤‡é€£ç·šå…ˆæ¸…é™¤èˆŠçš„ source\n            if (self.mediaStreamSource) {\n                self.mediaStreamSource.disconnect();\n            }\n\n            // é€£æ¥éº¥å…‹é¢¨\n            self.mediaStreamSource = audioContext.createMediaStreamSource(stream);\n            if (preGainNode) {\n                try { \n                    self.mediaStreamSource.connect(preGainNode); \n                } catch(e) { \n                    console.warn('connect preGainNode failed', e); \n                }\n            } else {\n                self.mediaStreamSource.connect(self.analyser);\n            }\n\n            // è¨­å®š FFT åƒæ•¸\n            self.analyser.fftSize = 1024;\n            self.bufferLength = self.analyser.fftSize;\n            self.dataArray = new Uint8Array(self.bufferLength);\n\n            console.log('âœ… LiveWaveform éŸ³è¨Šé€£æ¥å®Œæˆï¼Œé–‹å§‹ç¹ªè£½');\n            \n            // ç«‹å³é–‹å§‹ç¹ªè£½\n            self.draw(false); // false = æ°´å¹³æ¨¡å¼\n        });\n    }\n\n    /**\n     * åœæ­¢å³æ™‚æ³¢å½¢é¡¯ç¤º\n     */\n    stop() {\n        if (!this.isRunning) return;\n        \n        this.isRunning = false;\n        \n        if (this.mediaStreamSource) {\n            this.mediaStreamSource.disconnect();\n            this.mediaStreamSource = null;\n        }\n\n        if (this.animationId) {\n            cancelAnimationFrame(this.animationId);\n            this.animationId = null;\n        }\n        \n        this.canvasContext.clearRect(0, 0, this.width, this.height);\n    }\n\n    /**\n     * ç¹ªè£½æ³¢å½¢ï¼ˆæŒçºŒæ›´æ–°ï¼‰\n     * @param {boolean} [isVertical=false] - æ˜¯å¦ç‚ºå‚ç›´æ¨¡å¼\n     */\n    draw(isVertical = false) {\n        if (!this.isRunning || !this.analyser || !this.dataArray) {\n            return;\n        }\n\n        this.animationId = requestAnimationFrame(() => this.draw(isVertical));\n\n        this.analyser.getByteTimeDomainData(this.dataArray);\n\n        if (!isVertical) {\n            // æ°´å¹³æ¨¡å¼\n            this.canvasContext.fillStyle = '#f0f0f0';\n            this.canvasContext.fillRect(0, 0, this.width, this.height);\n\n            this.canvasContext.lineWidth = 2;\n            this.canvasContext.strokeStyle = '#1E88E5';\n            this.canvasContext.beginPath();\n\n            const sliceWidth = this.width / this.bufferLength;\n            let x = 0;\n\n            for (let i = 0; i < this.bufferLength; i++) {\n                const v = (this.dataArray[i] / 128.0 - 1) * this.amplification;\n                const y = (v * this.height / 2) + (this.height / 2);\n\n                if (i === 0) {\n                    this.canvasContext.moveTo(x, y);\n                } else {\n                    this.canvasContext.lineTo(x, y);\n                }\n\n                x += sliceWidth;\n            }\n\n            this.canvasContext.lineTo(this.width, this.height / 2);\n            this.canvasContext.stroke();\n        } else {\n            // å‚ç›´æ¨¡å¼ï¼ˆæ»¾å‹•ç¹ªè£½ï¼‰\n            const scrollSpeed = 2;\n            this._verticalScrollOffset += scrollSpeed;\n            \n            if (this._verticalScrollOffset >= this.height) {\n                this._verticalScrollOffset = 0;\n                this.canvasContext.fillStyle = '#f0f0f0';\n                this.canvasContext.fillRect(0, 0, this.width, this.height);\n            }\n\n            this.canvasContext.lineWidth = 1.5;\n            this.canvasContext.strokeStyle = '#1E88E5';\n            this.canvasContext.beginPath();\n\n            const sliceHeight = this.height / this.bufferLength;\n            let y = 0;\n\n            for (let i = 0; i < this.bufferLength; i++) {\n                const v = (this.dataArray[i] / 128.0 - 1) * this.amplification;\n                const x = (v * this.width / 2) + (this.width / 2);\n\n                if (i === 0) {\n                    this.canvasContext.moveTo(x, y);\n                } else {\n                    this.canvasContext.lineTo(x, y);\n                }\n\n                y += sliceHeight;\n            }\n\n            this.canvasContext.stroke();\n        }\n    }\n}\n\n/* ================================================================\n * VUMeter é¡ - å³æ™‚éŸ³é‡ (RMS/Peak) é¡¯ç¤º\n * è¨ˆç®— RMS èˆ‡ Peakï¼Œè½‰æ›ç‚º dB å€¼ (-90dB ~ 0dB)\n * æä¾› peak hold åŠŸèƒ½ï¼šå³°å€¼ç¶­æŒä¸€æ®µæ™‚é–“å¾Œç·©é™\n * ================================================================ */\nexport class VUMeter {\n    constructor(canvas, analyserNode) {\n        this.canvas = canvas;\n        this.ctx = canvas.getContext('2d');\n        this.analyser = analyserNode;\n        this.bufferLength = 2048;\n        this.timeData = new Float32Array(this.bufferLength);\n        this.levelDb = -90;\n        this.peakDb = -90;\n        this.holdPeakDb = -90;\n        this.lastPeakTime = 0;\n        this.peakHoldMillis = 1500;\n        this.fallRateDbPerSec = 20;\n        this.minDb = -90;\n        this.maxDb = 0;\n        this.animationId = null;\n        this.lastClipTime = 0;\n        this.clipHoldMillis = 2000;\n        this._lastLogTime = 0;\n    }\n\n    _computeLevels() {\n        if (!this.analyser) return { rmsDb: this.minDb, peakDb: this.minDb };\n        \n        const required = this.analyser.fftSize || this.bufferLength;\n        if (this.timeData.length !== required) {\n            this.bufferLength = required;\n            this.timeData = new Float32Array(required);\n        }\n        \n        this.analyser.getFloatTimeDomainData(this.timeData);\n        let sumSquares = 0;\n        let peak = 0;\n        let clipped = false;\n        \n        for (let i = 0; i < this.bufferLength; i++) {\n            let v = this.timeData[i];\n            if (v > 1) v = 1;\n            else if (v < -1) v = -1;\n            sumSquares += v * v;\n            const absV = Math.abs(v);\n            if (absV > peak) peak = absV;\n            if (absV >= 0.995) clipped = true;\n        }\n        \n        const rms = Math.sqrt(sumSquares / this.bufferLength);\n        let rmsDb = rms > 0 ? 20 * Math.log10(rms) : -Infinity;\n        let peakDb = peak > 0 ? 20 * Math.log10(peak) : -Infinity;\n        \n        if (rmsDb < this.minDb) rmsDb = this.minDb;\n        if (rmsDb > this.maxDb) rmsDb = this.maxDb;\n        if (peakDb < this.minDb) peakDb = this.minDb;\n        if (peakDb > this.maxDb) peakDb = this.maxDb;\n        \n        if (clipped) {\n            this.lastClipTime = performance.now ? performance.now() : Date.now();\n        }\n        \n        return { rmsDb, peakDb };\n    }\n\n    resize() {\n        this.clear();\n    }\n\n    clear() {\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    draw(currentDb) {\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        \n        // èƒŒæ™¯\n        ctx.clearRect(0, 0, w, h);\n        const grd = ctx.createLinearGradient(0, 0, w, 0);\n        grd.addColorStop(0, '#2d3748');\n        grd.addColorStop(1, '#1a202c');\n        ctx.fillStyle = grd;\n        ctx.fillRect(0, 0, w, h);\n\n        // dB å°æ‡‰åˆ° 0~1\n        let norm = (currentDb - this.minDb) / (this.maxDb - this.minDb);\n        if (norm < 0) norm = 0;\n        if (norm > 1) norm = 1;\n\n        // å½©è‰²æ¼¸å±¤ (ç¶ ->é»ƒ->ç´…)\n        const barGrad = ctx.createLinearGradient(0, 0, w, 0);\n        barGrad.addColorStop(0, '#38a169');\n        barGrad.addColorStop(0.6, '#d69e2e');\n        barGrad.addColorStop(0.85, '#dd6b20');\n        barGrad.addColorStop(1, '#c53030');\n        ctx.fillStyle = barGrad;\n        const barWidth = Math.round(w * norm);\n        ctx.fillRect(0, 0, barWidth, h);\n\n        // åˆ»åº¦ç·š\n        ctx.save();\n        ctx.strokeStyle = 'rgba(255,255,255,0.15)';\n        ctx.lineWidth = 1;\n        ctx.beginPath();\n        \n        for (let db = this.minDb; db <= this.maxDb; db += 10) {\n            const posNorm = (db - this.minDb) / (this.maxDb - this.minDb);\n            const xPos = Math.round(w * posNorm) + 0.5;\n            \n            if (db === 0) {\n                ctx.strokeStyle = 'rgba(255,255,255,0.35)';\n                ctx.beginPath();\n                ctx.moveTo(xPos, 0);\n                ctx.lineTo(xPos, h);\n                ctx.stroke();\n                ctx.strokeStyle = 'rgba(255,255,255,0.15)';\n            } else {\n                ctx.moveTo(xPos, 0);\n                ctx.lineTo(xPos, h * 0.4);\n                ctx.moveTo(xPos, h);\n                ctx.lineTo(xPos, h * 0.6);\n            }\n            \n            if (db % 20 === 0 || db === -10) {\n                const label = db.toString();\n                ctx.fillStyle = (db === 0) ? '#ffffff' : (db === -10 ? '#ffeb3b' : '#cbd5e0');\n                ctx.font = '10px -apple-system,Segoe UI,sans-serif';\n                ctx.textAlign = 'center';\n                ctx.textBaseline = 'top';\n                ctx.fillText(label, xPos, 1);\n            }\n        }\n        ctx.restore();\n\n        // -10dBFS å€åŸŸé«˜äº®\n        const minus10Norm = (-10 - this.minDb) / (this.maxDb - this.minDb);\n        if (minus10Norm > 0 && minus10Norm < 1) {\n            const minus10X = Math.round(w * minus10Norm);\n            ctx.save();\n            ctx.fillStyle = 'rgba(255,235,59,0.08)';\n            ctx.fillRect(minus10X - 2, 0, 4, h);\n            ctx.restore();\n        }\n\n        // å³°å€¼ hold æŒ‡ç¤ºç·š\n        let holdNorm = (this.holdPeakDb - this.minDb) / (this.maxDb - this.minDb);\n        if (holdNorm < 0) holdNorm = 0;\n        if (holdNorm > 1) holdNorm = 1;\n        const holdX = Math.round(w * holdNorm);\n        ctx.strokeStyle = '#ffffff';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(holdX + 0.5, 0);\n        ctx.lineTo(holdX + 0.5, h);\n        ctx.stroke();\n\n        // æ–‡å­—é¡¯ç¤º\n        ctx.fillStyle = '#f0f0f0';\n        ctx.font = 'bold 12px -apple-system,Segoe UI,sans-serif';\n        ctx.textAlign = 'left';\n        ctx.textBaseline = 'middle';\n        const displayRms = currentDb <= this.minDb ? '-âˆ' : currentDb.toFixed(1);\n        const displayPeak = this.peakDb <= this.minDb ? '-âˆ' : this.peakDb.toFixed(1);\n        const txt = `RMS ${displayRms} dBFS   Peak ${displayPeak} dBFS`;\n        ctx.fillText(txt, 8, h / 2);\n\n        // CLIP æŒ‡ç¤º\n        const now = performance.now ? performance.now() : Date.now();\n        if (this.lastClipTime && (now - this.lastClipTime) < this.clipHoldMillis) {\n            ctx.save();\n            ctx.fillStyle = '#B00020';\n            const badgeW = 42, badgeH = 18;\n            ctx.fillRect(w - badgeW - 8, 4, badgeW, badgeH);\n            ctx.fillStyle = '#fff';\n            ctx.font = 'bold 12px -apple-system,Segoe UI,sans-serif';\n            ctx.textAlign = 'center';\n            ctx.textBaseline = 'middle';\n            ctx.fillText('CLIP', w - badgeW / 2 - 8, 4 + badgeH / 2 + 0.5);\n            ctx.restore();\n        }\n    }\n\n    update() {\n        const levels = this._computeLevels();\n        this.levelDb = levels.rmsDb;\n        this.peakDb = levels.peakDb;\n\n        const now = performance.now();\n        \n        // æ›´æ–° peak hold\n        if (this.peakDb > this.holdPeakDb + 0.5) {\n            this.holdPeakDb = this.peakDb;\n            this.lastPeakTime = now;\n        } else {\n            const elapsed = now - this.lastPeakTime;\n            if (elapsed > this.peakHoldMillis) {\n                const fallSeconds = (elapsed - this.peakHoldMillis) / 1000;\n                const fallAmount = this.fallRateDbPerSec * fallSeconds;\n                this.holdPeakDb = Math.max(this.peakDb, this.holdPeakDb - fallAmount);\n            }\n        }\n        \n        this.draw(this.levelDb);\n    }\n\n    start() {\n        this.stop();\n        \n        if (this.analyser) {\n            const required = this.analyser.fftSize || 2048;\n            if (this.timeData.length !== required) {\n                this.bufferLength = required;\n                this.timeData = new Float32Array(required);\n            }\n        }\n        \n        const self = this;\n        function loop() {\n            self.update();\n            self.animationId = requestAnimationFrame(loop);\n        }\n        loop();\n    }\n\n    stop() {\n        if (this.animationId) {\n            cancelAnimationFrame(this.animationId);\n            this.animationId = null;\n        }\n        this.clear();\n    }\n}\n\n/* ================================================================\n * AccumulatedWaveform é¡ - ç´¯ç©éŸ³è¨Šæ³¢å½¢é¡¯ç¤º\n * æŒçºŒç¹ªè£½ç›®å‰éŒ„è£½å®Œæˆçš„éŸ³è¨Šæ³¢å½¢\n * æ”¯æ´ OffscreenCanvas + Worker åŠ é€Ÿ\n * æ”¯æ´ç¸®æ”¾ã€å¹³ç§»ã€æ’­æ”¾ä½ç½®é¡¯ç¤º\n * ================================================================ */\nexport class AccumulatedWaveform {\n    constructor(canvas, options = {}) {\n        this.canvas = canvas;\n        this.canvasContext = null;\n        this.width = canvas.width;\n        this.height = canvas.height;\n\n        this.targetSampleRate = 5000;\n        this.sourceSampleRate = 48000;\n        this.decimationFactor = 10;\n\n        this.sampleMin = [];\n        this.sampleMax = [];\n        this.sampleCount = 0;\n\n        this.zoomFactor = 1;\n        this.viewStart = 0;\n        this.isAutoScroll = true;\n        this._panRemainder = 0;\n        \n        this.playbackPosition = 0;\n        this.isPlaying = false;\n        this.playbackStartTime = 0;\n        this.playbackStartSample = 0;\n\n        this.rawZoomMode = false;\n        this.rawViewStart = 0;\n        this.rawVisibleRaw = 0;\n\n        this._useWorker = options.useWorker !== false;\n        this._worker = null;\n        this._appendBatchMin = [];\n        this._appendBatchMax = [];\n        this._appendFlushScheduled = false;\n        this.lastDetail = null;\n        this.lastDensity = null;\n        \n        // å˜—è©¦ä½¿ç”¨ OffscreenCanvas + Worker\n        if (this._useWorker && canvas.transferControlToOffscreen && typeof Worker !== 'undefined') {\n            try {\n                const off = canvas.transferControlToOffscreen();\n                this._worker = new Worker(options.workerPath || 'workers/wf-worker.js');\n                \n                this._worker.postMessage({\n                    type: 'init',\n                    canvas: off,\n                    width: this.width,\n                    height: this.height,\n                    verticalMode: false,\n                    showClipMarks: options.showClipMarks !== false,\n                    sourceSampleRate: this.sourceSampleRate,\n                    decimationFactor: this.decimationFactor\n                }, [off]);\n                \n                const self = this;\n                this._worker.onmessage = function(ev) {\n                    const msg = ev.data;\n                    if (!msg) return;\n                    if (msg.type === 'detailUpdate') {\n                        self.lastDetail = msg.detail;\n                        self.lastDensity = msg.density;\n                    }\n                };\n            } catch(e) {\n                console.warn('OffscreenCanvas åˆå§‹åŒ–å¤±æ•—ï¼Œä½¿ç”¨ä¸»ç·šç¨‹ç¹ªè£½:', e);\n                this._useWorker = false;\n            }\n        } else {\n            this._useWorker = false;\n        }\n        \n        // å¦‚æœæ²’æœ‰ä½¿ç”¨ Workerï¼Œç²å– 2D context\n        if (!this._useWorker) {\n            try {\n                this.canvasContext = canvas.getContext('2d');\n            } catch(e) {\n                console.warn('ç„¡æ³•ç²å– canvas context:', e);\n            }\n        }\n        \n        // è¨­ç½®æ»‘é¼ äº’å‹•\n        this._setupMouseInteraction();\n        \n        this.clear();\n    }\n    \n    /**\n     * è¨­ç½®æ»‘é¼ äº’å‹•ï¼ˆå¹³ç§»ã€ç¸®æ”¾ã€é»æ“Šå®šä½ï¼‰\n     * @private\n     */\n    _setupMouseInteraction() {\n        if (!this.canvas) return;\n        \n        let isDragging = false;\n        let dragStartX = 0;\n        let dragStartViewStart = 0;\n        \n        // æ»‘é¼ æŒ‰ä¸‹\n        this.canvas.addEventListener('mousedown', (e) => {\n            isDragging = true;\n            dragStartX = e.offsetX;\n            dragStartViewStart = this.viewStart;\n            this.isAutoScroll = false;\n            this.canvas.style.cursor = 'grabbing';\n        });\n        \n        // æ»‘é¼ ç§»å‹•ï¼ˆæ‹–æ›³ï¼‰\n        this.canvas.addEventListener('mousemove', (e) => {\n            if (!isDragging) return;\n            \n            const deltaX = e.offsetX - dragStartX;\n            const info = this.getVisibleSamples();\n            const samplesPerPixel = info.visible / this.width;\n            const sampleDelta = Math.round(-deltaX * samplesPerPixel);\n            \n            this.viewStart = dragStartViewStart + sampleDelta;\n            this._enforceViewBounds();\n            this.draw();\n        });\n        \n        // æ»‘é¼ æ”¾é–‹\n        this.canvas.addEventListener('mouseup', () => {\n            if (isDragging) {\n                isDragging = false;\n                this.canvas.style.cursor = 'grab';\n            }\n        });\n        \n        // æ»‘é¼ é›¢é–‹ canvas\n        this.canvas.addEventListener('mouseleave', () => {\n            if (isDragging) {\n                isDragging = false;\n                this.canvas.style.cursor = 'default';\n            }\n        });\n        \n        // æ»‘é¼ æ»¾è¼ªï¼ˆç¸®æ”¾ï¼‰\n        this.canvas.addEventListener('wheel', (e) => {\n            e.preventDefault();\n            \n            // è¨ˆç®—æ»‘é¼ ä½ç½®ç›¸å°æ–¼ canvas çš„æ¯”ä¾‹\n            const rect = this.canvas.getBoundingClientRect();\n            const x = e.clientX - rect.left;\n            const anchorRatio = x / this.width;\n            \n            // æ ¹æ“šæ»¾è¼ªæ–¹å‘ç¸®æ”¾\n            const zoomSteps = e.deltaY > 0 ? -1 : 1;\n            this.zoomBySteps(zoomSteps, anchorRatio);\n        });\n        \n        // é»æ“Šå®šä½ï¼ˆè·³åˆ°æ’­æ”¾ä½ç½®ï¼‰\n        this.canvas.addEventListener('click', (e) => {\n            if (isDragging) return; // å¦‚æœæ˜¯æ‹–æ›³çµæŸï¼Œä¸è§¸ç™¼é»æ“Š\n            \n            const info = this.getVisibleSamples();\n            const clickRatio = e.offsetX / this.width;\n            const clickedSample = Math.floor(info.start + clickRatio * info.visible);\n            \n            // è§¸ç™¼è‡ªå®šç¾©äº‹ä»¶ï¼Œè®“å¤–éƒ¨è™•ç†æ’­æ”¾è·³è½‰\n            const event = new CustomEvent('waveform-seek', {\n                detail: {\n                    sample: clickedSample,\n                    time: clickedSample / this.sourceSampleRate\n                }\n            });\n            this.canvas.dispatchEvent(event);\n        });\n        \n        // è¨­ç½® cursor æ¨£å¼\n        this.canvas.style.cursor = 'grab';\n    }\n\n    clear() {\n        if (this._useWorker && this._worker) {\n            this._worker.postMessage({ type: 'reset' });\n            return;\n        }\n        if (!this.canvasContext) return;\n        \n        this.canvasContext.clearRect(0, 0, this.width, this.height);\n        this.canvasContext.fillStyle = '#f0f0f0';\n        this.canvasContext.fillRect(0, 0, this.width, this.height);\n        this.canvasContext.lineWidth = 1;\n        this.canvasContext.strokeStyle = '#d0d0d0';\n        this.canvasContext.beginPath();\n        this.canvasContext.moveTo(0, this.height / 2);\n        this.canvasContext.lineTo(this.width, this.height / 2);\n        this.canvasContext.stroke();\n    }\n\n    reset() {\n        this.sampleMin.length = 0;\n        this.sampleMax.length = 0;\n        this.sampleCount = 0;\n        this.zoomFactor = 1;\n        this.viewStart = 0;\n        this.isAutoScroll = true;\n        this._panRemainder = 0;\n        this.clear();\n    }\n\n    append(audioSamples) {\n        if (!audioSamples || !audioSamples.length) {\n            return;\n        }\n\n        const factor = this.decimationFactor;\n        const total = audioSamples.length;\n        const appendedMin = [];\n        const appendedMax = [];\n        \n        // æ¯ç§’è¨˜éŒ„ä¸€æ¬¡\n        if (!this._lastAppendLog) this._lastAppendLog = 0;\n        const now = Date.now();\n        if (now - this._lastAppendLog > 1000) {\n            console.log('ğŸ“ˆ AccumulatedWaveform.append():', total, 'æ¨£æœ¬ â†’', \n                        Math.floor(total / factor), 'å€å¡Š');\n            this._lastAppendLog = now;\n        }\n        \n        // æ”¹é€²çš„æ¼”ç®—æ³•ï¼šDC Offset Removalï¼ˆç§»é™¤ç›´æµåç§»ï¼‰\n        // å…ˆè¨ˆç®—å€å¡Šå¹³å‡å€¼ï¼Œå†ä»¥æ­¤ç‚ºä¸­å¿ƒè¨ˆç®— min/max\n        // é€™æ¨£å¯ä»¥è®“æ³¢å½¢æ›´å°ç¨±ã€ç´°ç·»\n        for (let i = 0; i < total; i += factor) {\n            let blockSum = 0;\n            let blockCount = 0;\n\n            // ç¬¬ä¸€éšæ®µï¼šè¨ˆç®—å€å¡Šå¹³å‡å€¼ï¼ˆDC offsetï¼‰\n            for (let j = 0; j < factor && (i + j) < total; j++) {\n                const sample = audioSamples[i + j];\n                blockSum += sample;\n                blockCount++;\n            }\n\n            if (!blockCount) {\n                continue;\n            }\n\n            const blockMean = blockSum / blockCount;\n\n            // ç¬¬äºŒéšæ®µï¼šä»¥å€å¡Šå¹³å‡å€¼ç‚ºä¸­å¿ƒï¼Œè¨ˆç®—å»ä¸­å¿ƒåŒ–çš„ min/max\n            let blockMin = 1.0;\n            let blockMax = -1.0;\n\n            for (let k = 0; k < blockCount; k++) {\n                const centeredSample = audioSamples[i + k] - blockMean;\n                if (centeredSample < blockMin) {\n                    blockMin = centeredSample;\n                }\n                if (centeredSample > blockMax) {\n                    blockMax = centeredSample;\n                }\n            }\n\n            // é˜²å‘†ï¼šç¢ºä¿ min <= max\n            if (blockMin > blockMax) {\n                blockMin = blockMax = 0;\n            }\n\n            this.sampleMin.push(blockMin);\n            this.sampleMax.push(blockMax);\n            appendedMin.push(blockMin);\n            appendedMax.push(blockMax);\n            this.sampleCount++;\n        }\n\n        if (this.isAutoScroll) {\n            this.scrollToLatest();\n        } else {\n            this._enforceViewBounds();\n        }\n\n        if (this._useWorker && this._worker) {\n            this._appendBatchMin.push(...appendedMin);\n            this._appendBatchMax.push(...appendedMax);\n            if (!this._appendFlushScheduled) {\n                this._appendFlushScheduled = true;\n                const self = this;\n                const flush = () => self._flushAppendBatch();\n                if (typeof requestAnimationFrame === 'function') {\n                    requestAnimationFrame(flush);\n                } else {\n                    setTimeout(flush, 32);\n                }\n            }\n        }\n        \n        this.draw();\n    }\n\n    _flushAppendBatch() {\n        if (!this._worker || this._appendBatchMin.length === 0) {\n            this._appendFlushScheduled = false;\n            return;\n        }\n        \n        this._worker.postMessage({\n            type: 'append',\n            minArr: this._appendBatchMin,\n            maxArr: this._appendBatchMax\n        });\n        \n        this._appendBatchMin = [];\n        this._appendBatchMax = [];\n        this._appendFlushScheduled = false;\n    }\n\n    draw() {\n        if (this._useWorker && this._worker) {\n            this._worker.postMessage({\n                type: 'draw',\n                zoomFactor: this.zoomFactor,\n                viewStart: this.viewStart,\n                playbackPosition: this.playbackPosition,\n                isPlaying: this.isPlaying\n            });\n            return;\n        }\n        \n        if (!this.canvasContext) return;\n        \n        // ä¸»ç·šç¨‹ç¹ªè£½\n        this.clear();\n        \n        const total = this.sampleMin.length;\n        if (!total) return;\n        \n        const visibleSamples = Math.min(total, Math.round(total / this.zoomFactor));\n        const start = Math.min(this.viewStart, Math.max(0, total - visibleSamples));\n        const end = Math.min(total, start + visibleSamples);\n        const centerY = this.height / 2;\n        \n        // ç¹ªè£½æ³¢å½¢ - æ‰¹æ¬¡è™•ç†\n        this.canvasContext.strokeStyle = '#1E88E5';\n        this.canvasContext.lineWidth = 1;\n        this.canvasContext.beginPath();\n        \n        for (let i = start; i < end; i++) {\n            const x = Math.floor(((i - start) / visibleSamples) * this.width) + 0.5;\n            const yMin = Math.floor(centerY - (this.sampleMax[i] * centerY * 0.95));\n            const yMax = Math.floor(centerY - (this.sampleMin[i] * centerY * 0.95));\n            \n            // ç¹ªè£½å‚ç›´ç·šæ®µ\n            this.canvasContext.moveTo(x, yMin);\n            this.canvasContext.lineTo(x, yMax);\n        }\n        \n        this.canvasContext.stroke();\n        \n        // ç¹ªè£½ä¸­ç·š\n        this.canvasContext.strokeStyle = '#d0d0d0';\n        this.canvasContext.lineWidth = 1;\n        this.canvasContext.beginPath();\n        this.canvasContext.moveTo(0, centerY + 0.5);\n        this.canvasContext.lineTo(this.width, centerY + 0.5);\n        this.canvasContext.stroke();\n    }\n\n    getVisibleSamples() {\n        const total = this.sampleCount;\n        if (total === 0) return { start: 0, end: 0, visible: 0 };\n        \n        const minVis = this._getMinVisibleSamples(total);\n        let visible = Math.max(minVis, Math.round(total / this.zoomFactor));\n        if (visible > total) visible = total;\n        \n        let start = this.viewStart;\n        if (start + visible > total) start = total - visible;\n        if (start < 0) start = 0;\n        \n        const end = Math.min(total, start + visible);\n        return { start, end, visible };\n    }\n\n    _getMinVisibleSamples(total) {\n        return Math.max(1, Math.floor(this.width / 2));\n    }\n\n    _enforceViewBounds() {\n        const info = this.getVisibleSamples();\n        this.viewStart = info.start;\n    }\n\n    scrollToLatest() {\n        const total = this.sampleCount;\n        if (total === 0) return;\n        \n        const minVis = this._getMinVisibleSamples(total);\n        let visible = Math.max(minVis, Math.round(total / this.zoomFactor));\n        if (visible > total) visible = total;\n        \n        this.viewStart = total - visible;\n        if (this.viewStart < 0) this.viewStart = 0;\n    }\n\n    setZoom(targetZoom, anchorSample) {\n        if (targetZoom < 1) targetZoom = 1;\n        const maxZoom = Math.max(1, this.sampleCount / this._getMinVisibleSamples(this.sampleCount));\n        if (targetZoom > maxZoom) targetZoom = maxZoom;\n        \n        const oldInfo = this.getVisibleSamples();\n        this.zoomFactor = targetZoom;\n        const newInfo = this.getVisibleSamples();\n        \n        if (typeof anchorSample === 'number' && anchorSample >= 0) {\n            const oldRatio = (anchorSample - oldInfo.start) / oldInfo.visible;\n            const desiredStart = anchorSample - oldRatio * newInfo.visible;\n            this.viewStart = Math.max(0, Math.min(this.sampleCount - newInfo.visible, desiredStart));\n        }\n        \n        this._enforceViewBounds();\n        this.draw();\n    }\n\n    zoomBySteps(stepCount, anchorRatio = 0.5) {\n        if (stepCount === 0) return;\n        \n        const zoomStep = 1.2;\n        const oldInfo = this.getVisibleSamples();\n        const anchorSample = oldInfo.start + anchorRatio * oldInfo.visible;\n        \n        let newZoom = this.zoomFactor;\n        if (stepCount > 0) {\n            newZoom *= Math.pow(zoomStep, stepCount);\n        } else {\n            newZoom /= Math.pow(zoomStep, -stepCount);\n        }\n        \n        this.setZoom(newZoom, anchorSample);\n    }\n\n    panBySamples(sampleDelta) {\n        if (sampleDelta === 0) return;\n        \n        this.isAutoScroll = false;\n        this.viewStart += sampleDelta;\n        this._enforceViewBounds();\n        this.draw();\n    }\n\n    panByPixels(pixelDelta) {\n        if (pixelDelta === 0) return;\n        \n        const info = this.getVisibleSamples();\n        const samplesPerPixel = info.visible / this.width;\n        const totalDelta = pixelDelta * samplesPerPixel + this._panRemainder;\n        const intDelta = Math.round(totalDelta);\n        this._panRemainder = totalDelta - intDelta;\n        \n        this.panBySamples(intDelta);\n    }\n\n    resetView() {\n        this.zoomFactor = 1;\n        this.viewStart = 0;\n        this.isAutoScroll = true;\n        this._panRemainder = 0;\n        this.scrollToLatest();\n        this.draw();\n    }\n\n    setSourceSampleRate(sampleRate) {\n        this.sourceSampleRate = sampleRate || 48000;\n        this.decimationFactor = Math.max(1, Math.round(this.sourceSampleRate / this.targetSampleRate));\n        \n        if (this._worker) {\n            this._worker.postMessage({\n                type: 'setSampleRate',\n                sourceSampleRate: this.sourceSampleRate,\n                decimationFactor: this.decimationFactor\n            });\n        }\n    }\n\n    _getSamplePair(index) {\n        if (index < 0 || index >= this.sampleCount) {\n            return { min: 0, max: 0 };\n        }\n        return {\n            min: this.sampleMin[index],\n            max: this.sampleMax[index]\n        };\n    }\n\n    setPlaybackPosition(sampleIndex) {\n        this.playbackPosition = sampleIndex;\n        this.draw();\n    }\n\n    setRawZoomMode(enabled) {\n        this.rawZoomMode = !!enabled;\n    }\n\n    startPlayback(startSample, sampleRate) {\n        this.isPlaying = true;\n        this.playbackStartSample = startSample || 0;\n        this.playbackStartTime = performance.now ? performance.now() : Date.now();\n        this.playbackPosition = this.playbackStartSample;\n        \n        const self = this;\n        const sr = sampleRate || this.sourceSampleRate;\n        \n        function updatePosition() {\n            if (!self.isPlaying) return;\n            \n            const now = performance.now ? performance.now() : Date.now();\n            const elapsed = (now - self.playbackStartTime) / 1000;\n            const rawSamples = elapsed * sr;\n            const decimatedPos = self.playbackStartSample + Math.floor(rawSamples / self.decimationFactor);\n            \n            self.playbackPosition = decimatedPos;\n            self.draw();\n            \n            requestAnimationFrame(updatePosition);\n        }\n        \n        requestAnimationFrame(updatePosition);\n    }\n\n    stopPlayback() {\n        this.isPlaying = false;\n        this.playbackPosition = 0;\n        this.draw();\n    }\n\n    _updatePlaybackPosition() {\n        if (!this.isPlaying) return;\n        \n        const now = performance.now ? performance.now() : Date.now();\n        const elapsed = (now - this.playbackStartTime) / 1000;\n        const rawSamples = elapsed * this.sourceSampleRate;\n        const decimatedPos = this.playbackStartSample + Math.floor(rawSamples / this.decimationFactor);\n        \n        this.playbackPosition = decimatedPos;\n    }\n}\n\n/* ================================================================\n * OverviewWaveform é¡ - å…¨å±€æ³¢å½¢æ¦‚è¦½\n * é¡¯ç¤ºæ•´å€‹éŒ„éŸ³çš„æ³¢å½¢æ¦‚è¦½ï¼Œä¸¦æ¨™ç¤ºç•¶å‰å¯è¦–ç¯„åœ\n * ================================================================ */\nexport class OverviewWaveform {\n    constructor(canvas, accumulatedWaveform) {\n        this.canvas = canvas;\n        this.ctx = canvas.getContext('2d');\n        this.accumulatedWaveform = accumulatedWaveform;\n        this.width = canvas.width;\n        this.height = canvas.height;\n        \n        // æš«æ™‚ç¦ç”¨ Worker æ¨¡å¼ï¼Œä½¿ç”¨ä¸»ç·šç¨‹ç¹ªè£½\n        this._useWorker = false;\n        this._workerRef = null;\n        this._warnedNoData = false;\n        this._lastTotal = 0;\n        \n        // è¨­ç½®æ»‘é¼ äº’å‹•\n        this._setupMouseInteraction();\n        \n        // æ³¨æ„ï¼šå¦‚æœè¦å•Ÿç”¨ Workerï¼Œéœ€è¦ç¢ºä¿ canvas å°šæœªç²å– context\n        // ä¸” accumulatedWaveform å·²æˆåŠŸè½‰ç§»å…¶ canvas æ§åˆ¶æ¬Š\n    }\n    \n    /**\n     * è¨­ç½®æ»‘é¼ äº’å‹•ï¼ˆé»æ“Šè·³è½‰ã€æ‹–æ›³å¯è¦–ç¯„åœï¼‰\n     * @private\n     */\n    _setupMouseInteraction() {\n        if (!this.canvas) return;\n        \n        let isDragging = false;\n        \n        // æ»‘é¼ æŒ‰ä¸‹ - é»æ“Šæˆ–é–‹å§‹æ‹–æ›³\n        this.canvas.addEventListener('mousedown', (e) => {\n            const acc = this.accumulatedWaveform;\n            if (!acc || acc.sampleCount === 0) return;\n            \n            isDragging = true;\n            this._handleSeek(e.offsetX);\n            this.canvas.style.cursor = 'grabbing';\n        });\n        \n        // æ»‘é¼ ç§»å‹• - æ‹–æ›³æ›´æ–°\n        this.canvas.addEventListener('mousemove', (e) => {\n            if (!isDragging) return;\n            this._handleSeek(e.offsetX);\n        });\n        \n        // æ»‘é¼ æ”¾é–‹\n        this.canvas.addEventListener('mouseup', () => {\n            isDragging = false;\n            this.canvas.style.cursor = 'pointer';\n        });\n        \n        // æ»‘é¼ é›¢é–‹\n        this.canvas.addEventListener('mouseleave', () => {\n            if (isDragging) {\n                isDragging = false;\n                this.canvas.style.cursor = 'pointer';\n            }\n        });\n        \n        // è¨­ç½® cursor æ¨£å¼\n        this.canvas.style.cursor = 'pointer';\n    }\n    \n    /**\n     * è™•ç†é»æ“Š/æ‹–æ›³è·³è½‰\n     * @private\n     */\n    _handleSeek(clickX) {\n        const acc = this.accumulatedWaveform;\n        if (!acc || acc.sampleCount === 0) return;\n        \n        const total = acc.sampleCount;\n        const clickRatio = Math.max(0, Math.min(1, clickX / this.width));\n        const targetSample = Math.floor(clickRatio * total);\n        \n        // æ›´æ–° accumulated waveform çš„è¦–åœ–ä½ç½®\n        const info = acc.getVisibleSamples();\n        const halfVisible = Math.floor(info.visible / 2);\n        acc.viewStart = Math.max(0, Math.min(total - info.visible, targetSample - halfVisible));\n        acc.isAutoScroll = false;\n        acc._enforceViewBounds();\n        acc.draw();\n        \n        // é‡ç¹ª overview ä»¥æ›´æ–°å¯è¦–ç¯„åœæŒ‡ç¤ºå™¨\n        this.draw();\n        \n        // è§¸ç™¼è‡ªå®šç¾©äº‹ä»¶\n        const event = new CustomEvent('overview-seek', {\n            detail: {\n                sample: targetSample,\n                time: targetSample / acc.sourceSampleRate\n            }\n        });\n        this.canvas.dispatchEvent(event);\n    }\n\n    clear() {\n        if (this._useWorker && this._workerRef) {\n            this._workerRef.postMessage({ type: 'clearOverview' });\n            return;\n        }\n        \n        this.ctx.clearRect(0, 0, this.width, this.height);\n        this.ctx.fillStyle = '#f5f5f5';\n        this.ctx.fillRect(0, 0, this.width, this.height);\n    }\n\n    draw() {\n        if (this._useWorker && this._workerRef) {\n            // Worker æœƒè‡ªå‹•åŒæ­¥ç¹ªè£½ overview\n            return;\n        }\n        \n        // ä¸»ç·šç¨‹ç¹ªè£½\n        this.clear();\n        \n        const acc = this.accumulatedWaveform;\n        if (!acc || acc.sampleCount === 0) {\n            console.log('âš ï¸ OverviewWaveform: æ²’æœ‰æ•¸æ“šå¯é¡¯ç¤º', {\n                hasAcc: !!acc,\n                sampleCount: acc ? acc.sampleCount : 0\n            });\n            return;\n        }\n        \n        const total = acc.sampleCount;\n        const info = acc.getVisibleSamples();\n        \n        console.log('ğŸ“Š OverviewWaveform ç¹ªè£½:', {\n            total,\n            visibleStart: info.start,\n            visibleEnd: info.end,\n            canvasWidth: this.width,\n            canvasHeight: this.height\n        });\n        \n        // ç¹ªè£½å…¨å±€æ³¢å½¢\n        this.ctx.strokeStyle = '#64b5f6';\n        this.ctx.lineWidth = 1;\n        \n        const samplesPerPixel = total / this.width;\n        for (let x = 0; x < this.width; x++) {\n            const sampleIndex = Math.floor(x * samplesPerPixel);\n            if (sampleIndex >= total) break;\n            \n            const sample = acc._getSamplePair(sampleIndex);\n            const centerY = this.height / 2;\n            const yMin = Math.floor(centerY - (sample.max * centerY * 0.9));\n            const yMax = Math.floor(centerY - (sample.min * centerY * 0.9));\n            \n            // ç¹ªè£½å‚ç›´ç·š\n            this.ctx.beginPath();\n            this.ctx.moveTo(x, yMin);\n            this.ctx.lineTo(x, yMax);\n            this.ctx.stroke();\n        }\n        \n        // ç¹ªè£½ä¸­ç·š\n        this.ctx.strokeStyle = '#e0e0e0';\n        this.ctx.lineWidth = 1;\n        this.ctx.beginPath();\n        this.ctx.moveTo(0, this.height / 2);\n        this.ctx.lineTo(this.width, this.height / 2);\n        this.ctx.stroke();\n        \n        // ç¹ªè£½å¯è¦–ç¯„åœæŒ‡ç¤ºå™¨\n        const viewStartX = Math.floor((info.start / total) * this.width);\n        const viewEndX = Math.floor((info.end / total) * this.width);\n        const viewWidth = Math.max(2, viewEndX - viewStartX);\n        \n        // åŠé€æ˜è¦†è“‹\n        this.ctx.fillStyle = 'rgba(33, 150, 243, 0.15)';\n        this.ctx.fillRect(viewStartX, 0, viewWidth, this.height);\n        \n        // é‚Šæ¡†\n        this.ctx.strokeStyle = '#2196F3';\n        this.ctx.lineWidth = 2;\n        this.ctx.strokeRect(viewStartX, 0, viewWidth, this.height);\n        \n        console.log('âœ… OverviewWaveform ç¹ªè£½å®Œæˆ');\n    }\n}\n\n// å°å‡ºæ‰€æœ‰é¡åˆ¥\nexport default WaveformRenderer;\n","/**\n * StorageAdapter - å„²å­˜é©é…å™¨åŸºé¡\n * å®šç¾©çµ±ä¸€çš„å„²å­˜ä»‹é¢ï¼Œæ”¯æ´å¤šç¨®å„²å­˜å¾Œç«¯\n */\n\nexport class StorageAdapter {\n  /**\n   * å„²å­˜éŸ³è¨Šæª”æ¡ˆ\n   * @param {Blob} blob - éŸ³è¨Š Blob ç‰©ä»¶\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @param {Object} metadata - å…ƒæ•¸æ“šï¼ˆå¯é¸ï¼‰\n   * @returns {Promise<string>} æª”æ¡ˆ ID æˆ– URL\n   */\n  async save(blob, filename, metadata = {}) {\n    throw new Error('save() must be implemented by subclass');\n  }\n  \n  /**\n   * è¼‰å…¥éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} id - æª”æ¡ˆ ID æˆ–åç¨±\n   * @returns {Promise<Blob>} éŸ³è¨Š Blob ç‰©ä»¶\n   */\n  async load(id) {\n    throw new Error('load() must be implemented by subclass');\n  }\n  \n  /**\n   * åˆªé™¤éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} id - æª”æ¡ˆ ID æˆ–åç¨±\n   * @returns {Promise<boolean>} æ˜¯å¦æˆåŠŸåˆªé™¤\n   */\n  async delete(id) {\n    throw new Error('delete() must be implemented by subclass');\n  }\n  \n  /**\n   * åˆ—å‡ºæ‰€æœ‰æª”æ¡ˆ\n   * @returns {Promise<Array>} æª”æ¡ˆåˆ—è¡¨\n   */\n  async list() {\n    throw new Error('list() must be implemented by subclass');\n  }\n  \n  /**\n   * æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨\n   * @param {string} id - æª”æ¡ˆ ID æˆ–åç¨±\n   * @returns {Promise<boolean>}\n   */\n  async exists(id) {\n    try {\n      await this.load(id);\n      return true;\n    } catch (error) {\n      return false;\n    }\n  }\n  \n  /**\n   * æ¸…ç©ºæ‰€æœ‰æª”æ¡ˆï¼ˆè¬¹æ…ä½¿ç”¨ï¼‰\n   * @returns {Promise<number>} åˆªé™¤çš„æª”æ¡ˆæ•¸é‡\n   */\n  async clear() {\n    const files = await this.list();\n    let count = 0;\n    \n    for (const file of files) {\n      try {\n        await this.delete(file.id || file.filename);\n        count++;\n      } catch (error) {\n        console.error('Failed to delete file:', file, error);\n      }\n    }\n    \n    return count;\n  }\n}\n\nexport default StorageAdapter;\n","/**\n * VoiceBank Recorder - ä¸»å…¥å£é»\n * è·¨å¹³å°éŸ³è¨ŠéŒ„éŸ³åº«\n * \n * @version 1.0.0\n * @author VoiceBank Team\n * @license MIT\n */\n\n// åŒ¯å‡ºæ ¸å¿ƒæ¨¡çµ„\nexport { AudioEngine } from './core/AudioEngine.js';\nexport { WaveformRenderer } from './core/WaveformRenderer.js';\nexport { DeviceManager } from './core/DeviceManager.js';\n\n// åŒ¯å‡º UI æ¨¡çµ„\nexport { RecorderUI } from './ui/RecorderUI.js';\n\n// åŒ¯å‡ºå„²å­˜æ¨¡çµ„\nexport {\n  StorageAdapter,\n  IndexedDBAdapter,\n  ServerAdapter,\n  ElectronAdapter,\n  CapacitorAdapter,\n  StorageFactory\n} from './storage/index.js';\n\n// åŒ¯å‡ºå·¥å…·æ¨¡çµ„\nexport { PlatformDetector } from './utils/PlatformDetector.js';\n\n/**\n * VoiceBankRecorder - ä¸»é¡åˆ¥\n * æä¾›çµ±ä¸€çš„ API ä»‹é¢\n */\nexport class VoiceBankRecorder {\n  /**\n   * å»ºæ§‹å‡½æ•¸\n   * @param {Object} options - é…ç½®é¸é …\n   * @param {string|HTMLElement} options.container - å®¹å™¨é¸æ“‡å™¨æˆ–å…ƒç´ \n   * @param {string} options.layout - ä½ˆå±€æ¨¡å¼ ('horizontal'|'vertical'|'auto')\n   * @param {string} options.theme - ä¸»é¡Œ ('light'|'dark')\n   * @param {Object} options.audio - éŸ³è¨Šé…ç½®\n   * @param {Object} options.waveform - æ³¢å½¢é…ç½®\n   * @param {Object} options.storage - å„²å­˜é…ç½®\n   * @param {Object} options.callbacks - äº‹ä»¶å›èª¿\n   */\n  constructor(options = {}) {\n    this.options = this.mergeOptions(options);\n    this.initialized = false;\n    \n    // åˆå§‹åŒ–å„²å­˜é©é…å™¨\n    this.storage = this.createStorageAdapter(this.options.storage);\n    \n    // ç‹€æ…‹\n    this.isRecording = false;\n    this.isPaused = false;\n    this.currentBlob = null;\n    \n    // å¦‚æœæä¾›äº†å®¹å™¨ï¼Œåˆå§‹åŒ– UI\n    if (this.options.container) {\n      this.initializeUI();\n    }\n  }\n  \n  /**\n   * åˆä½µé…ç½®é¸é …\n   * @param {Object} options - ç”¨æˆ¶é¸é …\n   * @returns {Object} åˆä½µå¾Œçš„é¸é …\n   */\n  mergeOptions(options) {\n    const defaults = {\n      container: null,\n      layout: 'auto',\n      theme: 'light',\n      \n      audio: {\n        sampleRate: 48000,\n        channels: 1,\n        agc: false,\n        gain: 1.0\n      },\n      \n      waveform: {\n        showOverview: true,\n        showAccumulated: true,\n        showLive: true,\n        decimation: 10,\n        colors: {\n          waveform: '#1E88E5',\n          selection: '#4CAF50',\n          playback: '#FF0000'\n        }\n      },\n      \n      storage: {\n        type: 'auto'\n      },\n      \n      callbacks: {\n        onRecordStart: () => {},\n        onRecordStop: () => {},\n        onRecordPause: () => {},\n        onRecordResume: () => {},\n        onPlayStart: () => {},\n        onPlayStop: () => {},\n        onError: (error) => console.error('VoiceBankRecorder error:', error)\n      }\n    };\n    \n    // æ·±åº¦åˆä½µ\n    return this.deepMerge(defaults, options);\n  }\n  \n  /**\n   * æ·±åº¦åˆä½µç‰©ä»¶\n   * @param {Object} target - ç›®æ¨™ç‰©ä»¶\n   * @param {Object} source - ä¾†æºç‰©ä»¶\n   * @returns {Object}\n   */\n  deepMerge(target, source) {\n    const result = { ...target };\n    \n    for (const key in source) {\n      if (source[key] instanceof Object && !Array.isArray(source[key])) {\n        result[key] = this.deepMerge(result[key] || {}, source[key]);\n      } else {\n        result[key] = source[key];\n      }\n    }\n    \n    return result;\n  }\n  \n  /**\n   * å‰µå»ºå„²å­˜é©é…å™¨\n   * @param {Object} storageConfig - å„²å­˜é…ç½®\n   * @returns {StorageAdapter}\n   */\n  createStorageAdapter(storageConfig) {\n    const { StorageFactory } = require('./storage/index.js');\n    return StorageFactory.create({\n      type: storageConfig.type || 'auto',\n      options: storageConfig\n    });\n  }\n  \n  /**\n   * åˆå§‹åŒ– UI\n   */\n  initializeUI() {\n    // TODO: å¯¦ä½œ UI åˆå§‹åŒ–\n    // é€™å°‡åœ¨å¾ŒçºŒéšæ®µå¯¦ä½œ\n    console.log('UI initialization - to be implemented');\n  }\n  \n  /**\n   * é–‹å§‹éŒ„éŸ³\n   * @returns {Promise<void>}\n   */\n  async startRecording() {\n    try {\n      if (this.isRecording) {\n        throw new Error('Already recording');\n      }\n      \n      // TODO: å¯¦ä½œéŒ„éŸ³é‚è¼¯\n      this.isRecording = true;\n      this.options.callbacks.onRecordStart();\n      \n      console.log('Recording started');\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åœæ­¢éŒ„éŸ³\n   * @returns {Promise<Blob>}\n   */\n  async stopRecording() {\n    try {\n      if (!this.isRecording) {\n        throw new Error('Not recording');\n      }\n      \n      // TODO: å¯¦ä½œåœæ­¢éŒ„éŸ³é‚è¼¯\n      this.isRecording = false;\n      \n      // æ¨¡æ“¬è¿”å› Blobï¼ˆå¯¦éš›æœƒå¾ AudioEngine ç²å–ï¼‰\n      this.currentBlob = null; // TODO: å¯¦éš›çš„ Blob\n      \n      this.options.callbacks.onRecordStop(this.currentBlob);\n      \n      console.log('Recording stopped');\n      return this.currentBlob;\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * æš«åœéŒ„éŸ³\n   * @returns {Promise<void>}\n   */\n  async pauseRecording() {\n    try {\n      if (!this.isRecording || this.isPaused) {\n        throw new Error('Cannot pause');\n      }\n      \n      this.isPaused = true;\n      this.options.callbacks.onRecordPause();\n      \n      console.log('Recording paused');\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * æ¢å¾©éŒ„éŸ³\n   * @returns {Promise<void>}\n   */\n  async resumeRecording() {\n    try {\n      if (!this.isRecording || !this.isPaused) {\n        throw new Error('Cannot resume');\n      }\n      \n      this.isPaused = false;\n      this.options.callbacks.onRecordResume();\n      \n      console.log('Recording resumed');\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * æ’­æ”¾éŒ„éŸ³\n   * @returns {Promise<void>}\n   */\n  async play() {\n    try {\n      // TODO: å¯¦ä½œæ’­æ”¾é‚è¼¯\n      this.options.callbacks.onPlayStart();\n      \n      console.log('Playback started');\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åœæ­¢æ’­æ”¾\n   * @returns {Promise<void>}\n   */\n  async stop() {\n    try {\n      // TODO: å¯¦ä½œåœæ­¢æ’­æ”¾é‚è¼¯\n      this.options.callbacks.onPlayStop();\n      \n      console.log('Playback stopped');\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * å„²å­˜éŒ„éŸ³\n   * @param {Blob} blob - éŸ³è¨Š Blobï¼ˆå¯é¸ï¼Œä½¿ç”¨ç•¶å‰éŒ„éŸ³ï¼‰\n   * @param {string} filename - æª”æ¡ˆåç¨±ï¼ˆå¯é¸ï¼Œè‡ªå‹•ç”Ÿæˆï¼‰\n   * @param {Object} metadata - å…ƒæ•¸æ“šï¼ˆå¯é¸ï¼‰\n   * @returns {Promise<string>} æª”æ¡ˆ ID\n   */\n  async saveRecording(blob = null, filename = null, metadata = {}) {\n    try {\n      const blobToSave = blob || this.currentBlob;\n      \n      if (!blobToSave) {\n        throw new Error('No recording to save');\n      }\n      \n      const filenameToUse = filename || `recording-${Date.now()}.wav`;\n      \n      const id = await this.storage.save(blobToSave, filenameToUse, metadata);\n      \n      console.log('Recording saved:', id);\n      return id;\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * è¼‰å…¥éŒ„éŸ³\n   * @param {string} id - æª”æ¡ˆ ID\n   * @returns {Promise<Blob>}\n   */\n  async loadRecording(id) {\n    try {\n      const blob = await this.storage.load(id);\n      this.currentBlob = blob;\n      \n      console.log('Recording loaded:', id);\n      return blob;\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆªé™¤éŒ„éŸ³\n   * @param {string} id - æª”æ¡ˆ ID\n   * @returns {Promise<boolean>}\n   */\n  async deleteRecording(id) {\n    try {\n      const result = await this.storage.delete(id);\n      \n      console.log('Recording deleted:', id);\n      return result;\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆ—å‡ºæ‰€æœ‰éŒ„éŸ³\n   * @returns {Promise<Array>}\n   */\n  async listRecordings() {\n    try {\n      const recordings = await this.storage.list();\n      \n      console.log('Recordings listed:', recordings.length);\n      return recordings;\n    } catch (error) {\n      this.options.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * å–å¾—ç•¶å‰éŒ„éŸ³ Blob\n   * @returns {Blob|null}\n   */\n  getCurrentBlob() {\n    return this.currentBlob;\n  }\n  \n  /**\n   * éŠ·æ¯€å¯¦ä¾‹\n   */\n  destroy() {\n    // TODO: æ¸…ç†è³‡æº\n    this.isRecording = false;\n    this.isPaused = false;\n    this.currentBlob = null;\n    \n    if (this.storage && typeof this.storage.close === 'function') {\n      this.storage.close();\n    }\n    \n    console.log('VoiceBankRecorder destroyed');\n  }\n}\n\n// é è¨­å°å‡º\nexport default VoiceBankRecorder;\n\n/**\n * ç‰ˆæœ¬è³‡è¨Š\n */\nexport const VERSION = '1.0.0';\n\n/**\n * å»ºç½®è³‡è¨Š\n */\nexport const BUILD_INFO = {\n  version: VERSION,\n  date: new Date().toISOString(),\n  name: 'VoiceBank Recorder'\n};\n","import DeviceManager from './DeviceManager.js';\n\n/**\n * AudioEngine - è·¨å¹³å°éŸ³è¨ŠéŒ„éŸ³å¼•æ“\n * \n * åŠŸèƒ½ï¼š\n * - å°è£ Web Audio API (AudioContext, AudioWorklet)\n * - æ”¯æ´ RecordRTC éŒ„éŸ³ (WAV æ ¼å¼)\n * - è‡ªå‹•è™•ç† AudioWorklet èˆ‡ ScriptProcessor fallback\n * - æä¾›éŒ„éŸ³æ§åˆ¶ (é–‹å§‹/åœæ­¢/æš«åœ/ç¹¼çºŒ)\n * - äº‹ä»¶é©…å‹•æ¶æ§‹ (recording-start, data-available, recording-stop ç­‰)\n * - éº¥å…‹é¢¨è¼¸å…¥ç®¡ç†èˆ‡å‰ç´šå¢ç›Šæ§åˆ¶\n * - æ•´åˆè£ç½®ç®¡ç† (DeviceManager)\n * \n * @example\n * const engine = new AudioEngine({\n *   sampleRate: 48000,\n *   autoGainControl: false,\n *   micGain: 1.0\n * });\n * \n * engine.on('recording-start', () => console.log('Started'));\n * engine.on('data-available', (pcmData) => console.log('PCM chunk', pcmData));\n * engine.on('recording-stop', (blob) => console.log('Finished', blob));\n * \n * await engine.initialize();\n * await engine.startRecording();\n * // ... éŒ„éŸ³ä¸­ ...\n * await engine.stopRecording();\n */\n\nexport class AudioEngine {\n    /**\n     * å‰µå»º AudioEngine å¯¦ä¾‹\n     * @param {Object} options - é…ç½®é¸é …\n     * @param {number} [options.sampleRate=48000] - æ¡æ¨£ç‡\n     * @param {boolean} [options.autoGainControl=false] - è‡ªå‹•å¢ç›Šæ§åˆ¶\n     * @param {boolean} [options.echoCancellation=false] - å›éŸ³æ¶ˆé™¤\n     * @param {boolean} [options.noiseSuppression=false] - å™ªéŸ³æŠ‘åˆ¶\n     * @param {number} [options.micGain=1.0] - å‰ç´šå¢ç›Š (1.0-6.0)\n     * @param {string} [options.deviceId] - éº¥å…‹é¢¨è¨­å‚™ ID\n     * @param {string} [options.workletPath='assets/js/worklet/pcm-collector.js'] - AudioWorklet æ¨¡çµ„è·¯å¾‘\n     * @param {boolean} [options.preferWorklet=true] - å„ªå…ˆä½¿ç”¨ AudioWorkletï¼ˆæ”¯æ´æ™‚ï¼‰\n     * @param {DeviceManager} [options.deviceManager] - å¤–éƒ¨æä¾›çš„ DeviceManager å¯¦ä¾‹ï¼ˆå¯é¸ï¼‰\n     * @param {boolean} [options.autoManageDevices=true] - æ˜¯å¦è‡ªå‹•å‰µå»ºå’Œç®¡ç† DeviceManager\n     */\n    constructor(options = {}) {\n        // é…ç½®é¸é …\n        this.config = {\n            sampleRate: options.sampleRate || 48000,\n            autoGainControl: options.autoGainControl !== undefined ? options.autoGainControl : false,\n            echoCancellation: options.echoCancellation !== undefined ? options.echoCancellation : false,\n            noiseSuppression: options.noiseSuppression !== undefined ? options.noiseSuppression : false,\n            micGain: options.micGain || 1.0,\n            deviceId: options.deviceId || null,\n            workletPath: options.workletPath || 'assets/js/worklet/pcm-collector.js',\n            preferWorklet: options.preferWorklet !== undefined ? options.preferWorklet : true,\n            autoManageDevices: options.autoManageDevices !== undefined ? options.autoManageDevices : true\n        };\n        \n        // è£ç½®ç®¡ç†å™¨\n        if (options.deviceManager) {\n            this.deviceManager = options.deviceManager;\n            this._ownDeviceManager = false;\n        } else if (this.config.autoManageDevices) {\n            this.deviceManager = new DeviceManager();\n            this._ownDeviceManager = true;\n        } else {\n            this.deviceManager = null;\n            this._ownDeviceManager = false;\n        }\n\n        // Web Audio API ç‰©ä»¶\n        this.audioContext = null;\n        this.analyser = null;\n        this.preGainNode = null;\n        this.mediaDest = null;\n        this.analyserSilencer = null;\n\n        // AudioWorklet ç›¸é—œ\n        this.workletSupported = false;\n        this.workletLoaded = false;\n        this.pcmCollectorNode = null;\n        this.usingWorklet = false;\n\n        // PCM æ•¸æ“šæ”¶é›† (AudioWorklet æ¨¡å¼)\n        this.pcmChunks = [];\n        this.pcmTotalSamples = 0;\n\n        // RecordRTC éŒ„éŸ³å™¨\n        this.recorder = null;\n        \n        // RecordRTC æ¨¡å¼ PCM æ¡é›†\n        this._pcmCaptureInterval = null;\n\n        // éº¥å…‹é¢¨ä¸²æµ\n        this.micStream = null;\n\n        // éŒ„éŸ³ç‹€æ…‹\n        this.isRecording = false;\n        this.isPaused = false;\n        this.isInitialized = false;\n\n        // æ™‚é–“æˆ³è¨˜\n        this.recordStartTime = 0;\n        this.recordStopTime = 0;\n        this.recordWallStartMs = 0;\n        this.recordWallStopMs = 0;\n\n        // æœ€å¾Œçš„éŒ„éŸ³çµæœ\n        this.latestBlob = null;\n        this.latestUrl = null;\n\n        // äº‹ä»¶ç›£è½å™¨\n        this._eventListeners = {};\n    }\n\n    /**\n     * åˆå§‹åŒ–éŸ³è¨Šå¼•æ“\n     * å‰µå»º AudioContextã€Analyserã€Gain ç¯€é»ç­‰\n     * @returns {Promise<void>}\n     */\n    async initialize() {\n        if (this.isInitialized) {\n            return;\n        }\n\n        try {\n            // å‰µå»º AudioContext\n            const AudioContextClass = window.AudioContext || window.webkitAudioContext;\n            this.audioContext = new AudioContextClass({ sampleRate: this.config.sampleRate });\n\n            // å‰µå»ºåˆ†æå™¨ç¯€é»\n            this.analyser = this.audioContext.createAnalyser();\n            this.analyser.fftSize = 256;\n\n            // å‰µå»ºå‰ç´šå¢ç›Šç¯€é»\n            this.preGainNode = this.audioContext.createGain();\n            this.preGainNode.gain.value = this.config.micGain;\n\n            // å‰µå»º MediaStreamDestinationï¼ˆä¾› RecordRTC ä½¿ç”¨ï¼‰\n            this.mediaDest = this.audioContext.createMediaStreamDestination();\n\n            // é€£æ¥ç¯€é»ï¼špreGain -> analyser -> silencer -> destination\n            this.preGainNode.connect(this.analyser);\n            this.preGainNode.connect(this.mediaDest);\n\n            // å‰µå»ºéœéŸ³ç¯€é»ï¼ˆé¿å…å›æˆï¼‰\n            this.analyserSilencer = this.audioContext.createGain();\n            this.analyserSilencer.gain.value = 0;\n            this.analyser.connect(this.analyserSilencer);\n            this.analyserSilencer.connect(this.audioContext.destination);\n\n            // æª¢æ¸¬ AudioWorklet æ”¯æ´\n            this.workletSupported = !!(\n                this.audioContext.audioWorklet && \n                window.AudioWorkletNode\n            );\n\n            // è¼‰å…¥ AudioWorklet æ¨¡çµ„ï¼ˆå¦‚æœæ”¯æ´ä¸”åå¥½ä½¿ç”¨ï¼‰\n            if (this.workletSupported && this.config.preferWorklet) {\n                try {\n                    await this.audioContext.audioWorklet.addModule(this.config.workletPath);\n                    this.workletLoaded = true;\n                    this._emit('worklet-loaded', { path: this.config.workletPath });\n                } catch (error) {\n                    console.warn('è¼‰å…¥ AudioWorklet æ¨¡çµ„å¤±æ•—ï¼Œå°‡å›é€€åˆ° RecordRTC:', error);\n                    this.workletLoaded = false;\n                    this._emit('worklet-load-failed', { error });\n                }\n            }\n\n            // æ¢å¾© AudioContextï¼ˆå¦‚æœæš«åœï¼‰\n            if (this.audioContext.state === 'suspended') {\n                await this.audioContext.resume();\n            }\n\n            this.isInitialized = true;\n            this._emit('initialized', {\n                sampleRate: this.audioContext.sampleRate,\n                state: this.audioContext.state,\n                workletSupported: this.workletSupported,\n                workletLoaded: this.workletLoaded\n            });\n\n        } catch (error) {\n            this._emit('error', { stage: 'initialize', error });\n            throw error;\n        }\n    }\n\n    /**\n     * é–‹å§‹éŒ„éŸ³\n     * @returns {Promise<void>}\n     */\n    async startRecording() {\n        if (!this.isInitialized) {\n            throw new Error('AudioEngine å°šæœªåˆå§‹åŒ–ï¼Œè«‹å…ˆèª¿ç”¨ initialize()');\n        }\n\n        if (this.isRecording) {\n            throw new Error('å·²ç¶“åœ¨éŒ„éŸ³ä¸­');\n        }\n\n        try {\n            // ç¢ºä¿ AudioContext æ˜¯æ´»èºç‹€æ…‹\n            if (this.audioContext.state === 'suspended') {\n                await this.audioContext.resume();\n            }\n\n            // åœæ­¢èˆŠçš„éº¥å…‹é¢¨ä¸²æµï¼ˆå¦‚æœå­˜åœ¨ï¼‰\n            this._stopMicrophone();\n\n            // ç²å–éº¥å…‹é¢¨ï¼ˆæœƒä½¿ç”¨ DeviceManager é¸æ“‡çš„è£ç½®ï¼‰\n            await this._captureMicrophone();\n\n            // é‡ç½® PCM æ•¸æ“šæ”¶é›†\n            this.pcmChunks = [];\n            this.pcmTotalSamples = 0;\n\n            // æ¸…ç†èˆŠçš„éŒ„éŸ³çµæœ\n            if (this.latestUrl) {\n                URL.revokeObjectURL(this.latestUrl);\n                this.latestUrl = null;\n            }\n            this.latestBlob = null;\n\n            // è¨˜éŒ„é–‹å§‹æ™‚é–“\n            this.recordStartTime = Date.now();\n            this.recordWallStartMs = performance.now();\n            this.recordStopTime = 0;\n            this.recordWallStopMs = 0;\n\n            // æ±ºå®šä½¿ç”¨ AudioWorklet æˆ– RecordRTC\n            const useWorklet = this.workletLoaded && this.config.preferWorklet;\n\n            if (useWorklet) {\n                await this._startWorkletRecording();\n            } else {\n                await this._startRecordRTCRecording();\n            }\n\n            this.isRecording = true;\n            this.isPaused = false;\n\n            this._emit('recording-start', {\n                timestamp: this.recordStartTime,\n                mode: useWorklet ? 'worklet' : 'recordrtc',\n                sampleRate: this.audioContext.sampleRate\n            });\n\n        } catch (error) {\n            this._emit('error', { stage: 'start-recording', error });\n            throw error;\n        }\n    }\n\n    /**\n     * åœæ­¢éŒ„éŸ³\n     * @returns {Promise<Blob>} éŒ„éŸ³çš„ Blob\n     */\n    async stopRecording() {\n        if (!this.isRecording) {\n            throw new Error('ç›®å‰æ²’æœ‰åœ¨éŒ„éŸ³');\n        }\n\n        try {\n            this.isRecording = false;\n            this.recordStopTime = Date.now();\n            this.recordWallStopMs = performance.now();\n\n            let blob;\n\n            if (this.usingWorklet) {\n                blob = await this._stopWorkletRecording();\n            } else if (this.recorder) {\n                blob = await this._stopRecordRTCRecording();\n            } else {\n                throw new Error('æ²’æœ‰å¯ç”¨çš„éŒ„éŸ³å™¨');\n            }\n\n            // åœæ­¢éº¥å…‹é¢¨\n            this._stopMicrophone();\n\n            // å„²å­˜çµæœ\n            this.latestBlob = blob;\n            this.latestUrl = URL.createObjectURL(blob);\n\n            const duration = (this.recordStopTime - this.recordStartTime) / 1000;\n\n            this._emit('recording-stop', {\n                blob,\n                url: this.latestUrl,\n                duration,\n                samples: this.pcmTotalSamples,\n                sampleRate: this.audioContext.sampleRate\n            });\n\n            return blob;\n\n        } catch (error) {\n            this._emit('error', { stage: 'stop-recording', error });\n            throw error;\n        }\n    }\n\n    /**\n     * æš«åœéŒ„éŸ³ï¼ˆåƒ… RecordRTC æ¨¡å¼æ”¯æ´ï¼‰\n     */\n    pauseRecording() {\n        if (!this.isRecording) {\n            throw new Error('ç›®å‰æ²’æœ‰åœ¨éŒ„éŸ³');\n        }\n\n        if (this.usingWorklet) {\n            throw new Error('AudioWorklet æ¨¡å¼ä¸æ”¯æ´æš«åœåŠŸèƒ½');\n        }\n\n        if (this.recorder && typeof this.recorder.pauseRecording === 'function') {\n            this.recorder.pauseRecording();\n            this.isPaused = true;\n            this._emit('recording-paused', { timestamp: Date.now() });\n        } else {\n            throw new Error('æš«åœåŠŸèƒ½ä¸å¯ç”¨');\n        }\n    }\n\n    /**\n     * ç¹¼çºŒéŒ„éŸ³ï¼ˆåƒ… RecordRTC æ¨¡å¼æ”¯æ´ï¼‰\n     */\n    resumeRecording() {\n        if (!this.isPaused) {\n            throw new Error('éŒ„éŸ³æ²’æœ‰æš«åœ');\n        }\n\n        if (this.recorder && typeof this.recorder.resumeRecording === 'function') {\n            this.recorder.resumeRecording();\n            this.isPaused = false;\n            this._emit('recording-resumed', { timestamp: Date.now() });\n        } else {\n            throw new Error('ç¹¼çºŒéŒ„éŸ³åŠŸèƒ½ä¸å¯ç”¨');\n        }\n    }\n\n    /**\n     * å–å¾—æœ€æ–°çš„éŒ„éŸ³æ•¸æ“š\n     * @returns {Object} { blob, url, duration, samples }\n     */\n    getLatestRecording() {\n        return {\n            blob: this.latestBlob,\n            url: this.latestUrl,\n            duration: this.latestBlob ? (this.recordStopTime - this.recordStartTime) / 1000 : 0,\n            samples: this.pcmTotalSamples,\n            sampleRate: this.audioContext ? this.audioContext.sampleRate : 0\n        };\n    }\n\n    /**\n     * å–å¾— PCM æ•¸æ“šè¦–çª—ï¼ˆåƒ… AudioWorklet æ¨¡å¼ï¼‰\n     * @param {number} start - èµ·å§‹æ¨£æœ¬ç´¢å¼•\n     * @param {number} count - æ¨£æœ¬æ•¸é‡\n     * @returns {Float32Array|null}\n     */\n    getPcmWindow(start, count) {\n        if (!this.usingWorklet || !this.pcmChunks.length) {\n            return null;\n        }\n\n        if (start < 0) start = 0;\n        const total = this.pcmTotalSamples;\n        if (start >= total) return new Float32Array(0);\n\n        const end = Math.min(total, start + count);\n        const out = new Float32Array(end - start);\n        let offset = 0;\n        let passed = 0;\n\n        for (let i = 0; i < this.pcmChunks.length && passed < end; i++) {\n            const chunk = this.pcmChunks[i];\n            if (!chunk || !chunk.length) continue;\n\n            const cLen = chunk.length;\n            const cStart = passed;\n            const cEnd = passed + cLen;\n\n            if (cEnd <= start) {\n                passed = cEnd;\n                continue;\n            }\n\n            const segStart = Math.max(start, cStart);\n            const segEnd = Math.min(end, cEnd);\n\n            if (segEnd > segStart) {\n                const localStart = segStart - cStart;\n                const slice = chunk.subarray(localStart, localStart + (segEnd - segStart));\n                out.set(slice, offset);\n                offset += slice.length;\n            }\n\n            passed = cEnd;\n            if (segEnd >= end) break;\n        }\n\n        return out;\n    }\n\n    /**\n     * å–å¾— Analyser ç¯€é»ï¼ˆä¾›å¤–éƒ¨æ³¢å½¢é¡¯ç¤ºä½¿ç”¨ï¼‰\n     * @returns {AnalyserNode|null}\n     */\n    getAnalyser() {\n        return this.analyser;\n    }\n\n    /**\n     * å–å¾— AudioContext\n     * @returns {AudioContext|null}\n     */\n    getAudioContext() {\n        return this.audioContext;\n    }\n\n    /**\n     * å–å¾—éº¥å…‹é¢¨åª’é«”æµ\n     * @returns {MediaStream|null}\n     */\n    get microphoneStream() {\n        return this.micStream;\n    }\n\n    /**\n     * è¨­å®šå‰ç´šå¢ç›Š\n     * @param {number} gain - å¢ç›Šå€¼ (1.0-6.0)\n     */\n    setMicGain(gain) {\n        gain = Math.max(1.0, Math.min(6.0, gain));\n        this.config.micGain = gain;\n\n        if (this.preGainNode) {\n            this.preGainNode.gain.value = gain;\n        }\n\n        this._emit('mic-gain-changed', { gain });\n    }\n\n    /**\n     * é‡‹æ”¾è³‡æº\n     */\n    dispose() {\n        if (this.isRecording) {\n            this.stopRecording().catch(console.error);\n        }\n\n        this._stopMicrophone();\n        this._stopPcmCapture();\n\n        if (this.latestUrl) {\n            URL.revokeObjectURL(this.latestUrl);\n            this.latestUrl = null;\n        }\n\n        if (this.audioContext) {\n            this.audioContext.close().catch(console.error);\n            this.audioContext = null;\n        }\n\n        this.analyser = null;\n        this.preGainNode = null;\n        this.mediaDest = null;\n        this.analyserSilencer = null;\n        this.pcmCollectorNode = null;\n        this.recorder = null;\n\n        this.pcmChunks = [];\n        this.pcmTotalSamples = 0;\n\n        this.isInitialized = false;\n\n        this._emit('disposed');\n    }\n\n    // ============================================================\n    // äº‹ä»¶ç³»çµ±\n    // ============================================================\n\n    /**\n     * è¨»å†Šäº‹ä»¶ç›£è½å™¨\n     * @param {string} event - äº‹ä»¶åç¨±\n     * @param {Function} handler - è™•ç†å‡½æ•¸\n     */\n    on(event, handler) {\n        if (!this._eventListeners[event]) {\n            this._eventListeners[event] = [];\n        }\n        this._eventListeners[event].push(handler);\n    }\n\n    /**\n     * ç§»é™¤äº‹ä»¶ç›£è½å™¨\n     * @param {string} event - äº‹ä»¶åç¨±\n     * @param {Function} handler - è™•ç†å‡½æ•¸\n     */\n    off(event, handler) {\n        if (!this._eventListeners[event]) return;\n\n        const index = this._eventListeners[event].indexOf(handler);\n        if (index > -1) {\n            this._eventListeners[event].splice(index, 1);\n        }\n    }\n\n    /**\n     * è§¸ç™¼äº‹ä»¶ï¼ˆå…§éƒ¨ä½¿ç”¨ï¼‰\n     * @private\n     */\n    _emit(event, data) {\n        if (!this._eventListeners[event]) return;\n\n        this._eventListeners[event].forEach(handler => {\n            try {\n                handler(data);\n            } catch (error) {\n                console.error(`äº‹ä»¶è™•ç†å™¨éŒ¯èª¤ [${event}]:`, error);\n            }\n        });\n    }\n\n    // ============================================================\n    // ç§æœ‰æ–¹æ³• - éº¥å…‹é¢¨æ•ç²\n    // ============================================================\n\n    async _captureMicrophone() {\n        let constraints;\n        \n        // å¦‚æœæœ‰ DeviceManagerï¼Œä½¿ç”¨å®ƒä¾†å»ºç«‹ç´„æŸæ¢ä»¶\n        if (this.deviceManager) {\n            constraints = this.deviceManager.getMicrophoneConstraints({\n                echoCancellation: this.config.echoCancellation,\n                noiseSuppression: this.config.noiseSuppression,\n                autoGainControl: this.config.autoGainControl\n            });\n            \n            // è¨˜éŒ„é¸æ“‡çš„è£ç½®\n            const selectedId = this.deviceManager.getSelectedMicrophoneId();\n            console.log('[AudioEngine] ä½¿ç”¨ DeviceManager é¸æ“‡çš„éº¥å…‹é¢¨:', selectedId);\n            console.log('[AudioEngine] ç´„æŸæ¢ä»¶:', JSON.stringify(constraints, null, 2));\n        } else {\n            // å‚³çµ±æ¨¡å¼ï¼šæ‰‹å‹•å»ºç«‹ç´„æŸæ¢ä»¶\n            constraints = {\n                audio: {\n                    echoCancellation: this.config.echoCancellation,\n                    noiseSuppression: this.config.noiseSuppression,\n                    autoGainControl: this.config.autoGainControl\n                },\n                video: false\n            };\n\n            // åŠ å…¥è¨­å‚™ ID é™åˆ¶ï¼ˆå¦‚æœæœ‰æŒ‡å®šï¼‰\n            if (this.config.deviceId) {\n                constraints.audio.deviceId = { exact: this.config.deviceId };\n            }\n            \n            console.log('[AudioEngine] ä½¿ç”¨å‚³çµ±æ¨¡å¼ï¼Œç´„æŸæ¢ä»¶:', JSON.stringify(constraints, null, 2));\n        }\n\n        try {\n            this.micStream = await navigator.mediaDevices.getUserMedia(constraints);\n\n            // iOS è‡ªå‹•å¢ç›Šèª¿æ•´\n            this._applyIOSMicGainAdjustment();\n\n            // é€£æ¥éº¥å…‹é¢¨åˆ°å‰ç´šå¢ç›Šç¯€é»\n            const source = this.audioContext.createMediaStreamSource(this.micStream);\n            source.connect(this.preGainNode);\n\n            const usedDeviceId = this.deviceManager ? \n                this.deviceManager.getSelectedMicrophoneId() : \n                this.config.deviceId;\n            \n            // å–å¾—å¯¦éš›ä½¿ç”¨çš„è£ç½®è³‡è¨Š\n            const audioTracks = this.micStream.getAudioTracks();\n            if (audioTracks.length > 0) {\n                const actualDevice = audioTracks[0].label;\n                console.log('[AudioEngine] å¯¦éš›ä½¿ç”¨çš„éº¥å…‹é¢¨:', actualDevice);\n            }\n\n            this._emit('microphone-captured', {\n                deviceId: usedDeviceId,\n                constraints\n            });\n\n        } catch (error) {\n            // å¦‚æœæŒ‡å®šè¨­å‚™å¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨é è¨­è¨­å‚™\n            if (error.name === 'OverconstrainedError' || error.name === 'NotFoundError') {\n                console.warn('æŒ‡å®šçš„éº¥å…‹é¢¨ç„¡æ³•ä½¿ç”¨ï¼Œå˜—è©¦é è¨­è¨­å‚™');\n\n                delete constraints.audio.deviceId;\n                this.micStream = await navigator.mediaDevices.getUserMedia(constraints);\n\n                this._applyIOSMicGainAdjustment();\n\n                const source = this.audioContext.createMediaStreamSource(this.micStream);\n                source.connect(this.preGainNode);\n\n                this._emit('microphone-captured-fallback', { constraints });\n            } else {\n                throw error;\n            }\n        }\n    }\n\n    _stopMicrophone() {\n        if (this.micStream) {\n            this.micStream.getTracks().forEach(track => {\n                try {\n                    track.stop();\n                } catch (error) {\n                    console.warn('åœæ­¢éº¥å…‹é¢¨è»Œé“å¤±æ•—:', error);\n                }\n            });\n            this.micStream = null;\n        }\n    }\n\n    _applyIOSMicGainAdjustment() {\n        // iOS ä¸Š AGC é—œé–‰æ™‚éŸ³é‡åä½ï¼Œè‡ªå‹•æå‡å¢ç›Š\n        try {\n            const ua = navigator.userAgent || '';\n            const isIOS = /iphone|ipad|ipod/i.test(ua);\n\n            if (isIOS && !this.config.autoGainControl) {\n                if (Math.abs(this.config.micGain - 1.0) < 0.0001) {\n                    this.setMicGain(3.5);\n                    this._emit('ios-gain-adjusted', { gain: 3.5 });\n                }\n            }\n        } catch (error) {\n            console.warn('iOS å¢ç›Šèª¿æ•´å¤±æ•—:', error);\n        }\n    }\n\n    // ============================================================\n    // ç§æœ‰æ–¹æ³• - AudioWorklet éŒ„éŸ³\n    // ============================================================\n\n    async _startWorkletRecording() {\n        try {\n            // å‰µå»º AudioWorkletNode\n            this.pcmCollectorNode = new AudioWorkletNode(\n                this.audioContext,\n                'pcm-collector-processor'\n            );\n\n            // ç›£è½ PCM æ•¸æ“š\n            this.pcmCollectorNode.port.onmessage = (event) => {\n                const { type, pcmData } = event.data;\n\n                if (type === 'pcm-data' && pcmData) {\n                    this.pcmChunks.push(new Float32Array(pcmData));\n                    this.pcmTotalSamples += pcmData.length;\n\n                    this._emit('data-available', {\n                        pcmData: new Float32Array(pcmData),\n                        totalSamples: this.pcmTotalSamples,\n                        mode: 'worklet'\n                    });\n                }\n            };\n\n            // é€£æ¥ç¯€é»ï¼špreGain -> pcmCollector -> analyser\n            this.preGainNode.connect(this.pcmCollectorNode);\n            this.pcmCollectorNode.connect(this.audioContext.destination);\n\n            this.usingWorklet = true;\n\n        } catch (error) {\n            console.error('AudioWorklet å•Ÿå‹•å¤±æ•—ï¼Œå›é€€åˆ° RecordRTC:', error);\n            this.usingWorklet = false;\n            await this._startRecordRTCRecording();\n        }\n    }\n\n    async _stopWorkletRecording() {\n        try {\n            // æ–·é–‹ AudioWorkletNode\n            if (this.pcmCollectorNode) {\n                this.pcmCollectorNode.port.onmessage = null;\n                this.preGainNode.disconnect(this.pcmCollectorNode);\n                this.pcmCollectorNode.disconnect();\n                this.pcmCollectorNode = null;\n            }\n\n            // åˆä½µ PCM æ•¸æ“šä¸¦è½‰æ›ç‚º WAV\n            if (this.pcmChunks.length === 0) {\n                throw new Error('æ²’æœ‰éŒ„éŸ³æ•¸æ“š');\n            }\n\n            const merged = new Float32Array(this.pcmTotalSamples);\n            let offset = 0;\n\n            for (const chunk of this.pcmChunks) {\n                merged.set(chunk, offset);\n                offset += chunk.length;\n            }\n\n            // è½‰æ›ç‚º 16-bit PCM WAV\n            const wavBuffer = this._buildWavFromFloat32Mono(\n                merged,\n                this.audioContext.sampleRate\n            );\n\n            const blob = new Blob([wavBuffer], { type: 'audio/wav' });\n\n            this.usingWorklet = false;\n\n            return blob;\n\n        } catch (error) {\n            console.error('AudioWorklet åœæ­¢å¤±æ•—:', error);\n            throw error;\n        }\n    }\n\n    // ============================================================\n    // ç§æœ‰æ–¹æ³• - RecordRTC éŒ„éŸ³\n    // ============================================================\n\n    async _startRecordRTCRecording() {\n        return new Promise((resolve, reject) => {\n            try {\n                // æª¢æŸ¥ RecordRTC æ˜¯å¦å¯ç”¨\n                if (typeof RecordRTC === 'undefined') {\n                    reject(new Error('RecordRTC æœªè¼‰å…¥'));\n                    return;\n                }\n\n                const recordStream = this.mediaDest.stream || this.micStream;\n\n                this.recorder = RecordRTC(recordStream, {\n                    type: 'audio',\n                    mimeType: 'audio/wav',\n                    recorderType: StereoAudioRecorder,\n                    numberOfAudioChannels: 1,\n                    bufferSize: 4096,\n                    timeSlice: 100,\n                    ondataavailable: (blob) => {\n                        this._emit('data-available', {\n                            blob,\n                            mode: 'recordrtc'\n                        });\n                    }\n                });\n\n                this.recorder.startRecording();\n                this.usingWorklet = false;\n\n                // å•Ÿå‹• PCM æ•¸æ“šæ¡é›†å¾ªç’°ï¼ˆç”¨æ–¼ç´¯ç©æ³¢å½¢ï¼‰\n                this._startPcmCapture();\n\n                resolve();\n\n            } catch (error) {\n                reject(error);\n            }\n        });\n    }\n\n    async _stopRecordRTCRecording() {\n        return new Promise((resolve, reject) => {\n            try {\n                if (!this.recorder) {\n                    reject(new Error('RecordRTC éŒ„éŸ³å™¨ä¸å­˜åœ¨'));\n                    return;\n                }\n\n                // åœæ­¢ PCM æ•¸æ“šæ¡é›†å¾ªç’°\n                this._stopPcmCapture();\n\n                this.recorder.stopRecording(() => {\n                    try {\n                        const blob = this.recorder.getBlob();\n\n                        // æ¸…ç†éŒ„éŸ³å™¨\n                        this.recorder = null;\n\n                        resolve(blob);\n                    } catch (error) {\n                        reject(error);\n                    }\n                });\n\n            } catch (error) {\n                reject(error);\n            }\n        });\n    }\n\n    /**\n     * å•Ÿå‹• PCM æ•¸æ“šæ¡é›†ï¼ˆRecordRTC æ¨¡å¼ä½¿ç”¨ï¼‰\n     * @private\n     */\n    _startPcmCapture() {\n        if (!this.analyser) return;\n\n        const bufferLength = this.analyser.fftSize;\n        const dataArray = new Float32Array(bufferLength);\n        \n        // æ¯ 100ms æ¡é›†ä¸€æ¬¡ PCM æ•¸æ“š\n        this._pcmCaptureInterval = setInterval(() => {\n            if (!this.isRecording || !this.analyser) {\n                return;\n            }\n\n            // å¾ AnalyserNode è®€å–æ™‚åŸŸæ•¸æ“š\n            this.analyser.getFloatTimeDomainData(dataArray);\n            \n            // è¤‡è£½æ•¸æ“šä»¥é¿å…è¢«è¦†è“‹\n            const pcmChunk = new Float32Array(dataArray);\n            \n            // å„²å­˜åˆ° pcmChunks\n            this.pcmChunks.push(pcmChunk);\n            this.pcmTotalSamples += pcmChunk.length;\n\n            // ç™¼é€äº‹ä»¶çµ¦ WaveformRenderer\n            this._emit('data-available', {\n                pcmData: pcmChunk,\n                totalSamples: this.pcmTotalSamples,\n                mode: 'recordrtc-pcm'\n            });\n        }, 100);\n    }\n\n    /**\n     * åœæ­¢ PCM æ•¸æ“šæ¡é›†\n     * @private\n     */\n    _stopPcmCapture() {\n        if (this._pcmCaptureInterval) {\n            clearInterval(this._pcmCaptureInterval);\n            this._pcmCaptureInterval = null;\n        }\n    }\n\n    // ============================================================\n    // ç§æœ‰æ–¹æ³• - WAV æ ¼å¼è½‰æ›\n    // ============================================================\n\n    _buildWavFromFloat32Mono(float32Data, sampleRate) {\n        const numSamples = float32Data.length;\n        const buffer = new ArrayBuffer(44 + numSamples * 2);\n        const view = new DataView(buffer);\n\n        // WAV Header\n        this._writeString(view, 0, 'RIFF');\n        view.setUint32(4, 36 + numSamples * 2, true);\n        this._writeString(view, 8, 'WAVE');\n        this._writeString(view, 12, 'fmt ');\n        view.setUint32(16, 16, true); // fmt chunk size\n        view.setUint16(20, 1, true);  // audio format (PCM)\n        view.setUint16(22, 1, true);  // number of channels\n        view.setUint32(24, sampleRate, true);\n        view.setUint32(28, sampleRate * 2, true); // byte rate\n        view.setUint16(32, 2, true);  // block align\n        view.setUint16(34, 16, true); // bits per sample\n        this._writeString(view, 36, 'data');\n        view.setUint32(40, numSamples * 2, true);\n\n        // PCM Data (float32 -> int16)\n        let offset = 44;\n        for (let i = 0; i < numSamples; i++) {\n            const sample = Math.max(-1, Math.min(1, float32Data[i]));\n            const int16 = sample < 0 ? sample * 0x8000 : sample * 0x7FFF;\n            view.setInt16(offset, int16, true);\n            offset += 2;\n        }\n\n        return buffer;\n    }\n\n    _writeString(view, offset, string) {\n        for (let i = 0; i < string.length; i++) {\n            view.setUint8(offset + i, string.charCodeAt(i));\n        }\n    }\n    \n    /**\n     * éŠ·æ¯€ AudioEngineï¼Œé‡‹æ”¾æ‰€æœ‰è³‡æº\n     */\n    destroy() {\n        // åœæ­¢éŒ„éŸ³ï¼ˆå¦‚æœæ­£åœ¨éŒ„éŸ³ï¼‰\n        if (this.isRecording) {\n            this.stopRecording().catch(err => {\n                console.warn('åœæ­¢éŒ„éŸ³å¤±æ•—:', err);\n            });\n        }\n        \n        // åœæ­¢éº¥å…‹é¢¨\n        this._stopMicrophone();\n        \n        // åœæ­¢ PCM æ¡é›†\n        this._stopPcmCapture();\n        \n        // æ¸…ç† AudioWorklet\n        if (this.pcmCollectorNode) {\n            this.pcmCollectorNode.disconnect();\n            this.pcmCollectorNode = null;\n        }\n        \n        // é—œé–‰ AudioContext\n        if (this.audioContext) {\n            this.audioContext.close().catch(err => {\n                console.warn('é—œé–‰ AudioContext å¤±æ•—:', err);\n            });\n            this.audioContext = null;\n        }\n        \n        // æ¸…ç† DeviceManagerï¼ˆå¦‚æœæ˜¯è‡ªå·±å‰µå»ºçš„ï¼‰\n        if (this._ownDeviceManager && this.deviceManager) {\n            this.deviceManager.destroy();\n            this.deviceManager = null;\n        }\n        \n        // æ¸…ç†äº‹ä»¶ç›£è½å™¨\n        this._eventListeners = {};\n        \n        // é‡ç½®ç‹€æ…‹\n        this.isInitialized = false;\n        this.isRecording = false;\n    }\n}\n\nexport default AudioEngine;\n","/**\n * CapacitorAdapter - Capacitor æª”æ¡ˆç³»çµ±å„²å­˜é©é…å™¨\n * ä½¿ç”¨ Capacitor Filesystem Plugin åœ¨ç§»å‹•è£ç½®ä¸Šå„²å­˜æª”æ¡ˆ\n */\n\nimport { StorageAdapter } from './StorageAdapter.js';\n\nexport class CapacitorAdapter extends StorageAdapter {\n  /**\n   * å»ºæ§‹å‡½æ•¸\n   * @param {string} directory - å„²å­˜ç›®éŒ„åç¨±\n   */\n  constructor(directory = 'recordings') {\n    super();\n    this.directory = directory;\n    \n    // æª¢æŸ¥ Capacitor æ˜¯å¦å¯ç”¨\n    if (typeof window === 'undefined' || !window.Capacitor) {\n      throw new Error('Capacitor not available. Make sure Capacitor is properly initialized.');\n    }\n    \n    this.Capacitor = window.Capacitor;\n    this.initialized = false;\n  }\n  \n  /**\n   * åˆå§‹åŒ–ï¼ˆç¢ºä¿ç›®éŒ„å­˜åœ¨ï¼‰\n   * @returns {Promise<void>}\n   */\n  async initialize() {\n    if (this.initialized) return;\n    \n    try {\n      const { Filesystem, Directory } = this.Capacitor.Plugins;\n      \n      // å˜—è©¦è®€å–ç›®éŒ„ï¼Œå¦‚æœä¸å­˜åœ¨å‰‡å‰µå»º\n      try {\n        await Filesystem.readdir({\n          path: this.directory,\n          directory: Directory.Documents\n        });\n      } catch (e) {\n        // ç›®éŒ„ä¸å­˜åœ¨ï¼Œå‰µå»ºå®ƒ\n        await Filesystem.mkdir({\n          path: this.directory,\n          directory: Directory.Documents,\n          recursive: true\n        });\n      }\n      \n      this.initialized = true;\n    } catch (error) {\n      console.error('Capacitor initialization error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * å„²å­˜éŸ³è¨Šæª”æ¡ˆ\n   * @param {Blob} blob - éŸ³è¨Š Blob\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @param {Object} metadata - å…ƒæ•¸æ“š\n   * @returns {Promise<string>} æª”æ¡ˆåç¨±\n   */\n  async save(blob, filename, metadata = {}) {\n    await this.initialize();\n    \n    try {\n      const { Filesystem, Directory } = this.Capacitor.Plugins;\n      \n      // è½‰æ› Blob ç‚º base64\n      const base64Data = await this.blobToBase64(blob);\n      \n      // å„²å­˜éŸ³è¨Šæª”æ¡ˆ\n      await Filesystem.writeFile({\n        path: `${this.directory}/${filename}`,\n        data: base64Data,\n        directory: Directory.Documents\n      });\n      \n      // å„²å­˜å…ƒæ•¸æ“š\n      if (metadata && Object.keys(metadata).length > 0) {\n        const metadataWithDefaults = {\n          ...metadata,\n          size: blob.size,\n          type: blob.type,\n          timestamp: Date.now()\n        };\n        \n        await Filesystem.writeFile({\n          path: `${this.directory}/${filename}.meta.json`,\n          data: JSON.stringify(metadataWithDefaults),\n          directory: Directory.Documents,\n          encoding: 'utf8'\n        });\n      }\n      \n      return filename;\n    } catch (error) {\n      console.error('Capacitor save error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * è¼‰å…¥éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @returns {Promise<Blob>}\n   */\n  async load(filename) {\n    await this.initialize();\n    \n    try {\n      const { Filesystem, Directory } = this.Capacitor.Plugins;\n      \n      const result = await Filesystem.readFile({\n        path: `${this.directory}/${filename}`,\n        directory: Directory.Documents\n      });\n      \n      // å°‡ base64 è½‰æ›ç‚º Blob\n      return this.base64ToBlob(result.data, 'audio/wav');\n    } catch (error) {\n      console.error('Capacitor load error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆªé™¤éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @returns {Promise<boolean>}\n   */\n  async delete(filename) {\n    await this.initialize();\n    \n    try {\n      const { Filesystem, Directory } = this.Capacitor.Plugins;\n      \n      // åˆªé™¤éŸ³è¨Šæª”æ¡ˆ\n      await Filesystem.deleteFile({\n        path: `${this.directory}/${filename}`,\n        directory: Directory.Documents\n      });\n      \n      // å˜—è©¦åˆªé™¤å…ƒæ•¸æ“šï¼ˆå¦‚æœå­˜åœ¨ï¼‰\n      try {\n        await Filesystem.deleteFile({\n          path: `${this.directory}/${filename}.meta.json`,\n          directory: Directory.Documents\n        });\n      } catch (e) {\n        // å…ƒæ•¸æ“šå¯èƒ½ä¸å­˜åœ¨ï¼Œå¿½ç•¥éŒ¯èª¤\n      }\n      \n      return true;\n    } catch (error) {\n      console.error('Capacitor delete error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆ—å‡ºæ‰€æœ‰æª”æ¡ˆ\n   * @returns {Promise<Array>}\n   */\n  async list() {\n    await this.initialize();\n    \n    try {\n      const { Filesystem, Directory } = this.Capacitor.Plugins;\n      \n      const result = await Filesystem.readdir({\n        path: this.directory,\n        directory: Directory.Documents\n      });\n      \n      // éæ¿¾æ‰å…ƒæ•¸æ“šæª”æ¡ˆï¼Œåªä¿ç•™éŸ³è¨Šæª”æ¡ˆ\n      const audioFiles = result.files.filter(f => !f.endsWith('.meta.json'));\n      \n      // ç‚ºæ¯å€‹æª”æ¡ˆè¼‰å…¥å…ƒæ•¸æ“š\n      const recordings = await Promise.all(\n        audioFiles.map(async (filename) => {\n          let metadata = {};\n          \n          try {\n            const metaResult = await Filesystem.readFile({\n              path: `${this.directory}/${filename}.meta.json`,\n              directory: Directory.Documents,\n              encoding: 'utf8'\n            });\n            metadata = JSON.parse(metaResult.data);\n          } catch (e) {\n            // æ²’æœ‰å…ƒæ•¸æ“š\n          }\n          \n          return {\n            id: filename,\n            filename: filename,\n            metadata: metadata,\n            timestamp: metadata.timestamp || 0,\n            date: metadata.timestamp ? new Date(metadata.timestamp) : null,\n            size: metadata.size || 0,\n            type: metadata.type || 'audio/wav'\n          };\n        })\n      );\n      \n      // æŒ‰æ™‚é–“æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰\n      recordings.sort((a, b) => b.timestamp - a.timestamp);\n      \n      return recordings;\n    } catch (error) {\n      console.error('Capacitor list error:', error);\n      return [];\n    }\n  }\n  \n  /**\n   * å–å¾—æª”æ¡ˆçš„ URIï¼ˆç”¨æ–¼æ’­æ”¾ï¼‰\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @returns {Promise<string>} æª”æ¡ˆ URI\n   */\n  async getUri(filename) {\n    await this.initialize();\n    \n    try {\n      const { Filesystem, Directory } = this.Capacitor.Plugins;\n      \n      const result = await Filesystem.getUri({\n        path: `${this.directory}/${filename}`,\n        directory: Directory.Documents\n      });\n      \n      return result.uri;\n    } catch (error) {\n      console.error('Capacitor getUri error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * Blob è½‰ base64\n   * @param {Blob} blob\n   * @returns {Promise<string>}\n   */\n  blobToBase64(blob) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        // ç§»é™¤ data:audio/wav;base64, å‰ç¶´\n        const base64 = reader.result.split(',')[1];\n        resolve(base64);\n      };\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }\n  \n  /**\n   * base64 è½‰ Blob\n   * @param {string} base64\n   * @param {string} mimeType\n   * @returns {Blob}\n   */\n  base64ToBlob(base64, mimeType = 'audio/wav') {\n    const byteCharacters = atob(base64);\n    const byteNumbers = new Array(byteCharacters.length);\n    \n    for (let i = 0; i < byteCharacters.length; i++) {\n      byteNumbers[i] = byteCharacters.charCodeAt(i);\n    }\n    \n    const byteArray = new Uint8Array(byteNumbers);\n    return new Blob([byteArray], { type: mimeType });\n  }\n  \n  /**\n   * å–å¾—å„²å­˜ç©ºé–“è³‡è¨Š\n   * @returns {Promise<Object>}\n   */\n  async getStorageInfo() {\n    const recordings = await this.list();\n    const totalSize = recordings.reduce((sum, r) => sum + (r.size || 0), 0);\n    \n    return {\n      count: recordings.length,\n      totalSize: totalSize,\n      totalSizeMB: (totalSize / (1024 * 1024)).toFixed(2),\n      recordings: recordings\n    };\n  }\n}\n\nexport default CapacitorAdapter;\n","/**\n * ElectronAdapter - Electron æª”æ¡ˆç³»çµ±å„²å­˜é©é…å™¨\n * ä½¿ç”¨ Electron çš„ IPC é€šè¨Šèˆ‡ä¸»é€²ç¨‹é€²è¡Œæª”æ¡ˆæ“ä½œ\n */\n\nimport { StorageAdapter } from './StorageAdapter.js';\n\nexport class ElectronAdapter extends StorageAdapter {\n  /**\n   * å»ºæ§‹å‡½æ•¸\n   * @param {string} savePath - é è¨­å„²å­˜è·¯å¾‘ï¼ˆç›¸å°æ–¼ç”¨æˆ¶æ–‡ä»¶ç›®éŒ„ï¼‰\n   */\n  constructor(savePath = 'recordings') {\n    super();\n    this.savePath = savePath;\n    \n    // æª¢æŸ¥ Electron API æ˜¯å¦å¯ç”¨\n    if (typeof window === 'undefined' || !window.electronAPI) {\n      throw new Error('Electron API not available. Make sure preload script is properly configured.');\n    }\n    \n    this.electronAPI = window.electronAPI;\n  }\n  \n  /**\n   * å„²å­˜éŸ³è¨Šæª”æ¡ˆ\n   * @param {Blob} blob - éŸ³è¨Š Blob\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @param {Object} metadata - å…ƒæ•¸æ“š\n   * @returns {Promise<string>} æª”æ¡ˆè·¯å¾‘\n   */\n  async save(blob, filename, metadata = {}) {\n    try {\n      // å°‡ Blob è½‰æ›ç‚º ArrayBuffer\n      const arrayBuffer = await blob.arrayBuffer();\n      \n      // è½‰æ›ç‚ºæ™®é€šé™£åˆ—ï¼ˆä»¥ä¾¿é€šé IPC å‚³éï¼‰\n      const buffer = Array.from(new Uint8Array(arrayBuffer));\n      \n      // å‘¼å« Electron API\n      const result = await this.electronAPI.saveRecording({\n        filename,\n        buffer,\n        metadata: {\n          ...metadata,\n          size: blob.size,\n          type: blob.type,\n          timestamp: Date.now()\n        }\n      });\n      \n      if (result.success) {\n        return result.id || result.path;\n      } else {\n        throw new Error(result.error || 'Save failed');\n      }\n    } catch (error) {\n      console.error('Electron save error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * è¼‰å…¥éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} filePath - æª”æ¡ˆè·¯å¾‘\n   * @returns {Promise<Blob>}\n   */\n  async load(filePath) {\n    try {\n      // å¾ Electron è®€å–æª”æ¡ˆ\n      const buffer = await this.electronAPI.loadRecording(filePath);\n      \n      // å°‡ Buffer è½‰æ›ç‚º Blob\n      const uint8Array = new Uint8Array(buffer);\n      return new Blob([uint8Array], { type: 'audio/wav' });\n    } catch (error) {\n      console.error('Electron load error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆªé™¤éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} filePath - æª”æ¡ˆè·¯å¾‘\n   * @returns {Promise<boolean>}\n   */\n  async delete(filePath) {\n    try {\n      const result = await this.electronAPI.deleteRecording(filePath);\n      return result.success;\n    } catch (error) {\n      console.error('Electron delete error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆ—å‡ºæ‰€æœ‰æª”æ¡ˆ\n   * @param {string} directory - ç›®éŒ„è·¯å¾‘ï¼ˆå¯é¸ï¼‰\n   * @returns {Promise<Array>}\n   */\n  async list(directory = null) {\n    try {\n      const recordings = await this.electronAPI.listRecordings(directory);\n      return recordings || [];\n    } catch (error) {\n      console.error('Electron list error:', error);\n      return [];\n    }\n  }\n  \n  /**\n   * é–‹å•Ÿæª”æ¡ˆé¸æ“‡å°è©±æ¡†\n   * @returns {Promise<string|null>} é¸æ“‡çš„æª”æ¡ˆè·¯å¾‘\n   */\n  async openFile() {\n    try {\n      if (this.electronAPI.openFile) {\n        return await this.electronAPI.openFile();\n      }\n      throw new Error('openFile API not available');\n    } catch (error) {\n      console.error('Electron openFile error:', error);\n      return null;\n    }\n  }\n  \n  /**\n   * é–‹å•Ÿå¦å­˜ç‚ºå°è©±æ¡†\n   * @param {Blob} blob - è¦å„²å­˜çš„ Blob\n   * @param {string} defaultFilename - é è¨­æª”æ¡ˆåç¨±\n   * @returns {Promise<string|null>} å„²å­˜çš„æª”æ¡ˆè·¯å¾‘\n   */\n  async saveAs(blob, defaultFilename = 'recording.wav') {\n    try {\n      const arrayBuffer = await blob.arrayBuffer();\n      const buffer = Array.from(new Uint8Array(arrayBuffer));\n      \n      if (this.electronAPI.saveAs) {\n        const result = await this.electronAPI.saveAs({\n          filename: defaultFilename,\n          buffer\n        });\n        \n        return result.success ? result.path : null;\n      }\n      \n      // å¦‚æœæ²’æœ‰ saveAs APIï¼Œä½¿ç”¨é è¨­çš„ save\n      return await this.save(blob, defaultFilename);\n    } catch (error) {\n      console.error('Electron saveAs error:', error);\n      return null;\n    }\n  }\n  \n  /**\n   * åœ¨æª”æ¡ˆç®¡ç†å™¨ä¸­é¡¯ç¤ºæª”æ¡ˆ\n   * @param {string} filePath - æª”æ¡ˆè·¯å¾‘\n   * @returns {Promise<boolean>}\n   */\n  async showInFolder(filePath) {\n    try {\n      if (this.electronAPI.showInFolder) {\n        await this.electronAPI.showInFolder(filePath);\n        return true;\n      }\n      return false;\n    } catch (error) {\n      console.error('Electron showInFolder error:', error);\n      return false;\n    }\n  }\n}\n\nexport default ElectronAdapter;\n","/**\n * IndexedDBAdapter - IndexedDB å„²å­˜å¯¦ç¾\n * ç”¨æ–¼ç€è¦½å™¨ç«¯æœ¬åœ°å„²å­˜ï¼Œç„¡éœ€ä¼ºæœå™¨\n */\n\nimport { StorageAdapter } from './StorageAdapter.js';\n\nexport class IndexedDBAdapter extends StorageAdapter {\n  /**\n   * å»ºæ§‹å‡½æ•¸\n   * @param {string} dbName - è³‡æ–™åº«åç¨±\n   * @param {string} storeName - å„²å­˜å€åç¨±\n   * @param {number} version - è³‡æ–™åº«ç‰ˆæœ¬\n   */\n  constructor(dbName = 'VoiceBankDB', storeName = 'recordings', version = 1) {\n    super();\n    this.dbName = dbName;\n    this.storeName = storeName;\n    this.version = version;\n    this.db = null;\n  }\n  \n  /**\n   * åˆå§‹åŒ–è³‡æ–™åº«\n   * @returns {Promise<IDBDatabase>}\n   */\n  async initialize() {\n    if (this.db) {\n      return this.db;\n    }\n    \n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(this.dbName, this.version);\n      \n      request.onerror = () => {\n        reject(new Error(`Failed to open IndexedDB: ${request.error}`));\n      };\n      \n      request.onsuccess = () => {\n        this.db = request.result;\n        resolve(this.db);\n      };\n      \n      request.onupgradeneeded = (event) => {\n        const db = event.target.result;\n        \n        // å‰µå»ºç‰©ä»¶å„²å­˜å€ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰\n        if (!db.objectStoreNames.contains(this.storeName)) {\n          const store = db.createObjectStore(this.storeName, { \n            keyPath: 'id', \n            autoIncrement: true \n          });\n          \n          // å‰µå»ºç´¢å¼•\n          store.createIndex('filename', 'filename', { unique: false });\n          store.createIndex('timestamp', 'timestamp', { unique: false });\n          store.createIndex('duration', 'duration', { unique: false });\n        }\n      };\n    });\n  }\n  \n  /**\n   * å„²å­˜éŸ³è¨Šæª”æ¡ˆ\n   * @param {Blob} blob - éŸ³è¨Š Blob\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @param {Object} metadata - å…ƒæ•¸æ“š\n   * @returns {Promise<string>} æª”æ¡ˆ ID\n   */\n  async save(blob, filename, metadata = {}) {\n    await this.initialize();\n    \n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([this.storeName], 'readwrite');\n      const store = transaction.objectStore(this.storeName);\n      \n      const record = {\n        filename: filename,\n        blob: blob,\n        size: blob.size,\n        type: blob.type,\n        timestamp: Date.now(),\n        metadata: metadata\n      };\n      \n      const request = store.add(record);\n      \n      request.onsuccess = () => {\n        resolve(String(request.result));\n      };\n      \n      request.onerror = () => {\n        reject(new Error(`Failed to save recording: ${request.error}`));\n      };\n      \n      transaction.onerror = () => {\n        reject(new Error(`Transaction failed: ${transaction.error}`));\n      };\n    });\n  }\n  \n  /**\n   * è¼‰å…¥éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} id - æª”æ¡ˆ ID\n   * @returns {Promise<Blob>}\n   */\n  async load(id) {\n    await this.initialize();\n    \n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([this.storeName], 'readonly');\n      const store = transaction.objectStore(this.storeName);\n      const request = store.get(Number(id));\n      \n      request.onsuccess = () => {\n        const record = request.result;\n        if (record && record.blob) {\n          resolve(record.blob);\n        } else {\n          reject(new Error(`Recording not found: ${id}`));\n        }\n      };\n      \n      request.onerror = () => {\n        reject(new Error(`Failed to load recording: ${request.error}`));\n      };\n    });\n  }\n  \n  /**\n   * åˆªé™¤éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} id - æª”æ¡ˆ ID\n   * @returns {Promise<boolean>}\n   */\n  async delete(id) {\n    await this.initialize();\n    \n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([this.storeName], 'readwrite');\n      const store = transaction.objectStore(this.storeName);\n      const request = store.delete(Number(id));\n      \n      request.onsuccess = () => {\n        resolve(true);\n      };\n      \n      request.onerror = () => {\n        reject(new Error(`Failed to delete recording: ${request.error}`));\n      };\n    });\n  }\n  \n  /**\n   * åˆ—å‡ºæ‰€æœ‰æª”æ¡ˆ\n   * @returns {Promise<Array>}\n   */\n  async list() {\n    await this.initialize();\n    \n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([this.storeName], 'readonly');\n      const store = transaction.objectStore(this.storeName);\n      const request = store.getAll();\n      \n      request.onsuccess = () => {\n        const records = request.result.map(record => ({\n          id: String(record.id),\n          filename: record.filename,\n          size: record.size,\n          type: record.type,\n          timestamp: record.timestamp,\n          date: new Date(record.timestamp),\n          metadata: record.metadata || {}\n        }));\n        resolve(records);\n      };\n      \n      request.onerror = () => {\n        reject(new Error(`Failed to list recordings: ${request.error}`));\n      };\n    });\n  }\n  \n  /**\n   * æ ¹æ“šæª”åæœå°‹\n   * @param {string} filename - æª”æ¡ˆåç¨±ï¼ˆæ”¯æ´éƒ¨åˆ†åŒ¹é…ï¼‰\n   * @returns {Promise<Array>}\n   */\n  async searchByFilename(filename) {\n    const allRecords = await this.list();\n    return allRecords.filter(record => \n      record.filename.toLowerCase().includes(filename.toLowerCase())\n    );\n  }\n  \n  /**\n   * å–å¾—å„²å­˜ç©ºé–“ä½¿ç”¨æƒ…æ³\n   * @returns {Promise<Object>}\n   */\n  async getStorageInfo() {\n    const records = await this.list();\n    const totalSize = records.reduce((sum, record) => sum + record.size, 0);\n    \n    return {\n      count: records.length,\n      totalSize: totalSize,\n      totalSizeMB: (totalSize / (1024 * 1024)).toFixed(2),\n      records: records\n    };\n  }\n  \n  /**\n   * æ¸…ç©ºæ‰€æœ‰éŒ„éŸ³\n   * @returns {Promise<number>} åˆªé™¤çš„æ•¸é‡\n   */\n  async clear() {\n    await this.initialize();\n    \n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction([this.storeName], 'readwrite');\n      const store = transaction.objectStore(this.storeName);\n      \n      // å…ˆå–å¾—æ•¸é‡\n      const countRequest = store.count();\n      \n      countRequest.onsuccess = () => {\n        const count = countRequest.result;\n        \n        // æ¸…ç©ºå„²å­˜å€\n        const clearRequest = store.clear();\n        \n        clearRequest.onsuccess = () => {\n          resolve(count);\n        };\n        \n        clearRequest.onerror = () => {\n          reject(new Error(`Failed to clear recordings: ${clearRequest.error}`));\n        };\n      };\n      \n      countRequest.onerror = () => {\n        reject(new Error(`Failed to count recordings: ${countRequest.error}`));\n      };\n    });\n  }\n  \n  /**\n   * å–å¾—ç€è¦½å™¨å„²å­˜ç©ºé–“é…é¡è³‡è¨Šï¼ˆå¦‚æœå¯ç”¨ï¼‰\n   * @returns {Promise<Object|null>}\n   */\n  async getStorageEstimate() {\n    if ('storage' in navigator && 'estimate' in navigator.storage) {\n      try {\n        const estimate = await navigator.storage.estimate();\n        return {\n          usage: estimate.usage,\n          quota: estimate.quota,\n          usageMB: (estimate.usage / (1024 * 1024)).toFixed(2),\n          quotaMB: (estimate.quota / (1024 * 1024)).toFixed(2),\n          usagePercent: ((estimate.usage / estimate.quota) * 100).toFixed(2)\n        };\n      } catch (error) {\n        console.warn('Failed to get storage estimate:', error);\n        return null;\n      }\n    }\n    return null;\n  }\n  \n  /**\n   * é—œé–‰è³‡æ–™åº«é€£æ¥\n   */\n  close() {\n    if (this.db) {\n      this.db.close();\n      this.db = null;\n    }\n  }\n}\n\nexport default IndexedDBAdapter;\n","/**\n * PlatformDetector - å¹³å°åµæ¸¬å·¥å…·\n * è‡ªå‹•åµæ¸¬ç•¶å‰é‹è¡Œç’°å¢ƒï¼ˆBrowser/Electron/Capacitorï¼‰\n */\n\nexport class PlatformDetector {\n  /**\n   * åµæ¸¬ç•¶å‰å¹³å°\n   * @returns {string} 'browser' | 'electron' | 'capacitor'\n   */\n  static detect() {\n    // æª¢æŸ¥æ˜¯å¦ç‚º Electron\n    if (typeof window !== 'undefined' && window.electronAPI) {\n      return 'electron';\n    }\n    \n    // æª¢æŸ¥æ˜¯å¦ç‚º Electronï¼ˆå¦ä¸€ç¨®æ–¹å¼ï¼‰\n    if (typeof process !== 'undefined' && process.versions && process.versions.electron) {\n      return 'electron';\n    }\n    \n    // æª¢æŸ¥æ˜¯å¦ç‚º Capacitor\n    if (typeof window !== 'undefined' && window.Capacitor) {\n      return 'capacitor';\n    }\n    \n    // é è¨­ç‚ºç€è¦½å™¨\n    return 'browser';\n  }\n  \n  /**\n   * æª¢æŸ¥æ˜¯å¦ç‚º Electron ç’°å¢ƒ\n   * @returns {boolean}\n   */\n  static isElectron() {\n    return this.detect() === 'electron';\n  }\n  \n  /**\n   * æª¢æŸ¥æ˜¯å¦ç‚º Capacitor ç’°å¢ƒ\n   * @returns {boolean}\n   */\n  static isCapacitor() {\n    return this.detect() === 'capacitor';\n  }\n  \n  /**\n   * æª¢æŸ¥æ˜¯å¦ç‚ºç€è¦½å™¨ç’°å¢ƒ\n   * @returns {boolean}\n   */\n  static isBrowser() {\n    return this.detect() === 'browser';\n  }\n  \n  /**\n   * æª¢æŸ¥æ˜¯å¦ç‚ºç§»å‹•è£ç½®\n   * @returns {boolean}\n   */\n  static isMobile() {\n    if (typeof window === 'undefined' || !window.navigator) {\n      return false;\n    }\n    \n    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n      window.navigator.userAgent\n    );\n  }\n  \n  /**\n   * æª¢æŸ¥æ˜¯å¦æ”¯æ´ AudioWorklet\n   * @returns {boolean}\n   */\n  static supportsAudioWorklet() {\n    if (typeof window === 'undefined' || !window.AudioContext) {\n      return false;\n    }\n    \n    const AudioContextClass = window.AudioContext || window.webkitAudioContext;\n    return 'audioWorklet' in AudioContextClass.prototype;\n  }\n  \n  /**\n   * æª¢æŸ¥æ˜¯å¦æ”¯æ´ OffscreenCanvas\n   * @returns {boolean}\n   */\n  static supportsOffscreenCanvas() {\n    return typeof OffscreenCanvas !== 'undefined';\n  }\n  \n  /**\n   * å–å¾—å¹³å°è³‡è¨Š\n   * @returns {Object}\n   */\n  static getInfo() {\n    return {\n      platform: this.detect(),\n      isElectron: this.isElectron(),\n      isCapacitor: this.isCapacitor(),\n      isBrowser: this.isBrowser(),\n      isMobile: this.isMobile(),\n      supportsAudioWorklet: this.supportsAudioWorklet(),\n      supportsOffscreenCanvas: this.supportsOffscreenCanvas(),\n      userAgent: typeof navigator !== 'undefined' ? navigator.userAgent : 'unknown'\n    };\n  }\n}\n\nexport default PlatformDetector;\n","/**\n * RecorderUI.js\n * VoiceBank Recorder ä¸» UI æ§åˆ¶å™¨\n * \n * è·è²¬ï¼š\n * - ç®¡ç†æ‰€æœ‰ UI å…ƒç´ å’Œç‹€æ…‹\n * - å”èª¿ AudioEngine å’Œ WaveformRenderer\n * - è™•ç†ç”¨æˆ¶äº¤äº’äº‹ä»¶\n * - æ›´æ–° UI é¡¯ç¤º\n * \n * @module RecorderUI\n * @requires AudioEngine\n * @requires WaveformRenderer\n */\n\n/**\n * RecorderUI é¡ - ä¸» UI æ§åˆ¶å™¨\n */\nexport class RecorderUI {\n  /**\n   * å»ºæ§‹å‡½æ•¸\n   * @param {string|HTMLElement} container - å®¹å™¨é¸æ“‡å™¨æˆ–å…ƒç´ \n   * @param {Object} options - é…ç½®é¸é …\n   * @param {AudioEngine} options.audioEngine - éŸ³è¨Šå¼•æ“å¯¦ä¾‹\n   * @param {WaveformRenderer} options.waveformRenderer - æ³¢å½¢æ¸²æŸ“å™¨å¯¦ä¾‹\n   * @param {Object} options.callbacks - å›èª¿å‡½æ•¸\n   */\n  constructor(container, options = {}) {\n    // å®¹å™¨å…ƒç´ \n    this.container = typeof container === 'string' \n      ? document.querySelector(container) \n      : container;\n    \n    if (!this.container) {\n      throw new Error('Container element not found');\n    }\n    \n    // æ ¸å¿ƒæ¨¡çµ„å¼•ç”¨\n    this.audioEngine = options.audioEngine;\n    this.waveformRenderer = options.waveformRenderer;\n    \n    // é…ç½®é¸é …\n    this.options = {\n      layout: options.layout || 'auto', // 'horizontal', 'vertical', 'auto'\n      theme: options.theme || 'light',  // 'light', 'dark'\n      showOverview: options.showOverview !== false,\n      ...options\n    };\n    \n    // å›èª¿å‡½æ•¸\n    this.callbacks = {\n      onRecordStart: options.onRecordStart || (() => {}),\n      onRecordStop: options.onRecordStop || (() => {}),\n      onPlayStart: options.onPlayStart || (() => {}),\n      onPlayStop: options.onPlayStop || (() => {}),\n      onError: options.onError || ((error) => console.error('UI Error:', error)),\n      ...options.callbacks\n    };\n    \n    // UI å…ƒç´ å¼•ç”¨ï¼ˆåˆå§‹åŒ–å¾Œå¡«å……ï¼‰\n    this.elements = {};\n    \n    // ç‹€æ…‹\n    this.state = {\n      isRecording: false,\n      isPlaying: false,\n      isPaused: false,\n      hasRecording: false,\n      duration: 0,\n      sampleCount: 0\n    };\n    \n    // å­æ§åˆ¶å™¨ï¼ˆå¯é¸ï¼‰\n    this.controlPanel = null;\n    this.playbackController = null;\n    this.layoutManager = null;\n  }\n  \n  /**\n   * åˆå§‹åŒ– UI\n   */\n  async initialize() {\n    try {\n      // 1. æ¸²æŸ“ UI çµæ§‹\n      this.renderUI();\n      \n      // 2. ç²å– DOM å…ƒç´ å¼•ç”¨\n      this.cacheElements();\n      \n      // 3. ç¶å®šäº‹ä»¶è™•ç†å™¨\n      this.bindEvents();\n      \n      // 4. åˆå§‹åŒ–å­æ§åˆ¶å™¨ï¼ˆå¦‚æœéœ€è¦ï¼‰\n      this.initializeSubControllers();\n      \n      // 5. æ‡‰ç”¨åˆå§‹è¨­å®š\n      this.applyInitialSettings();\n      \n      // 6. é€£æ¥æ ¸å¿ƒæ¨¡çµ„äº‹ä»¶\n      this.connectCoreModules();\n      \n      console.log('âœ… RecorderUI initialized');\n    } catch (error) {\n      this.callbacks.onError(error);\n      throw error;\n    }\n  }\n  \n  /**\n   * æ¸²æŸ“ UI çµæ§‹\n   * æ³¨æ„ï¼šé€™æ˜¯ç°¡åŒ–ç‰ˆï¼Œå¯¦éš›æ‡‰è©²å¾ public/index.html æå–å®Œæ•´ HTML\n   */\n  renderUI() {\n    this.container.innerHTML = `\n      <div class=\"voicebank-recorder\" data-layout=\"${this.options.layout}\" data-theme=\"${this.options.theme}\">\n        <!-- æ§åˆ¶é¢æ¿ -->\n        <div class=\"recorder-controls\">\n          <button id=\"vbr-btn-record\" class=\"btn-record\">\n            <span class=\"icon\">â—</span>\n            <span class=\"label\">é–‹å§‹éŒ„éŸ³</span>\n          </button>\n          \n          <div class=\"recording-info\">\n            <span id=\"vbr-recording-duration\">00:00.0</span>\n            <span id=\"vbr-sample-count\">0 samples</span>\n          </div>\n        </div>\n        \n        <!-- æ³¢å½¢å®¹å™¨ -->\n        <div class=\"waveform-wrapper\" id=\"vbr-waveform-wrapper\">\n          <!-- å³æ™‚æ³¢å½¢ -->\n          <div class=\"waveform-section\">\n            <label>å³æ™‚æ³¢å½¢</label>\n            <canvas id=\"vbr-live-waveform\" width=\"800\" height=\"120\"></canvas>\n          </div>\n          \n          <!-- VU Meter -->\n          <div class=\"waveform-section\">\n            <label>éŸ³é‡è¡¨</label>\n            <canvas id=\"vbr-vu-meter\" width=\"800\" height=\"50\"></canvas>\n          </div>\n          \n          <!-- ç´¯ç©æ³¢å½¢ -->\n          <div class=\"waveform-section\">\n            <label>ç´¯ç©æ³¢å½¢</label>\n            <canvas id=\"vbr-accumulated-waveform\" width=\"800\" height=\"200\"></canvas>\n          </div>\n          \n          <!-- æ¦‚è¦½æ³¢å½¢ -->\n          ${this.options.showOverview ? `\n          <div class=\"waveform-section\">\n            <label>æ¦‚è¦½æ³¢å½¢</label>\n            <canvas id=\"vbr-overview-waveform\" width=\"800\" height=\"80\"></canvas>\n          </div>\n          ` : ''}\n        </div>\n        \n        <!-- æ’­æ”¾æ§åˆ¶ -->\n        <div class=\"playback-controls\">\n          <button id=\"vbr-btn-play\" class=\"btn-play\" disabled>\n            <span class=\"icon\">â–¶</span>\n            <span class=\"label\">æ’­æ”¾</span>\n          </button>\n          <button id=\"vbr-btn-pause\" class=\"btn-pause\" disabled>\n            <span class=\"icon\">â¸</span>\n            <span class=\"label\">æš«åœ</span>\n          </button>\n          <button id=\"vbr-btn-stop\" class=\"btn-stop\" disabled>\n            <span class=\"icon\">â¹</span>\n            <span class=\"label\">åœæ­¢</span>\n          </button>\n        </div>\n        \n        <!-- å·¥å…·åˆ— -->\n        <div class=\"toolbar\">\n          <button id=\"vbr-btn-save\" class=\"btn-save\" disabled>\n            <span class=\"icon\">ğŸ’¾</span>\n            <span class=\"label\">å„²å­˜</span>\n          </button>\n          <button id=\"vbr-btn-clear\" class=\"btn-clear\" disabled>\n            <span class=\"icon\">ğŸ—‘ï¸</span>\n            <span class=\"label\">æ¸…é™¤</span>\n          </button>\n          <button id=\"vbr-btn-layout-toggle\" class=\"btn-layout-toggle\">\n            <span class=\"icon\">ğŸ”„</span>\n            <span class=\"label\">åˆ‡æ›ä½ˆå±€</span>\n          </button>\n        </div>\n      </div>\n    `;\n  }\n  \n  /**\n   * ç·©å­˜ DOM å…ƒç´ å¼•ç”¨\n   */\n  cacheElements() {\n    this.elements = {\n      // æŒ‰éˆ•\n      btnRecord: document.getElementById('vbr-btn-record'),\n      btnPlay: document.getElementById('vbr-btn-play'),\n      btnPause: document.getElementById('vbr-btn-pause'),\n      btnStop: document.getElementById('vbr-btn-stop'),\n      btnSave: document.getElementById('vbr-btn-save'),\n      btnClear: document.getElementById('vbr-btn-clear'),\n      btnLayoutToggle: document.getElementById('vbr-btn-layout-toggle'),\n      \n      // é¡¯ç¤ºå…ƒç´ \n      recordingDuration: document.getElementById('vbr-recording-duration'),\n      sampleCount: document.getElementById('vbr-sample-count'),\n      waveformWrapper: document.getElementById('vbr-waveform-wrapper'),\n      \n      // Canvas å…ƒç´ \n      liveCanvas: document.getElementById('vbr-live-waveform'),\n      vuMeterCanvas: document.getElementById('vbr-vu-meter'),\n      accumulatedCanvas: document.getElementById('vbr-accumulated-waveform'),\n      overviewCanvas: document.getElementById('vbr-overview-waveform')\n    };\n  }\n  \n  /**\n   * ç¶å®šäº‹ä»¶è™•ç†å™¨\n   */\n  bindEvents() {\n    // éŒ„éŸ³æŒ‰éˆ•\n    if (this.elements.btnRecord) {\n      this.elements.btnRecord.addEventListener('click', () => {\n        this.handleRecordToggle();\n      });\n    }\n    \n    // æ’­æ”¾æ§åˆ¶æŒ‰éˆ•\n    if (this.elements.btnPlay) {\n      this.elements.btnPlay.addEventListener('click', () => {\n        this.handlePlay();\n      });\n    }\n    \n    if (this.elements.btnPause) {\n      this.elements.btnPause.addEventListener('click', () => {\n        this.handlePause();\n      });\n    }\n    \n    if (this.elements.btnStop) {\n      this.elements.btnStop.addEventListener('click', () => {\n        this.handleStop();\n      });\n    }\n    \n    // å·¥å…·æŒ‰éˆ•\n    if (this.elements.btnSave) {\n      this.elements.btnSave.addEventListener('click', () => {\n        this.handleSave();\n      });\n    }\n    \n    if (this.elements.btnClear) {\n      this.elements.btnClear.addEventListener('click', () => {\n        this.handleClear();\n      });\n    }\n    \n    if (this.elements.btnLayoutToggle) {\n      this.elements.btnLayoutToggle.addEventListener('click', () => {\n        this.handleLayoutToggle();\n      });\n    }\n    \n    // è¦–çª—å¤§å°è®Šæ›´\n    window.addEventListener('resize', () => {\n      this.handleResize();\n    });\n  }\n  \n  /**\n   * åˆå§‹åŒ–å­æ§åˆ¶å™¨ï¼ˆå¯é¸ï¼‰\n   */\n  initializeSubControllers() {\n    // é€™è£¡å¯ä»¥åˆå§‹åŒ–å…¶ä»– UI å­æ§åˆ¶å™¨\n    // ä¾‹å¦‚ï¼šthis.controlPanel = new ControlPanel(this);\n    // ç›®å‰å…ˆä¿æŒç°¡å–®\n  }\n  \n  /**\n   * æ‡‰ç”¨åˆå§‹è¨­å®š\n   */\n  applyInitialSettings() {\n    // æ‡‰ç”¨ä½ˆå±€\n    this.applyLayout(this.options.layout);\n    \n    // æ‡‰ç”¨ä¸»é¡Œ\n    this.applyTheme(this.options.theme);\n    \n    // åˆå§‹åŒ–æŒ‰éˆ•ç‹€æ…‹\n    this.updateButtonStates();\n  }\n  \n  /**\n   * é€£æ¥æ ¸å¿ƒæ¨¡çµ„äº‹ä»¶\n   */\n  connectCoreModules() {\n    if (!this.audioEngine || !this.waveformRenderer) {\n      console.warn('Core modules not provided, UI will have limited functionality');\n      return;\n    }\n    \n    // AudioEngine äº‹ä»¶\n    this.audioEngine.on('recording-start', () => {\n      this.onRecordingStart();\n    });\n    \n    this.audioEngine.on('recording-stop', (data) => {\n      this.onRecordingStop(data);\n    });\n    \n    this.audioEngine.on('data-available', (data) => {\n      this.onDataAvailable(data);\n    });\n    \n    this.audioEngine.on('error', (error) => {\n      this.onAudioError(error);\n    });\n  }\n  \n  // ==================== äº‹ä»¶è™•ç†å™¨ ====================\n  \n  /**\n   * è™•ç†éŒ„éŸ³æŒ‰éˆ•åˆ‡æ›\n   */\n  async handleRecordToggle() {\n    try {\n      if (this.state.isRecording) {\n        // åœæ­¢éŒ„éŸ³\n        await this.audioEngine.stopRecording();\n      } else {\n        // é–‹å§‹éŒ„éŸ³\n        await this.audioEngine.startRecording();\n      }\n    } catch (error) {\n      this.callbacks.onError(error);\n      this.showError('éŒ„éŸ³æ“ä½œå¤±æ•—ï¼š' + error.message);\n    }\n  }\n  \n  /**\n   * è™•ç†æ’­æ”¾\n   */\n  async handlePlay() {\n    try {\n      // TODO: å¯¦ç¾æ’­æ”¾é‚è¼¯\n      console.log('Play recording');\n      this.callbacks.onPlayStart();\n    } catch (error) {\n      this.callbacks.onError(error);\n    }\n  }\n  \n  /**\n   * è™•ç†æš«åœ\n   */\n  async handlePause() {\n    try {\n      // TODO: å¯¦ç¾æš«åœé‚è¼¯\n      console.log('Pause playback');\n    } catch (error) {\n      this.callbacks.onError(error);\n    }\n  }\n  \n  /**\n   * è™•ç†åœæ­¢\n   */\n  async handleStop() {\n    try {\n      // TODO: å¯¦ç¾åœæ­¢é‚è¼¯\n      console.log('Stop playback');\n      this.callbacks.onPlayStop();\n    } catch (error) {\n      this.callbacks.onError(error);\n    }\n  }\n  \n  /**\n   * è™•ç†å„²å­˜\n   */\n  async handleSave() {\n    try {\n      // TODO: å¯¦ç¾å„²å­˜é‚è¼¯\n      console.log('Save recording');\n    } catch (error) {\n      this.callbacks.onError(error);\n    }\n  }\n  \n  /**\n   * è™•ç†æ¸…é™¤\n   */\n  async handleClear() {\n    if (!confirm('ç¢ºå®šè¦æ¸…é™¤ç•¶å‰éŒ„éŸ³å—ï¼Ÿ')) {\n      return;\n    }\n    \n    try {\n      // æ¸…é™¤æ³¢å½¢\n      if (this.waveformRenderer) {\n        this.waveformRenderer.reset();\n      }\n      \n      // é‡ç½®ç‹€æ…‹\n      this.state.hasRecording = false;\n      this.state.duration = 0;\n      this.state.sampleCount = 0;\n      \n      // æ›´æ–°é¡¯ç¤º\n      this.updateDurationDisplay();\n      this.updateButtonStates();\n      \n      console.log('Recording cleared');\n    } catch (error) {\n      this.callbacks.onError(error);\n    }\n  }\n  \n  /**\n   * è™•ç†ä½ˆå±€åˆ‡æ›\n   */\n  handleLayoutToggle() {\n    const currentLayout = this.container.dataset.layout;\n    const newLayout = currentLayout === 'horizontal' ? 'vertical' : 'horizontal';\n    this.applyLayout(newLayout);\n  }\n  \n  /**\n   * è™•ç†è¦–çª—å¤§å°è®Šæ›´\n   */\n  handleResize() {\n    // èª¿æ•´ Canvas å°ºå¯¸\n    if (this.waveformRenderer) {\n      this.waveformRenderer.resize();\n    }\n  }\n  \n  // ==================== æ ¸å¿ƒæ¨¡çµ„äº‹ä»¶å›èª¿ ====================\n  \n  /**\n   * éŒ„éŸ³é–‹å§‹å›èª¿\n   */\n  onRecordingStart() {\n    this.state.isRecording = true;\n    this.state.hasRecording = true;\n    \n    // æ›´æ–° UI\n    this.setRecordingState(true);\n    this.updateButtonStates();\n    \n    // å•Ÿå‹•æ³¢å½¢é¡¯ç¤º\n    if (this.waveformRenderer) {\n      // WaveformRenderer æœƒè‡ªå‹•å¾ AudioEngine ç²å–æ•¸æ“š\n    }\n    \n    // å›èª¿\n    this.callbacks.onRecordStart();\n    \n    console.log('ğŸ™ï¸ Recording started');\n  }\n  \n  /**\n   * éŒ„éŸ³åœæ­¢å›èª¿\n   */\n  onRecordingStop(data) {\n    this.state.isRecording = false;\n    \n    // æ›´æ–° UI\n    this.setRecordingState(false);\n    this.updateButtonStates();\n    \n    // å›èª¿\n    this.callbacks.onRecordStop(data);\n    \n    console.log('â¹ï¸ Recording stopped', data);\n  }\n  \n  /**\n   * æ•¸æ“šå¯ç”¨å›èª¿\n   */\n  onDataAvailable(data) {\n    // æ›´æ–°æ™‚é•·å’Œæ¨£æœ¬æ•¸\n    if (data.duration !== undefined) {\n      this.state.duration = data.duration;\n    }\n    if (data.sampleCount !== undefined) {\n      this.state.sampleCount = data.sampleCount;\n    }\n    \n    // æ›´æ–°é¡¯ç¤º\n    this.updateDurationDisplay();\n  }\n  \n  /**\n   * éŸ³è¨ŠéŒ¯èª¤å›èª¿\n   */\n  onAudioError(error) {\n    this.showError('éŸ³è¨ŠéŒ¯èª¤ï¼š' + error.message);\n    this.callbacks.onError(error);\n  }\n  \n  // ==================== UI æ›´æ–°æ–¹æ³• ====================\n  \n  /**\n   * è¨­å®šéŒ„éŸ³ç‹€æ…‹\n   * @param {boolean} isRecording - æ˜¯å¦æ­£åœ¨éŒ„éŸ³\n   */\n  setRecordingState(isRecording) {\n    const btn = this.elements.btnRecord;\n    if (!btn) return;\n    \n    if (isRecording) {\n      btn.classList.add('recording');\n      btn.querySelector('.icon').textContent = 'â¹';\n      btn.querySelector('.label').textContent = 'åœæ­¢éŒ„éŸ³';\n    } else {\n      btn.classList.remove('recording');\n      btn.querySelector('.icon').textContent = 'â—';\n      btn.querySelector('.label').textContent = 'é–‹å§‹éŒ„éŸ³';\n    }\n  }\n  \n  /**\n   * æ›´æ–°æŒ‰éˆ•ç‹€æ…‹\n   */\n  updateButtonStates() {\n    const { isRecording, isPlaying, isPaused, hasRecording } = this.state;\n    \n    // éŒ„éŸ³æŒ‰éˆ•ï¼šæ’­æ”¾æ™‚ç¦ç”¨\n    if (this.elements.btnRecord) {\n      this.elements.btnRecord.disabled = isPlaying;\n    }\n    \n    // æ’­æ”¾æ§åˆ¶æŒ‰éˆ•ï¼šæ²’æœ‰éŒ„éŸ³æ™‚ç¦ç”¨\n    if (this.elements.btnPlay) {\n      this.elements.btnPlay.disabled = !hasRecording || isRecording || isPlaying;\n    }\n    \n    if (this.elements.btnPause) {\n      this.elements.btnPause.disabled = !isPlaying || isPaused;\n    }\n    \n    if (this.elements.btnStop) {\n      this.elements.btnStop.disabled = !isPlaying && !isPaused;\n    }\n    \n    // å·¥å…·æŒ‰éˆ•\n    if (this.elements.btnSave) {\n      this.elements.btnSave.disabled = !hasRecording || isRecording;\n    }\n    \n    if (this.elements.btnClear) {\n      this.elements.btnClear.disabled = !hasRecording || isRecording;\n    }\n  }\n  \n  /**\n   * æ›´æ–°æ™‚é•·é¡¯ç¤º\n   */\n  updateDurationDisplay() {\n    if (this.elements.recordingDuration) {\n      this.elements.recordingDuration.textContent = this.formatDuration(this.state.duration);\n    }\n    \n    if (this.elements.sampleCount) {\n      this.elements.sampleCount.textContent = `${this.state.sampleCount.toLocaleString()} samples`;\n    }\n  }\n  \n  /**\n   * æ ¼å¼åŒ–æ™‚é•·\n   * @param {number} seconds - ç§’æ•¸\n   * @returns {string} æ ¼å¼åŒ–å¾Œçš„æ™‚é•· (MM:SS.S)\n   */\n  formatDuration(seconds) {\n    const minutes = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    const decimal = Math.floor((seconds % 1) * 10);\n    \n    return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}.${decimal}`;\n  }\n  \n  /**\n   * æ‡‰ç”¨ä½ˆå±€\n   * @param {string} layout - 'horizontal', 'vertical', 'auto'\n   */\n  applyLayout(layout) {\n    if (layout === 'auto') {\n      // è‡ªå‹•åµæ¸¬\n      layout = window.innerWidth > window.innerHeight ? 'horizontal' : 'vertical';\n    }\n    \n    this.container.dataset.layout = layout;\n    this.options.layout = layout;\n    \n    // é€šçŸ¥ WaveformRenderer\n    if (this.waveformRenderer) {\n      this.waveformRenderer.setVerticalMode(layout === 'vertical');\n    }\n    \n    console.log(`ğŸ“ Layout changed to: ${layout}`);\n  }\n  \n  /**\n   * æ‡‰ç”¨ä¸»é¡Œ\n   * @param {string} theme - 'light', 'dark'\n   */\n  applyTheme(theme) {\n    this.container.dataset.theme = theme;\n    this.options.theme = theme;\n    \n    console.log(`ğŸ¨ Theme changed to: ${theme}`);\n  }\n  \n  /**\n   * é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯\n   * @param {string} message - éŒ¯èª¤è¨Šæ¯\n   */\n  showError(message) {\n    // ç°¡å–®çš„éŒ¯èª¤é¡¯ç¤ºï¼ˆå¯ä»¥æ“´å±•ç‚ºæ›´å¥½çš„ UIï¼‰\n    alert('éŒ¯èª¤ï¼š' + message);\n  }\n  \n  /**\n   * é¡¯ç¤ºé€šçŸ¥\n   * @param {string} message - é€šçŸ¥è¨Šæ¯\n   * @param {number} duration - æŒçºŒæ™‚é–“ï¼ˆæ¯«ç§’ï¼‰\n   */\n  showNotice(message, duration = 3000) {\n    // ç°¡å–®çš„é€šçŸ¥é¡¯ç¤ºï¼ˆå¯ä»¥æ“´å±•ç‚ºæ›´å¥½çš„ UIï¼‰\n    console.log('ğŸ“¢ Notice:', message);\n  }\n  \n  // ==================== å…¬é–‹ API ====================\n  \n  /**\n   * å–å¾—ç•¶å‰ç‹€æ…‹\n   * @returns {Object} ç‹€æ…‹ç‰©ä»¶\n   */\n  getState() {\n    return { ...this.state };\n  }\n  \n  /**\n   * è¨­å®šé¸é …\n   * @param {Object} options - é¸é …ç‰©ä»¶\n   */\n  setOptions(options) {\n    this.options = { ...this.options, ...options };\n    \n    // æ‡‰ç”¨è®Šæ›´\n    if (options.layout) {\n      this.applyLayout(options.layout);\n    }\n    if (options.theme) {\n      this.applyTheme(options.theme);\n    }\n  }\n  \n  /**\n   * éŠ·æ¯€ UI\n   */\n  destroy() {\n    // ç§»é™¤äº‹ä»¶ç›£è½å™¨\n    // ï¼ˆç°¡åŒ–ç‰ˆï¼Œå¯¦éš›æ‡‰è©²è¨˜éŒ„æ‰€æœ‰ç›£è½å™¨ä¸¦é€ä¸€ç§»é™¤ï¼‰\n    \n    // æ¸…ç©ºå®¹å™¨\n    if (this.container) {\n      this.container.innerHTML = '';\n    }\n    \n    // æ¸…ç©ºå¼•ç”¨\n    this.elements = {};\n    this.audioEngine = null;\n    this.waveformRenderer = null;\n    \n    console.log('ğŸ—‘ï¸ RecorderUI destroyed');\n  }\n}\n\nexport default RecorderUI;\n","/**\n * ServerAdapter - ä¼ºæœå™¨å„²å­˜é©é…å™¨\n * æ”¯æ´ PHP/Node.js ç­‰å¾Œç«¯å„²å­˜æ–¹æ¡ˆ\n */\n\nimport { StorageAdapter } from './StorageAdapter.js';\n\nexport class ServerAdapter extends StorageAdapter {\n  /**\n   * å»ºæ§‹å‡½æ•¸\n   * @param {Object} config - é…ç½®é¸é …\n   * @param {string} config.baseURL - åŸºç¤ URL\n   * @param {string} config.saveEndpoint - ä¸Šå‚³ç«¯é»\n   * @param {string} config.loadEndpoint - ä¸‹è¼‰ç«¯é»\n   * @param {string} config.deleteEndpoint - åˆªé™¤ç«¯é»\n   * @param {string} config.listEndpoint - åˆ—è¡¨ç«¯é»ï¼ˆå¯é¸ï¼‰\n   */\n  constructor(config = {}) {\n    super();\n    this.baseURL = config.baseURL || '';\n    this.saveEndpoint = config.saveEndpoint || '/backend/save.php';\n    this.loadEndpoint = config.loadEndpoint || '/public/uploads/';\n    this.deleteEndpoint = config.deleteEndpoint || '/backend/delete.php';\n    this.listEndpoint = config.listEndpoint || '/api/recordings';\n    this.headers = config.headers || {};\n  }\n  \n  /**\n   * å„²å­˜éŸ³è¨Šæª”æ¡ˆ\n   * @param {Blob} blob - éŸ³è¨Š Blob\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @param {Object} metadata - å…ƒæ•¸æ“š\n   * @returns {Promise<string>} æª”æ¡ˆåç¨±\n   */\n  async save(blob, filename, metadata = {}) {\n    const formData = new FormData();\n    formData.append('audio-blob', blob);\n    formData.append('audio-filename', filename);\n    \n    if (metadata && Object.keys(metadata).length > 0) {\n      formData.append('metadata', JSON.stringify(metadata));\n    }\n    \n    try {\n      const response = await fetch(this.baseURL + this.saveEndpoint, {\n        method: 'POST',\n        body: formData,\n        headers: this.headers\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Upload failed: ${response.status} ${response.statusText}`);\n      }\n      \n      const result = await response.text();\n      \n      // æª¢æŸ¥ PHP ç«¯é»çš„å›æ‡‰ï¼ˆé€šå¸¸æ˜¯ 'success'ï¼‰\n      if (result.toLowerCase().includes('success')) {\n        return filename;\n      } else {\n        throw new Error(`Server error: ${result}`);\n      }\n    } catch (error) {\n      console.error('Save error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * è¼‰å…¥éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @returns {Promise<Blob>}\n   */\n  async load(filename) {\n    try {\n      const url = this.baseURL + this.loadEndpoint + filename;\n      const response = await fetch(url, {\n        headers: this.headers\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Load failed: ${response.status} ${response.statusText}`);\n      }\n      \n      return await response.blob();\n    } catch (error) {\n      console.error('Load error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆªé™¤éŸ³è¨Šæª”æ¡ˆ\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @returns {Promise<boolean>}\n   */\n  async delete(filename) {\n    try {\n      const response = await fetch(this.baseURL + this.deleteEndpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.headers\n        },\n        body: JSON.stringify({ filename })\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Delete failed: ${response.status} ${response.statusText}`);\n      }\n      \n      const result = await response.text();\n      return result.toLowerCase().includes('success');\n    } catch (error) {\n      console.error('Delete error:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * åˆ—å‡ºæ‰€æœ‰æª”æ¡ˆ\n   * @returns {Promise<Array>}\n   */\n  async list() {\n    try {\n      const response = await fetch(this.baseURL + this.listEndpoint, {\n        headers: this.headers\n      });\n      \n      if (!response.ok) {\n        throw new Error(`List failed: ${response.status} ${response.statusText}`);\n      }\n      \n      const data = await response.json();\n      return Array.isArray(data) ? data : [];\n    } catch (error) {\n      console.error('List error:', error);\n      // å¦‚æœå¾Œç«¯ä¸æ”¯æ´ list æ“ä½œï¼Œè¿”å›ç©ºé™£åˆ—\n      return [];\n    }\n  }\n  \n  /**\n   * ä½¿ç”¨ XMLHttpRequest ä¸Šå‚³ï¼ˆå¸¶é€²åº¦å›èª¿ï¼‰\n   * @param {Blob} blob - éŸ³è¨Š Blob\n   * @param {string} filename - æª”æ¡ˆåç¨±\n   * @param {Object} metadata - å…ƒæ•¸æ“š\n   * @param {Function} onProgress - é€²åº¦å›èª¿ (percent)\n   * @returns {Promise<string>}\n   */\n  async saveWithProgress(blob, filename, metadata = {}, onProgress = null) {\n    return new Promise((resolve, reject) => {\n      const formData = new FormData();\n      formData.append('audio-blob', blob);\n      formData.append('audio-filename', filename);\n      \n      if (metadata && Object.keys(metadata).length > 0) {\n        formData.append('metadata', JSON.stringify(metadata));\n      }\n      \n      const xhr = new XMLHttpRequest();\n      \n      // é€²åº¦äº‹ä»¶\n      if (onProgress) {\n        xhr.upload.addEventListener('progress', (e) => {\n          if (e.lengthComputable) {\n            const percent = (e.loaded / e.total) * 100;\n            onProgress(percent);\n          }\n        });\n      }\n      \n      // å®Œæˆäº‹ä»¶\n      xhr.addEventListener('load', () => {\n        if (xhr.status >= 200 && xhr.status < 300) {\n          const result = xhr.responseText;\n          if (result.toLowerCase().includes('success')) {\n            resolve(filename);\n          } else {\n            reject(new Error(`Server error: ${result}`));\n          }\n        } else {\n          reject(new Error(`Upload failed: ${xhr.status} ${xhr.statusText}`));\n        }\n      });\n      \n      // éŒ¯èª¤äº‹ä»¶\n      xhr.addEventListener('error', () => {\n        reject(new Error('Network error during upload'));\n      });\n      \n      // å–æ¶ˆäº‹ä»¶\n      xhr.addEventListener('abort', () => {\n        reject(new Error('Upload cancelled'));\n      });\n      \n      // ç™¼é€è«‹æ±‚\n      xhr.open('POST', this.baseURL + this.saveEndpoint);\n      \n      // è¨­å®šè‡ªå®šç¾© headers\n      Object.keys(this.headers).forEach(key => {\n        xhr.setRequestHeader(key, this.headers[key]);\n      });\n      \n      xhr.send(formData);\n    });\n  }\n}\n\nexport default ServerAdapter;\n","/**\n * Storage Module - å„²å­˜æ¨¡çµ„çµ±ä¸€å…¥å£\n * åŒ¯å‡ºæ‰€æœ‰å„²å­˜é©é…å™¨\n */\n\nexport { StorageAdapter } from './StorageAdapter.js';\nexport { IndexedDBAdapter } from './IndexedDBAdapter.js';\nexport { ServerAdapter } from './ServerAdapter.js';\nexport { ElectronAdapter } from './ElectronAdapter.js';\nexport { CapacitorAdapter } from './CapacitorAdapter.js';\n\n/**\n * StorageFactory - å„²å­˜é©é…å™¨å·¥å» \n * æ ¹æ“šé…ç½®è‡ªå‹•å‰µå»ºé©ç•¶çš„å„²å­˜é©é…å™¨\n */\nexport class StorageFactory {\n  /**\n   * å‰µå»ºå„²å­˜é©é…å™¨\n   * @param {Object} config - é…ç½®é¸é …\n   * @param {string} config.type - å„²å­˜é¡å‹ ('browser'|'electron'|'capacitor'|'server'|'auto')\n   * @param {Object} config.options - é©é…å™¨ç‰¹å®šé¸é …\n   * @returns {StorageAdapter}\n   */\n  static create(config = {}) {\n    const type = config.type || 'auto';\n    const options = config.options || {};\n    \n    // è‡ªå‹•åµæ¸¬\n    if (type === 'auto') {\n      return this.createAuto(options);\n    }\n    \n    // æ ¹æ“šé¡å‹å‰µå»º\n    switch (type.toLowerCase()) {\n      case 'browser':\n      case 'indexeddb':\n        const { IndexedDBAdapter } = require('./IndexedDBAdapter.js');\n        return new IndexedDBAdapter(\n          options.dbName,\n          options.storeName,\n          options.version\n        );\n      \n      case 'electron':\n        const { ElectronAdapter } = require('./ElectronAdapter.js');\n        return new ElectronAdapter(options.savePath);\n      \n      case 'capacitor':\n        const { CapacitorAdapter } = require('./CapacitorAdapter.js');\n        return new CapacitorAdapter(options.directory);\n      \n      case 'server':\n      case 'php':\n      case 'nodejs':\n        const { ServerAdapter } = require('./ServerAdapter.js');\n        return new ServerAdapter(options);\n      \n      default:\n        throw new Error(`Unknown storage type: ${type}`);\n    }\n  }\n  \n  /**\n   * è‡ªå‹•å‰µå»ºé©é…å™¨ï¼ˆæ ¹æ“šç’°å¢ƒï¼‰\n   * @param {Object} options - é¸é …\n   * @returns {StorageAdapter}\n   */\n  static createAuto(options = {}) {\n    // æª¢æŸ¥ Electron\n    if (typeof window !== 'undefined' && window.electronAPI) {\n      const { ElectronAdapter } = require('./ElectronAdapter.js');\n      return new ElectronAdapter(options.savePath);\n    }\n    \n    // æª¢æŸ¥ Capacitor\n    if (typeof window !== 'undefined' && window.Capacitor) {\n      const { CapacitorAdapter } = require('./CapacitorAdapter.js');\n      return new CapacitorAdapter(options.directory);\n    }\n    \n    // é è¨­ä½¿ç”¨ IndexedDBï¼ˆç€è¦½å™¨ï¼‰\n    const { IndexedDBAdapter } = require('./IndexedDBAdapter.js');\n    return new IndexedDBAdapter(\n      options.dbName,\n      options.storeName,\n      options.version\n    );\n  }\n}\n\nexport default StorageFactory;\n"],"names":["DeviceManager","constructor","options","this","micStorageKey","outputStorageKey","autoLoadPreferences","autoRequestPermission","microphoneDevices","outputDevices","selectedMicDeviceId","selectedOutputDeviceId","_eventListeners","devicechange","micchange","outputchange","_deviceChangeListener","loadPreferences","console","log","savedMicId","localStorage","getItem","savedOutputId","error","warn","savePreference","type","deviceId","setItem","isSupported","navigator","mediaDevices","enumerateDevices","requestMicrophonePermission","getUserMedia","Error","audio","getTracks","forEach","track","stop","message","enumerateMicrophones","requestPermission","devices","filter","device","kind","enumerateOutputDevices","enumerateAllDevices","microphones","outputs","Promise","all","selectMicrophone","save","_emit","selectOutputDevice","getSelectedMicrophoneId","getSelectedOutputDeviceId","getSelectedMicrophone","find","getSelectedOutputDevice","getMicrophoneConstraints","additionalConstraints","constraints","video","exact","setAudioOutputDevice","audioElement","targetDeviceId","setSinkId","isDeviceAvailable","some","startDeviceChangeMonitoring","async","addEventListener","stopDeviceChangeMonitoring","removeEventListener","on","event","callback","push","off","index","indexOf","splice","data","destroy","LiveWaveform","canvas","analyserNode","canvasContext","getContext","analyser","mediaStreamSource","animationId","isRunning","width","height","bufferLength","dataArray","amplification","_lastDataArray","_verticalScrollOffset","start","stream","audioContext","preGainNode","hasAudioContext","hasAnalyser","self","contextReady","resolve","state","resume","catch","err","then","disconnect","createMediaStreamSource","connect","e","fftSize","Uint8Array","draw","cancelAnimationFrame","clearRect","isVertical","requestAnimationFrame","getByteTimeDomainData","scrollSpeed","fillStyle","fillRect","lineWidth","strokeStyle","beginPath","sliceHeight","y","i","x","moveTo","lineTo","stroke","sliceWidth","VUMeter","ctx","timeData","Float32Array","levelDb","peakDb","holdPeakDb","lastPeakTime","peakHoldMillis","fallRateDbPerSec","minDb","maxDb","lastClipTime","clipHoldMillis","_lastLogTime","_computeLevels","rmsDb","required","length","getFloatTimeDomainData","sumSquares","peak","clipped","v","absV","Math","abs","rms","sqrt","log10","Infinity","performance","now","Date","resize","clear","currentDb","w","h","grd","createLinearGradient","addColorStop","norm","barGrad","barWidth","round","db","posNorm","xPos","label","toString","font","textAlign","textBaseline","fillText","restore","minus10Norm","minus10X","holdNorm","holdX","txt","toFixed","badgeW","badgeH","update","levels","elapsed","fallSeconds","fallAmount","max","loop","AccumulatedWaveform","targetSampleRate","sourceSampleRate","decimationFactor","sampleMin","sampleMax","sampleCount","zoomFactor","viewStart","isAutoScroll","_panRemainder","playbackPosition","isPlaying","playbackStartTime","playbackStartSample","rawZoomMode","rawViewStart","rawVisibleRaw","_useWorker","useWorker","_worker","_appendBatchMin","_appendBatchMax","_appendFlushScheduled","lastDetail","lastDensity","transferControlToOffscreen","Worker","workerPath","postMessage","verticalMode","showClipMarks","onmessage","ev","msg","detail","density","_setupMouseInteraction","isDragging","dragStartX","dragStartViewStart","offsetX","style","cursor","deltaX","samplesPerPixel","getVisibleSamples","visible","sampleDelta","_enforceViewBounds","preventDefault","rect","getBoundingClientRect","anchorRatio","clientX","left","zoomSteps","deltaY","zoomBySteps","info","clickRatio","clickedSample","floor","CustomEvent","sample","time","dispatchEvent","reset","append","audioSamples","factor","total","appendedMin","appendedMax","_lastAppendLog","blockSum","blockCount","j","blockMean","blockMin","blockMax","k","centeredSample","scrollToLatest","flush","_flushAppendBatch","setTimeout","minArr","maxArr","visibleSamples","min","end","centerY","yMin","yMax","minVis","_getMinVisibleSamples","setZoom","targetZoom","anchorSample","maxZoom","oldInfo","newInfo","desiredStart","stepCount","newZoom","pow","panBySamples","panByPixels","pixelDelta","totalDelta","intDelta","resetView","setSourceSampleRate","sampleRate","_getSamplePair","setPlaybackPosition","sampleIndex","setRawZoomMode","enabled","startPlayback","startSample","sr","updatePosition","rawSamples","decimatedPos","stopPlayback","_updatePlaybackPosition","OverviewWaveform","accumulatedWaveform","_workerRef","_warnedNoData","_lastTotal","acc","_handleSeek","clickX","targetSample","halfVisible","hasAcc","visibleStart","visibleEnd","canvasWidth","canvasHeight","viewStartX","viewEndX","viewWidth","strokeRect","StorageAdapter","blob","filename","metadata","load","id","delete","list","exists","files","count","file","VoiceBankRecorder","mergeOptions","initialized","storage","createStorageAdapter","isRecording","isPaused","currentBlob","container","initializeUI","defaults","layout","theme","channels","agc","gain","waveform","showOverview","showAccumulated","showLive","decimation","colors","selection","playback","callbacks","onRecordStart","onRecordStop","onRecordPause","onRecordResume","onPlayStart","onPlayStop","onError","deepMerge","target","source","result","key","Object","Array","isArray","storageConfig","StorageFactory","require","create","startRecording","stopRecording","pauseRecording","resumeRecording","play","saveRecording","blobToSave","filenameToUse","loadRecording","deleteRecording","listRecordings","recordings","getCurrentBlob","close","VERSION","BUILD_INFO","version","date","toISOString","name","config","autoGainControl","undefined","echoCancellation","noiseSuppression","micGain","workletPath","preferWorklet","autoManageDevices","deviceManager","_ownDeviceManager","mediaDest","analyserSilencer","workletSupported","workletLoaded","pcmCollectorNode","usingWorklet","pcmChunks","pcmTotalSamples","recorder","_pcmCaptureInterval","micStream","isInitialized","recordStartTime","recordStopTime","recordWallStartMs","recordWallStopMs","latestBlob","latestUrl","initialize","AudioContextClass","window","AudioContext","webkitAudioContext","createAnalyser","createGain","value","createMediaStreamDestination","destination","audioWorklet","AudioWorkletNode","addModule","path","stage","_stopMicrophone","_captureMicrophone","URL","revokeObjectURL","useWorklet","_startWorkletRecording","_startRecordRTCRecording","timestamp","mode","_stopWorkletRecording","_stopRecordRTCRecording","createObjectURL","duration","url","samples","getLatestRecording","getPcmWindow","out","offset","passed","chunk","cStart","cEnd","segStart","segEnd","localStart","slice","subarray","set","getAnalyser","getAudioContext","microphoneStream","setMicGain","dispose","_stopPcmCapture","handler","selectedId","JSON","stringify","_applyIOSMicGainAdjustment","usedDeviceId","audioTracks","getAudioTracks","actualDevice","ua","userAgent","test","port","pcmData","totalSamples","merged","wavBuffer","_buildWavFromFloat32Mono","Blob","reject","RecordRTC","recordStream","mimeType","recorderType","StereoAudioRecorder","numberOfAudioChannels","bufferSize","timeSlice","ondataavailable","_startPcmCapture","getBlob","setInterval","pcmChunk","clearInterval","float32Data","numSamples","buffer","ArrayBuffer","view","DataView","_writeString","setUint32","setUint16","int16","setInt16","string","setUint8","charCodeAt","directory","super","Capacitor","Filesystem","Directory","Plugins","readdir","Documents","mkdir","recursive","base64Data","blobToBase64","writeFile","keys","metadataWithDefaults","size","encoding","readFile","base64ToBlob","deleteFile","audioFiles","f","endsWith","map","metaResult","parse","sort","a","b","getUri","uri","reader","FileReader","onloadend","base64","split","onerror","readAsDataURL","byteCharacters","atob","byteNumbers","byteArray","getStorageInfo","totalSize","reduce","sum","r","totalSizeMB","savePath","electronAPI","arrayBuffer","from","success","filePath","uint8Array","openFile","saveAs","defaultFilename","showInFolder","dbName","storeName","request","indexedDB","open","onsuccess","onupgradeneeded","objectStoreNames","contains","store","createObjectStore","keyPath","autoIncrement","createIndex","unique","transaction","objectStore","record","add","String","get","Number","getAll","records","searchByFilename","toLowerCase","includes","countRequest","clearRequest","getStorageEstimate","estimate","usage","quota","usageMB","quotaMB","usagePercent","detect","process","versions","electron","isElectron","isCapacitor","isBrowser","isMobile","supportsAudioWorklet","prototype","supportsOffscreenCanvas","OffscreenCanvas","getInfo","platform","document","querySelector","audioEngine","waveformRenderer","elements","hasRecording","controlPanel","playbackController","layoutManager","renderUI","cacheElements","bindEvents","initializeSubControllers","applyInitialSettings","connectCoreModules","innerHTML","btnRecord","getElementById","btnPlay","btnPause","btnStop","btnSave","btnClear","btnLayoutToggle","recordingDuration","waveformWrapper","liveCanvas","vuMeterCanvas","accumulatedCanvas","overviewCanvas","handleRecordToggle","handlePlay","handlePause","handleStop","handleSave","handleClear","handleLayoutToggle","handleResize","applyLayout","applyTheme","updateButtonStates","onRecordingStart","onRecordingStop","onDataAvailable","onAudioError","showError","confirm","updateDurationDisplay","newLayout","dataset","setRecordingState","btn","classList","textContent","remove","disabled","formatDuration","toLocaleString","seconds","minutes","secs","decimal","padStart","innerWidth","innerHeight","setVerticalMode","alert","showNotice","getState","setOptions","baseURL","saveEndpoint","loadEndpoint","deleteEndpoint","listEndpoint","headers","formData","FormData","response","fetch","method","body","ok","status","statusText","text","json","saveWithProgress","onProgress","xhr","XMLHttpRequest","upload","lengthComputable","percent","loaded","responseText","setRequestHeader","send","createAuto","IndexedDBAdapter","ElectronAdapter","CapacitorAdapter","ServerAdapter","liveWaveform","vuMeter","overviewWaveform","isVerticalMode","_overviewUpdateScheduled","_setupAudioEngineListeners","stopLive","appendPCM","startLive","terminate"],"mappings":"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"}